[
  {
    "sha": "2ecb71f915d4505329c3e8f993f436a2cf031aa6",
    "filename": "grobid-core/src/main/java/org/grobid/core/document/DocumentNode.java",
    "status": "modified",
    "additions": 19,
    "deletions": 10,
    "changes": 29,
    "blob_url": "https://github.com/kermitt2/grobid/blob/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/main/java/org/grobid/core/document/DocumentNode.java",
    "raw_url": "https://github.com/kermitt2/grobid/raw/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/main/java/org/grobid/core/document/DocumentNode.java",
    "contents_url": "https://api.github.com/repos/kermitt2/grobid/contents/grobid-core/src/main/java/org/grobid/core/document/DocumentNode.java?ref=300efd318157817afce26c06cef0ee87bdc30e4d",
    "patch": "@@ -12,32 +12,33 @@\n  */\n \n public class DocumentNode {\n+    private Integer id = null;\n+\n     // Gorn address for tree structure\n     private String address = null;\n-\n     // real numbering of the section, if any\n-    private String realNumber = null;\n \n+    private String realNumber = null;\n     // normalized numbering of the section, if any\n-    private String normalizedNumber = null;\n \n+    private String normalizedNumber = null;\n     // the string attached to this document level, e.g. section title\n-    private String label = null;\n \n+    private String label = null;\n     // list of child document nodes\n-    private List<DocumentNode> children = null;\n \n+    private List<DocumentNode> children = null;\n     // offset relatively to the document tokenization (so token offset, NOT character offset)\n+\n     public int startToken = -1;\n     public int endToken = -1;\n-\n     // coordinates of the string attached to this document level, typically where an index link\n     // action point in the document\n-    private BoundingBox boundingBox = null;\n \n+    private BoundingBox boundingBox = null;\n     // parent document node, if null it is a root node\n-    private DocumentNode father = null;\n \n+    private DocumentNode father = null;\n     public DocumentNode() {\n     }\n \n@@ -128,8 +129,8 @@ public String toString() {\n     }\n \n     public String toString(int tab) {\n-        StringBuffer sb = new StringBuffer();\n-        sb.append(address + \" \" + label + \" \" + startToken + \" \" + endToken + \"\\n\");\n+        StringBuilder sb = new StringBuilder();\n+        sb.append(id).append(\" \").append(address).append(\" \").append(label).append(\" \").append(startToken).append(\" \").append(endToken).append(\"\\n\");\n \n         if (children != null) {\n             for (DocumentNode node : children) {\n@@ -169,6 +170,7 @@ public DocumentNode getSpanningNode(int position) {\n         }\n     }\n \n+\n     /*public DocumentNode nextSlibing() {\n          if ( (children != null) && (children.size() > 0) ) {\n              return children.get(0);\n@@ -182,5 +184,12 @@ else if (father == null) {\n              }\n          }\n      }*/\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n }\n "
  },
  {
    "sha": "57081fce9702eab2c78e8ffa2df83840e1ac4bfa",
    "filename": "grobid-core/src/main/java/org/grobid/core/sax/PDFALTOOutlineSaxHandler.java",
    "status": "modified",
    "additions": 18,
    "deletions": 12,
    "changes": 30,
    "blob_url": "https://github.com/kermitt2/grobid/blob/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/main/java/org/grobid/core/sax/PDFALTOOutlineSaxHandler.java",
    "raw_url": "https://github.com/kermitt2/grobid/raw/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/main/java/org/grobid/core/sax/PDFALTOOutlineSaxHandler.java",
    "contents_url": "https://api.github.com/repos/kermitt2/grobid/contents/grobid-core/src/main/java/org/grobid/core/sax/PDFALTOOutlineSaxHandler.java?ref=300efd318157817afce26c06cef0ee87bdc30e4d",
    "patch": "@@ -32,6 +32,7 @@\n \tprivate int currentParentId = -1;\n \n \tprivate Map<Integer,DocumentNode> nodes = null;\n+\tprivate Map<Integer, Integer> labels = new HashMap<>();\n \t\n \tpublic PDFALTOOutlineSaxHandler(Document doc) {\n \t\tthis.doc = doc;\n@@ -53,11 +54,14 @@ public void endElement(java.lang.String uri, java.lang.String localName,\n \t\t\tjava.lang.String qName) throws SAXException {\n \n \t\tif (qName.equals(\"STRING\")) {\n-\t\t\tlabel = getText();\n+\t\t    currentNode.setLabel(getText());\n+            currentNode.setBoundingBox(box);\n \t\t} else if (qName.equals(\"ITEM\")) {\n-\t\t\tcurrentNode.setLabel(label);\n-\t\t\tcurrentNode.setBoundingBox(box);\n-\t\t}\n+            box = null;\n+            label = null;\n+\t\t} else if (qName.equals(\"TOCITEMLIST\")) {\n+\t\t    currentParentId = -1;\n+        }\n \t}\n \t\n \tpublic void startElement(String namespaceURI, String localName,\n@@ -66,7 +70,7 @@ public void startElement(String namespaceURI, String localName,\n \t\t\t// this is the document root\n \t\t\troot = new DocumentNode();\n \t\t\tnodes = new HashMap<Integer,DocumentNode>();\n-\t\t} if (qName.equals(\"ITEM\")) {\n+\t\t} else if (qName.equals(\"ITEM\")) {\n \t\t\tcurrentNode = new DocumentNode();\n \t\t\t// get the node id \n \t\t\tint length = atts.getLength();\n@@ -78,7 +82,7 @@ public void startElement(String namespaceURI, String localName,\n \t\t\t\tString value = atts.getValue(i);\n \n \t\t\t\tif ((name != null) && (value != null)) {\n-\t\t\t\t\tif (name.equals(\"id\")) {\n+\t\t\t\t\tif (name.equalsIgnoreCase(\"id\")) {\n \t\t\t\t\t\ttry {\n \t\t\t\t\t\t\tcurrentId = Integer.parseInt(value);\n \t\t\t\t\t\t} catch(Exception e) {\n@@ -88,14 +92,16 @@ public void startElement(String namespaceURI, String localName,\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n-\t\t\t//currentNode.setId(currentId);\n+\t\t\tcurrentNode.setId(currentId);\n \t\t\tnodes.put(currentId,currentNode);\n \t\t\tif (currentParentId != -1) {\n \t\t\t\tDocumentNode father = nodes.get(currentParentId);\n-\t\t\t\tif (father == null)\n-\t\t\t\t\tSystem.out.println(\"Warning, father not yet encountered! id is \" + currentParentId);\n-\t\t\t\tcurrentNode.setFather(father);\n-\t\t\t\tfather.addChild(currentNode);\n+                if (father == null)\n+\t\t\t\t\tLOGGER.warn(\"Father not yet encountered! id is \" + currentParentId);\n+                else {\n+\t\t\t\t    currentNode.setFather(father);\n+\t\t\t\t    father.addChild(currentNode);\n+                }\n \t\t\t} else {\n \t\t\t\t// parent is the root node\n \t\t\t\tcurrentNode.setFather(root);\n@@ -211,4 +217,4 @@ public void startElement(String namespaceURI, String localName,\n \t\taccumulator.setLength(0);\n \t}\n \t\n-}\n\\ No newline at end of file\n+}"
  },
  {
    "sha": "55ff70622ad9a0353882f861eb8e52618e9c25b8",
    "filename": "grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxHandlerTest.java",
    "status": "added",
    "additions": 74,
    "deletions": 0,
    "changes": 74,
    "blob_url": "https://github.com/kermitt2/grobid/blob/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxHandlerTest.java",
    "raw_url": "https://github.com/kermitt2/grobid/raw/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxHandlerTest.java",
    "contents_url": "https://api.github.com/repos/kermitt2/grobid/contents/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxHandlerTest.java?ref=300efd318157817afce26c06cef0ee87bdc30e4d",
    "patch": "@@ -0,0 +1,74 @@\n+package org.grobid.core.sax;\n+\n+import org.grobid.core.document.Document;\n+import org.grobid.core.document.DocumentSource;\n+import org.grobid.core.document.DocumentNode;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import javax.xml.parsers.SAXParser;\n+import javax.xml.parsers.SAXParserFactory;\n+\n+import java.io.InputStream;\n+\n+import static org.easymock.EasyMock.createMock;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.nullValue;\n+import static org.hamcrest.collection.IsCollectionWithSize.hasSize;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+\n+public class PDFALTOOutlineSaxHandlerTest {\n+    SAXParserFactory spf = SAXParserFactory.newInstance();\n+\n+    PDFALTOOutlineSaxHandler target;\n+    DocumentSource mockDocumentSource;\n+    Document document;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+\n+        mockDocumentSource = createMock(DocumentSource.class);\n+\n+        document = Document.createFromText(\"\");\n+        target = new PDFALTOOutlineSaxHandler(document);\n+    }\n+\n+    @Test\n+    public void testParsing_pdf2XMLOutline_ShouldWork() throws Exception {\n+        InputStream is = this.getClass().getResourceAsStream(\"pdfalto.xml_outline.xml\");\n+\n+        SAXParser p = spf.newSAXParser();\n+        p.parse(is, target);\n+\n+        DocumentNode root = target.getRootNode();\n+        assertTrue(root.getChildren().size() > 0);\n+        assertThat(root.getChildren(), hasSize(9));\n+    }\n+\n+    @Test\n+    public void testParsing_pdf2XMLOutline_errorcase_ShouldWork() throws Exception {\n+        InputStream is = this.getClass().getResourceAsStream(\"test_outline.xml\");\n+\n+        SAXParser p = spf.newSAXParser();\n+        p.parse(is, target);\n+\n+        DocumentNode root = target.getRootNode();\n+        assertThat(root.getChildren(), hasSize(5));\n+        assertThat(root.getChildren().get(0).getLabel(), is(\"A Identification\"));\n+        assertThat(root.getChildren().get(0).getChildren(), is(nullValue()));\n+        assertThat(root.getChildren().get(1).getLabel(), is(\"B Résumé consolidé public.\"));\n+        assertThat(root.getChildren().get(1).getChildren(), hasSize(1));\n+        assertThat(root.getChildren().get(2).getLabel(), is(\"C Mémoire scientifique en français\"));\n+        assertThat(root.getChildren().get(2).getChildren(), hasSize(6));\n+        assertThat(root.getChildren().get(2).getChildren().get(2).getLabel(), is(\"C.3 Approche scientifique et technique\"));\n+        assertThat(root.getChildren().get(3).getLabel(), is(\"D Liste des livrables\"));\n+        assertThat(root.getChildren().get(3).getChildren(), is(nullValue()));\n+        assertThat(root.getChildren().get(4).getLabel(), is(\"E Impact du projet\"));\n+        assertThat(root.getChildren().get(4).getChildren(), hasSize(4));\n+        assertThat(root.getChildren().get(4).getChildren().get(1).getLabel(), is(\"E.2 Liste des publications et communications\"));\n+        assertThat(root.getChildren().get(4).getChildren().get(2).getLabel(), is(\"E.3 Liste des autres valorisations scientifiques\"));\n+\n+    }\n+\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "247425328b8609ccb4500c917de6ea0e0a0d3604",
    "filename": "grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxParserTest.java",
    "status": "removed",
    "additions": 0,
    "deletions": 47,
    "changes": 47,
    "blob_url": "https://github.com/kermitt2/grobid/blob/bfc10f77998a141e14e1a88483ef42954e0d30b2/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxParserTest.java",
    "raw_url": "https://github.com/kermitt2/grobid/raw/bfc10f77998a141e14e1a88483ef42954e0d30b2/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxParserTest.java",
    "contents_url": "https://api.github.com/repos/kermitt2/grobid/contents/grobid-core/src/test/java/org/grobid/core/sax/PDFALTOOutlineSaxParserTest.java?ref=bfc10f77998a141e14e1a88483ef42954e0d30b2",
    "patch": "@@ -1,47 +0,0 @@\n-package org.grobid.core.sax;\n-\n-import org.grobid.core.document.Document;\n-import org.grobid.core.document.DocumentSource;\n-import org.grobid.core.document.DocumentNode;\n-import org.junit.Before;\n-import org.junit.Test;\n-\n-import javax.xml.parsers.SAXParser;\n-import javax.xml.parsers.SAXParserFactory;\n-\n-import java.io.InputStream;\n-\n-import static org.easymock.EasyMock.createMock;\n-import static org.hamcrest.collection.IsCollectionWithSize.hasSize;\n-import static org.junit.Assert.assertThat;\n-import static org.junit.Assert.assertTrue;\n-\n-public class PDFALTOOutlineSaxParserTest {\n-    SAXParserFactory spf = SAXParserFactory.newInstance();\n-\n-    PDFALTOOutlineSaxHandler target;\n-    DocumentSource mockDocumentSource;\n-    Document document;\n-\n-    @Before\n-    public void setUp() throws Exception {\n-\n-        mockDocumentSource = createMock(DocumentSource.class);\n-\n-        document = Document.createFromText(\"\");\n-        target = new PDFALTOOutlineSaxHandler(document);\n-    }\n-\n-    @Test\n-    public void testParsing_pdf2XMLOutline_ShouldWork() throws Exception {\n-        InputStream is = this.getClass().getResourceAsStream(\"pdfalto.xml_outline.xml\");\n-\n-        SAXParser p = spf.newSAXParser();\n-        p.parse(is, target);\n-\n-        DocumentNode root = target.getRootNode();\n-        assertTrue(root.getChildren().size() > 0);\n-        assertThat(root.getChildren(), hasSize(9));\n-    }\n-\n-}\n\\ No newline at end of file"
  },
  {
    "sha": "be55ae88fae20255ec613d7addefb82a30fcf361",
    "filename": "grobid-core/src/test/resources/org/grobid/core/sax/test_outline.xml",
    "status": "added",
    "additions": 75,
    "deletions": 0,
    "changes": 75,
    "blob_url": "https://github.com/kermitt2/grobid/blob/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/test/resources/org/grobid/core/sax/test_outline.xml",
    "raw_url": "https://github.com/kermitt2/grobid/raw/300efd318157817afce26c06cef0ee87bdc30e4d/grobid-core/src/test/resources/org/grobid/core/sax/test_outline.xml",
    "contents_url": "https://api.github.com/repos/kermitt2/grobid/contents/grobid-core/src/test/resources/org/grobid/core/sax/test_outline.xml?ref=300efd318157817afce26c06cef0ee87bdc30e4d",
    "patch": "@@ -0,0 +1,75 @@\n+<?xml version=\"1.0\"?>\n+<TOCITEMS nbPages=\"4\">\n+    <TOCITEMLIST level=\"0\">\n+        <ITEM ID=\"0\">\n+            <STRING>A Identification</STRING>\n+            <LINK page=\"2\" top=\"71.0000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+        </ITEM>\n+        <ITEM ID=\"1\">\n+            <STRING>B R&#xE9;sum&#xE9; consolid&#xE9; public.</STRING>\n+            <LINK page=\"2\" top=\"377.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+            <TOCITEMLIST level=\"1\" idItemParent=\"1\">\n+                <ITEM ID=\"2\">\n+                    <STRING>B.1 R&#xE9;sum&#xE9; consolid&#xE9; public en fran&#xE7;ais</STRING>\n+                    <LINK page=\"2\" top=\"412.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+            </TOCITEMLIST>\n+        </ITEM>\n+        <ITEM ID=\"3\">\n+            <STRING>C M&#xE9;moire scientifique en fran&#xE7;ais</STRING>\n+            <LINK page=\"1\" top=\"71.0000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+            <TOCITEMLIST level=\"1\" idItemParent=\"3\">\n+                <ITEM ID=\"4\">\n+                    <STRING>C.1 R&#xE9;sum&#xE9; du m&#xE9;moire</STRING>\n+                    <LINK page=\"1\" top=\"109.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"5\">\n+                    <STRING>C.2 Enjeux et probl&#xE9;matique, &#xE9;tat de l&#x2019;art</STRING>\n+                    <LINK page=\"1\" top=\"334.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"6\">\n+                    <STRING>C.3 Approche scientifique et technique</STRING>\n+                    <LINK page=\"1\" top=\"235.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"7\">\n+                    <STRING>C.4 R&#xE9;sultats obtenus</STRING>\n+                    <LINK page=\"1\" top=\"264.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"8\">\n+                    <STRING>C.5 Discussion, conclusion</STRING>\n+                    <LINK page=\"1\" top=\"357.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"9\">\n+                    <STRING>C.6 R&#xE9;f&#xE9;rences</STRING>\n+                    <LINK page=\"1\" top=\"582.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+            </TOCITEMLIST>\n+        </ITEM>\n+        <ITEM ID=\"10\">\n+            <STRING>D Liste des livrables</STRING>\n+            <LINK page=\"1\" top=\"71.0000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+        </ITEM>\n+        <ITEM ID=\"11\">\n+            <STRING>E Impact du projet</STRING>\n+            <LINK page=\"1\" top=\"649.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+            <TOCITEMLIST level=\"1\" idItemParent=\"11\">\n+                <ITEM ID=\"12\">\n+                    <STRING>E.1 Indicateurs d&#x2019;impact</STRING>\n+                    <LINK page=\"1\" top=\"368.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"13\">\n+                    <STRING>E.2 Liste des publications et communications</STRING>\n+                    <LINK page=\"1\" top=\"317.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"14\">\n+                    <STRING>E.3 Liste des autres valorisations scientifiques</STRING>\n+                    <LINK page=\"1\" top=\"170.000\" bottom=\"0.0000\" left=\"68.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+                <ITEM ID=\"15\">\n+                    <STRING>E.4 Bilan et suivi des personnels recrut&#xE9;s en CDD (hors stagiaires)</STRING>\n+                    <LINK page=\"1\" top=\"318.000\" bottom=\"0.0000\" left=\"40.0000\" right=\"0.0000\"/>\n+                </ITEM>\n+            </TOCITEMLIST>\n+        </ITEM>\n+    </TOCITEMLIST>\n+</TOCITEMS>"
  }
]
