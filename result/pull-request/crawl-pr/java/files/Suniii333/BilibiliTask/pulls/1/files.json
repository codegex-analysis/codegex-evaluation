[
  {
    "sha": "2a6c036ffed2ce28af6584c3440410e5200cb05e",
    "filename": ".github/workflows/avoid.yml",
    "status": "added",
    "additions": 32,
    "deletions": 0,
    "changes": 32,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/.github/workflows/avoid.yml",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/.github/workflows/avoid.yml",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/.github/workflows/avoid.yml?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -0,0 +1,32 @@\n+name: 'Avoid workflow being suspended'\n+\n+on:\n+  workflow_dispatch:\n+  schedule:\n+    - cron: '0 0 1 * *'\n+\n+jobs:\n+  avoid_workflow_suspended:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: 'Checkout codes'\n+        uses: actions/checkout@v2\n+      \n+      - name: 'Avoid Github Workflow being suspended'\n+        run: echo $(cat /proc/sys/kernel/random/uuid) > UUID.txt\n+      \n+      - name: 'Commit Files'\n+        id: commit\n+        run: |\n+          git config --local user.email \"action@github.com\"\n+          git config --local user.name \"GitHub Action\"\n+          git add .\n+          git diff --quiet && git diff --staged --quiet || git commit -am 'avoid being suspended'\n+          echo ::set-output name=status::success\n+           \n+      - name: 'GitHub Push'\n+        if: steps.commit.output.status != 'success'\n+        uses: ad-m/github-push-action@v0.6.0\n+        with:\n+          github_token: ${{ secrets.GITHUB_TOKEN }}\n+          branch: ${{ github.ref }}"
  },
  {
    "sha": "0cdfec762beae6d4ee54b733e15a7f49ea720cc8",
    "filename": ".idea/inspectionProfiles/Project_Default.xml",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/.idea/inspectionProfiles/Project_Default.xml",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/.idea/inspectionProfiles/Project_Default.xml",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/.idea/inspectionProfiles/Project_Default.xml?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -30,7 +30,7 @@\n       <option name=\"IGNORE_JAVADOC_PERIOD\" value=\"true\" />\n       <option name=\"IGNORE_DUPLICATED_THROWS\" value=\"false\" />\n       <option name=\"IGNORE_POINT_TO_ITSELF\" value=\"false\" />\n-      <option name=\"myAdditionalJavadocTags\" value=\"Time,date\" />\n+      <option name=\"myAdditionalJavadocTags\" value=\"Time,date,base\" />\n     </inspection_tool>\n   </profile>\n </component>\n\\ No newline at end of file"
  },
  {
    "sha": "18448d955074f652a35e7a7d8644823858980509",
    "filename": "Dockerfile",
    "status": "added",
    "additions": 13,
    "deletions": 0,
    "changes": 13,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/Dockerfile",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/Dockerfile",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/Dockerfile?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -0,0 +1,13 @@\n+FROM anapsix/alpine-java:8u201b09_jdk_unlimited\n+\n+WORKDIR /app\n+COPY . /app\n+\n+RUN crontab -l | { cat; echo \"1 8 * * * java -jar /app/BilibiliTask-1.0.9-all.jar >> /var/log/bilibili_task.log 2>&1\"; } | crontab -\n+RUN touch /var/log/bilibili_task.log\n+\n+RUN sh gradlew clean build\n+RUN cp /app/build/libs/*.jar /app/\n+RUN sh gradlew clean\n+\n+CMD crond && tail -f /var/log/bilibili_task.log"
  },
  {
    "sha": "0c6f553221eeaecef91e65707dd70e0e2fab3178",
    "filename": "README.md",
    "status": "modified",
    "additions": 33,
    "deletions": 2,
    "changes": 35,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/README.md",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/README.md",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/README.md?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -32,18 +32,20 @@\n * [x] 支持功能自定义(自定义投币数量，银瓜子兑换硬币开关等)\n * [x] 账户失效提醒(发送到你的微信或者钉钉提醒、邮箱提醒)\n * [x] 支持多种方式推送运行结果(钉钉、微信)\n+* [x] 支持Docker自己部署\n \n # 目录\n \n - [简介](#简介)\n - [功能](#功能)\n - [目录](#目录)\n-- [使用方法](#使用方法)\n+- [Github Actions部署方法](#github-actions-部署方法)\n   - [1.fork本项目](#1fork本项目)\n   - [2.准备需要的参数](#2准备需要的参数)\n   - [3.将获取到参数填到Secrets](#3将获取到参数填到secrets)\n   - [4.开启actions](#4开启actions)\n   - [5.进行一次push操作](#5进行一次push操作)\n+- [Docker部署方法](#Docker部署方法)\n - [进阶使用](#进阶使用)\n   - [1.配置文件说明](#1配置文件说明)\n   - [2.推送运行结果到微信](#2推送运行结果到微信)\n@@ -61,7 +63,7 @@\n ✔ | 本次程序运行，成功的执行了代码，并完成了任务(例如，分享视频，今日未分享过，那么程序就应该请求分享视频的接口，协助完成分享视频的任务)。\n ❌ | 可能两种操作会出现这个符号。1.程序成功的执行了，尝试去完成任务，但是中途遇到了未知的失败。2.程序成功的执行了，检测到此类任务已经完成(例如，分享视频，今日已经分享过，那么程序不应该请求分享视频的接口，无需协助完成分享视频的任务)，就无需再去完成。可以理解为跳过或遇到错误。\n \n-# 使用方法\n+# Github Actions 部署方法\n \n ## 1.fork本项目\n \n@@ -157,6 +159,18 @@ selectLike: 0\n \n 如实在没有想给他投币的up主，可以考虑把我填上哦 `477137547` 😄\n \n+# Docker部署方法\n+\n+* 使用如下命令请自行替换所需的环境变量\n+* **每天00:01分运行程序**\n+```(shell script)\n+docker run -d \\\n+  --env BILI_JCT=自行填写 \\\n+  --env DEDEUSERID=自行填写 \\\n+  --env SESSDATA=自行填写 \\\n+  timmyovo/bilibilitask\n+```\n+\n ## 2.推送运行结果到微信\n \n ### 使用`server`酱将程序运行结果推送到微信\n@@ -239,6 +253,13 @@ TELEGRAM_CHAT_ID   | xxxxx\n \n ![](img/自定义程序运行时间.png)\n \n+# Docker\n+\n+* **每天00:01分运行程序**\n+```\n+docker run -d --env BILI_JCT=自行填写 --env DEDEUSERID=自行填写 --env SESSDATA=自行填写 timmyovo/bilibilitask\n+```\n+\n # 如何拉取最新代码\n \n ## 方法一\n@@ -285,6 +306,16 @@ git push origin main\n \n # 更新日志\n \n+## 2020-02-06\n+\n++ 避免投币给单一`up`主\n+\n++ 更新`b`币卷充电接口\n+\n++ 修复投币计算(投币数为负数)\n+\n++ 修复近30天未投币出现的bug\n+\n ## 2020-12-17\n \n + 增加`server`酱测试号版推送，感谢[sh4wnzec](https://github.com/sh4wnzec)"
  },
  {
    "sha": "f86eb23df9f58bf8c2c3d9f6e310dc1d9fc0df02",
    "filename": "UUID.txt",
    "status": "added",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/UUID.txt",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/UUID.txt",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/UUID.txt?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -0,0 +1 @@\n+b4dbbeec-03a1-4b2d-a5eb-49895bbfeacd"
  },
  {
    "sha": "274f0b4780ab6fecb84e5320af16d8c20a468aae",
    "filename": "build.gradle",
    "status": "modified",
    "additions": 12,
    "deletions": 1,
    "changes": 13,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/build.gradle",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/build.gradle",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/build.gradle?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -1,10 +1,11 @@\n plugins {\n     id 'java'\n     id \"io.freefair.lombok\" version '5.3.0'\n+    id 'com.github.johnrengelman.shadow' version '6.1.0'\n }\n \n group = 'top.srcrs'\n-version = '1.0.8'\n+version = '1.0.9'\n sourceCompatibility = JavaVersion.VERSION_1_8\n \n configurations {\n@@ -41,6 +42,16 @@ dependencies {\n     testImplementation junit\n }\n \n+jar {\n+    manifest {\n+        attributes(\"Main-Class\": \"top.srcrs.BiliStart\")\n+    }\n+}\n+\n+artifacts {\n+    archives shadowJar\n+}\n+\n test {\n     useJUnitPlatform()\n }"
  },
  {
    "sha": "1526f75e3c5c2cf9c1841c5e738271f4647b796d",
    "filename": "gradle/wrapper/gradle-wrapper.properties",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/gradle/wrapper/gradle-wrapper.properties",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/gradle/wrapper/gradle-wrapper.properties",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/gradle/wrapper/gradle-wrapper.properties?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -1,5 +1,5 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n-distributionUrl=https\\://services.gradle.org/distributions/gradle-6.7.1-bin.zip\n+distributionUrl=https\\://downloads.gradle-dn.com/distributions/gradle-6.7.1-bin.zip\n zipStoreBase=GRADLE_USER_HOME\n zipStorePath=wrapper/dists\n\\ No newline at end of file"
  },
  {
    "sha": "51442837f1ccc7310d594b164914b8f42fd2ddfb",
    "filename": "img/server酱推送的结果.jpg",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/server%E9%85%B1%E6%8E%A8%E9%80%81%E7%9A%84%E7%BB%93%E6%9E%9C.jpg",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/server%E9%85%B1%E6%8E%A8%E9%80%81%E7%9A%84%E7%BB%93%E6%9E%9C.jpg",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/server%E9%85%B1%E6%8E%A8%E9%80%81%E7%9A%84%E7%BB%93%E6%9E%9C.jpg?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "b80be89ac2b179697682ebe3ca7eee86f5b8da12",
    "filename": "img/开启actions.gif",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E5%BC%80%E5%90%AFactions.gif",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E5%BC%80%E5%90%AFactions.gif",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E5%BC%80%E5%90%AFactions.gif?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "e5af20a70260605f1df630dfb185bc0c1b8527af",
    "filename": "img/添加Secrets.png",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E6%B7%BB%E5%8A%A0Secrets.png",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E6%B7%BB%E5%8A%A0Secrets.png",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E6%B7%BB%E5%8A%A0Secrets.png?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "edba2c4d8f743279e16a2a31b0ceaf5265777bf4",
    "filename": "img/自定义程序运行时间.png",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4.png",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4.png",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4.png?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "c416cd5bd4c7b5d10e28014a0776e4f468a419ef",
    "filename": "img/获取Cookie.png",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%8E%B7%E5%8F%96Cookie.png",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%8E%B7%E5%8F%96Cookie.png",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E8%8E%B7%E5%8F%96Cookie.png?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "63c4916adad69fc9e35dca5b2a36ddd29a4e654d",
    "filename": "img/获取钉钉Webhook.gif",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%8E%B7%E5%8F%96%E9%92%89%E9%92%89Webhook.gif",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%8E%B7%E5%8F%96%E9%92%89%E9%92%89Webhook.gif",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E8%8E%B7%E5%8F%96%E9%92%89%E9%92%89Webhook.gif?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "4b609cf44e46e8c6fe37971ab828fcd4aa59d6dd",
    "filename": "img/运行结果.gif",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.gif",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.gif",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.gif?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "e8f995288ec35c3da61ee88c50777eaddd8c6848",
    "filename": "img/进行一次push操作.gif",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%BF%9B%E8%A1%8C%E4%B8%80%E6%AC%A1push%E6%93%8D%E4%BD%9C.gif",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/img/%E8%BF%9B%E8%A1%8C%E4%B8%80%E6%AC%A1push%E6%93%8D%E4%BD%9C.gif",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/img/%E8%BF%9B%E8%A1%8C%E4%B8%80%E6%AC%A1push%E6%93%8D%E4%BD%9C.gif?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e"
  },
  {
    "sha": "5d6c2fbc57f7327f40f343e38f87477d1c98b62e",
    "filename": "src/main/java/top/srcrs/BiliStart.java",
    "status": "modified",
    "additions": 4,
    "deletions": 7,
    "changes": 11,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/BiliStart.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/BiliStart.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/main/java/top/srcrs/BiliStart.java?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -86,7 +86,7 @@ public static void main(String ...args) {\n      */\n     private static void scanTask() {\n         List<Class<?>> clazzList = new ArrayList<>();\n-        PackageScanner pack = new PackageScanner() {\n+        TaskRegistry pack = new TaskRegistry() {\n             @Override\n             public void dealClass(String className) {\n                 try{\n@@ -100,10 +100,10 @@ public void dealClass(String className) {\n                 }\n             }\n         };\n-        pack.scannerPackage(\"top.srcrs.task\");\n+        pack.runTasks();\n \n         clazzList.stream().sorted(Comparator.comparing(Class::getName)).forEach(clazz -> {\n-            try{\n+            try {\n                 Constructor<?> constructor = clazz.getConstructor();\n                 Object object = constructor.newInstance();\n                 Method method = object.getClass().getMethod(\"run\");\n@@ -115,13 +115,10 @@ public void dealClass(String className) {\n     }\n \n     public static boolean checkEnv() {\n-\n         String BILI_JCT = System.getenv(\"BILI_JCT\");\n         String SESSDATA = System.getenv(\"SESSDATA\");\n         String DEDEUSERID = System.getenv(\"DEDEUSERID\");\n-        USER_DATA.setCookie(System.getenv(\"BILI_JCT\"),\n-                System.getenv(\"SESSDATA\"),\n-                System.getenv(\"DEDEUSERID\"));\n+        USER_DATA.setCookie(BILI_JCT, SESSDATA, DEDEUSERID);\n         return StringUtil.isAnyBlank(BILI_JCT, SESSDATA, DEDEUSERID);\n     }\n "
  },
  {
    "sha": "373da51bebe593b82efdcafc76234b73637b78ed",
    "filename": "src/main/java/top/srcrs/task/daily/ThrowCoinTask.java",
    "status": "modified",
    "additions": 61,
    "deletions": 4,
    "changes": 65,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/task/daily/ThrowCoinTask.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/task/daily/ThrowCoinTask.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/main/java/top/srcrs/task/daily/ThrowCoinTask.java?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -11,6 +11,7 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.Random;\n+import java.util.stream.Collectors;\n \n /**\n  * 进行视频投币\n@@ -28,6 +29,8 @@ public void run() {\n         try {\n             /* 今天投币获得了多少经验 */\n             int reward = getReward();\n+            /* 更新每天登录后所能领取的登录硬币奖励 */\n+            updateMoney();\n             /* 还剩多少个硬币 */\n             int num2 = USER_DATA.getMoney().intValue();\n             /* 配置类中设置投币数 */\n@@ -36,7 +39,7 @@ public void run() {\n                当今日已经投过 num3 个硬币将不再进行投币\n                否则则应该投 (num3-num1) 个硬币\n             */\n-            int num1 = (num3*10 - reward) / 10;\n+            int num1 = Math.max((num3*10 - reward) / 10,0);\n             /* 避免设置投币数为负数异常 */\n             num3 = Math.max(num3,0);\n             /* 实际需要投 num个硬币 */\n@@ -57,9 +60,9 @@ public void run() {\n             /* 获取自定义配置中 up 主投稿的30条最新视频 */\n             if(config.getUpList() == null && num > 0){\n                 log.info(\"【优先投币up】: 未配置优先投币up主\");\n-            } else{\n+            } else {\n                 if(num - videoAid.size() > 0){\n-                    for(String up : config.getUpList()){\n+                    for(String up : getTodayUpList(num)) {\n                         videoAid.addAll(spaceSearch(up,num - videoAid.size()));\n                         log.info(\"【优先投币up {} 】: 成功获取到: {} 个视频\", up, videoAid.size());\n                     }\n@@ -82,7 +85,7 @@ public void run() {\n                 String aid = videoAid.get(i);\n                 JSONObject json = throwCoin(aid, \"1\", config.getSelectLike());\n                 /* 输出的日志消息 */\n-                String msg ;\n+                String msg;\n                 if (\"0\".equals(json.getString(\"code\"))) {\n                     msg = \"硬币-1✔\";\n                 } else {\n@@ -97,6 +100,16 @@ public void run() {\n         }\n     }\n \n+    /**\n+     * 更新每天登录后所能领取的登录硬币奖励\n+     * @author Arriv9l\n+     * @Time 2021-01-24\n+     */\n+    public void updateMoney() {\n+        JSONObject jsonObject = Request.get(\"https://api.bilibili.com/x/web-interface/nav\");\n+        USER_DATA.setMoney(jsonObject.getJSONObject(\"data\").getBigDecimal(\"money\"));\n+    }\n+\n     /**\n      * 给视频投币\n      * @param aid         视频 aid 号\n@@ -211,6 +224,50 @@ private boolean isThrowCoins(String aid, String mid){\n         return multiply == 0;\n     }\n \n+    /**\n+     * 获取用户30天内投过硬币的视频\n+     * @return JSONArray 用户30天内投过硬币的视频\n+     * @author Arriv9l\n+     * @base https://github.com/SocialSisterYi/bilibili-API-collect/blob/master/user/space.md#获取用户最近投币的视频明细\n+     * @Time 2021-01-24\n+     */\n+    private JSONArray getThrowCoinVideoList() {\n+        JSONObject pJson = new JSONObject();\n+        pJson.put(\"vmid\", System.getenv(\"DEDEUSERID\"));\n+        JSONObject object = Request.get(\"http://api.bilibili.com/x/space/coin/video\", pJson);\n+        return object.getJSONArray(\"data\");\n+    }\n+\n+    /**\n+     * 获取今天可投币的自定义配置 up 主\n+     * @param num 需要投币的数量\n+     * @return List<String> 今天可投币的自定义配置 up 主\n+     * @author Arriv9l\n+     * @base https://juejin.cn/post/6844903833726894093\n+     * @Time 2021-01-24\n+     */\n+    private List<String> getTodayUpList(int num) {\n+        JSONArray vList = getThrowCoinVideoList();\n+        List<String> configUpList = config.getUpList();\n+        List<String> upList = new ArrayList<>();\n+        // 近30天未投币直接跳过\n+        if(vList==null){\n+            return new ArrayList<>(configUpList);\n+        }\n+        for (Object object : vList) {\n+            JSONObject data = (JSONObject) object;\n+            String mid = data.getJSONObject(\"owner\").getString(\"mid\");\n+            if (configUpList.contains(mid) && !upList.contains(mid)) {\n+                upList.add(mid);\n+                if (upList.size() + num == configUpList.size()) {\n+                    break;\n+                }\n+            }\n+        }\n+        /* 求 configUpList 与 upList 的差集 */\n+        return configUpList.stream().filter(item -> !upList.contains(item)).collect(Collectors.toList());\n+    }\n+\n     /**\n      * 获取 up 主的最新30条视频投稿信息\n      * 从中挑选从未投币的视频进行投币"
  },
  {
    "sha": "20592d30b4424beb42abbbabf3f248f00ab93c09",
    "filename": "src/main/java/top/srcrs/util/PackageScanner.java",
    "status": "removed",
    "additions": 0,
    "deletions": 74,
    "changes": 74,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/d867ab384f25b53a490c1926c01ffc84db979aec/src/main/java/top/srcrs/util/PackageScanner.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/d867ab384f25b53a490c1926c01ffc84db979aec/src/main/java/top/srcrs/util/PackageScanner.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/main/java/top/srcrs/util/PackageScanner.java?ref=d867ab384f25b53a490c1926c01ffc84db979aec",
    "patch": "@@ -1,74 +0,0 @@\n-package top.srcrs.util;\n-\n-import lombok.extern.slf4j.Slf4j;\n-\n-import java.io.File;\n-import java.net.URL;\n-import java.util.Enumeration;\n-\n-/**\n- * 扫描task包下的所有的class文件\n- * @author srcrs\n- * @Time 2020-10-13\n- */\n-@Slf4j\n-public abstract class PackageScanner {\n-\n-    /**\n-     * 将 . 路径换为 / 路径\n-     * @param packageName 包名\n-     * @author srcrs\n-     * @Time 2020-10-13\n-     */\n-    public void scannerPackage(String packageName) {\n-        String packagePath = packageName.replace('.', '/');\n-        /* 真正的路径中是以 / 或 \\ 相隔，此路径以 \\ 相隔 */\n-        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();\n-        try {\n-            Enumeration<URL> resources = classLoader.getResources(packagePath);\n-            /* 得到绝对路径 */\n-            while (resources.hasMoreElements()) {\n-                URL url = resources.nextElement();\n-                File root = new File(url.toURI());\n-                /* 将url转化成uri，以此创建File对象，后面解析就变成了对File的处理 */\n-                scannerDirectory(root, packageName);\n-            }\n-        } catch (Exception e) {\n-            log.error(\"💔扫包错误 : \", e);\n-        }\n-    }\n-\n-    /**\n-     * 递归搜索target路径下所有的class文件\n-     * @param currentFile java文件生成的class文件路径\n-     * @param packageName 包名\n-     * @author srcrs\n-     * @Time 2020-10-13\n-     */\n-    private void scannerDirectory(File currentFile, String packageName) {\n-        if (!currentFile.isDirectory()) {\n-            return;\n-        }\n-        File[] files = currentFile.listFiles();\n-        /* 得到File对象类型的【完整路径】的数组 */\n-        for (File file : files != null ? files : new File[0]) {\n-            if (file.isFile() && file.getName().endsWith(\".class\")) {\n-                String fileName = file.getName().replace(\".class\", \"\");\n-                /* 去除掉后缀 .class */\n-                String className = packageName + \".\" + fileName;\n-                /* 得到带包名的类，为取得元类对象做准备 */\n-                dealClass(className);\n-                /* 将得到的元类对象通过抽象方法参数传递给用户，以便用户后续操作。 */\n-            } else if (file.isDirectory()) {\n-                scannerDirectory(file, packageName + \".\" + file.getName());\n-                /* 此处采用递归，只要是目录就继续往下一层遍历，直到file.isFile()为true,且以.class结尾 */\n-            }\n-        }\n-    }\n-\n-    /**\n-     * 获得真实的className\n-     * @param className className\n-     */\n-    public abstract void dealClass(String className);\n-}"
  },
  {
    "sha": "43d59befee7e828c8f3449152061f3ebe7414bea",
    "filename": "src/main/java/top/srcrs/util/TaskRegistry.java",
    "status": "added",
    "additions": 50,
    "deletions": 0,
    "changes": 50,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/util/TaskRegistry.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/java/top/srcrs/util/TaskRegistry.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/main/java/top/srcrs/util/TaskRegistry.java?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -0,0 +1,50 @@\n+package top.srcrs.util;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import top.srcrs.Task;\n+import top.srcrs.task.bigvip.BiCoinApply;\n+import top.srcrs.task.bigvip.CollectVipGift;\n+import top.srcrs.task.daily.DailyTask;\n+import top.srcrs.task.daily.ThrowCoinTask;\n+import top.srcrs.task.live.BiLiveTask;\n+import top.srcrs.task.live.GiveGiftTask;\n+import top.srcrs.task.live.Silver2CoinTask;\n+import top.srcrs.task.manga.MangaTask;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/**\n+ * 运行所有已注册的Task\n+ *\n+ * @author srcrs\n+ * @Time 2020-10-13\n+ */\n+@Slf4j\n+public abstract class TaskRegistry {\n+\n+    private static final List<Class<? extends Task>> REGISTERED_TASKS = Arrays.asList(\n+            BiCoinApply.class,\n+            CollectVipGift.class,\n+            DailyTask.class,\n+            ThrowCoinTask.class,\n+            BiLiveTask.class,\n+            GiveGiftTask.class,\n+            Silver2CoinTask.class,\n+            MangaTask.class\n+    );\n+\n+    /**\n+     * 运行所有已注册任务\n+     */\n+    public void runTasks() {\n+        REGISTERED_TASKS.stream().map(Class::getName).forEach(this::dealClass);\n+    }\n+\n+    /**\n+     * 获得真实的className\n+     *\n+     * @param className className\n+     */\n+    public abstract void dealClass(String className);\n+}"
  },
  {
    "sha": "c6f98d34d4be1eeca728bcf2592e9891cd0db833",
    "filename": "src/main/resources/api.json",
    "status": "modified",
    "additions": 9,
    "deletions": 0,
    "changes": 9,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/resources/api.json",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/main/resources/api.json",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/main/resources/api.json?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -532,6 +532,15 @@\n         },\n         \"comment\": \"用户追番列表\"\n       },\n+      \"videos\": {\n+        \"url\": \"http://api.bilibili.com/x/space/coin/video\",\n+        \"method\": \"GET\",\n+        \"verify\": false,\n+        \"params\": {\n+          \"vmid\": \"uid\"\n+        },\n+        \"comment\": \"30天内投过硬币的视频\"\n+      },\n       \"followings\": {\n         \"url\": \"https://api.bilibili.com/x/relation/followings\",\n         \"method\": \"GET\","
  },
  {
    "sha": "d92a0362ea1b4dcda2da2e36c6ac8a936d0d4027",
    "filename": "src/test/java/top/srcrs/util/SendTest.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/test/java/top/srcrs/util/SendTest.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/test/java/top/srcrs/util/SendTest.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/test/java/top/srcrs/util/SendTest.java?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -34,7 +34,7 @@ void SendPushPlusTest() {\n     @Test\n     void SendTgBotTest() {\n         if(StringUtil.isNotBlank(System.getenv(\"TGBOT\"))){\n-            SendTgBot.send(System.getenv(\"TGBOT\"));\n+            SendTelegram.send(System.getenv(\"TELEGRAM_BOT_TOKEN\"),System.getenv(\"TELEGRAM_CHAT_ID\"));\n         }\n     }\n "
  },
  {
    "sha": "b19bbe6a3bd9e5729afb523db449f32575e36138",
    "filename": "src/test/java/top/srcrs/util/TaskRegistryTest.java",
    "status": "renamed",
    "additions": 3,
    "deletions": 3,
    "changes": 6,
    "blob_url": "https://github.com/Suniii333/BilibiliTask/blob/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/test/java/top/srcrs/util/TaskRegistryTest.java",
    "raw_url": "https://github.com/Suniii333/BilibiliTask/raw/74b513c770fd54d7e64b75a64c1a28e1407bfe9e/src/test/java/top/srcrs/util/TaskRegistryTest.java",
    "contents_url": "https://api.github.com/repos/Suniii333/BilibiliTask/contents/src/test/java/top/srcrs/util/TaskRegistryTest.java?ref=74b513c770fd54d7e64b75a64c1a28e1407bfe9e",
    "patch": "@@ -13,11 +13,11 @@\n  * @author : Ali\n  * @date : 2020/12/5\n  */\n-class PackageScannerTest {\n+class TaskRegistryTest {\n \n     @Test\n     void taskTest() {\n-        PackageScanner pack = new PackageScanner() {\n+        TaskRegistry pack = new TaskRegistry() {\n             @Override\n             public void dealClass(String className) {\n                 try{\n@@ -29,7 +29,7 @@ public void dealClass(String className) {\n                 }\n             }\n         };\n-        pack.scannerPackage(\"top.srcrs.task\");\n+        pack.runTasks();\n     }\n \n }",
    "previous_filename": "src/test/java/top/srcrs/util/PackageScannerTest.java"
  }
]
