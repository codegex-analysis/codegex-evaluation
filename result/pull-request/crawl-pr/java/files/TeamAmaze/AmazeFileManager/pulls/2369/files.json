[
  {
    "sha": "5c50b546f36c88b25f9c4f3265ad04fcd4f481f5",
    "filename": "app/src/main/java/com/amaze/filemanager/ui/activities/MainActivity.java",
    "status": "modified",
    "additions": 11,
    "deletions": 23,
    "changes": 34,
    "blob_url": "https://github.com/TeamAmaze/AmazeFileManager/blob/7dd0e92b866152effa3f64bc58fbe32b7b4c0496/app/src/main/java/com/amaze/filemanager/ui/activities/MainActivity.java",
    "raw_url": "https://github.com/TeamAmaze/AmazeFileManager/raw/7dd0e92b866152effa3f64bc58fbe32b7b4c0496/app/src/main/java/com/amaze/filemanager/ui/activities/MainActivity.java",
    "contents_url": "https://api.github.com/repos/TeamAmaze/AmazeFileManager/contents/app/src/main/java/com/amaze/filemanager/ui/activities/MainActivity.java?ref=7dd0e92b866152effa3f64bc58fbe32b7b4c0496",
    "patch": "@@ -38,6 +38,7 @@\n import static com.amaze.filemanager.ui.fragments.preference_fragments.PreferencesConstants.PREFERENCE_VIEW;\n \n import java.io.File;\n+import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n@@ -220,7 +221,7 @@\n   private boolean openProcesses = false;\n   private MaterialDialog materialDialog;\n   private boolean backPressedToExitOnce = false;\n-  private Toast toast = null;\n+  private WeakReference<Toast> toast = new WeakReference<>(null);\n   private Intent intent;\n   private View indicator_layout;\n \n@@ -844,7 +845,9 @@ public void exit() {\n       }\n     } else {\n       this.backPressedToExitOnce = true;\n-      showToast(getString(R.string.press_again));\n+      final Toast toast = Toast.makeText(this, getString(R.string.press_again), Toast.LENGTH_SHORT);\n+      this.toast = new WeakReference<>(toast);\n+      toast.show();\n       new Handler()\n           .postDelayed(\n               () -> {\n@@ -985,26 +988,6 @@ public boolean onPrepareOptionsMenu(Menu menu) {\n     return super.onPrepareOptionsMenu(menu);\n   }\n \n-  void showToast(String message) {\n-    if (this.toast == null) {\n-      // Create toast if found null, it would he the case of first call only\n-      this.toast = Toast.makeText(this, message, Toast.LENGTH_SHORT);\n-    } else if (this.toast.getView() == null) {\n-      // Toast not showing, so create new one\n-      this.toast = Toast.makeText(this, message, Toast.LENGTH_SHORT);\n-    } else {\n-      // Updating toast message is showing\n-      this.toast.setText(message);\n-    }\n-\n-    // Showing toast finally\n-    this.toast.show();\n-  }\n-\n-  void killToast() {\n-    if (this.toast != null) this.toast.cancel();\n-  }\n-\n   // called when the user exits the action mode\n   @Override\n   public boolean onOptionsItemSelected(MenuItem item) {\n@@ -1189,7 +1172,12 @@ protected void onPause() {\n     if (SDK_INT >= Build.VERSION_CODES.KITKAT) {\n       unregisterReceiver(mOtgReceiver);\n     }\n-    killToast();\n+\n+    final Toast toast = this.toast.get();\n+    if (toast != null) {\n+      toast.cancel();\n+    }\n+    this.toast = new WeakReference<>(null);\n   }\n \n   @Override"
  }
]
