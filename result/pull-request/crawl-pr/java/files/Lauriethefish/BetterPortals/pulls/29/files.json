[
  {
    "sha": "c365763382c109e0c44fa3365e5dbfdfba6330ef",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/API.java",
    "status": "modified",
    "additions": 2,
    "deletions": 3,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/API.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/API.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/API.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -7,7 +7,6 @@\n import com.lauriethefish.betterportals.api.PortalPredicate;\n import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n import com.lauriethefish.betterportals.bukkit.portal.IPortalManager;\n-import com.lauriethefish.betterportals.bukkit.portal.PortalFactory;\n import com.lauriethefish.betterportals.bukkit.portal.predicate.IPortalPredicateManager;\n import com.lauriethefish.betterportals.shared.logging.Logger;\n import org.bukkit.util.Vector;\n@@ -21,12 +20,12 @@\n  */\n public class API extends BetterPortalsAPI {\n     private final Logger logger;\n-    private final PortalFactory portalFactory;\n+    private final IPortal.Factory portalFactory;\n     private final IPortalManager portalManager;\n     private final IPortalPredicateManager portalPredicateManager;\n \n     @Inject\n-    public API(Logger logger, PortalFactory portalFactory, IPortalManager portalManager, IPortalPredicateManager portalPredicateManager) {\n+    public API(Logger logger, IPortal.Factory portalFactory, IPortalManager portalManager, IPortalPredicateManager portalPredicateManager) {\n         this.logger = logger;\n         this.portalFactory = portalFactory;\n         this.portalManager = portalManager;"
  },
  {
    "sha": "afc909d1dedfcc15532904b0ea6a017e5a4ed097",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/BetterPortals.java",
    "status": "modified",
    "additions": 57,
    "deletions": 38,
    "changes": 95,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/BetterPortals.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/BetterPortals.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/BetterPortals.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -24,8 +24,8 @@\n import java.util.List;\n \n public class BetterPortals extends JavaPlugin {\n-    private Logger logger;\n-    private ConfigManager configManager;\n+    @Inject private Logger logger;\n+    @Inject private ConfigManager configManager;\n \n     @Inject private CommandTree commandTree;\n     @Inject private IPortalStorage portalStorage;\n@@ -47,14 +47,9 @@\n     public void onEnable() {\n         saveDefaultConfig();\n \n-        // Unfortunately, guice doesn't really have support for conveniently catching errors during eager bindings, or binding some classes first then stopping if they fail.\n-        // To get round this, we first create an initial injector for loading the config, then create another with the eager bindings actually used for startup.\n-        // This works out pretty well.\n-        Injector preInitInjector = null;\n         if(firstEnable) {\n-            preInitInjector = Guice.createInjector(new PreInitModule(this));\n-            this.logger = preInitInjector.getInstance(Logger.class);\n-            this.configManager = preInitInjector.getInstance(ConfigManager.class);\n+            startup();\n+            if(didEnableFail) {return;}\n         }\n \n         try {\n@@ -67,44 +62,70 @@ public void onEnable() {\n         }\n \n         if(firstEnable) {\n-            try {\n-                Injector injector = preInitInjector.createChildInjector(new MainModule(this));\n-                injector.injectMembers(this);\n-            } catch (RuntimeException ex) {\n-                logger.severe(\"A critical error occurred during plugin startup\");\n-                ex.printStackTrace();\n-                didEnableFail = true;\n-                return;\n+            if(miscConfig.isTestingCommandsEnabled()) {\n+                commandTree.registerTestCommands();\n             }\n-\n-            try {\n-                portalStorage.loadPortals();\n-            } catch(IOException | RuntimeException ex) {\n-                getLogger().severe(\"Failed to load the portals from portals.yml. Did you modify it with an incorrect format?\");\n-                ex.printStackTrace();\n-                didEnableFail = true;\n-                return;\n-            }\n-\n-            if(miscConfig.isUpdateCheckEnabled()) {\n-                updateManager.checkForUpdates();\n-            }\n-        }   else    {\n-            eventRegistrar.onPluginReload();\n-            portalManager.onReload();\n         }\n \n         if(proxyConfig.isEnabled()) {\n             logger.fine(\"Proxy is enabled! Initialising connection . . .\");\n             portalClient.connect();\n         }\n \n+        if(!firstEnable) {\n+            reloadConfig();\n+            loadConfig();\n+\n+            eventRegistrar.onPluginReload();\n+            portalManager.onReload();\n+        }\n+\n         blockUpdateFinisher.start();\n         mainUpdate.start();\n         portalStorage.start();\n \n-        firstEnable = false;\n         apiImplementation.onEnable();\n+        firstEnable = false;\n+    }\n+\n+    private boolean loadConfig() {\n+        try {\n+            configManager.loadValues(getConfig(), this);\n+        }   catch(RuntimeException ex) {\n+            logger.warning(\"Failed to reload the config file. Please check your YAML syntax!: %s: %s\", ex.getClass().getName(), ex.getMessage());\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    private void startup() {\n+        try {\n+            Injector injector = Guice.createInjector(new MainModule(this));\n+            injector.injectMembers(this);\n+        } catch (RuntimeException ex) {\n+            getLogger().severe(\"A critical error occurred during plugin startup\");\n+            ex.printStackTrace();\n+            didEnableFail = true;\n+            return;\n+        }\n+\n+        if(!loadConfig()) {\n+            didEnableFail = true;\n+            return;\n+        }\n+\n+        try {\n+            portalStorage.loadPortals();\n+        } catch(IOException | RuntimeException ex) {\n+            getLogger().severe(\"Failed to load the portals from portals.yml. Did you modify it with an incorrect format?\");\n+            ex.printStackTrace();\n+            didEnableFail = true;\n+            return;\n+        }\n+\n+        if(miscConfig.isUpdateCheckEnabled()) {\n+            updateManager.checkForUpdates();\n+        }\n     }\n \n     public void softReload() {\n@@ -116,10 +137,7 @@ public void softReload() {\n         }\n \n         reloadConfig();\n-        try {\n-            configManager.loadValues(getConfig(), this);\n-        }   catch(RuntimeException ex) {\n-            logger.warning(\"Failed to reload the config file. Please check your YAML syntax!: %s: %s\", ex.getClass().getName(), ex.getMessage());\n+        if(!loadConfig()) {\n             return;\n         }\n \n@@ -129,6 +147,7 @@ public void softReload() {\n         if(proxyConfig.isEnabled()) {\n             portalClient.connect();\n         }\n+        apiImplementation.onEnable();\n     }\n \n     @Override"
  },
  {
    "sha": "b3e2b48402efe242d145434de5e247326928891e",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MainModule.java",
    "status": "modified",
    "additions": 3,
    "deletions": 33,
    "changes": 36,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MainModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MainModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MainModule.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,50 +1,19 @@\n package com.lauriethefish.betterportals.bukkit;\n \n import com.google.inject.AbstractModule;\n-import com.google.inject.assistedinject.FactoryModuleBuilder;\n-import com.google.inject.name.Names;\n import com.lauriethefish.betterportals.bukkit.block.BlockModule;\n-import com.lauriethefish.betterportals.bukkit.block.FloodFillViewableBlockArray;\n-import com.lauriethefish.betterportals.bukkit.block.IViewableBlockArray;\n-import com.lauriethefish.betterportals.bukkit.block.ViewableBlockArrayFactory;\n-import com.lauriethefish.betterportals.bukkit.block.external.*;\n import com.lauriethefish.betterportals.bukkit.command.CommandsModule;\n import com.lauriethefish.betterportals.bukkit.entity.EntityModule;\n-import com.lauriethefish.betterportals.bukkit.entity.IPortalEntityList;\n-import com.lauriethefish.betterportals.bukkit.entity.PortalEntityList;\n-import com.lauriethefish.betterportals.bukkit.entity.PortalEntityListFactory;\n-import com.lauriethefish.betterportals.bukkit.entity.faking.*;\n import com.lauriethefish.betterportals.bukkit.events.EventsModule;\n-import com.lauriethefish.betterportals.bukkit.math.PortalTransformationsFactory;\n import com.lauriethefish.betterportals.bukkit.net.*;\n import com.lauriethefish.betterportals.bukkit.player.*;\n-import com.lauriethefish.betterportals.bukkit.player.selection.*;\n-import com.lauriethefish.betterportals.bukkit.player.view.IPlayerPortalView;\n-import com.lauriethefish.betterportals.bukkit.player.view.PlayerPortalView;\n-import com.lauriethefish.betterportals.bukkit.player.view.PlayerPortalViewFactory;\n-import com.lauriethefish.betterportals.bukkit.player.view.ViewFactory;\n-import com.lauriethefish.betterportals.bukkit.player.view.block.*;\n-import com.lauriethefish.betterportals.bukkit.player.view.entity.IPlayerEntityView;\n-import com.lauriethefish.betterportals.bukkit.player.view.entity.PlayerEntityView;\n import com.lauriethefish.betterportals.bukkit.portal.*;\n-import com.lauriethefish.betterportals.bukkit.portal.blend.DimensionBlendManager;\n-import com.lauriethefish.betterportals.bukkit.portal.blend.IDimensionBlendManager;\n-import com.lauriethefish.betterportals.bukkit.portal.predicate.IPortalPredicateManager;\n-import com.lauriethefish.betterportals.bukkit.portal.predicate.PortalPredicateManager;\n-import com.lauriethefish.betterportals.bukkit.portal.spawning.IPortalSpawner;\n-import com.lauriethefish.betterportals.bukkit.portal.spawning.PortalSpawner;\n-import com.lauriethefish.betterportals.bukkit.portal.storage.IPortalStorage;\n-import com.lauriethefish.betterportals.bukkit.portal.storage.YamlPortalStorage;\n import com.lauriethefish.betterportals.bukkit.tasks.BlockUpdateFinisher;\n-import com.lauriethefish.betterportals.bukkit.tasks.MainUpdate;\n import com.lauriethefish.betterportals.bukkit.tasks.ThreadedBlockUpdateFinisher;\n import com.lauriethefish.betterportals.bukkit.util.performance.IPerformanceWatcher;\n import com.lauriethefish.betterportals.bukkit.util.performance.PerformanceWatcher;\n-import com.lauriethefish.betterportals.shared.net.IRequestHandler;\n-import com.lauriethefish.betterportals.shared.net.encryption.EncryptedObjectStream;\n-import com.lauriethefish.betterportals.shared.net.encryption.EncryptedObjectStreamFactory;\n-import com.lauriethefish.betterportals.shared.net.encryption.IEncryptedObjectStream;\n-import org.bukkit.Bukkit;\n+import com.lauriethefish.betterportals.shared.logging.Logger;\n+import com.lauriethefish.betterportals.shared.logging.OverrideLogger;\n import org.bukkit.plugin.java.JavaPlugin;\n \n public class MainModule extends AbstractModule {\n@@ -58,6 +27,7 @@ public MainModule(BetterPortals pl) {\n     protected void configure() {\n         bind(JavaPlugin.class).toInstance(pl);\n         bind(BetterPortals.class).toInstance(pl);\n+        bind(Logger.class).toInstance(new OverrideLogger(pl.getLogger()));\n \n         bind(BlockUpdateFinisher.class).to(ThreadedBlockUpdateFinisher.class);\n         bind(IPerformanceWatcher.class).to(PerformanceWatcher.class);"
  },
  {
    "sha": "4438ae9704c5684d02c1ffdc3fff28588c9fd10c",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MinecraftVersionModule.java",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MinecraftVersionModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MinecraftVersionModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/MinecraftVersionModule.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -3,7 +3,6 @@\n import com.google.inject.AbstractModule;\n import com.google.inject.assistedinject.FactoryModuleBuilder;\n import com.lauriethefish.betterportals.bukkit.block.multiblockchange.IMultiBlockChangeManager;\n-import com.lauriethefish.betterportals.bukkit.block.multiblockchange.MultiBlockChangeManagerFactory;\n import com.lauriethefish.betterportals.bukkit.block.multiblockchange.MultiBlockChangeManager_1_16_2;\n import com.lauriethefish.betterportals.bukkit.block.multiblockchange.MultiBlockChangeManager_Old;\n import com.lauriethefish.betterportals.bukkit.block.rotation.IBlockRotator;\n@@ -28,7 +27,7 @@ protected void configure() {\n         bind(IChunkGenerationChecker.class).to(VersionUtil.isMcVersionAtLeast(\"1.14.0\") ? ModernChunkGenerationChecker.class : LegacyChunkGenerationChecker.class);\n         install(new FactoryModuleBuilder()\n             .implement(IMultiBlockChangeManager.class, VersionUtil.isMcVersionAtLeast(\"1.16.2\") ? MultiBlockChangeManager_1_16_2.class : MultiBlockChangeManager_Old.class)\n-            .build(MultiBlockChangeManagerFactory.class)\n+            .build(IMultiBlockChangeManager.Factory.class)\n         );\n     }\n }"
  },
  {
    "sha": "9defee84dc9c99508a23e4797e807f612f79bb73",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/PreInitModule.java",
    "status": "removed",
    "additions": 0,
    "deletions": 20,
    "changes": 20,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/PreInitModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/PreInitModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/PreInitModule.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,20 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit;\n-\n-import com.google.inject.AbstractModule;\n-import com.lauriethefish.betterportals.shared.logging.Logger;\n-import com.lauriethefish.betterportals.shared.logging.OverrideLogger;\n-\n-/**\n- * Binds values for loading the config and logging during plugin startup.\n- */\n-public class PreInitModule extends AbstractModule {\n-    private final BetterPortals pl;\n-    public PreInitModule(BetterPortals pl) {\n-        this.pl = pl;\n-    }\n-\n-    @Override\n-    public void configure() {\n-        bind(Logger.class).toInstance(new OverrideLogger(pl.getLogger()));\n-    }\n-}"
  },
  {
    "sha": "5fd6140b449cd3870de9364b80394cf47868e2ce",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/BlockModule.java",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/BlockModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/BlockModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/BlockModule.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -14,12 +14,12 @@\n     public void configure() {\n         install(new FactoryModuleBuilder()\n                 .implement(IViewableBlockArray.class, FloodFillViewableBlockArray.class)\n-                .build(ViewableBlockArrayFactory.class)\n+                .build(IViewableBlockArray.Factory.class)\n         );\n \n         install(new FactoryModuleBuilder()\n                 .implement(IBlockChangeWatcher.class, BlockChangeWatcher.class)\n-                .build(BlockChangeWatcherFactory.class)\n+                .build(IBlockChangeWatcher.Factory.class)\n         );\n \n         install(new FactoryModuleBuilder()"
  },
  {
    "sha": "936f39bcc7f7e5a4f1fbf5819573905603cf00e3",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/FloodFillViewableBlockArray.java",
    "status": "modified",
    "additions": 8,
    "deletions": 1,
    "changes": 9,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/FloodFillViewableBlockArray.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/FloodFillViewableBlockArray.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/FloodFillViewableBlockArray.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,5 +1,6 @@\n package com.lauriethefish.betterportals.bukkit.block;\n \n+import com.comphenix.protocol.wrappers.WrappedBlockData;\n import com.google.inject.Inject;\n import com.google.inject.assistedinject.Assisted;\n import com.lauriethefish.betterportals.bukkit.block.data.BlockData;\n@@ -16,6 +17,7 @@\n import com.lauriethefish.betterportals.bukkit.util.performance.OperationTimer;\n import com.lauriethefish.betterportals.shared.logging.Logger;\n import lombok.Getter;\n+import org.bukkit.Material;\n import org.bukkit.World;\n \n import java.util.ArrayList;\n@@ -81,6 +83,11 @@ private boolean isInLine(IntVector relPos) {\n      * @param start Start position of the flood fill\n      */\n     private void searchFromBlock(IntVector start) {\n+        WrappedBlockData backgroundData = renderConfig.getBackgroundBlockData();\n+        if(backgroundData == null) {\n+            backgroundData = MaterialUtil.PORTAL_EDGE_DATA; // Use the default if not overridden in the config\n+        }\n+\n         List<IntVector> stack = new ArrayList<>(renderConfig.getTotalArrayLength());\n         stack.add(start);\n \n@@ -97,7 +104,7 @@ private void searchFromBlock(IntVector start) {\n             ViewableBlockInfo blockInfo = new ViewableBlockInfo(originData, destData);\n             boolean isEdge = renderConfig.isEdge(relPos);\n             if(isEdge && !isOccluding) {\n-                blockInfo.setRenderedDestData(MaterialUtil.PORTAL_EDGE_DATA);\n+                blockInfo.setRenderedDestData(backgroundData);\n             }   else    {\n                 blockInfo.setRenderedDestData(blockRotator.rotateByMatrix(rotateDestToOrigin, destData).toProtocolLib());\n             }"
  },
  {
    "sha": "38698282720f4ee70cd77f77b7a4f05b7efbd4fb",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/IViewableBlockArray.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/IViewableBlockArray.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/IViewableBlockArray.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/IViewableBlockArray.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -2,6 +2,7 @@\n \n import com.lauriethefish.betterportals.bukkit.config.RenderConfig;\n import com.lauriethefish.betterportals.api.IntVector;\n+import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n import org.bukkit.util.Vector;\n \n import java.util.concurrent.ConcurrentMap;\n@@ -33,4 +34,8 @@\n      * Next time {@link IViewableBlockArray#update(int)} is called, another initial update will be done, which takes longer.\n      */\n     void reset();\n+\n+    interface Factory {\n+        IViewableBlockArray create(IPortal portal);\n+    }\n }"
  },
  {
    "sha": "c70580dc4637cdfd367f435dbb05f7490e7cf4dc",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/ViewableBlockArrayFactory.java",
    "status": "removed",
    "additions": 0,
    "deletions": 7,
    "changes": 7,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/ViewableBlockArrayFactory.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/ViewableBlockArrayFactory.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/ViewableBlockArrayFactory.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,7 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit.block;\n-\n-import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n-\n-public interface ViewableBlockArrayFactory {\n-    IViewableBlockArray create(IPortal portal);\n-}"
  },
  {
    "sha": "b139d336dd2fd2f4abfb6c6dcd7e98c370cd8284",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/BlockChangeWatcherFactory.java",
    "status": "removed",
    "additions": 0,
    "deletions": 7,
    "changes": 7,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/BlockChangeWatcherFactory.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/BlockChangeWatcherFactory.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/BlockChangeWatcherFactory.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,7 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit.block.external;\n-\n-import com.lauriethefish.betterportals.bukkit.net.requests.GetBlockDataChangesRequest;\n-\n-public interface BlockChangeWatcherFactory {\n-    IBlockChangeWatcher create(GetBlockDataChangesRequest request);\n-}"
  },
  {
    "sha": "17c8996bcd8fa4d15cbafa89904e24172d8aa446",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/ExternalBlockWatcherManager.java",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/ExternalBlockWatcherManager.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/ExternalBlockWatcherManager.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/ExternalBlockWatcherManager.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -23,12 +23,12 @@\n     private static final int BLOCK_WATCHER_CLEAR_DELAY = 5;\n \n     private final Logger logger;\n-    private final BlockChangeWatcherFactory blockChangeWatcherFactory;\n+    private final IBlockChangeWatcher.Factory blockChangeWatcherFactory;\n     private final Map<UUID, IBlockChangeWatcher> watchers = new HashMap<>();\n     private final Map<UUID, Instant> lastRequested = new HashMap<>();\n \n     @Inject\n-    public ExternalBlockWatcherManager(Logger logger, BlockChangeWatcherFactory blockChangeWatcherFactory) {\n+    public ExternalBlockWatcherManager(Logger logger, IBlockChangeWatcher.Factory blockChangeWatcherFactory) {\n         this.logger = logger;\n         this.blockChangeWatcherFactory = blockChangeWatcherFactory;\n     }"
  },
  {
    "sha": "008417aca911c8da7ac69f2d18479120ce7776c5",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/IBlockChangeWatcher.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/IBlockChangeWatcher.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/IBlockChangeWatcher.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/external/IBlockChangeWatcher.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,6 +1,7 @@\n package com.lauriethefish.betterportals.bukkit.block.external;\n \n import com.lauriethefish.betterportals.api.IntVector;\n+import com.lauriethefish.betterportals.bukkit.net.requests.GetBlockDataChangesRequest;\n import org.jetbrains.annotations.NotNull;\n \n import java.util.Map;\n@@ -16,4 +17,8 @@\n      * @return The new block data, as an integer.\n      */\n     @NotNull Map<IntVector, Integer> checkForChanges();\n+\n+    interface Factory {\n+        IBlockChangeWatcher create(GetBlockDataChangesRequest request);\n+    }\n }"
  },
  {
    "sha": "6f33dc361c50003a48b5edd927127260da5ec588",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/IMultiBlockChangeManager.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/IMultiBlockChangeManager.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/IMultiBlockChangeManager.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/IMultiBlockChangeManager.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,6 +1,7 @@\n package com.lauriethefish.betterportals.bukkit.block.multiblockchange;\n \n import com.comphenix.protocol.wrappers.WrappedBlockData;\n+import org.bukkit.entity.Player;\n import org.bukkit.util.Vector;\n \n /**\n@@ -19,4 +20,8 @@\n      * Does <i>not</i> clear changes.\n      */\n     void sendChanges();\n+\n+    interface Factory {\n+        IMultiBlockChangeManager create(Player player);\n+    }\n }"
  },
  {
    "sha": "455728ddc7e74114e3b0c88dfb0ac174f5cf0aca",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/MultiBlockChangeManagerFactory.java",
    "status": "removed",
    "additions": 0,
    "deletions": 7,
    "changes": 7,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/MultiBlockChangeManagerFactory.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/MultiBlockChangeManagerFactory.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/block/multiblockchange/MultiBlockChangeManagerFactory.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,7 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit.block.multiblockchange;\n-\n-import org.bukkit.entity.Player;\n-\n-public interface MultiBlockChangeManagerFactory {\n-    IMultiBlockChangeManager create(Player player);\n-}"
  },
  {
    "sha": "9e085cc43f4c790858ae7650388b44b9d7537a86",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CommandsModule.java",
    "status": "modified",
    "additions": 0,
    "deletions": 1,
    "changes": 1,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CommandsModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CommandsModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CommandsModule.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -7,6 +7,5 @@\n     public void configure() {\n         bind(MainCommands.class).asEagerSingleton();\n         bind(CustomPortalCommands.class).asEagerSingleton();\n-        bind(TestingCommands.class).asEagerSingleton();\n     }\n }"
  },
  {
    "sha": "0a29ffb465e144c72d413ba9ca4d5e44b7eaecda",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CustomPortalCommands.java",
    "status": "modified",
    "additions": 3,
    "deletions": 7,
    "changes": 10,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CustomPortalCommands.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CustomPortalCommands.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/CustomPortalCommands.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -7,10 +7,8 @@\n import com.lauriethefish.betterportals.bukkit.command.framework.annotations.*;\n import com.lauriethefish.betterportals.bukkit.config.MessageConfig;\n import com.lauriethefish.betterportals.bukkit.player.IPlayerData;\n-import com.lauriethefish.betterportals.bukkit.player.selection.IPortalWandManager;\n import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n import com.lauriethefish.betterportals.bukkit.portal.IPortalManager;\n-import com.lauriethefish.betterportals.bukkit.portal.PortalFactory;\n import org.bukkit.Location;\n import org.bukkit.entity.Player;\n import org.jetbrains.annotations.NotNull;\n@@ -22,14 +20,12 @@\n \n     private final IPortalManager portalManager;\n     private final MessageConfig messageConfig;\n-    private final IPortalWandManager portalWandManager;\n-    private final PortalFactory portalFactory;\n+    private final IPortal.Factory portalFactory;\n \n     @Inject\n-    public CustomPortalCommands(CommandTree commandTree, IPortalManager portalManager, MessageConfig messageConfig, IPortalWandManager portalWandManager, PortalFactory portalFactory) {\n+    public CustomPortalCommands(CommandTree commandTree, IPortalManager portalManager, MessageConfig messageConfig, IPortal.Factory portalFactory) {\n         this.portalManager = portalManager;\n         this.messageConfig = messageConfig;\n-        this.portalWandManager = portalWandManager;\n         this.portalFactory = portalFactory;\n \n         commandTree.registerCommands(this);\n@@ -130,7 +126,7 @@ public boolean linkExternalPortals(IPlayerData playerData, boolean invert) throw\n     @RequiresPlayer\n     @Description(\"Gives you the wand for selecting portals\")\n     public boolean getPortalWand(Player player) {\n-        player.getInventory().addItem(portalWandManager.getPortalWand());\n+        player.getInventory().addItem(messageConfig.getPortalWand());\n         return true;\n     }\n "
  },
  {
    "sha": "02d19f6406b3a96f111fda9c9aabc103f9d18290",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/TestingCommands.java",
    "status": "modified",
    "additions": 11,
    "deletions": 6,
    "changes": 17,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/TestingCommands.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/TestingCommands.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/TestingCommands.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -4,7 +4,6 @@\n import com.google.inject.Singleton;\n import com.lauriethefish.betterportals.bukkit.block.data.BlockData;\n import com.lauriethefish.betterportals.bukkit.block.data.ModernBlockData;\n-import com.lauriethefish.betterportals.bukkit.command.framework.CommandTree;\n import com.lauriethefish.betterportals.bukkit.command.framework.annotations.*;\n import com.lauriethefish.betterportals.bukkit.config.MiscConfig;\n import com.lauriethefish.betterportals.bukkit.entity.faking.EntityInfo;\n@@ -19,6 +18,7 @@\n import com.lauriethefish.betterportals.bukkit.util.performance.Operation;\n import com.lauriethefish.betterportals.bukkit.util.performance.OperationTimer;\n import com.lauriethefish.betterportals.shared.net.RequestException;\n+import org.bukkit.Chunk;\n import org.bukkit.block.BlockState;\n import org.bukkit.command.CommandSender;\n import org.bukkit.entity.Entity;\n@@ -38,15 +38,11 @@\n     private List<Integer> storedData;\n \n     @Inject\n-    public TestingCommands(CommandTree commandTree, IPerformanceWatcher performanceWatcher, NewPortalChecker spawnChecker, IEntityPacketManipulator entityPacketManipulator, IPortalClient portalClient, MiscConfig miscConfig) {\n+    public TestingCommands(IPerformanceWatcher performanceWatcher, NewPortalChecker spawnChecker, IEntityPacketManipulator entityPacketManipulator, IPortalClient portalClient, MiscConfig miscConfig) {\n         this.performanceWatcher = performanceWatcher;\n         this.spawnChecker = spawnChecker;\n         this.entityPacketManipulator = entityPacketManipulator;\n         this.portalClient = portalClient;\n-\n-        if(miscConfig.isTestingCommandsEnabled()) {\n-            commandTree.registerCommands(this);\n-        }\n     }\n \n     @Command\n@@ -194,4 +190,13 @@ public boolean sendForwardedRequest(CommandSender sender, String serverName) {\n \n         return true;\n     }\n+\n+    @Command\n+    @Path(\"betterportals/test/refresh\")\n+    @RequiresPlayer\n+    public boolean refreshChunk(Player sender) {\n+        Chunk senderChunk = sender.getLocation().getChunk();\n+        sender.getWorld().refreshChunk(senderChunk.getX(), senderChunk.getZ());\n+        return true;\n+    }\n }"
  },
  {
    "sha": "36f5a801fd7c1235d99e3fb68e055b1989b14b28",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/framework/CommandTree.java",
    "status": "modified",
    "additions": 9,
    "deletions": 1,
    "changes": 10,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/framework/CommandTree.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/framework/CommandTree.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/command/framework/CommandTree.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -2,6 +2,7 @@\n \n import com.google.inject.Inject;\n import com.google.inject.Singleton;\n+import com.lauriethefish.betterportals.bukkit.command.TestingCommands;\n import com.lauriethefish.betterportals.bukkit.command.framework.annotations.Aliases;\n import com.lauriethefish.betterportals.bukkit.command.framework.annotations.Command;\n import com.lauriethefish.betterportals.bukkit.command.framework.annotations.Path;\n@@ -22,14 +23,16 @@\n     private final MessageConfig messages;\n     private final Logger logger;\n     private final IPlayerDataManager playerDataManager;\n+    private final TestingCommands testingCommands;\n \n     private final ParentCommand rootNode;\n \n     @Inject\n-    public CommandTree(MessageConfig messages, Logger logger, IPlayerDataManager playerDataManager) {\n+    public CommandTree(MessageConfig messages, Logger logger, IPlayerDataManager playerDataManager, TestingCommands testingCommands) {\n         this.messages = messages;\n         this.logger = logger;\n         this.playerDataManager = playerDataManager;\n+        this.testingCommands = testingCommands;\n \n         // We don't want to print an exception if another command like /gamemode is entered\n         this.rootNode = new ParentCommand(logger, messages, true);\n@@ -113,4 +116,9 @@ public boolean onGlobalCommand(CommandSender sender, String label, String[] args\n \n         return rootNode.tabComplete(sender, args);\n     }\n+\n+    public void registerTestCommands() {\n+        logger.fine(\"Registering test commands\");\n+        registerCommands(testingCommands);\n+    }\n }"
  },
  {
    "sha": "2470f2103912c3e0aeac6e981977c9c31f85cf85",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/MessageConfig.java",
    "status": "modified",
    "additions": 38,
    "deletions": 3,
    "changes": 41,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/MessageConfig.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/MessageConfig.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/MessageConfig.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,14 +1,17 @@\n package com.lauriethefish.betterportals.bukkit.config;\n \n-import com.google.inject.Inject;\n import com.google.inject.Singleton;\n import com.lauriethefish.betterportals.bukkit.command.framework.CommandException;\n+import com.lauriethefish.betterportals.bukkit.util.nms.NBTTagUtil;\n import lombok.Getter;\n import org.bukkit.ChatColor;\n+import org.bukkit.Material;\n import org.bukkit.configuration.ConfigurationSection;\n import org.bukkit.configuration.file.FileConfiguration;\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.inventory.meta.ItemMeta;\n+import org.jetbrains.annotations.NotNull;\n \n-import javax.inject.Named;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.Objects;\n@@ -18,12 +21,16 @@\n  */\n @Singleton\n public class MessageConfig {\n+    private static final String PORTAL_WAND_TAG = \"portalWand\";\n+\n     private final Map<String, String> messageMap = new HashMap<>();\n \n-    @Getter private String portalWandName;\n+    private String portalWandName;\n     @Getter private String prefix;\n     @Getter private String messageColor;\n \n+    private ItemStack portalWand = null;\n+\n     public void load(FileConfiguration file) {\n         ConfigurationSection messagesSection = Objects.requireNonNull(file.getConfigurationSection(\"chatMessages\"), \"Missing chat messages section\");\n \n@@ -36,6 +43,34 @@ public void load(FileConfiguration file) {\n         messageColor = ChatColor.translateAlternateColorCodes('&', Objects.requireNonNull(messagesSection.getString(\"messageColor\"), \"Missing messageColor\"));\n     }\n \n+    /**\n+     * @return The wand with the NBT tags for creating portals\n+     */\n+    public @NotNull ItemStack getPortalWand() {\n+        if(portalWand == null) {\n+            portalWand = new ItemStack(Material.BLAZE_ROD);\n+\n+            ItemMeta meta = portalWand.getItemMeta();\n+            assert meta != null;\n+            meta.setDisplayName(portalWandName);\n+\n+            portalWand.setItemMeta(meta);\n+            // Portal wand checking is done with an NBT tag\n+            portalWand = NBTTagUtil.addMarkerTag(portalWand, PORTAL_WAND_TAG);\n+        }\n+\n+        return portalWand;\n+    }\n+\n+    /**\n+     * Checks if <code>item</code> is a portal wand\n+     * @param item The item to test\n+     * @return true if it is a valid portal wand, false otherwise\n+     */\n+    public boolean isPortalWand(ItemStack item) {\n+        return NBTTagUtil.hasMarkerTag(item, PORTAL_WAND_TAG);\n+    }\n+\n     /**\n      * Finds a chat message with the plugin prefix.\n      * @param name The name in the config"
  },
  {
    "sha": "8939899f04d6394f204332bb90df19d2a1003e8c",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/RenderConfig.java",
    "status": "modified",
    "additions": 12,
    "deletions": 0,
    "changes": 12,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/RenderConfig.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/RenderConfig.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/config/RenderConfig.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,8 +1,11 @@\n package com.lauriethefish.betterportals.bukkit.config;\n \n+import com.comphenix.protocol.wrappers.WrappedBlockData;\n import com.google.inject.Singleton;\n import com.lauriethefish.betterportals.api.IntVector;\n+import com.lauriethefish.betterportals.bukkit.util.MaterialUtil;\n import lombok.Getter;\n+import org.bukkit.Material;\n import org.bukkit.configuration.ConfigurationSection;\n import org.bukkit.configuration.file.FileConfiguration;\n import org.bukkit.util.Vector;\n@@ -23,6 +26,8 @@\n \n     private IntVector halfFullSize;\n \n+    private WrappedBlockData backgroundBlockData; // Default to black concrete\n+\n     private final IntVector[] surroundingOffsets = new IntVector[]{\n         new IntVector(1, 0, 0),\n         new IntVector(-1, 0, 0),\n@@ -72,6 +77,13 @@ public void load(FileConfiguration file) {\n         worldSwitchWaitTime = file.getInt(\"waitTimeAfterSwitchingWorlds\"); // TODO: implement or yeet\n         portalBlocksHidden = file.getBoolean(\"hidePortalBlocks\");\n         blockStateRefreshInterval = file.getInt(\"blockStateRefreshInterval\");\n+\n+        String bgBlockString = file.getString(\"backgroundBlock\", \"\");\n+        assert bgBlockString != null;\n+\n+        if(!bgBlockString.isEmpty()) {\n+            backgroundBlockData = WrappedBlockData.createData(Material.valueOf(bgBlockString));\n+        }\n     }\n \n     public boolean isEdge(int x, int y, int z) {"
  },
  {
    "sha": "0d3df13c07766c6f0f37d6ac69cf77e365f41788",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/EntityModule.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/EntityModule.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/EntityModule.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/EntityModule.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -9,7 +9,7 @@\n     public void configure() {\n         install(new FactoryModuleBuilder()\n                 .implement(IEntityTracker.class, EntityTracker.class)\n-                .build(EntityTrackerFactory.class)\n+                .build(IEntityTracker.Factory.class)\n         );\n \n         bind(IEntityPacketManipulator.class).to(EntityPacketManipulator.class);"
  },
  {
    "sha": "d31aeca3f57b11b4636d4756a89b8e07b8501610",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/IEntityTeleportManager.java",
    "status": "modified",
    "additions": 30,
    "deletions": 0,
    "changes": 30,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/IEntityTeleportManager.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/IEntityTeleportManager.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/IEntityTeleportManager.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -1,9 +1,39 @@\n package com.lauriethefish.betterportals.bukkit.entity;\n \n+import com.google.inject.Inject;\n+import com.lauriethefish.betterportals.bukkit.net.IPortalClient;\n+import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n+import com.lauriethefish.betterportals.bukkit.portal.predicate.IPortalPredicateManager;\n+import com.lauriethefish.betterportals.shared.logging.Logger;\n+import org.bukkit.plugin.java.JavaPlugin;\n+\n public interface IEntityTeleportManager {\n     /**\n      * Called every tick while the portal is active.\n      * Teleports entities that walk through the portal\n      */\n     void update();\n+\n+    class Factory {\n+        private final Logger logger;\n+        private final IPortalPredicateManager predicateManager;\n+        private final IPortalClient portalClient;\n+        private final JavaPlugin pl;\n+\n+        @Inject\n+        public Factory(Logger logger, IPortalPredicateManager predicateManager, IPortalClient portalClient, JavaPlugin pl) {\n+            this.logger = logger;\n+            this.predicateManager = predicateManager;\n+            this.portalClient = portalClient;\n+            this.pl = pl;\n+        }\n+\n+        public IEntityTeleportManager create(IPortal portal) {\n+            if(portal.isCrossServer()) {\n+                return new ExternalEntityTeleportManager(portal, logger, pl, predicateManager, portalClient);\n+            }   else    {\n+                return new LocalEntityTeleportManager(portal, logger, predicateManager);\n+            }\n+        }\n+    }\n }"
  },
  {
    "sha": "a7c1d69ef87dd8f65991fd90b6bae72b77eac0dc",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/TeleportManagerFactory.java",
    "status": "removed",
    "additions": 0,
    "deletions": 31,
    "changes": 31,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/TeleportManagerFactory.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/TeleportManagerFactory.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/TeleportManagerFactory.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,31 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit.entity;\n-\n-import com.google.inject.Inject;\n-import com.lauriethefish.betterportals.bukkit.net.IPortalClient;\n-import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n-import com.lauriethefish.betterportals.bukkit.portal.predicate.IPortalPredicateManager;\n-import com.lauriethefish.betterportals.shared.logging.Logger;\n-import org.bukkit.plugin.java.JavaPlugin;\n-\n-public class TeleportManagerFactory {\n-    private final Logger logger;\n-    private final IPortalPredicateManager predicateManager;\n-    private final IPortalClient portalClient;\n-    private final JavaPlugin pl;\n-\n-    @Inject\n-    public TeleportManagerFactory(Logger logger, IPortalPredicateManager predicateManager, IPortalClient portalClient, JavaPlugin pl) {\n-        this.logger = logger;\n-        this.predicateManager = predicateManager;\n-        this.portalClient = portalClient;\n-        this.pl = pl;\n-    }\n-\n-    public IEntityTeleportManager create(IPortal portal) {\n-        if(portal.isCrossServer()) {\n-            return new ExternalEntityTeleportManager(portal, logger, pl, predicateManager, portalClient);\n-        }   else    {\n-            return new LocalEntityTeleportManager(portal, logger, predicateManager);\n-        }\n-    }\n-}"
  },
  {
    "sha": "e0069c47e4da1e4b9585690044b3958b8664c5a8",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackerFactory.java",
    "status": "removed",
    "additions": 0,
    "deletions": 8,
    "changes": 8,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackerFactory.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/bae8c7fe43678a72a96610235d1fd01088473489/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackerFactory.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackerFactory.java?ref=bae8c7fe43678a72a96610235d1fd01088473489",
    "patch": "@@ -1,8 +0,0 @@\n-package com.lauriethefish.betterportals.bukkit.entity.faking;\n-\n-import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n-import org.bukkit.entity.Entity;\n-\n-public interface EntityTrackerFactory {\n-    IEntityTracker create(Entity entity, IPortal portal);\n-}"
  },
  {
    "sha": "1bfb74d039140b3d2bd14a53a8215b7df8ffbb7e",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackingManager.java",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackingManager.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackingManager.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/EntityTrackingManager.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -27,7 +27,7 @@\n @Singleton\n public class EntityTrackingManager implements IEntityTrackingManager, Listener {\n     private final Logger logger;\n-    private final EntityTrackerFactory entityTrackerFactory;\n+    private final IEntityTracker.Factory entityTrackerFactory;\n     private final Map<IPortal, Map<Entity, IEntityTracker>> trackersByPortal = new HashMap<>(); // Used for separating trackers based on portal\n     private final Map<Entity, Collection<IEntityTracker>> trackersByEntity = new HashMap<>(); // Used for calling events when the tracked entities perform animations\n \n@@ -37,7 +37,7 @@\n     private final Map<Entity, EquipmentSlot> lastHandUsed = new HashMap<>();\n \n     @Inject\n-    public EntityTrackingManager(Logger logger, IEventRegistrar eventRegistrar, EntityTrackerFactory entityTrackerFactory) {\n+    public EntityTrackingManager(Logger logger, IEventRegistrar eventRegistrar, IEntityTracker.Factory entityTrackerFactory) {\n         this.logger = logger;\n         this.entityTrackerFactory = entityTrackerFactory;\n         eventRegistrar.register(this);"
  },
  {
    "sha": "4bc5c8ccfc02c1396b3bd618e3cccc3d5c5acab1",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/IEntityTracker.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/IEntityTracker.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/IEntityTracker.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/entity/faking/IEntityTracker.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -2,6 +2,7 @@\n \n import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n import com.lauriethefish.betterportals.bukkit.util.nms.AnimationType;\n+import org.bukkit.entity.Entity;\n import org.bukkit.entity.Player;\n import org.jetbrains.annotations.NotNull;\n \n@@ -53,4 +54,8 @@\n      * @param pickedUp The info of the entity that got picked up\n      */\n     void onPickup(@NotNull EntityInfo pickedUp);\n+\n+    interface Factory {\n+        IEntityTracker create(Entity entity, IPortal portal);\n+    }\n }"
  },
  {
    "sha": "689df60331bf5e7ad946ec148baff2ad5f70957d",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/PortalTeleportationEvents.java",
    "status": "modified",
    "additions": 5,
    "deletions": 4,
    "changes": 9,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/PortalTeleportationEvents.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/PortalTeleportationEvents.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/PortalTeleportationEvents.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -18,22 +18,23 @@\n  * We cancel regular nether portal teleportation since we override it.\n  */\n public class PortalTeleportationEvents implements Listener {\n+    private final PortalSpawnConfig spawnConfig;\n     private final IPortalManager portalManager;\n     private final MessageConfig messageConfig;\n-    private final double portalExistenceRadius;\n \n     @Inject\n     public PortalTeleportationEvents(IEventRegistrar eventRegistrar, IPortalManager portalManager, PortalSpawnConfig spawnConfig, MessageConfig messageConfig) {\n         this.portalManager = portalManager;\n         this.messageConfig = messageConfig;\n-\n-        Vector maxPortalSize = spawnConfig.getMaxPortalSize();\n-        this.portalExistenceRadius = Math.max(maxPortalSize.getX(), maxPortalSize.getY()) + 2;\n+        this.spawnConfig = spawnConfig;\n \n         eventRegistrar.register(this);\n     }\n \n     private boolean isPluginPortal(@NotNull Entity entity) {\n+        Vector maxPortalSize = spawnConfig.getMaxPortalSize();\n+        double portalExistenceRadius = Math.max(maxPortalSize.getX(), maxPortalSize.getY()) + 2;\n+\n         return portalManager.findClosestPortal(entity.getLocation(), portalExistenceRadius) != null;\n     }\n "
  },
  {
    "sha": "3d24b9565cd7809b324aaab9a78307e0f564c671",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SelectionEvents.java",
    "status": "modified",
    "additions": 2,
    "deletions": 5,
    "changes": 7,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SelectionEvents.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SelectionEvents.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SelectionEvents.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -5,7 +5,6 @@\n import com.lauriethefish.betterportals.bukkit.player.IPlayerData;\n import com.lauriethefish.betterportals.bukkit.player.IPlayerDataManager;\n import com.lauriethefish.betterportals.bukkit.player.selection.IPortalSelection;\n-import com.lauriethefish.betterportals.bukkit.player.selection.IPortalWandManager;\n import org.bukkit.Location;\n import org.bukkit.entity.Player;\n import org.bukkit.event.EventHandler;\n@@ -17,13 +16,11 @@\n import java.util.Objects;\n \n public class SelectionEvents implements Listener {\n-    private final IPortalWandManager portalWandManager;\n     private final IPlayerDataManager playerDataManager;\n     private final MessageConfig messageConfig;\n \n     @Inject\n-    public SelectionEvents(IEventRegistrar eventRegistrar, IPortalWandManager portalWandManager, IPlayerDataManager playerDataManager, MessageConfig messageConfig) {\n-        this.portalWandManager = portalWandManager;\n+    public SelectionEvents(IEventRegistrar eventRegistrar, IPlayerDataManager playerDataManager, MessageConfig messageConfig) {\n         this.playerDataManager = playerDataManager;\n         this.messageConfig = messageConfig;\n \n@@ -33,7 +30,7 @@ public SelectionEvents(IEventRegistrar eventRegistrar, IPortalWandManager portal\n     @EventHandler\n     public void onPlayerInteract(PlayerInteractEvent event) {\n         ItemStack item = event.getItem();\n-        if(item == null || !portalWandManager.isPortalWand(item))  {return;}\n+        if(item == null || !messageConfig.isPortalWand(item))  {return;}\n \n         // We only care about left or right clicks\n         Action action = event.getAction();"
  },
  {
    "sha": "3500e882aedd5035a33b501685289c0cf6bd1a16",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SpawningEvents.java",
    "status": "modified",
    "additions": 2,
    "deletions": 3,
    "changes": 5,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SpawningEvents.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SpawningEvents.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/events/SpawningEvents.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -7,7 +7,6 @@\n import com.lauriethefish.betterportals.bukkit.portal.IPortal;\n import com.lauriethefish.betterportals.bukkit.portal.IPortalManager;\n import com.lauriethefish.betterportals.api.PortalDirection;\n-import com.lauriethefish.betterportals.bukkit.portal.PortalFactory;\n import com.lauriethefish.betterportals.bukkit.portal.spawning.IPortalSpawner;\n import com.lauriethefish.betterportals.bukkit.portal.spawning.PortalSpawnPosition;\n import com.lauriethefish.betterportals.bukkit.util.VersionUtil;\n@@ -35,13 +34,13 @@\n \n     private final IPortalSpawner portalSpawnChecker;\n     private final IPortalManager portalManager;\n-    private final PortalFactory portalFactory;\n+    private final IPortal.Factory portalFactory;\n     private final PortalSpawnConfig spawnConfig;\n     private final MessageConfig messageConfig;\n     private final Logger logger;\n \n     @Inject\n-    public SpawningEvents(IEventRegistrar eventRegistrar, IPortalSpawner portalSpawnChecker, IPortalManager portalManager, PortalFactory portalFactory, PortalSpawnConfig spawnConfig, MessageConfig messageConfig, Logger logger) {\n+    public SpawningEvents(IEventRegistrar eventRegistrar, IPortalSpawner portalSpawnChecker, IPortalManager portalManager, IPortal.Factory portalFactory, PortalSpawnConfig spawnConfig, MessageConfig messageConfig, Logger logger) {\n         this.portalSpawnChecker = portalSpawnChecker;\n         this.portalManager = portalManager;\n         this.portalFactory = portalFactory;"
  },
  {
    "sha": "042015e35de6e0358dc5aad9858741322c3e60ef",
    "filename": "bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/player/IPlayerData.java",
    "status": "modified",
    "additions": 4,
    "deletions": 0,
    "changes": 4,
    "blob_url": "https://github.com/Lauriethefish/BetterPortals/blob/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/player/IPlayerData.java",
    "raw_url": "https://github.com/Lauriethefish/BetterPortals/raw/29e240a291d108ea35df25c7f6ad818cb2bf6e07/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/player/IPlayerData.java",
    "contents_url": "https://api.github.com/repos/Lauriethefish/BetterPortals/contents/bukkit/src/main/java/com/lauriethefish/betterportals/bukkit/player/IPlayerData.java?ref=29e240a291d108ea35df25c7f6ad818cb2bf6e07",
    "patch": "@@ -38,4 +38,8 @@\n      * Resets portal views when the plugin is disabled.\n      */\n     void onPluginDisable();\n+\n+    interface Factory {\n+        IPlayerData create(Player player);\n+    }\n }"
  }
]
