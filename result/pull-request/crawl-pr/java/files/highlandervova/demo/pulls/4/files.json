[
  {
    "sha": "9828be11e1466661aa663da0628cbe2627468063",
    "filename": "src/main/java/cache/CarCache.java",
    "status": "modified",
    "additions": 5,
    "deletions": 1,
    "changes": 6,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/cache/CarCache.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/cache/CarCache.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/cache/CarCache.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -4,12 +4,15 @@\n import dao.HibernateCarDao;\n import data.Car;\n import data.Option;\n+import enums.SpringBeanName;\n \n import java.time.LocalDateTime;\n import java.util.Collection;\n import java.util.Map;\n import java.util.concurrent.ConcurrentHashMap;\n \n+import static spring.SpringContextHolder.getBean;\n+\n public class CarCache {\n     private static Map<String, Car> data = new ConcurrentHashMap<>();\n     private static Map<String, Option> dataOption = new ConcurrentHashMap<>();\n@@ -38,7 +41,8 @@ private static boolean hasTime() {\n         return time.isAfter(before);\n     }\n     private static void updateCache() {\n-        CarDao carDao = new HibernateCarDao();\n+        //CarDao carDao = new HibernateCarDao();\n+       CarDao carDao = (CarDao) getBean(SpringBeanName.CARDAO.getName());\n         Collection<Car> cars = carDao.getAllCars();\n         data = new ConcurrentHashMap<>();\n         for (Car c : cars) {"
  },
  {
    "sha": "d65527189a242e078aa58da74b13d3bd3dc5be2d",
    "filename": "src/main/java/cache/OptionCache.java",
    "status": "modified",
    "additions": 7,
    "deletions": 3,
    "changes": 10,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/cache/OptionCache.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/cache/OptionCache.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/cache/OptionCache.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,18 +1,21 @@\n package cache;\n \n-import dao.CarDao;\n-import dao.HibernateCarDao;\n+//import dao.CarDao;\n+//import dao.HibernateCarDao;\n import dao.HibernateOptionDao;\n import dao.OptionDao;\n-import data.Car;\n+\n import data.Option;\n+import enums.SpringBeanName;\n \n import java.time.LocalDateTime;\n \n import java.util.Collection;\n import java.util.Map;\n import java.util.concurrent.ConcurrentHashMap;\n \n+import static spring.SpringContextHolder.getBean;\n+\n public class OptionCache {\n \n     private static Map<String, Option> data = new ConcurrentHashMap<>();\n@@ -34,6 +37,7 @@ private static boolean hasTime() {\n     }\n     private static void updateCache() {\n         OptionDao optionDao = new HibernateOptionDao();\n+        //OptionDao optionDao = (OptionDao) getBean(SpringBeanName.OPTION_DAO.getName());\n         Collection<Option> options = optionDao.getAllOptions();\n         data = new ConcurrentHashMap<>();\n         for (Option o : options) {"
  },
  {
    "sha": "22eeb1a50be70f45c2b586d145e37a624b50c93f",
    "filename": "src/main/java/dao/HibernateCarOptionDao.java",
    "status": "added",
    "additions": 70,
    "deletions": 0,
    "changes": 70,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/HibernateCarOptionDao.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/HibernateCarOptionDao.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/dao/HibernateCarOptionDao.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -0,0 +1,70 @@\n+package dao;\n+\n+\n+import data.CarOption;\n+import hibernate.HibernateUtil;\n+import org.hibernate.Query;\n+import org.hibernate.Session;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+\n+public class HibernateCarOptionDao implements CarOptionDao {\n+\n+    @Override\n+    public Collection<String> getByCarId(String carId) {\n+        Session s = HibernateUtil.getSession();\n+        Collection<CarOption> carOptions =\n+                s.createQuery(\"FROM CarOption WHERE carId='\" + carId + \"'\").list();\n+        Collection<String> out = new ArrayList<>();\n+        for (CarOption co : carOptions) {\n+            out.add(co.getOptionId());\n+        }\n+        s.close();\n+        return out;\n+    }\n+\n+    @Override\n+    public Collection<String> getOptionsByCarIdForAdd (String carId)   {\n+        Session s = HibernateUtil.getSession();\n+        Collection<CarOption> carOptions =\n+       s.createQuery(\"SELECT o.id FROM option o \" +\n+                            \"left outer  join car_option co on co.option_id = o.id  \" +\n+                            \" and co.car_id = '\" + carId+\"' where co.id is null\").list();\n+        Collection<String> out = new ArrayList<>();\n+        for (CarOption co : carOptions) {\n+            out.add(co.getOptionId());\n+        }\n+        s.close();\n+        return out;\n+    }\n+\n+\n+    @Override\n+    public boolean addNewOptionCar(CarOption co) {\n+        Session s = HibernateUtil.getSession();\n+        s.beginTransaction();\n+        s.save(co);\n+        s.getTransaction().commit();\n+        s.close();\n+        return true;\n+    }\n+\n+    @Override\n+    public boolean removeOptionCar(String carId, String optionId) {\n+        Session s = HibernateUtil.getSession();\n+        s.beginTransaction();\n+        Query query = s.createQuery(\"delete from car_option co where co.car_id = :carId and co.option_id =:optionId\");\n+        query.setParameter(\"carId\", carId);\n+        query.setParameter(\"optionId\", optionId);\n+        query.executeUpdate();\n+        s.getTransaction().commit();\n+        s.close();\n+        return true;\n+    }\n+\n+    @Override\n+    public boolean createTableCarOption() {\n+        return false;\n+    }\n+}"
  },
  {
    "sha": "0b2553084ed8aada6db0fc0c2e9f9280eceffeaa",
    "filename": "src/main/java/dao/HibernateUserDao.java",
    "status": "modified",
    "additions": 12,
    "deletions": 6,
    "changes": 18,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/HibernateUserDao.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/HibernateUserDao.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/dao/HibernateUserDao.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -19,11 +19,17 @@ public User getByLogin(String login) {\n \n     @Override\n     public boolean add(User u) {\n-        Session s = HibernateUtil.getSession();\n-        s.beginTransaction();\n-        s.save(u);\n-        s.getTransaction().commit();\n-        s.close();\n-        return true;\n+        if (getByLogin(u.getLogin()) != null) {\n+            return false;\n+        } else {\n+\n+\n+            Session s = HibernateUtil.getSession();\n+            s.beginTransaction();\n+            s.save(u);\n+            s.getTransaction().commit();\n+            s.close();\n+            return true;\n+        }\n     }\n }"
  },
  {
    "sha": "4cfff05c139f1d4c52a488c7985a50ef156e6800",
    "filename": "src/main/java/dao/UserDaoImpl.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/UserDaoImpl.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/dao/UserDaoImpl.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/dao/UserDaoImpl.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -26,7 +26,7 @@ public User getByLogin(String login) {\n                         rs.getString(\"phone\"));\n             } else return null;\n         } catch (Exception e) {\n-            System.out.println(\"Error save user;\");\n+            System.out.println(\"Error login user;\");\n             e.printStackTrace();\n             return null;\n         }"
  },
  {
    "sha": "fa14cc3c235f912edb132ce53f808607e6f315bf",
    "filename": "src/main/java/data/Car.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/data/Car.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/data/Car.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/data/Car.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -8,7 +8,7 @@\n \n @Entity\n @Table(name = \"car\")\n-@Embeddable\n+//@Embeddable\n public class Car implements Serializable {\n \n   //  @EmbeddedId"
  },
  {
    "sha": "934f9419cb78f4e54ff5fa4d29d4bf77e0739286",
    "filename": "src/main/java/data/CarOption.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/data/CarOption.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/data/CarOption.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/data/CarOption.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -40,7 +40,7 @@\n   //          inverseJoinColumns =  @JoinColumn(name = \"car_id\"))\n     private String carId;\n \n-  @Id\n+\n   @Column(name=\"option_id\")\n  //   (mappedBy=\"option\")\n    // @OrderBy(\"id\")"
  },
  {
    "sha": "e0de669505f57d165f3ccd6cd17cea95ab34b3e5",
    "filename": "src/main/java/enums/SpringBeanName.java",
    "status": "modified",
    "additions": 9,
    "deletions": 1,
    "changes": 10,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/enums/SpringBeanName.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/enums/SpringBeanName.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/enums/SpringBeanName.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -2,7 +2,15 @@\n \n public enum SpringBeanName {\n     USER_SERVICE(\"userService\"),\n-    HTML_SERVICE(\"htmlService\");\n+    HTML_SERVICE(\"htmlService\"),\n+    OPTION_SERVICE(\"optionService\"),\n+    CAR_SERVICE(\"carService\"),\n+    VALIDATION_SERVICE(\"validationService\"),\n+    CARDAO(\"cardao\"),\n+    OPTION_DAO(\"optionDao\"),\n+    CAR_OPTION_DAO(\"carOptionDao\"),\n+    USER_DAO(\"userDao\");\n+\n     private String name;\n     SpringBeanName(String name) {\n         this.name = name;"
  },
  {
    "sha": "bf41b05054c95d2efad6c2262ad1e41fbedf72e0",
    "filename": "src/main/java/service/CarService.java",
    "status": "modified",
    "additions": 16,
    "deletions": 3,
    "changes": 19,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/CarService.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/CarService.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/service/CarService.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -2,24 +2,28 @@\n \n import cache.CarCache;\n import dao.CarDao;\n+\n import dao.HibernateCarDao;\n import data.Car;\n+import enums.SpringBeanName;\n \n import java.util.Collection;\n import java.util.UUID;\n \n+import static spring.SpringContextHolder.getBean;\n import static util.StringUtil.isNotEmpty;\n \n public class CarService {\n-    CarDao carDAO = new HibernateCarDao();\n-    OptionService optionService = new OptionService();\n+//    CarDao carDAO = new HibernateCarDao();\n+    private CarDao carDAO = (CarDao) getBean(SpringBeanName.CARDAO.getName());\n+  //  OptionService optionService = new OptionService();\n+    private OptionService optionService = (OptionService) getBean(SpringBeanName.OPTION_SERVICE.getName());\n \n     public boolean checkAddCarParameters(String name, String desc, String picture, Integer type, Integer price) {\n         return isNotEmpty(name) && isNotEmpty(desc) && isNotEmpty(picture) &&\n                 type != null && type >= 1 && type <= 3 &&\n                 price != null & price > 0;\n     }\n-\n     public Car addNewCar(String name, String desc, Integer type, Integer price, String picture) {\n         Car c = new Car(UUID.randomUUID().toString(), name, type, price, desc, picture);\n         return carDAO.add(c) ? c : null;\n@@ -38,4 +42,13 @@ public Car getById(String id) {\n         out.setOptions(optionService.getOptionsByCarId(out.getId()));\n         return out;\n     }\n+\n+    public Collection<Car> getByType(int type) {\n+        Collection<Car> out = carDAO.getByType( type);\n+        for (Car c : out) {\n+            c.setOptions(optionService.getOptionsByCarId(c.getId()));\n+        }\n+        return out;\n+    }\n+\n }"
  },
  {
    "sha": "4568a73d0c77bf4fd19bc60514785e888a048541",
    "filename": "src/main/java/service/HtmlService.java",
    "status": "modified",
    "additions": 12,
    "deletions": 17,
    "changes": 29,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/HtmlService.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/HtmlService.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/service/HtmlService.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -4,11 +4,8 @@\n import data.Option;\n import enums.CarType;\n import enums.RedirectPath;\n-\n import java.util.Collection;\n-\n public class HtmlService {\n-\n     public String getMainPage(String title, Collection<Car> cars) {\n         StringBuilder out = new StringBuilder();\n         out.append(getHead(title));\n@@ -18,6 +15,11 @@ public String getMainPage(String title, Collection<Car> cars) {\n             out.append(\"<tr><td>\");\n             out.append(c.getName());\n             out.append(\"</td><td>\");\n+            out.append(\"<a href='\");\n+            out.append(RedirectPath.MAIN_PAGE.getValue());\n+            out.append(\"?type=\");\n+            out.append(c.getType());\n+            out.append(\"'>\");\n             switch (c.getType()) {\n                 case 1:\n                     out.append(CarType.SEDAN.name());\n@@ -42,7 +44,6 @@ public String getMainPage(String title, Collection<Car> cars) {\n             out.append(c.getPicture());\n             out.append(\"' alt='No Picture'/></a>\");\n             out.append(\"</td><td>\");\n-        //    out.append(\"<h1>Options:</h1>\");\n             out.append(\"<form action='\");\n             out.append(RedirectPath.OPTION_PAGE.getValue());\n             out.append(\"' method='GET'>\\n\");\n@@ -70,19 +71,14 @@ public String getMainPage(String title, Collection<Car> cars) {\n         out.append(getEnd());\n         return out.toString();\n     }\n-\n-\n     public String getOptionPage\n             (String title,\n              Collection<Option> availableOptions,\n              Collection<Option> extendedOptions, String carId)\n     {\n-\n         StringBuilder out = new StringBuilder();\n         out.append(getHead(title));\n-\n         out.append(\"<h1>Available Options:</h1>\");\n-\n         for (Option r : availableOptions) {\n             out.append(\"<h2>\" + r.getName() + \"</h2>\");\n             out.append(\"<form action='\");\n@@ -118,7 +114,6 @@ public String getMainPage(String title, Collection<Car> cars) {\n         out.append(getEnd());\n         return out.toString();\n     }\n-\n     public String getAddPage(String title) {\n         StringBuilder out = new StringBuilder();\n         out.append(getHead(title));\n@@ -127,8 +122,12 @@ public String getAddPage(String title) {\n         out.append(\"' method='POST'>\\n\");\n         out.append(\"    Enter Car Name: <input type='text' name='name'></br>\\n\");\n         out.append(\"    Enter Description: <input type='text' name='description'></br>\\n\");\n-        out.append(\"    Enter Type: <input type='number' name='type'></br>\\n\");\n-        out.append(\"    Enter Price: <input type='number' name='price'></br>\\n\");\n+        out.append(\"    Select type: <select name='type' >\");\n+        out.append(\"         <option value=1> SEDAN </option>\");\n+        out.append(\"         <option value=2> HATCHBACK</option>\");\n+        out.append(\"         <option value=3> CROSSOVER </option> \");\n+        out.append(\"         </select>\");\n+        out.append(\"    Enter Price: <input type='number'  name='price'></br>\");\n         out.append(\"    Enter Picture link: <input type='text' name='picture'></br>\\n\");\n         out.append(\"    <input type='submit' value='Add Car'>\\n\");\n         out.append(\"</form>\");\n@@ -140,7 +139,6 @@ public String getAddPage(String title) {\n         out.append(getEnd());\n         return out.toString();\n     }\n-\n     public String getAuthPage(String title) {\n         StringBuilder out = new StringBuilder();\n         out.append(getHead(title));\n@@ -179,7 +177,6 @@ public String getRegPage(String title) {\n         out.append(getEnd());\n         return out.toString();\n     }\n-\n     private String getHead(String title) {\n         StringBuilder out = new StringBuilder();\n         out.append(\"<html><head><title>\");\n@@ -192,11 +189,9 @@ private String getHead(String title) {\n         out.append(\"</head><body>\");\n         return out.toString();\n     }\n-\n-    private String getEnd() {\n+   private String getEnd() {\n         return \"</body></html>\";\n     }\n-\n     public String getDetailPage(String title, Car c) {\n         StringBuilder out = new StringBuilder();\n         out.append(getHead(title));"
  },
  {
    "sha": "71c16a552611937431a4a601ad76219f7ba00564",
    "filename": "src/main/java/service/OptionService.java",
    "status": "modified",
    "additions": 17,
    "deletions": 38,
    "changes": 55,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/OptionService.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/OptionService.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/service/OptionService.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,70 +1,49 @@\n package service;\n \n \n-import cache.CarCache;\n+\n import cache.OptionCache;\n import dao.*;\n-//import dao.OptionDAO;\n-import data.Car;\n import data.CarOption;\n import data.Option;\n-\n+import enums.SpringBeanName;\n import java.util.ArrayList;\n import java.util.Collection;\n import java.util.Random;\n+import static spring.SpringContextHolder.getBean;\n \n public class OptionService {\n   // private OptionDao optionDAO = new OptionDaoImpl();\n-  private OptionDao optionDAO = new HibernateOptionDao();\n-  private CarOptionDao carOptionDAO = new CarOptionDaoImpl();\n- // private CarOptionDao carOptionDAO = new HibernateCarOptionDao();\n-\n-\n-\n-\n+  private OptionDao optionDao = new HibernateOptionDao();\n+  //OptionDao optionDao = (OptionDao) getBean(SpringBeanName.OPTION_DAO.getName());\n+ //  private CarOptionDao carOptionDao = new CarOptionDaoImpl();\n+  // CarOptionDao carOptionDao = (CarOptionDao) getBean(SpringBeanName.CAR_OPTION_DAO.getName());\n+  private CarOptionDao carOptionDao = new HibernateCarOptionDao();\n+    public  OptionService()  { }\n+    public OptionService(OptionDao optionDao) {\n+        this.optionDao = optionDao;\n+    }\n     public Collection<Option>  getOptionsByCarId(String carId) {\n-        Collection<String> optionIds = carOptionDAO.getByCarId(carId);\n+        Collection<String> optionIds = carOptionDao.getByCarId(carId);\n         Collection<Option> out = new ArrayList<>();\n         for (String optionId : optionIds) {\n-            //out.add(optionDAO.getById(optionId));//todo: 27 OptionCache\n             out.add(OptionCache.getById(optionId));\n-\n         }\n         return out;\n     }\n     public Collection<Option>   getOptionsByCarIdAdd(String carId) {\n-        Collection<String> optionIds = carOptionDAO.getOptionsByCarIdForAdd(carId);\n+        Collection<String> optionIds = carOptionDao.getOptionsByCarIdForAdd(carId);\n         Collection<Option> out = new ArrayList<>();\n         for (String optionId : optionIds) {\n-            out.add(optionDAO.getById(optionId));\n-\n+            out.add(optionDao.getById(optionId));\n         }\n         return out;\n     }\n-\n-//\n-//    public Collection<Car> getAllCars() {\n-//        Collection<Car> out = CarCache.getAllCars();\n-//        for (Car c : out) {\n-//            c.setOptions(optionService.getOptionsByCarId(c.getId()));\n-//        }\n-//        return out;\n-//    }\n-//\n-//    public Car getById(String id) {\n-//        Car out = CarCache.getById(id);\n-//        out.setOptions(optionService.getOptionsByCarId(out.getId()));\n-//        return out;\n-//    }\n-//\n     public CarOption addNewOptionCar(String id, String CarId) {\n         CarOption co = new CarOption(new Random().nextInt(), id, CarId);\n-        return carOptionDAO.addNewOptionCar(co) ? co : null;\n+        return carOptionDao.addNewOptionCar(co) ? co : null;\n     }\n-\n     public boolean removeOptionCar(String CarId, String OptionId) {\n-       return carOptionDAO.removeOptionCar( CarId, OptionId) ;\n-\n+       return carOptionDao.removeOptionCar( CarId, OptionId) ;\n     }\n-\n }"
  },
  {
    "sha": "a57ec0dbebe30120cb8d9df0b843a72b7f8c0b2c",
    "filename": "src/main/java/service/UserService.java",
    "status": "modified",
    "additions": 14,
    "deletions": 4,
    "changes": 18,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/UserService.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/UserService.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/service/UserService.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,23 +1,33 @@\n package service;\n \n+//import dao.HibernateUserDao;\n import dao.HibernateUserDao;\n import dao.UserDao;\n+//import dao.UserDaoImpl;\n+import dao.UserDaoImpl;\n import data.User;\n+import enums.SpringBeanName;\n \n import java.util.Random;\n \n+import static spring.SpringContextHolder.getBean;\n+\n public class UserService {\n-    private UserDao uDao = new HibernateUserDao();\n+   // private UserDao userDao = new HibernateUserDao();\n+    private UserDao userDao = new UserDaoImpl();\n+     // UserDao userDao = (UserDao) getBean(SpringBeanName.USER_DAO.getName());\n \n     public User addNewUser(String login, String pass) {\n-        User u = new User(new Random().nextInt(), login, pass, 0, null);\n-        return uDao.add(u) ? u : null;\n+\n+       User u = new User(new Random().nextInt(), login, pass, 0, \"No\");\n+\n+        return userDao.add(u) ? u : null;\n     }\n     public boolean checkUserPassword(User u, String pass) {\n         return u != null && u.getPass().equals(pass);\n     }\n \n     public User getByLogin(String login) {\n-        return uDao.getByLogin(login);\n+        return userDao.getByLogin(login);\n     }\n }"
  },
  {
    "sha": "1e0b9c5654dd9a0e6081f2c94c504af1ccedd025",
    "filename": "src/main/java/service/ValidationService.java",
    "status": "modified",
    "additions": 10,
    "deletions": 3,
    "changes": 13,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/ValidationService.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/service/ValidationService.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/service/ValidationService.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -2,13 +2,20 @@\n \n import dao.HibernateUserDao;\n import dao.UserDao;\n+import dao.UserDaoImpl;\n+import enums.SpringBeanName;\n+\n+import static spring.SpringContextHolder.getBean;\n \n public class ValidationService {\n-    private UserDao uDao = new HibernateUserDao();\n+   // private UserDao userDao = new HibernateUserDao();\n+   private UserDao userDao = new UserDaoImpl();\n+   // UserDao userDao = (UserDao) getBean(SpringBeanName.USER_DAO.getName());\n+\n \n-    public boolean validateRegistration(String login, String pass1, String pass2) {\n+    public  boolean validateRegistration(String login, String pass1, String pass2) {\n         if (pass1 != null && pass1.equals(pass2) && login != null) {\n-            if (uDao.getByLogin(login) == null) {\n+            if (userDao.getByLogin(login) == null) {\n                 return true;\n             } else return false;\n         } else return false;"
  },
  {
    "sha": "ecdab53687202fad544dc8b709e42f993a747335",
    "filename": "src/main/java/servlet/AddServlet.java",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/AddServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/AddServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/AddServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -17,8 +17,14 @@\n import static spring.SpringContextHolder.getBean;\n \n public class AddServlet extends HttpServlet {\n+\n+\n     CarService carService = new CarService();\n+   // CarService carService = (CarService) getBean(SpringBeanName.CAR_SERVICE.getName());\n+\n+\n     HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n+   // HtmlService htmlService = new HtmlService();\n \n     @Override\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {"
  },
  {
    "sha": "c40c98a80366b18f2a867dfcd40310b638c804fe",
    "filename": "src/main/java/servlet/AuthServlet.java",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/AuthServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/AuthServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/AuthServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,5 +1,7 @@\n package servlet;\n \n+import dao.UserDao;\n+import dao.UserDaoImpl;\n import data.User;\n import enums.*;\n import service.HtmlService;\n@@ -16,8 +18,12 @@\n import static spring.SpringContextHolder.getBean;\n \n public class AuthServlet extends HttpServlet {\n+    //UserService uServ = new UserService();\n     private UserService uServ = (UserService) getBean(SpringBeanName.USER_SERVICE.getName());\n+\n+\n     private HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n+    //HtmlService htmlService = new HtmlService();\n \n     @Override\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {"
  },
  {
    "sha": "45f53b69658829697c1d4fd4c8a555f35f231081",
    "filename": "src/main/java/servlet/DetailServlet.java",
    "status": "modified",
    "additions": 5,
    "deletions": 1,
    "changes": 6,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/DetailServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/DetailServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/DetailServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -17,7 +17,11 @@\n \n public class DetailServlet extends HttpServlet {\n     HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n-    CarService  carService  = new CarService();\n+   //HtmlService htmlService = new HtmlService();\n+\n+\n+   CarService  carService  = new CarService();\n+   // CarService carService = (CarService) getBean(SpringBeanName.CAR_SERVICE.getName());\n \n     @Override\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {"
  },
  {
    "sha": "c7429b9d4a2d1c44819c0f2d2ed609cddf8328ae",
    "filename": "src/main/java/servlet/MainServlet.java",
    "status": "modified",
    "additions": 15,
    "deletions": 8,
    "changes": 23,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/MainServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/MainServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/MainServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,9 +1,6 @@\n package servlet;\n \n-import enums.RedirectPath;\n-import enums.SessionAttribute;\n-import enums.SpringBeanName;\n-import enums.Title;\n+import enums.*;\n import service.CarService;\n import service.HtmlService;\n \n@@ -17,15 +14,25 @@\n import static spring.SpringContextHolder.getBean;\n \n public class MainServlet extends HttpServlet {\n-    HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n-    CarService carService   = new CarService();\n-\n+    //HtmlService htmlService = new HtmlService();\n+     HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n+     CarService carService   = new CarService();\n+  //  CarService carService = (CarService) getBean(SpringBeanName.CAR_SERVICE.getName());\n     @Override\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n+        Integer type = null;\n         if (req.getSession().getAttribute(SessionAttribute.AUTHENTICATED.getValue()) != null) {\n             resp.setContentType(\"text/html\");\n             PrintWriter out = resp.getWriter();\n-            out.println(htmlService.getMainPage(Title.MAIN_PAGE.getValue(), carService.getAllCars()));\n+            if ( req.getParameter(RequestParameter.TYPE.getValue()) == null )\n+            {\n+                out.println(htmlService.getMainPage(Title.MAIN_PAGE.getValue(), carService.getAllCars()));\n+            }\n+            else\n+            {\n+                type =   Integer.parseInt(req.getParameter(RequestParameter.TYPE.getValue()));\n+                out.println(htmlService.getMainPage(Title.MAIN_PAGE.getValue(), carService.getByType(type)));\n+            }\n         } else {\n             resp.sendRedirect(RedirectPath.AUTH_PAGE.getValue());\n         }"
  },
  {
    "sha": "83c93f958458d3f7cf6f26536c82492fcf54c133",
    "filename": "src/main/java/servlet/OptionServlet.java",
    "status": "modified",
    "additions": 58,
    "deletions": 5,
    "changes": 63,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/OptionServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/OptionServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/OptionServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -1,8 +1,11 @@\n package servlet;\n \n import data.Car;\n+import data.CarOption;\n import data.Option;\n+import enums.RedirectPath;\n import enums.RequestParameter;\n+import enums.SpringBeanName;\n import enums.Title;\n import service.CarService;\n import service.HtmlService;\n@@ -16,24 +19,74 @@\n import java.io.PrintWriter;\n import java.util.Collection;\n \n+import static spring.SpringContextHolder.getBean;\n+\n public class OptionServlet extends HttpServlet {\n-    private HtmlService   htmlService   = new HtmlService();\n-    private OptionService optionService = new OptionService();\n+\n+    //  private HtmlService   htmlService   = new HtmlService();\n+    private HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n+\n+    private OptionService optionService = (OptionService) getBean(SpringBeanName.OPTION_SERVICE.getName());\n+    //private OptionService optionService = new OptionService();\n+\n     private CarService    carService    = new CarService();\n+//  CarService carService = (CarService) getBean(SpringBeanName.CAR_SERVICE.getName());\n \n     @Override\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n         String carId = req.getParameter(RequestParameter.CAR_ID.getValue());\n         resp.setContentType(\"text/html\");\n         PrintWriter out = resp.getWriter();\n-        Collection<Option> allOptions = optionService.getOptionsByCarId(carId);\n+      //  Collection<Option> allOptions = optionService.getOptionsByCarId(carId);\n         Car c = carService.getById(carId);\n+\n+        Collection<Option> addOptions = optionService.getOptionsByCarIdAdd(carId);\n+\n+\n+        out.println(htmlService.getOptionPage(Title.OPTIONS.getValue(), c.getOptions(), addOptions, carId));\n+\n+\n+\n+\n+\n         //todo: 27 exclude redundant options;\n-        out.println(htmlService.getOptionPage(Title.OPTIONS.getValue(), allOptions, c.getOptions(), carId));\n+       // out.println(htmlService.getOptionPage(Title.OPTIONS.getValue(), allOptions, c.getOptions(), carId));\n     }\n \n     @Override\n     protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n-        //todo: 27 implement doPost\n+        String carId = req.getParameter(RequestParameter.CAR_ID.getValue());\n+        String optionId = req.getParameter(RequestParameter.OPTION_ID.getValue());\n+\n+\n+\n+        if(   req.getParameter(RequestParameter.ADD.getValue()) != null){\n+\n+\n+            CarOption co = optionService.addNewOptionCar(carId, optionId );\n+            if (co != null) {\n+\n+                resp.sendRedirect(RedirectPath.MAIN_PAGE.getValue());\n+            } else {\n+                resp.sendRedirect(RedirectPath.FIRST_PAGE.getValue());\n+            }\n+        }\n+\n+//!!!\n+        if(   req.getParameter(RequestParameter.REMOVE.getValue()) != null){\n+            boolean boolTrue = optionService.removeOptionCar(carId, optionId );\n+            if (  boolTrue )\n+            {\n+\n+                resp.sendRedirect(RedirectPath.MAIN_PAGE.getValue());\n+            } else {\n+                resp.sendRedirect(RedirectPath.FIRST_PAGE.getValue());\n+            }\n+        }\n+\n+\n+\n+\n+        //todo: 27 implement doPost TODO\n     }\n }"
  },
  {
    "sha": "3f7516100f2f729ac36091b1946100e094a8542a",
    "filename": "src/main/java/servlet/RegServlet.java",
    "status": "modified",
    "additions": 12,
    "deletions": 2,
    "changes": 14,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/RegServlet.java",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/java/servlet/RegServlet.java",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/java/servlet/RegServlet.java?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -3,6 +3,7 @@\n import data.User;\n import enums.*;\n import service.HtmlService;\n+import service.OptionService;\n import service.UserService;\n import service.ValidationService;\n \n@@ -20,17 +21,26 @@\n     protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n         resp.setContentType(\"text/html\");\n         PrintWriter out = resp.getWriter();\n-        HtmlService htmlService = new HtmlService();\n+\n+        //HtmlService htmlService = new HtmlService();\n+        HtmlService htmlService = (HtmlService) getBean(SpringBeanName.HTML_SERVICE.getName());\n+\n+     //ValidationService validationService = (ValidationService) getBean(SpringBeanName.VALIDATION_SERVICE.getName());\n         out.println(htmlService.getRegPage(Title.REGISTRATION.getValue()));\n     }\n \n     @Override\n     protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n+     ValidationService validationService = (ValidationService) getBean(SpringBeanName.VALIDATION_SERVICE.getName());\n+\n         String login = req.getParameter(RequestParameter.LOGIN.getValue());\n         String pass1 = req.getParameter(RequestParameter.PASS1.getValue());\n         String pass2 = req.getParameter(RequestParameter.PASS2.getValue());\n-        if (new ValidationService().validateRegistration(login, pass1, pass2)) {\n+\n+        if (validationService.validateRegistration(login, pass1, pass2)) {\n             User u = ((UserService) getBean(SpringBeanName.USER_SERVICE.getName())).addNewUser(login, pass1);\n+            //User u = new service.UserService().addNewUser(login, pass1);\n+\n             if (u != null) {\n                 req.getSession().setAttribute(SessionAttribute.AUTHENTICATED.getValue(), u);\n                 resp.sendRedirect(RedirectPath.MAIN_PAGE.getValue());"
  },
  {
    "sha": "a9dd036ab1ae5c4f3a4befe0daf81d48a1582718",
    "filename": "src/main/resources/hibernate.cfg.xml",
    "status": "modified",
    "additions": 2,
    "deletions": 1,
    "changes": 3,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/resources/hibernate.cfg.xml",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/resources/hibernate.cfg.xml",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/resources/hibernate.cfg.xml?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -12,7 +12,8 @@\n         <property name=\"hibernate.dialect\">org.hibernate.dialect.PostgreSQL9Dialect</property>\n         <mapping class=\"data.User\"/>\n         <mapping class=\"data.Option\"/>\n-        <mapping class=\"data.CarOption\"/>\n+        <mapping class=\"data.CarOption\"/>  <!--can't migration to hibernate-->\n         <mapping class=\"data.Car\"/>\n+\n     </session-factory>\n </hibernate-configuration>\n\\ No newline at end of file"
  },
  {
    "sha": "92bfcbf1288c6b31dc4a9490c7c4a40ce99aa54f",
    "filename": "src/main/resources/spring-context.xml",
    "status": "modified",
    "additions": 8,
    "deletions": 1,
    "changes": 9,
    "blob_url": "https://github.com/highlandervova/demo/blob/2d02171dda261808195458681d3d7d8665b45532/src/main/resources/spring-context.xml",
    "raw_url": "https://github.com/highlandervova/demo/raw/2d02171dda261808195458681d3d7d8665b45532/src/main/resources/spring-context.xml",
    "contents_url": "https://api.github.com/repos/highlandervova/demo/contents/src/main/resources/spring-context.xml?ref=2d02171dda261808195458681d3d7d8665b45532",
    "patch": "@@ -5,6 +5,13 @@\n         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\">\n \n     <bean id=\"userService\" class=\"service.UserService\"/>\n-    <bean id=\"htmlService\" class=\"service.HtmlService\"/>\n+   <bean id=\"htmlService\" class=\"service.HtmlService\"/>\n+    <bean id=\"optionService\" class=\"service.OptionService\"/>\n+  <!--  <bean id=\"carService\" class=\"service.CarService\"/>-->\n+    <bean id=\"validationService\" class=\"service.ValidationService\"/>\n+   <bean id=\"cardao\" class=\"dao.HibernateCarDao\"/>\n+   <!-- <bean id=\"optionDao\" class=\"dao.HibernateOptionDao\"/> -->\n+    <!--<bean id=\"userDao\" class=\"dao.UserDaoImpl\"/>-->\n+    <bean id=\"carOptionDao\" class=\"dao.CarOptionDaoImpl\"/>\n \n </beans>\n\\ No newline at end of file"
  }
]
