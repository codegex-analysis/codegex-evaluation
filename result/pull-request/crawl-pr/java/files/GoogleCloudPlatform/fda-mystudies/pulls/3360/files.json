[
  {
    "sha": "5730b963a187ef9d8c54a47dd1bfb7b53a104228",
    "filename": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/StudyController.java",
    "status": "modified",
    "additions": 11,
    "deletions": 0,
    "changes": 11,
    "blob_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/blob/18becc060aa5f09f959187009c3960e4075998b6/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/StudyController.java",
    "raw_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/raw/18becc060aa5f09f959187009c3960e4075998b6/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/StudyController.java",
    "contents_url": "https://api.github.com/repos/GoogleCloudPlatform/fda-mystudies/contents/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/StudyController.java?ref=18becc060aa5f09f959187009c3960e4075998b6",
    "patch": "@@ -97,6 +97,7 @@\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RequestMethod;\n import org.springframework.web.client.RestTemplate;\n+import org.springframework.web.multipart.MultipartHttpServletRequest;\n import org.springframework.web.servlet.ModelAndView;\n \n @Controller\n@@ -3969,6 +3970,16 @@ public ModelAndView saveOrUpdateStudyNotification(\n   public ModelAndView saveOrUpdateStudyOverviewPage(\n       HttpServletRequest request, StudyPageBean studyPageBean) {\n     logger.info(\"StudyController - saveOrUpdateStudyOverviewPage - Starts\");\n+    if (request instanceof MultipartHttpServletRequest) {\n+      MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;\n+      Map<String, String[]> m = multipartRequest.getParameterMap();\n+      for (Map.Entry<String, String[]> entry : m.entrySet()) {\n+        if (entry.getKey().equals(\"description\")) {\n+          String[] descriptions = entry.getValue();\n+          studyPageBean.setDescription(descriptions);\n+        }\n+      }\n+    }\n     Map<String, String> propMap = FdahpStudyDesignerUtil.getAppProperties();\n     String message = FdahpStudyDesignerConstants.FAILURE;\n     ModelAndView mav = new ModelAndView(\"redirect:/adminStudies/studyList.do\");"
  },
  {
    "sha": "9bdd3ebe037b0815164d3d209df1007fb4224efe",
    "filename": "study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/overViewPage.jsp",
    "status": "modified",
    "additions": 110,
    "deletions": 11,
    "changes": 121,
    "blob_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/blob/18becc060aa5f09f959187009c3960e4075998b6/study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/overViewPage.jsp",
    "raw_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/raw/18becc060aa5f09f959187009c3960e4075998b6/study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/overViewPage.jsp",
    "contents_url": "https://api.github.com/repos/GoogleCloudPlatform/fda-mystudies/contents/study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/overViewPage.jsp?ref=18becc060aa5f09f959187009c3960e4075998b6",
    "patch": "@@ -185,16 +185,15 @@\n                   <div class=\"mt-xlg\">\n                     <div class=\"gray-xs-f mb-xs\">\n                       Description\n-                      <small>(200 characters max)</small>\n                       <span\n                           class=\"requiredStar\">*\n                       </span>\n                     </div>\n                     <div class=\"form-group elaborateClass\">\n-                      <textarea class=\" form-control updateInput\" rows=\"5\"\n+                      <textarea class=\" form-control updateInput summernote\" rows=\"5\"\n                                 id=\"editor1\" name=\"description\" required\n-                                data-error=\"Please enter plain text of up to 200 characters max.\"\n-                                maxlength=\"200\"></textarea>\n+                                data-error=\"Please fill out this field.\"\n+                                ></textarea>\n \n                       <div class=\"help-block with-errors red-txt\"></div>\n                     </div>\n@@ -327,16 +326,15 @@\n                   <div class=\"mt-md\">\n                     <div class=\"gray-xs-f mb-xs\">\n                       Description\n-                      <small>(200 characters max)</small>\n                       <span\n                           class=\"requiredStar\">*\n                       </span>\n                     </div>\n                     <div class=\"form-group elaborateClass\">\n-                      <textarea class=\"form-control updateInput\" rows=\"5\"\n+                      <textarea class=\"form-control summernote\" rows=\"5\"\n                                 name=\"description\" id=\"editor${spbSt.count}\" required\n-                                data-error=\"Please enter plain text of up to 200 characters max.\"\n-                                maxlength=\"200\">${studyPageBo.description}</textarea>\n+                                data-error=\"Please fill out this field.\"\n+                                >${studyPageBo.description}</textarea>\n                       <div class=\"help-block with-errors red-txt\"></div>\n                     </div>\n                   </div>\n@@ -402,6 +400,39 @@\n     </c:if>\n     $(\"[data-toggle=tooltip]\").tooltip();\n     var countId = ${fn:length(studyPageBos)+ 2};\n+  //summernote editor initialization\n+    $('.summernote')\n+        .summernote(\n+            {\n+              placeholder: '',\n+              disableResizeEditor: true,\n+              tabsize: 2,\n+              height: 200,\n+              toolbar: [\n+                [\n+                  'font',\n+                  ['bold', 'italic']],\n+                [\n+                  'para',\n+                  ['paragraph',\n+                    'ul', 'ol']],\n+                ['font', ['underline']],\n+                ['insert', ['link']],\n+                ['hr'],\n+                ['clear'],\n+                ['cut'],\n+                ['undo'],\n+                ['redo'],\n+                ['fontname',\n+                  ['fontname']],\n+                ['fontsize',\n+                  ['fontsize']],]\n+            });\n+    \n+    <c:if test=\"${not empty permission}\">\n+    $('.summernote').summernote('disable');\n+    </c:if>\n+    \n     // File Upload\n     $(document).on(\"click\", \".uploadImgbtn\", function () {\n       $(this).parent().find(\".uploadImg\").click();\n@@ -508,11 +539,11 @@\n           \"</div>\" +\n           \"</div>\" +\n           \"<div class=mt-lg>\" +\n-          \"<div class='gray-xs-f mb-xs'>Description <small>(200 characters max) </small><span class='requiredStar'>*</span></div>\"\n+          \"<div class='gray-xs-f mb-xs'>Description<span class='requiredStar'>*</span></div>\"\n           +\n-          \"<div class='form-group elaborateClass'><textarea class='form-control updateInput' name='description' id='editor\"\n+          \"<div class='form-group elaborateClass'><textarea class='summernote form-control updateInput' name='description' id='editor\"\n           + countId\n-          + \"' rows='5' required data-error='Please enter plain text of up to 200 characters max.' maxlength='200'></textarea>\"\n+          + \"' rows='5' required data-error='Please fill out this field.'></textarea>\"\n           +\n           \"<div class='help-block with-errors red-txt'></div></div>\" +\n           \"</div>\" +\n@@ -530,6 +561,37 @@\n       countId++;\n       $(\"[data-toggle=tooltip]\").tooltip();\n       $('body').find('.panel-collapse:last').collapse('show').addClass('in');\n+      $('.summernote')\n+      .summernote(\n+          {\n+            placeholder: '',\n+            disableResizeEditor: true,\n+            tabsize: 2,\n+            height: 200,\n+            toolbar: [\n+              [\n+                'font',\n+                ['bold', 'italic']],\n+              [\n+                'para',\n+                ['paragraph',\n+                  'ul', 'ol']],\n+              ['font', ['underline']],\n+              ['insert', ['link']],\n+              ['hr'],\n+              ['clear'],\n+              ['cut'],\n+              ['undo'],\n+              ['redo'],\n+              ['fontname',\n+                ['fontname']],\n+              ['fontsize',\n+                ['fontsize']],]\n+          });\n+  <c:if test=\"${not empty permission}\">\n+  $('.summernote').summernote('disable');\n+  </c:if>\n+  \n     });\n     $(document).on('show.bs.collapse', '.panel-collapse', function () {\n       $('.panel-collapse').not(this).collapse('hide').removeClass('in');\n@@ -555,6 +617,39 @@\n         $('#overViewFormId').submit();\n       }\n     });\n+    function validateSummernote(){   \n+        var valid=true;     \n+           $(\"textarea[id^='editor']\").each(function (i, el) {\n+        \t   var richTextVal = $(this).val()\n+       \t\tvar a=$(this).val();\n+       \t\tif ($(this).summernote(\n+   \t     'code') === '<br>' || $(this).summernote(\n+   \t     'code') === '' || $(this).summernote('code') === '<p><br></p>') {\n+      \t\t $(this).attr(\n+      \t\t       'required', true);\n+      \t\t   $(this)\n+      \t\t       .parent()\n+      \t\t       .addClass(\n+      \t\t           'has-error has-danger')\n+      \t\t       .find(\".help-block\")\n+      \t\t       .empty()\n+      \t\t       .append(\n+      \t\t           '<ul class=\"list-unstyled\"><li>Please fill out this field.</li></ul>');\n+       \t\t\tvalid=false;\n+       \t\t\treturn false;\n+          }else{\n+        \t  var richTextVal = $(this).val();\n+        \t  if (null != richTextVal && richTextVal != '' && typeof richTextVal != 'undefined' && richTextVal != '<p><br></p>'){\n+          \t  var richText=$(this).summernote('code');\n+          \t  var escaped = $(this).text(richText).html();\n+            \t  $(this).val(escaped);\n+        \t  }\n+          }\n+    \t      });\n+\t      return valid;\n+    \n+    } \n+    \n     $(\"#completedId\").on('click', function (e) {\n       e.preventDefault();\n       var formValid = true;\n@@ -582,6 +677,10 @@\n             '.in').collapse('show');\n         $(this).parents('body').find(\".has-error-cust:first\").ScrollTo();\n       }\n+      var isValid=validateSummernote();\n+      if(isValid===false){\n+          return false;\n+      }\n       if (isFromValid($(this).parents('form')) && formValid) {\n         $(this).attr('disabled', 'disabled')\n         $(this).parents('form').submit();"
  }
]
