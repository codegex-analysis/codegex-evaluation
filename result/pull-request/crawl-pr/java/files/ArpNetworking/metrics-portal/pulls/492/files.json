[
  {
    "sha": "38760284f3b10c31a28baee4df30c579a561bff3",
    "filename": ".github/workflows/build.yml",
    "status": "removed",
    "additions": 0,
    "deletions": 34,
    "changes": 34,
    "blob_url": "https://github.com/ArpNetworking/metrics-portal/blob/4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882/.github/workflows/build.yml",
    "raw_url": "https://github.com/ArpNetworking/metrics-portal/raw/4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882/.github/workflows/build.yml",
    "contents_url": "https://api.github.com/repos/ArpNetworking/metrics-portal/contents/.github/workflows/build.yml?ref=4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882",
    "patch": "@@ -1,34 +0,0 @@\n-name: build\n-on:\n-  pull_request:\n-  # If we ever want a sanity check this allows us to run the build from the UI\n-  workflow_dispatch:\n-\n-jobs:\n-  build:\n-    name: Build\n-    runs-on: ubuntu-latest\n-    # See Maven profile displayPluginUpdates in parent pom\n-    env:\n-      TRAVIS: true\n-    steps:\n-      - name: Checkout\n-        uses: actions/checkout@5a4ac9002d0be2fb38bd78e4b4dbde5606d7042f\n-      - name: Cache JDK\n-        uses: actions/cache@0781355a23dac32fd3bac414512f4b903437991a\n-        with:\n-          path: ~/.jdk\n-          key: ${{ runner.os }}-jdk-${{ hashFiles('.jdkw', 'jdk-wrapper.sh') }}\n-      - name: Cache Dependencies (Maven + SBT)\n-        uses: actions/cache@0781355a23dac32fd3bac414512f4b903437991a\n-        with:\n-          path: |\n-            ~/.ivy2\n-            ~/.m2\n-            ~/.sbt\n-          key: ${{ runner.os }}-m2-sbt-ivy-${{ hashFiles('pom.xml', '**/*.sbt', 'project/build.properties') }}\n-          restore-keys: ${{ runner.os }}-m2-sbt-ivy-\n-      - name: Dump POM (Debug)\n-        run: ./jdk-wrapper.sh ./mvnw help:effective-pom\n-      - name: Maven Verify\n-        run: ./jdk-wrapper.sh ./mvnw clean verify -P rpm -U -B -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.httpconnectionManager.ttlSeconds=120"
  },
  {
    "sha": "f6e182bb575eb65bc67c3296282b483c84f6e32b",
    "filename": ".github/workflows/release.yml",
    "status": "removed",
    "additions": 0,
    "deletions": 66,
    "changes": 66,
    "blob_url": "https://github.com/ArpNetworking/metrics-portal/blob/4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882/.github/workflows/release.yml",
    "raw_url": "https://github.com/ArpNetworking/metrics-portal/raw/4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882/.github/workflows/release.yml",
    "contents_url": "https://api.github.com/repos/ArpNetworking/metrics-portal/contents/.github/workflows/release.yml?ref=4dc27b0bd4eb3ceb5b3bf85a6bfa7be1165a1882",
    "patch": "@@ -1,66 +0,0 @@\n-name: release\n-on:\n-  push:\n-    tags:\n-      - \"metrics-portal-*\"\n-jobs:\n-  build:\n-    name: Build\n-    runs-on: ubuntu-latest\n-    # See Maven profile displayPluginUpdates in parent pom\n-    env:\n-      TRAVIS: true\n-    steps:\n-      - name: Checkout\n-        uses: actions/checkout@5a4ac9002d0be2fb38bd78e4b4dbde5606d7042f\n-      - name: Cache JDK\n-        uses: actions/cache@0781355a23dac32fd3bac414512f4b903437991a\n-        with:\n-          path: ~/.jdk\n-          key: ${{ runner.os }}-jdk-${{ hashFiles('.jdkw', 'jdk-wrapper.sh') }}\n-      - name: Cache Dependencies (Maven + SBT)\n-        uses: actions/cache@0781355a23dac32fd3bac414512f4b903437991a\n-        with:\n-          path: |\n-            ~/.ivy2\n-            ~/.m2\n-            ~/.sbt\n-          key: ${{ runner.os }}-m2-sbt-ivy-${{ hashFiles('pom.xml', '**/*.sbt', 'project/build.properties') }}\n-          restore-keys: ${{ runner.os }}-m2-sbt-ivy-\n-      - name: Build and Release\n-        env:\n-          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}\n-          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}\n-          GPG_PASS: ${{ secrets.GPG_PASS_BRANDON }}\n-          OSSRH_PASS: ${{ secrets.OSSRH_PASS }}\n-          OSSRH_USER: ${{ secrets.OSSRH_USER }}\n-        run: |\n-          gpg --batch --import arpnetworking.key\n-          ./jdk-wrapper.sh ./mvnw clean deploy -P release --settings settings.xml -P rpm -U -B -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.httpconnectionManager.ttlSeconds=120\n-      - name: Create Github Release\n-        id: create_github_release\n-        uses: actions/create-release@0cb9c9b65d5d1901c1f53e5e66eaf4afd303e70e\n-        env:\n-          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n-        with:\n-          tag_name: ${{ github.ref }}\n-          release_name: Release ${{ github.ref }}\n-          draft: false\n-          prerelease: false\n-      - name: Upload Release Asset RPM\n-        uses: csexton/release-asset-action@73f9d3bb8efa2547046ae5130a5c4597e983d543\n-        with:\n-          pattern: \"./target/rpm/kairosdb/RPMS/noarch/metrics-portal*.rpm\"\n-          github-token: ${{ secrets.GITHUB_TOKEN }}\n-          release-url: ${{ steps.create_github_release.outputs.upload_url }}\n-      - name: Upload Release Asset Tar.gz\n-        uses: csexton/release-asset-action@73f9d3bb8efa2547046ae5130a5c4597e983d543\n-        with:\n-          pattern: \"./target/metrics-portal*-bin.tgz\"\n-          github-token: ${{ secrets.GITHUB_TOKEN }}\n-          release-url: ${{ steps.create_github_release.outputs.upload_url }}\n-\n-# To Do:\n-# 1) Standard Github Actions upload release asset does not accept wildcards.\n-#    Doc: https://github.com/actions/upload-release-asset\n-#    Issue: https://github.com/actions/upload-release-asset/issues/47"
  },
  {
    "sha": "ca4ea91b13d010b1808a9ab09577a0c6359e199d",
    "filename": "Jenkinsfile",
    "status": "added",
    "additions": 73,
    "deletions": 0,
    "changes": 73,
    "blob_url": "https://github.com/ArpNetworking/metrics-portal/blob/2cb11a6e5367165415e657835bb1d323418bdaef/Jenkinsfile",
    "raw_url": "https://github.com/ArpNetworking/metrics-portal/raw/2cb11a6e5367165415e657835bb1d323418bdaef/Jenkinsfile",
    "contents_url": "https://api.github.com/repos/ArpNetworking/metrics-portal/contents/Jenkinsfile?ref=2cb11a6e5367165415e657835bb1d323418bdaef",
    "patch": "@@ -0,0 +1,73 @@\n+pipeline {\n+  agent {\n+    kubernetes {\n+      yamlFile 'kubes-pod.yaml'\n+      defaultContainer 'ubuntu'\n+      activeDeadlineSeconds 3600\n+      idleMinutes 15\n+    }\n+  }\n+  stages {\n+    stage('Init') {\n+      steps {\n+        checkout scm\n+\tscript {\n+\t  def m = (env.GIT_URL =~ /(\\/|:)(([^\\/]+)\\/)?(([^\\/]+?)(\\.git)?)$/)\n+\t  if (m) {\n+\t    org = m.group(3)\n+\t    repo = m.group(5)\n+\t  }\n+\t}\n+      }\n+    }\n+    stage('Setup build') {\n+      when { not { buildingTag() } }\n+      steps {\n+        script {\n+          target = \"verify\"\n+        }\n+      }\n+    }\n+    stage('Setup release') {\n+      when { buildingTag(); not { changeRequest() }  }\n+      steps {\n+        script {\n+          target = \"deploy -P release -P rpm --settings settings.xml\"\n+        }\n+        sh 'gpg --batch --import arpnetworking.key'\n+      }\n+    }\n+    stage('Build') {\n+      environment {\n+        KAIROSDB_HOST = \"localhost\"\n+        KAIROSDB_PORT = \"8082\"\n+      }\n+      steps {\n+        withCredentials([usernamePassword(credentialsId: 'jenkins-dockerhub', usernameVariable: 'DOCKER_USERNAME', passwordVariable: 'DOCKER_PASSWORD'),\n+            usernamePassword(credentialsId: 'jenkins-ossrh', usernameVariable: 'OSSRH_USER', passwordVariable: 'OSSRH_PASS'),\n+            string(credentialsId: 'jenkins-gpg', variable: 'GPG_PASS')]) {\n+          withMaven {\n+            sh \"./jdk-wrapper.sh ./mvnw $target -P rpm -U -B -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -Ddocker.verbose=true\"\n+          }\n+        }\n+      }\n+    }\n+    stage('GitHub release') {\n+      when { buildingTag(); not { changeRequest() }  }\n+      steps {\n+        withCredentials([usernamePassword(credentialsId: 'brandonarp-github-token', usernameVariable: 'GITHUB_USERNAME', passwordVariable: 'GITHUB_TOKEN')]) {\n+          sh \"github-release release --user ${org} --repo ${repo} --tag ${TAG_NAME}\"\n+          sh \"github-release upload --user ${org} --repo ${repo} --tag ${TAG_NAME} --name ${TAG_NAME}.tgz --file target/*.tgz\"\n+          sh \"github-release upload --user ${org} --repo ${repo} --tag ${TAG_NAME} --name ${TAG_NAME}.rpm --file target/rpm/*/RPMS/*/*.rpm\"\n+        }\n+      }\n+    }\n+  }\n+  post('Analysis') {\n+    always {\n+      recordIssues(\n+          enabledForFailure: true, aggregatingResults: true,\n+          tools: [java(), checkStyle(reportEncoding: 'UTF-8'), spotBugs()])\n+    }\n+  }\n+}"
  },
  {
    "sha": "f1671a438a1b019d6da2af43075ff3b822954fa3",
    "filename": "kubes-pod.yaml",
    "status": "added",
    "additions": 59,
    "deletions": 0,
    "changes": 59,
    "blob_url": "https://github.com/ArpNetworking/metrics-portal/blob/2cb11a6e5367165415e657835bb1d323418bdaef/kubes-pod.yaml",
    "raw_url": "https://github.com/ArpNetworking/metrics-portal/raw/2cb11a6e5367165415e657835bb1d323418bdaef/kubes-pod.yaml",
    "contents_url": "https://api.github.com/repos/ArpNetworking/metrics-portal/contents/kubes-pod.yaml?ref=2cb11a6e5367165415e657835bb1d323418bdaef",
    "patch": "@@ -0,0 +1,59 @@\n+spec:\n+  containers:\n+  - env:\n+    - name: \"DOCKER_TLS_CERTDIR\"\n+      value: \"/certs\"\n+    image: \"docker:20.10-dind\"\n+    imagePullPolicy: \"Always\"\n+    name: \"dind\"\n+    securityContext:\n+      privileged: true\n+      runAsUser: 0\n+    volumeMounts:\n+    - mountPath: \"/certs/client\"\n+      name: \"docker-secrets\"\n+      readOnly: false\n+      #    - mountPath: \"/var/lib/docker\"\n+      #      name: \"docker-cache\"\n+      #      readOnly: false\n+  - env:\n+    - name: \"DOCKER_TLS_VERIFY\"\n+      value: \"1\"\n+    - name: \"DOCKER_HOST\"\n+      value: \"tcp://localhost:2376\"\n+    - name: \"DOCKER_CERT_PATH\"\n+      value: \"/certs/client\"\n+    - name: \"_JAVA_OPTIONS\"\n+      value: \"-Duser.home=/home/jenkins\"\n+    - name: \"JDKW_VERBOSE\"\n+      value: \"1\"\n+    - name: \"HOME\"\n+      value: \"/home/jenkins\"\n+    image: \"docker.arpnetworking.com/build-base\"\n+    imagePullPolicy: \"Always\"\n+    name: \"ubuntu\"\n+    tty: true\n+    securityContext:\n+      runAsUser: 1000\n+      capabilities:\n+        add:\n+          - SYS_NICE\n+    volumeMounts:\n+    - mountPath: \"/cache\"\n+      name: \"build-cache\"\n+      readOnly: false\n+    - mountPath: \"/certs/client\"\n+      name: \"docker-secrets\"\n+      readOnly: false\n+  volumes:\n+  - name: \"docker-secrets\"\n+    emptyDir:\n+      medium: \"Memory\"\n+  - name: \"build-cache\"\n+    persistentVolumeClaim:\n+      claimName: \"jenkins-build-cache\"\n+      readOnly: false\n+      #  - name: \"docker-cache\"\n+      #    persistentVolumeClaim:\n+      #      claimName: \"jenkins-docker-cache\"\n+      #      readOnly: false"
  }
]
