[
  {
    "sha": "e7e92ceac55b9a8a39755be9e55b6f988a30dde1",
    "filename": "Root/index.js",
    "status": "modified",
    "additions": 7,
    "deletions": 1,
    "changes": 8,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/Root/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/Root/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/Root/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -2,6 +2,8 @@ import React from 'react'\n import { Platform } from 'react-native'\n import init from 'startupjs/init'\n import App from 'startupjs/app'\n+import { initAuthApp } from '@startupjs/auth'\n+import * as localForms from '@startupjs/auth-local'\n import { observer, model } from 'startupjs'\n import { BASE_URL } from '@env'\n import orm from '../model'\n@@ -18,9 +20,13 @@ if (Platform.OS === 'web') window.model = model\n init({ baseUrl: BASE_URL, orm })\n \n export default observer(() => {\n+  const auth = initAuthApp({\n+    localForms\n+  })\n+\n   return pug`\n     App(\n-      apps={main}\n+      apps={main, auth}\n     )\n   `\n })"
  },
  {
    "sha": "846d3f4d6f630e7082b5300ca6604a3518869d30",
    "filename": "components/Title/index.js",
    "status": "added",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/Title/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/Title/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/components/Title/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,10 @@\n+import React from 'react'\n+import { H1 } from '@startupjs/ui'\n+\n+import './index.styl'\n+\n+export default function Title ({ children }) {\n+  return pug`\n+    H1.title(bold)= children\n+  `\n+}"
  },
  {
    "sha": "b17707271a10b9ecdb80fa9407d56e157bbdd7c2",
    "filename": "components/Title/index.styl",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/Title/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/Title/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/components/Title/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,3 @@\n+.title\n+  font(xxl)\n+  text-align center"
  },
  {
    "sha": "8820fa3a6e01c89435734351f14ac4b204096df0",
    "filename": "components/index.js",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/components/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/components/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1 @@\n+export { default as Title } from './Title'"
  },
  {
    "sha": "8c4733e38d79470ad07e4128a3718d0b2cf8fcd9",
    "filename": "helpers/constants.json",
    "status": "added",
    "additions": 34,
    "deletions": 0,
    "changes": 34,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/helpers/constants.json",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/helpers/constants.json",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/helpers/constants.json?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,34 @@\n+{\n+  \"GAME_STATUS\": {\n+    \"WAITING_PLAYERS\": \"waitingPlayers\",\n+    \"WAITING_ANSWER_PLAYERS\": \"waitingAnswerPlayers\",\n+    \"WAITING_NEW_ROUND\": \"waitingNewRound\",\n+    \"COMPLETED\": \"completed\"\n+  },\n+  \"ANSWER\": {\n+    \"STONE\" : {\n+      \"ID\" : \"stone\",\n+      \"LABEL\": \"Камень\",\n+      \"STRONGER\": [\"scissor\"],\n+      \"ORDER\": 1\n+    },\n+    \"SCISSOR\" : {\n+      \"ID\" : \"scissor\",\n+      \"LABEL\": \"Ножницы\",\n+      \"STRONGER\": [\"paper\"],\n+      \"ORDER\": 2\n+    },\n+    \"PAPER\" : {\n+      \"ID\" : \"paper\",\n+      \"LABEL\": \"Бумага\",\n+      \"STRONGER\": [\"stone\"],\n+      \"ORDER\": 3\n+    },\n+    \"SURRENDER\" : {\n+      \"ID\" : \"surrender\",\n+      \"LABEL\": \"Сдаться\",\n+      \"STRONGER\": [],\n+      \"ORDER\": 4\n+    }\n+  }\n+}"
  },
  {
    "sha": "4ddac21f0352ac0f5b12e73e4df0a8e068dddc64",
    "filename": "main/Layout/index.js",
    "status": "modified",
    "additions": 12,
    "deletions": 36,
    "changes": 48,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/Layout/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/Layout/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/Layout/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1,46 +1,22 @@\n-import React from 'react'\n-import { observer, emit, useValue, useLocal } from 'startupjs'\n-import { Button, Div, H1, Layout, Menu, Portal, Row, SmartSidebar } from '@startupjs/ui'\n-import { faBars } from '@fortawesome/free-solid-svg-icons'\n-import APP from '../../app.json'\n-import './index.styl'\n-\n-const { displayName } = APP\n+import React, { useEffect } from 'react'\n+import { useHistory, useLocation } from 'react-router-native'\n+import { observer, useSession } from 'startupjs'\n+import { Div, Layout, Portal } from '@startupjs/ui'\n \n-const APP_NAME = displayName.charAt(0).toUpperCase() + displayName.slice(1)\n-\n-const MenuItem = observer(({ url, children }) => {\n-  const [currentUrl] = useLocal('$render.url')\n-  return pug`\n-    Menu.Item(\n-      active=currentUrl === url\n-      onPress=() => emit('url', url)\n-    )= children\n-  `\n-})\n+import './index.styl'\n \n export default observer(function ({ children }) {\n-  const [opened, $opened] = useValue(false)\n+  const [loggedIn] = useSession('loggedIn')\n+  const history = useHistory()\n+  const location = useLocation()\n \n-  function renderSidebar () {\n-    return pug`\n-      Menu.sidebar-menu\n-        MenuItem(url='/') App\n-        MenuItem(url='/about') About\n-    `\n-  }\n+  useEffect(() => {\n+    if (location.pathname !== '/' && !loggedIn) history.push('/')\n+  }, [location, loggedIn])\n \n   return pug`\n     Portal.Provider\n       Layout\n-        SmartSidebar.sidebar(\n-          $open=$opened\n-          renderContent=renderSidebar\n-        )\n-          Row.menu\n-            Button(color='secondaryText' icon=faBars onPress=() => $opened.set(!opened))\n-            H1.logo= APP_NAME\n-\n-          Div.body= children\n+        Div.body= children\n   `\n })"
  },
  {
    "sha": "eacdd5e6249648bfa7a1e6d908ea0f8400b6ed00",
    "filename": "main/Layout/index.styl",
    "status": "modified",
    "additions": 0,
    "deletions": 22,
    "changes": 22,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/Layout/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/Layout/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/Layout/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1,24 +1,2 @@\n-$menuHeight = 6u\n-\n-.sidebar\n-  background-color #eee\n-\n-  &-menu\n-    padding-top 2u\n-\n-.menu\n-  background-color rgba(black, 0.02)\n-  height $menuHeight\n-  z-index 1\n-  align-items center\n-  padding 0 2u\n-  border-bottom-width 1px\n-  border-bottom-color rgba(black, 0.05)\n-\n-.logo\n-  margin-left 2u\n-  color $UI.colors.secondaryText\n-  font(xl)\n-\n .body\n   flex 1"
  },
  {
    "sha": "cae2e03620bbd6d420b1f49e36d705ed4e9aa44f",
    "filename": "main/pages/PGame/PlayerGame/index.js",
    "status": "added",
    "additions": 67,
    "deletions": 0,
    "changes": 67,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/PlayerGame/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/PlayerGame/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/PlayerGame/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,67 @@\n+import React, { useMemo, useEffect } from 'react'\n+import { observer, useSession, useDoc } from 'startupjs'\n+import { Div, Radio, Span, Row } from '@startupjs/ui'\n+import { Title } from 'components'\n+import { ANSWER, GAME_STATUS } from 'helpers/constants'\n+\n+import './index.styl'\n+\n+export default observer(function PGame ({ gameId, backToGames }) {\n+  const answer = useMemo(() => {\n+    const _answer = []\n+    for (const key in ANSWER) {\n+      _answer.push({\n+        order: ANSWER[key].ORDER,\n+        value: ANSWER[key].ID,\n+        label: ANSWER[key].LABEL\n+      })\n+    }\n+    _answer.sort((a, b) => a.order - b.order)\n+    return _answer\n+  }, [])\n+  const [user] = useSession('user')\n+  const [game = {}, $game] = useDoc('games', gameId)\n+  const currentRound = (game.history && game.history[game.history.length - 1]) || {}\n+  const isFirstUser = game.firstUser === user.id\n+  const [rival] = useDoc('users', isFirstUser ? game.secondUser : game.firstUser)\n+\n+  const setAnser = (value) => $game.setAnser(isFirstUser, value)\n+\n+  const getRivalText = () => {\n+    if (rival) return rival.firstName\n+    return 'еще не зашел в игру'\n+  }\n+\n+  const getWinName = () => {\n+    if (game[currentRound.winner] || game[currentRound.winner] === user.id) return user.firstName\n+    if (game[currentRound.winner]) return rival.firstName\n+    return 'Ничья'\n+  }\n+\n+  useEffect(() => {\n+    if (game.status === GAME_STATUS.COMPLETED) backToGames()\n+  }, [game.status])\n+\n+  return pug`\n+    Title= game.name + ' - раунд ' + game.history.length\n+    Row.rival\n+      Span(bold) Ваш соперник#{' '}\n+      Span= getRivalText()\n+    if (game.status === GAME_STATUS.WAITING_NEW_ROUND)\n+      Div.winner\n+        Span.won(\n+          bold\n+          variant='h5'\n+          styleName={\n+            lost: (currentRound.winner === 'firstUser' && !isFirstUser) || (currentRound.winner === 'secondUser' && isFirstUser)\n+          }\n+        )= 'Победил в раунде ' + game.history.length +' - ' + getWinName()\n+        Span Ждем следующий раунд\n+    Radio.radio(\n+      value=currentRound[isFirstUser ? 'firstUserAnswer' : 'secondUserAnswer']\n+      onChange=setAnser\n+      disabled=!!currentRound[isFirstUser ? 'firstUserAnswer' : 'secondUserAnswer']\n+      options=answer\n+    )\n+  `\n+})"
  },
  {
    "sha": "eaff42de7a6a7e2b284794e30555aa70dfa93982",
    "filename": "main/pages/PGame/PlayerGame/index.styl",
    "status": "added",
    "additions": 11,
    "deletions": 0,
    "changes": 11,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/PlayerGame/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/PlayerGame/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/PlayerGame/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,11 @@\n+.winner\n+.radio\n+.rival\n+  margin-top 2u\n+\n+.won\n+  color $UI.colors.success\n+\n+.lost\n+  color $UI.colors.error\n+"
  },
  {
    "sha": "cc414935ac35e3f7baef3185984460f773878a51",
    "filename": "main/pages/PGame/ProfessorGame/index.js",
    "status": "added",
    "additions": 50,
    "deletions": 0,
    "changes": 50,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/ProfessorGame/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/ProfessorGame/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/ProfessorGame/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,50 @@\n+import React from 'react'\n+import { observer, useDoc } from 'startupjs'\n+import { Button, Row, Span, Div } from '@startupjs/ui'\n+import { Title } from 'components'\n+import { GAME_STATUS, ANSWER } from 'helpers/constants'\n+\n+import './index.styl'\n+\n+export default observer(function PGame ({ gameId, backToGames }) {\n+  const [game = {}, $game] = useDoc('games', gameId)\n+  const [firstUser] = useDoc('users', game.firstUser)\n+  const [secondUser] = useDoc('users', game.secondUser)\n+\n+  const newRound = () => {\n+    $game.set('history', [...game.history, {}])\n+    $game.set('status', GAME_STATUS.WAITING_ANSWER_PLAYERS)\n+  }\n+\n+  const finishGame = () => {\n+    $game.set('status', GAME_STATUS.COMPLETED)\n+    backToGames()\n+  }\n+\n+  const currentRound = (game.history && game.history[game.history.length - 1]) || {}\n+\n+  const getAnser = (isFirstUser) => {\n+    if (!game.firstUser || !game.secondUser) return ''\n+    if (currentRound[isFirstUser ? 'firstUserAnswer' : 'secondUserAnswer']) return ANSWER[(isFirstUser ? currentRound.firstUserAnswer : currentRound.secondUserAnswer).toUpperCase()].LABEL\n+    return 'еще не дал ответ'\n+  }\n+\n+  return pug`\n+    Title= game.name + ' - раунд ' + game.history.length\n+    Div.answers\n+      Row\n+        Span(bold)= (firstUser.firstName || 'Первый игрок еще не вошел в игру') + ': '\n+        Span= getAnser(true)\n+      Row\n+        Span(bold)= (secondUser.firstName|| 'Второй игрок еще не вошел в игру') + ': '\n+        Span= getAnser()\n+    Button.new(\n+      disabled=game.status !== GAME_STATUS.WAITING_NEW_ROUND\n+      onPress=newRound\n+    ) Новый раунд\n+    Button.end(\n+      onPress=finishGame\n+      disabled=game.status !== GAME_STATUS.WAITING_NEW_ROUND\n+    ) Закончить игру\n+  `\n+})"
  },
  {
    "sha": "e10617405bc89d7b5fe71fd670ad2c3cececeb6e",
    "filename": "main/pages/PGame/ProfessorGame/index.styl",
    "status": "added",
    "additions": 4,
    "deletions": 0,
    "changes": 4,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/ProfessorGame/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/ProfessorGame/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/ProfessorGame/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,4 @@\n+.answers\n+.new\n+.end\n+  margin-top 2u"
  },
  {
    "sha": "975bd6a8e42e098b8a16d5b22e721c3916d03f40",
    "filename": "main/pages/PGame/index.js",
    "status": "added",
    "additions": 21,
    "deletions": 0,
    "changes": 21,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,21 @@\n+import React from 'react'\n+import { withRouter } from 'react-router-native'\n+import { observer, useSession } from 'startupjs'\n+import { Content } from '@startupjs/ui'\n+import PlayerGame from './PlayerGame'\n+import ProfessorGame from './ProfessorGame'\n+\n+import './index.styl'\n+\n+export default observer(withRouter(function PGame ({ match: { params: { gameId } }, history }) {\n+  const [isProfessor] = useSession('isProfessor')\n+  const backToGames = () => history.push('/games')\n+\n+  return pug`\n+    Content.root\n+      if (isProfessor)\n+        ProfessorGame(gameId=gameId backToGames=backToGames)\n+      else\n+        PlayerGame(gameId=gameId backToGames=backToGames)\n+  `\n+}))"
  },
  {
    "sha": "eb0fb4f2b8627e6b71dde18465d6bd83d6be505c",
    "filename": "main/pages/PGame/index.styl",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGame/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGame/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,3 @@\n+.root\n+  padding 2u\n+  flex 1"
  },
  {
    "sha": "5ac9d89206ff13085d4fc321ef0f4bce4f6aa02a",
    "filename": "main/pages/PGames/Game/index.js",
    "status": "added",
    "additions": 38,
    "deletions": 0,
    "changes": 38,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/Game/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/Game/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/Game/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,38 @@\n+import React from 'react'\n+import { observer, useDoc } from 'startupjs'\n+import { Row, Button, Span, Div } from '@startupjs/ui'\n+import moment from 'moment'\n+\n+import './index.styl'\n+\n+export default observer(function Game ({ game, joinGame, getCountPlayers }) {\n+  const [professor] = useDoc('users', game.professor)\n+\n+  return pug`\n+    Row.row(\n+      level=1\n+      align=\"between\"\n+      vAlign=\"center\"\n+      shape=\"rounded\"\n+    )\n+      Div\n+        Span(\n+          bold\n+          variant=\"h6\"\n+        )= game.name\n+        Row\n+          Span(italic) Дата создания:#{' '}\n+          Span= moment(game.createdAt).format('MM-DD-YYYY:HH-MM')\n+        Row\n+          Span(italic) Количество участников:#{' '}\n+          Span= getCountPlayers(game)\n+        Row\n+          Span(italic) Профессор:#{' '}\n+          Span= professor.firstName\n+      Button(\n+        onPress=() => joinGame(game)\n+        color='primary'\n+        variant='flat'\n+      ) Войти\n+  `\n+})"
  },
  {
    "sha": "0ac33d203a7f116d36562b5c8f8ac8379defbd55",
    "filename": "main/pages/PGames/Game/index.styl",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/Game/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/Game/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/Game/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,3 @@\n+.row\n+  padding 2u\n+  margin-top 1u"
  },
  {
    "sha": "e7076e80e6e8930f7de1e8c79c1548daa7936f84",
    "filename": "main/pages/PGames/GamesList/index.js",
    "status": "added",
    "additions": 68,
    "deletions": 0,
    "changes": 68,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/GamesList/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/GamesList/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/GamesList/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,68 @@\n+import React, { useState } from 'react'\n+import { ScrollView } from 'react-native'\n+import { useHistory } from 'react-router-native'\n+import { observer, useSession, useBatchQuery, useBatch } from 'startupjs'\n+import { Row, Pagination } from '@startupjs/ui'\n+import { GAME_STATUS } from 'helpers/constants'\n+import Game from '../Game'\n+\n+import './index.styl'\n+\n+const LIMIT = 10\n+\n+export default observer(function GamesList () {\n+  const history = useHistory()\n+  const [isProfessor] = useSession('isProfessor')\n+  const [userId] = useSession('user.id')\n+  const [page, setPage] = useState(0)\n+  const queryForGamesList = isProfessor\n+    ? {\n+        professor: userId,\n+        status: { $ne: GAME_STATUS.COMPLETED }\n+      }\n+    : {\n+        $or: [\n+          { firstUser: userId, status: { $ne: GAME_STATUS.COMPLETED } },\n+          { secondUser: userId, status: { $ne: GAME_STATUS.COMPLETED } },\n+          { status: GAME_STATUS.WAITING_PLAYERS }\n+        ]\n+      }\n+  const [gamesList, $gamesList] = useBatchQuery('games', { ...queryForGamesList, $skip: page * LIMIT, $limit: LIMIT })\n+  const [gamesListCount] = useBatchQuery('games', { ...queryForGamesList, $count: true })\n+  useBatch()\n+\n+  const getCountPlayers = (game) => {\n+    let count = 0\n+    game.firstUser && count++\n+    game.secondUser && count++\n+    return count\n+  }\n+\n+  const joinGame = (game) => {\n+    if (!isProfessor && game.firstUser !== userId && game.secondUser !== userId && game.firstUser) {\n+      $gamesList.set(`${game.id}.secondUser`, userId)\n+      $gamesList.set(`${game.id}.status`, GAME_STATUS.WAITING_ANSWER_PLAYERS)\n+    }\n+    if (!isProfessor && game.firstUser !== userId && game.secondUser !== userId && !game.firstUser) {\n+      $gamesList.set(`${game.id}.firstUser`, userId)\n+    }\n+    history.push(`/games/${game.id}`)\n+  }\n+\n+  const pages = Math.ceil(gamesListCount / LIMIT)\n+\n+  return pug`\n+    ScrollView.scroll\n+      each game, index in gamesList\n+        Game(game=game joinGame=joinGame getCountPlayers=getCountPlayers key=game.id)\n+    if (pages > 1)\n+      Row(\n+        align=\"center\"\n+      )\n+        Pagination(\n+          page=page\n+          pages=pages\n+          onChangePage=setPage\n+        )\n+  `\n+})"
  },
  {
    "sha": "0d77494884c2c477e79fdecf2491495ebd2595fd",
    "filename": "main/pages/PGames/GamesList/index.styl",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/GamesList/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/GamesList/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/GamesList/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,3 @@\n+.scroll\n+  padding 1u\n+  margin-top 2u"
  },
  {
    "sha": "a6243468b8dddc09f300045962430e5957361748",
    "filename": "main/pages/PGames/index.js",
    "status": "added",
    "additions": 47,
    "deletions": 0,
    "changes": 47,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,47 @@\n+import React, { useState } from 'react'\n+import { observer, useSession, useModel } from 'startupjs'\n+import { Content, Button, TextInput, Link, Row, Checkbox } from '@startupjs/ui'\n+import { Title } from 'components'\n+import GamesList from './GamesList'\n+\n+import './index.styl'\n+\n+export default observer(function PGames () {\n+  const [isProfessor, $isProfessor] = useSession('isProfessor')\n+  const [userId] = useSession('user.id')\n+  const [gameName, setGameName] = useState('')\n+  const $games = useModel('games')\n+\n+  const onCreateGame = () => {\n+    $games.addNew(gameName, userId)\n+    setGameName('')\n+  }\n+\n+  return pug`\n+    Content.root\n+      Title Игры\n+      if isProfessor\n+        TextInput(\n+          label='Имя игры'\n+          placeholder='Введите имя игры'\n+          value=gameName\n+          onChangeText=setGameName\n+        )\n+        Button.create(\n+          color='primary'\n+          variant='flat'\n+          disabled=gameName.length <=2\n+          onPress=onCreateGame\n+        ) Создать игру\n+      GamesList\n+      Row(align=\"between\" vAlign=\"center\")\n+        Checkbox(\n+          label='Стать профессором'\n+          value=isProfessor\n+          onChange=(value) => $isProfessor.set(value)\n+        )\n+        Link.pastGame(\n+          to=\"/past-games\"\n+        ) Пройденные игры\n+  `\n+})"
  },
  {
    "sha": "308559aaee00b3b70b50597fb293ff8695c79b4f",
    "filename": "main/pages/PGames/index.styl",
    "status": "added",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PGames/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PGames/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,10 @@\n+.root\n+  padding 2u\n+  flex 1\n+\n+.create\n+  margin-top 1u\n+\n+.pastGame\n+  font(xl)\n+  text-align center"
  },
  {
    "sha": "83caf30104925f316fa1e0d409fe89a7af48d192",
    "filename": "main/pages/PHome/index.js",
    "status": "modified",
    "additions": 61,
    "deletions": 4,
    "changes": 65,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PHome/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PHome/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PHome/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1,12 +1,69 @@\n import React from 'react'\n import { ScrollView } from 'react-native'\n-import { observer } from 'startupjs'\n-import { Content } from '@startupjs/ui'\n+import { observer, useQuery, useSession } from 'startupjs'\n+import { Content, H2, Span, Row, Link, Button } from '@startupjs/ui'\n+import { AuthForm, LogoutButton } from '@startupjs/auth'\n+import * as localForms from '@startupjs/auth-local'\n+import { Title } from 'components'\n+import { GAME_STATUS } from 'helpers/constants'\n+\n import './index.styl'\n \n export default observer(function PHome () {\n+  const [games = []] = useQuery('games', { status: { $ne: GAME_STATUS.WAITING_PLAYERS } })\n+  const [users] = useQuery('users', {})\n+  const [loggedIn] = useSession('loggedIn')\n+\n+  const getName = (id) => {\n+    const user = users.find(e => e.id === id)\n+    if (user) return user.firstName\n+    return 'Неизвестный юзер'\n+  }\n+\n+  const getScoreTable = () => {\n+    let scoreTable = []\n+    if (games.length) {\n+      const players = {}\n+\n+      games.forEach(g => {\n+        if (!g.history.length) return\n+        const lastGame = g.history[g.history.length - 1]\n+        players[g.firstUser] = (players[g.firstUser] || 0) + (lastGame.allScoreFirstUser || 0)\n+        players[g.secondUser] = (players[g.secondUser] || 0) + (lastGame.allScoreSecondUser || 0)\n+      })\n+\n+      for (const key in players) {\n+        scoreTable.push({\n+          name: getName(key),\n+          score: players[key]\n+        })\n+      }\n+      scoreTable.sort((a, b) => b.score - a.score)\n+    }\n+    return scoreTable\n+  }\n+\n   return pug`\n-    ScrollView.root\n-      Content\n+    Content.root\n+      Title Игра \"Камень - ножница - бумага\"\n+      // AuthForm(localForms=localForms)\n+      if (!loggedIn)\n+        AuthForm(localForms=localForms)\n+      else\n+        LogoutButton\n+        Link(to=\"/games\")\n+          Button.games Go to Game\n+      if (getScoreTable().length > 0)\n+        H2.leaders(bold) Лидеры\n+        ScrollView.scroll\n+          each item, index in getScoreTable()\n+            Row.row(\n+              level=1\n+              align=\"between\"\n+              shape=\"rounded\"\n+              key=index\n+            )\n+              Span(styleName={isFirst: index === 0})= item.name\n+              Span(styleName={isFirst: index === 0})= item.score\n   `\n })"
  },
  {
    "sha": "c0d4395b5d270a7366b7b0f32899098de841e659",
    "filename": "main/pages/PHome/index.styl",
    "status": "modified",
    "additions": 16,
    "deletions": 1,
    "changes": 17,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PHome/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PHome/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PHome/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1,3 +1,18 @@\n .root\n-  padding 2u 0\n+  padding 2u\n   flex 1\n+\n+.leaders\n+  margin-top 4u\n+  font(xl)\n+  text-align center\n+\n+.scroll\n+  padding 1u\n+\n+.row\n+  margin-top 1u\n+  padding 1u\n+\n+.isFirst\n+  color $UI.colors.success"
  },
  {
    "sha": "f74763482b1cd0d03c0edeb5936f9b66fb592ecc",
    "filename": "main/pages/PPastGames/HistoryGame/index.js",
    "status": "added",
    "additions": 59,
    "deletions": 0,
    "changes": 59,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/HistoryGame/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/HistoryGame/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PPastGames/HistoryGame/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,59 @@\n+import React, { useState } from 'react'\n+import { observer } from 'startupjs'\n+import { Div, Pagination, Span, Row, Table, Thead, Tbody, Tr, Th, Td } from '@startupjs/ui'\n+import { ANSWER } from 'helpers/constants'\n+\n+import './index.styl'\n+\n+const LIMIT = 10\n+\n+export default observer(function PPastGames ({ history, firstUserName, secondUserName }) {\n+  const [page, setPage] = useState(0)\n+  const historyPagination = history.slice(page * LIMIT, page * LIMIT + LIMIT)\n+  const pages = Math.ceil(history.length / LIMIT)\n+\n+  return pug`\n+    if (pages > 1)\n+      Row(align=\"center\")\n+        Pagination(\n+          page=page\n+          pages=pages\n+          onChangePage=setPage\n+        )\n+    each item, index in historyPagination\n+      Div(\n+        key=index\n+      )\n+        Span.round(bold) Раунд #{index + 1}\n+        Table.table\n+          Thead\n+            Tr\n+              Th\n+                Span Игрок\n+              Th\n+                Span Ответ\n+              Th\n+                Span Баллы за раунд\n+              Th\n+                Span Всего баллов\n+          Tbody\n+            Tr\n+              Td\n+                Span= firstUserName\n+              Td\n+                Span= ANSWER[item.firstUserAnswer.toUpperCase()].LABEL\n+              Td\n+                Span= item.scoreFirstUser\n+              Td\n+                Span= item.allScoreFirstUser\n+            Tr\n+              Td\n+                Span= secondUserName\n+              Td\n+                Span= ANSWER[item.secondUserAnswer.toUpperCase()].LABEL\n+              Td\n+                Span= item.scoreSecondUser\n+              Td\n+                Span= item.allScoreSecondUser\n+  `\n+})"
  },
  {
    "sha": "8900618e5f26fd0a439df35929b14a8d77e90bf2",
    "filename": "main/pages/PPastGames/HistoryGame/index.styl",
    "status": "added",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/HistoryGame/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/HistoryGame/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PPastGames/HistoryGame/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,6 @@\n+.round\n+  margin-top 2u\n+\n+.table\n+  margin-top 1u\n+  border 1px solid $UI.colors.dark"
  },
  {
    "sha": "150b78f35c6105a24124be5495b6cb58c4a68c50",
    "filename": "main/pages/PPastGames/index.js",
    "status": "added",
    "additions": 99,
    "deletions": 0,
    "changes": 99,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PPastGames/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,99 @@\n+import React, { useState } from 'react'\n+import { ScrollView } from 'react-native'\n+import { observer, useSession, useBatchQuery, useBatch } from 'startupjs'\n+import { Div, Pagination, Span, Link, Collapse, Content, Row } from '@startupjs/ui'\n+import { Title } from 'components'\n+import { GAME_STATUS } from 'helpers/constants'\n+import HistoryGame from './HistoryGame'\n+\n+import './index.styl'\n+\n+const LIMIT = 10\n+\n+export default observer(function PPastGames () {\n+  const [expand, setExpand] = useState()\n+  const [isProfessor] = useSession('isProfessor')\n+  const [page, setPage] = useState(0)\n+  const [userId] = useSession('user.id')\n+  const queryForGamesList = isProfessor\n+    ? {\n+        professor: userId,\n+        status: GAME_STATUS.COMPLETED\n+      }\n+    : {\n+        $or: [\n+          { firstUser: userId, status: GAME_STATUS.COMPLETED },\n+          { secondUser: userId, status: GAME_STATUS.COMPLETED }\n+        ]\n+      }\n+  const [users] = useBatchQuery('users', {})\n+  const [gamesList = []] = useBatchQuery('games', { ...queryForGamesList, $skip: page * LIMIT, $limit: LIMIT })\n+  const [gamesListCount] = useBatchQuery('games', { ...queryForGamesList, $count: true })\n+\n+  useBatch()\n+\n+  const getName = (id) => {\n+    const user = users.find(e => e.id === id)\n+    if (user) return user.firstName\n+    return 'Неизвестный юзер'\n+  }\n+\n+  const getScore = (isFirstUser, history) => {\n+    return history[history.length - 1][isFirstUser ? 'allScoreFirstUser' : 'allScoreSecondUser']\n+  }\n+\n+  const handleChange = (panel) => (shouldExpand) => {\n+    setExpand(shouldExpand ? panel : null)\n+  }\n+\n+  const pages = Math.ceil(gamesListCount / LIMIT)\n+\n+  return pug`\n+    Content.root\n+      Title Пройденные игры\n+      Row(\n+        align=\"right\"\n+      )\n+        Link(to=\"/games\") Назад\n+      if (gamesList.length === 0)\n+        Row(\n+          align=\"center\"\n+        )\n+          Span.warning У вас нет пройденных игр\n+      else\n+        ScrollView.scroll\n+          each game, index in gamesList\n+            Div.container(\n+              key=index\n+              level=2\n+            )\n+              Span(\n+                bold\n+                variant=\"h6\"\n+              )= game.name\n+              Row\n+                Span(italic) Игроки:#{' '}\n+                Span= getName(game.firstUser) + ' / ' + getName(game.secondUser)\n+              Row\n+                Span(italic) Cчет:#{' '}\n+                Span= getScore(true, game.history) + ' / ' + getScore(false, game.history)\n+              Row\n+                Span(italic) Профессор: #{' '}\n+                Span= getName(game.professor)\n+              Collapse.collapse(\n+                open=expand === game.id\n+                title=\"История игры\"\n+                onChange=handleChange(game.id)\n+                variant=\"pure\"\n+              )\n+                if (expand === game.id)\n+                  HistoryGame(history=game.history firstUserName=getName(game.firstUser) secondUserName=getName(game.secondUser))\n+        if (pages > 1)\n+          Row(align=\"center\")\n+            Pagination(\n+              page=page\n+              pages=pages\n+              onChangePage=setPage\n+            )\n+  `\n+})"
  },
  {
    "sha": "c9f59da1bda0933ada0eb8369beebad7fe92ed71",
    "filename": "main/pages/PPastGames/index.styl",
    "status": "added",
    "additions": 18,
    "deletions": 0,
    "changes": 18,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/index.styl",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/PPastGames/index.styl",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/PPastGames/index.styl?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,18 @@\n+.root\n+  padding 2u\n+  flex 1\n+\n+.warning\n+  margin-top 3u\n+  font(xxl)\n+  color $UI.colors.warning\n+\n+.scroll\n+  padding 1u\n+\n+.container\n+  margin-top 2u\n+  padding 2u\n+\n+.collapse\n+  margin-top 2u"
  },
  {
    "sha": "16b9ce8087a9b72445ac8c390bda7eda99942893",
    "filename": "main/pages/index.js",
    "status": "modified",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/pages/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/pages/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1 +1,4 @@\n export { default as PHome } from './PHome'\n+export { default as PGames } from './PGames'\n+export { default as PGame } from './PGame'\n+export { default as PPastGames } from './PPastGames'"
  },
  {
    "sha": "2593a6158558abc711373873996f0b5c5b6ca631",
    "filename": "main/routes.js",
    "status": "modified",
    "additions": 15,
    "deletions": 0,
    "changes": 15,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/routes.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/main/routes.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/main/routes.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -3,5 +3,20 @@ export default (components = {}) => [\n     path: '/',\n     exact: true,\n     component: components.PHome\n+  },\n+  {\n+    path: '/games',\n+    exact: true,\n+    component: components.PGames\n+  },\n+  {\n+    path: '/games/:gameId',\n+    exact: true,\n+    component: components.PGame\n+  },\n+  {\n+    path: '/past-games',\n+    exact: true,\n+    component: components.PPastGames\n   }\n ]"
  },
  {
    "sha": "3f7773743125d862f39ec4e323f7ce02a9dda60a",
    "filename": "model/GameModel.js",
    "status": "added",
    "additions": 62,
    "deletions": 0,
    "changes": 62,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/GameModel.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/GameModel.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/model/GameModel.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,62 @@\n+import { BaseModel } from 'startupjs/orm'\n+import { ANSWER, GAME_STATUS } from 'helpers/constants'\n+\n+export default class GameModel extends BaseModel {\n+  setAnser (isFirstUser, value) {\n+    const { firstUserAnswer, secondUserAnswer } = this.getCurrentRound()\n+    const userAnswer = isFirstUser ? 'firstUserAnswer' : 'secondUserAnswer'\n+    const id = (this.get('history')).length - 1\n+    this.set(`history.${id}.${userAnswer}`, value)\n+\n+    if (secondUserAnswer || firstUserAnswer) {\n+      const lastGame = this.getLastGame()\n+      const winner = this.getWinner()\n+      const combo = this.getCombo(winner, lastGame.combo)\n+      const scoreFirstUser = this.getScore(winner === 'firstUser', lastGame.combo === 'firstUser', lastGame.allScoreFirstUser || 0)\n+      const scoreSecondUser = this.getScore(winner === 'secondUser', lastGame.combo === 'secondUser', lastGame.allScoreSecondUser || 0)\n+      const allScoreFirstUser = (lastGame.allScoreFirstUser || 0) + scoreFirstUser\n+      const allScoreSecondUser = (lastGame.allScoreSecondUser || 0) + scoreSecondUser\n+\n+      this.set(`history.${id}`, {\n+        winner,\n+        combo,\n+        scoreFirstUser,\n+        scoreSecondUser,\n+        allScoreFirstUser,\n+        allScoreSecondUser,\n+        firstUserAnswer: firstUserAnswer || value,\n+        secondUserAnswer: secondUserAnswer || value\n+      })\n+      this.set('status', GAME_STATUS.WAITING_NEW_ROUND)\n+    }\n+  }\n+\n+  getCurrentRound () {\n+    const history = this.get('history')\n+    return history[history.length - 1]\n+  }\n+\n+  getLastGame () {\n+    const history = this.get('history')\n+    return history[history.length - 2] || {}\n+  }\n+\n+  getWinner () {\n+    const { firstUserAnswer, secondUserAnswer } = this.getCurrentRound()\n+    if (firstUserAnswer === secondUserAnswer) return null\n+    if (firstUserAnswer === ANSWER.SURRENDER.ID || ANSWER[secondUserAnswer.toUpperCase()].STRONGER.includes(firstUserAnswer)) return 'secondUser'\n+    // if (secondUserAnswer === ANSWER.SURRENDER.ID || ANSWER[firstUserAnswer.toUpperCase()].STRONGER.includes(secondUserAnswer)) return 'firstUser'\n+    return 'firstUser'\n+  }\n+\n+  getCombo (winner, lastCombo) {\n+    if (winner === null) return lastCombo\n+    return winner\n+  }\n+\n+  getScore (isWinner, isLastCombo, lastScore) {\n+    if (!isWinner) return 0\n+    if (!isLastCombo) return 1\n+    return lastScore\n+  }\n+}"
  },
  {
    "sha": "5ebe8cb61be254390445845ee14219783c086a72",
    "filename": "model/GamesModel.js",
    "status": "added",
    "additions": 18,
    "deletions": 0,
    "changes": 18,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/GamesModel.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/GamesModel.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/model/GamesModel.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -0,0 +1,18 @@\n+import { BaseModel } from 'startupjs/orm'\n+import { GAME_STATUS } from 'helpers/constants'\n+\n+export default class GamesModel extends BaseModel {\n+  async addNew (name, professor) {\n+    const createdAt = Date.now()\n+    const id = await this.add({\n+      name,\n+      firstUser: null,\n+      secondUser: null,\n+      professor,\n+      createdAt,\n+      status: GAME_STATUS.WAITING_PLAYERS,\n+      history: [{}]\n+    })\n+    return id\n+  }\n+}"
  },
  {
    "sha": "3fb962b07ccb890274657e5529bdc4817802eae9",
    "filename": "model/index.js",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/shir-dm/stone/blob/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/index.js",
    "raw_url": "https://github.com/shir-dm/stone/raw/df6fc92a1d01f11d8e1f60c6e39964e2486a73ba/model/index.js",
    "contents_url": "https://api.github.com/repos/shir-dm/stone/contents/model/index.js?ref=df6fc92a1d01f11d8e1f60c6e39964e2486a73ba",
    "patch": "@@ -1,2 +1,7 @@\n+import Games from './GamesModel'\n+import Game from './GameModel'\n+\n export default function (racer) {\n+  racer.orm('games', Games)\n+  racer.orm('games.*', Game)\n }"
  }
]
