[
  {
    "sha": "c161d865edae3e9dafb5bcb9cbc54fc57778b4ce",
    "filename": "README.md",
    "status": "modified",
    "additions": 5,
    "deletions": 5,
    "changes": 10,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/README.md",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/README.md",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/README.md?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -20,7 +20,7 @@\n ## 版本说明\n | 最新版本     | mica 版本         | spring boot 版本  | spring cloud 版本 |\n | ----------- | ---------------- | ---------------- | ----------------- |\n-| 2.4.2-GA    | mica 2.4.x       | 2.4.x            | 2020              |\n+| 2.4.3-GA    | mica 2.4.x       | 2.4.x            | 2020              |\n | 2.1.1-GA    | mica 2.0.x~2.1.x | 2.2.x ~ 2.3.x    | Hoxton            |\n \n ## mica 生态\n@@ -49,18 +49,18 @@ lombok 生成的 method 问题：https://github.com/rzwitserloot/lombok/issues/1\n ## 协议解释\n LGPL（[GNU Lesser General Public License](http://www.gnu.org/licenses/lgpl.html)）\n \n-LGPL是GPL的一个为主要为类库使用设计的开源协议。和GPL要求任何使用/修改/衍生之GPL类库的的软件必须采用GPL协议不同。LGPL允许商业软件通过类库引用(link)方式使用LGPL类库而不需要开源商业软件的代码。这使得采用LGPL协议的开源代码可以被商业软件作为类库引用并发布和销售。\n+LGPL 是 GPL 的一个为主要为类库使用设计的开源协议。和 GPL 要求任何使用/修改/衍生之 GPL 类库的的软件必须采用 GPL 协议不同。LGPL 允许商业软件通过类库引用(link)方式使用 LGPL 类库而不需要开源商业软件的代码。这使得采用 LGPL 协议的开源代码可以被商业软件作为类库引用并发布和销售。\n \n-但是如果修改LGPL协议的代码或者衍生，则所有修改的代码，涉及修改部分的额外代码和衍生的代码都必须采用LGPL协议。因此LGPL协议的开源代码很适合作为第三方类库被商业软件引用，但不适合希望以LGPL协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。\n+但是如果修改 LGPL 协议的代码或者衍生，则所有修改的代码，涉及修改部分的额外代码和衍生的代码都必须采用 LGPL 协议。因此 LGPL 协议的开源代码很适合作为第三方类库被商业软件引用，但不适合希望以 LGPL 协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。\n \n ## 用户权益\n 允许以引入不改源码的形式免费用于学习、毕设、公司项目、私活等。\n \n 特殊情况修改代码，但仍然想闭源需经过作者同意。\n \n-对未经过授权和不遵循 lgpl 协议二次开源或者商业化我们将追究到底。\n+对未经过授权和不遵循 LGPL 协议二次开源或者商业化我们将追究到底。\n \n-参考请注明：参考自 mica：https://github.com/lets-mica/mica ，另请遵循 lgpl 协议。\n+参考请注明：参考自 mica：https://github.com/lets-mica/mica ，另请遵循 LGPL 协议。\n \n `注意`：若禁止条款被发现有权追讨 **19999** 的授权费。\n "
  },
  {
    "sha": "25d1f9decb2e57c4efb547f42d0b49db14330803",
    "filename": "build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/build.gradle",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/build.gradle",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/build.gradle?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -4,7 +4,7 @@ plugins {\n \n ext {\n     javaVersion = JavaVersion.VERSION_1_8\n-    springBootVersion = \"2.4.2\"\n+    springBootVersion = \"2.4.4\"\n     springCloudVersion = \"2020.0.1\"\n     micaAutoVersion = \"2.0.3\"\n     micaWeiXinVersion = \"2.0.5\""
  },
  {
    "sha": "b38af8d95d7d09f51a8fb0af4f784c6e827d1cf9",
    "filename": "gradle.properties",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/gradle.properties",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/gradle.properties",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/gradle.properties?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -1,4 +1,4 @@\n-VERSION=2.4.3-GA\n+VERSION=2.4.4-SNAPSHOT\n GROUPID=net.dreamlu\n \n SONAR_TOKEN=***"
  },
  {
    "sha": "235fe98ee6f53483c0e725896020c40900f7b167",
    "filename": "mica-core/src/main/java/net/dreamlu/mica/core/utils/DesensitizationUtil.java",
    "status": "modified",
    "additions": 76,
    "deletions": 40,
    "changes": 116,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-core/src/main/java/net/dreamlu/mica/core/utils/DesensitizationUtil.java",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-core/src/main/java/net/dreamlu/mica/core/utils/DesensitizationUtil.java",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-core/src/main/java/net/dreamlu/mica/core/utils/DesensitizationUtil.java?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -37,10 +37,7 @@\n \t */\n \t@Nullable\n \tpublic static String chineseName(@Nullable final String fullName) {\n-\t\tif (StringUtil.isBlank(fullName)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(fullName, 1, 0, CharPool.STAR);\n+\t\treturn sensitive(fullName, 1, 0);\n \t}\n \n \t/**\n@@ -51,10 +48,7 @@ public static String chineseName(@Nullable final String fullName) {\n \t */\n \t@Nullable\n \tpublic static String idCardNum(@Nullable final String id) {\n-\t\tif (StringUtil.isBlank(id)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(id, 0, 4, CharPool.STAR);\n+\t\treturn sensitive(id, 0, 4);\n \t}\n \n \t/**\n@@ -65,10 +59,7 @@ public static String idCardNum(@Nullable final String id) {\n \t */\n \t@Nullable\n \tpublic static String phoneNo(@Nullable final String num) {\n-\t\tif (StringUtil.isBlank(num)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(num, 0, 4, CharPool.STAR);\n+\t\treturn sensitive(num, 0, 4);\n \t}\n \n \t/**\n@@ -79,10 +70,7 @@ public static String phoneNo(@Nullable final String num) {\n \t */\n \t@Nullable\n \tpublic static String mobileNo(@Nullable final String num) {\n-\t\tif (StringUtil.isBlank(num)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(num, 3, 4, CharPool.STAR);\n+\t\treturn sensitive(num, 3, 4);\n \t}\n \n \t/**\n@@ -94,10 +82,7 @@ public static String mobileNo(@Nullable final String num) {\n \t */\n \t@Nullable\n \tpublic static String address(@Nullable final String address, final int sensitiveSize) {\n-\t\tif (StringUtil.isBlank(address)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(address, 0, sensitiveSize, CharPool.STAR);\n+\t\treturn sensitive(address, 0, sensitiveSize);\n \t}\n \n \t/**\n@@ -115,7 +100,7 @@ public static String email(@Nullable final String email) {\n \t\tif (index <= 1) {\n \t\t\treturn email;\n \t\t} else {\n-\t\t\treturn sensitive(email, 1, email.length() - index, CharPool.STAR);\n+\t\t\treturn sensitive(email, 1, email.length() - index);\n \t\t}\n \t}\n \n@@ -127,10 +112,7 @@ public static String email(@Nullable final String email) {\n \t */\n \t@Nullable\n \tpublic static String bankCard(@Nullable final String cardNum) {\n-\t\tif (StringUtil.isBlank(cardNum)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(cardNum, 6, 4, CharPool.STAR);\n+\t\treturn sensitive(cardNum, 6, 4);\n \t}\n \n \t/**\n@@ -141,10 +123,7 @@ public static String bankCard(@Nullable final String cardNum) {\n \t */\n \t@Nullable\n \tpublic static String cnapsCode(@Nullable final String code) {\n-\t\tif (StringUtil.isBlank(code)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(code, 2, 0, CharPool.STAR);\n+\t\treturn sensitive(code, 2, 0);\n \t}\n \n \t/**\n@@ -159,7 +138,7 @@ public static String right(@Nullable final String sensitiveStr) {\n \t\t\treturn StringPool.EMPTY;\n \t\t}\n \t\tint length = sensitiveStr.length();\n-\t\treturn sensitive(sensitiveStr, length / 2, 0, CharPool.STAR);\n+\t\treturn sensitive(sensitiveStr, length / 2, 0);\n \t}\n \n \t/**\n@@ -174,7 +153,7 @@ public static String left(@Nullable final String sensitiveStr) {\n \t\t\treturn StringPool.EMPTY;\n \t\t}\n \t\tint length = sensitiveStr.length();\n-\t\treturn sensitive(sensitiveStr, 0, length / 2, CharPool.STAR);\n+\t\treturn sensitive(sensitiveStr, 0, length / 2);\n \t}\n \n \t/**\n@@ -208,33 +187,90 @@ public static String middle(@Nullable final String sensitiveStr) {\n \t */\n \t@Nullable\n \tpublic static String all(@Nullable final String sensitiveStr) {\n-\t\tif (StringUtil.isBlank(sensitiveStr)) {\n-\t\t\treturn StringPool.EMPTY;\n-\t\t}\n-\t\treturn sensitive(sensitiveStr, 0, 0, CharPool.STAR);\n+\t\treturn sensitive(sensitiveStr, 0, 0);\n+\t}\n+\n+\t/**\n+\t * 文本脱敏\n+\t *\n+\t * @param str       字符串\n+\t * @param fromIndex 开始的索引\n+\t * @param lastSize  尾部长度\n+\t * @return 脱敏后的字符串\n+\t */\n+\t@Nullable\n+\tpublic static String sensitive(@Nullable String str, int fromIndex, int lastSize) {\n+\t\treturn sensitive(str, fromIndex, lastSize, CharPool.STAR);\n+\t}\n+\n+\t/**\n+\t * 文本脱敏\n+\t *\n+\t * @param str       字符串\n+\t * @param fromIndex 开始的索引\n+\t * @param lastSize  尾部长度\n+\t * @param padSize   填充的长度\n+\t * @return 脱敏后的字符串\n+\t */\n+\t@Nullable\n+\tpublic static String sensitive(@Nullable String str, int fromIndex, int lastSize, int padSize) {\n+\t\treturn sensitive(str, fromIndex, lastSize, CharPool.STAR, padSize);\n \t}\n \n-\tprivate static String sensitive(String str, int fromIndex, int lastSize, char padChar) {\n+\t/**\n+\t * 文本脱敏\n+\t *\n+\t * @param str       字符串\n+\t * @param fromIndex 开始的索引\n+\t * @param lastSize  尾部长度\n+\t * @param padChar   填充的字符\n+\t * @return 脱敏后的字符串\n+\t */\n+\t@Nullable\n+\tpublic static String sensitive(@Nullable String str, int fromIndex, int lastSize, char padChar) {\n+\t\treturn sensitive(str, fromIndex, lastSize, padChar, -1);\n+\t}\n+\n+\t/**\n+\t * 文本脱敏\n+\t *\n+\t * @param str       字符串\n+\t * @param fromIndex 开始的索引\n+\t * @param lastSize  尾部长度\n+\t * @param padChar   填充的字符\n+\t * @param padSize   填充的长度\n+\t * @return 脱敏后的字符串\n+\t */\n+\t@Nullable\n+\tpublic static String sensitive(@Nullable String str, int fromIndex, int lastSize, char padChar, int padSize) {\n+\t\tif (str == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (StringUtil.isBlank(str)) {\n+\t\t\treturn StringPool.EMPTY;\n+\t\t}\n \t\tint length = str.length();\n \t\t// 全部脱敏\n \t\tif (fromIndex == 0 && lastSize == 0) {\n-\t\t\treturn StringUtil.repeat(CharPool.STAR, length);\n+\t\t\tint padSiz = padSize > 0 ? padSize : length;\n+\t\t\treturn StringUtil.repeat(CharPool.STAR, padSiz);\n \t\t}\n \t\tint toIndex = length - lastSize;\n+\t\tint padSiz = padSize > 0 ? padSize : toIndex - fromIndex;\n \t\t// 头部脱敏\n \t\tif (fromIndex == 0) {\n \t\t\tString tail = str.substring(toIndex);\n-\t\t\treturn StringUtil.repeat(padChar, toIndex - fromIndex).concat(tail);\n+\t\t\treturn StringUtil.repeat(padChar, padSiz).concat(tail);\n \t\t}\n \t\t// 尾部脱敏\n \t\tif (toIndex == length) {\n \t\t\tString head = str.substring(0, fromIndex);\n-\t\t\treturn head.concat(StringUtil.repeat(padChar, toIndex - fromIndex));\n+\t\t\treturn head.concat(StringUtil.repeat(padChar, padSiz));\n \t\t}\n \t\t// 中部\n \t\tString head = str.substring(0, fromIndex);\n \t\tString tail = str.substring(toIndex);\n-\t\treturn head + StringUtil.repeat(padChar, toIndex - fromIndex) + tail;\n+\t\treturn head + StringUtil.repeat(padChar, padSiz) + tail;\n \t}\n \n }"
  },
  {
    "sha": "bd951b3a3fba017bc6278affe0b2ce1edc5ded45",
    "filename": "mica-core/src/test/java/net/dreamlu/mica/test/utils/DesensitizationUtilTest.java",
    "status": "modified",
    "additions": 7,
    "deletions": 0,
    "changes": 7,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-core/src/test/java/net/dreamlu/mica/test/utils/DesensitizationUtilTest.java",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-core/src/test/java/net/dreamlu/mica/test/utils/DesensitizationUtilTest.java",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-core/src/test/java/net/dreamlu/mica/test/utils/DesensitizationUtilTest.java?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -74,4 +74,11 @@ public void test8() {\n \t\tAssert.assertEquals(\"11***\", middle1);\n \t}\n \n+\t@Test\n+\tpublic void test9() {\n+\t\tString str1 = \"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIzYzNlOGI5MTljMjg2OTMzYjIxMWRkNzNlNTgwZmJiNSIsImF1ZCI6Ik1pY2EtRmFzdC1XZWIiLCJpc3MiOiJNaWNhLUZhc3QtQXBpIiwiaWF0IjoxNjE1NDQzODQzLCJzdWIiOiJhZG1pbiIsIm5iZiI6MTYxNTQ0Mzg0MywiZXhwIjoxNjE4MDM1ODQzfQ.XjZV-f0r3FK75VjSdM7lNFf6rU4v_2jxPwD-_-NfyN4\";\n+\t\tString sensitive = DesensitizationUtil.sensitive(str1, 14, 14, 4);\n+\t\tAssert.assertEquals(\"eyJhbGciOiJIUz****2jxPwD-_-NfyN4\", sensitive);\n+\t}\n+\n }"
  },
  {
    "sha": "cb0e35b4f81e4056e18d17aeea5c232b56936e09",
    "filename": "mica-ip2region/src/main/java/net/dreamlu/mica/ip2region/core/DbSearcher.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/main/java/net/dreamlu/mica/ip2region/core/DbSearcher.java",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/main/java/net/dreamlu/mica/ip2region/core/DbSearcher.java",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-ip2region/src/main/java/net/dreamlu/mica/ip2region/core/DbSearcher.java?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -165,7 +165,7 @@ public DataBlock btreeSearch(long ip) throws IOException {\n \t\tif (HeaderSip == null) {\n \t\t\t//reader.seek(8L);    //pass the super block\n \t\t\t//byte[] b = new byte[dbConfig.getTotalHeaderSize()];\n-\t\t\tbyte[] b = new byte[4096];\n+\t\t\tbyte[] b = new byte[8 * 1024];\n \t\t\t//pass the super block\n \t\t\treader.readFully(8L, b, 0, b.length);\n "
  },
  {
    "sha": "3b6a296ee296d2b5e5fec5b4d5328c699f0c4229",
    "filename": "mica-ip2region/src/main/resources/ip2region/ip2region.db",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/main/resources/ip2region/ip2region.db",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/main/resources/ip2region/ip2region.db",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-ip2region/src/main/resources/ip2region/ip2region.db?ref=f791a527c2a8f8b7f99591d84f92417cc955f308"
  },
  {
    "sha": "74b72fd71cc63eb18a6a515265e31f882a478404",
    "filename": "mica-ip2region/src/test/java/net/dreamlu/mica/ip2region/test/Ip2regionTest.java",
    "status": "modified",
    "additions": 9,
    "deletions": 0,
    "changes": 9,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/test/java/net/dreamlu/mica/ip2region/test/Ip2regionTest.java",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-ip2region/src/test/java/net/dreamlu/mica/ip2region/test/Ip2regionTest.java",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-ip2region/src/test/java/net/dreamlu/mica/ip2region/test/Ip2regionTest.java?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -3,7 +3,9 @@\n import net.dreamlu.mica.ip2region.config.Ip2regionConfiguration;\n import net.dreamlu.mica.ip2region.config.Ip2regionProperties;\n import net.dreamlu.mica.ip2region.core.Ip2regionSearcher;\n+import net.dreamlu.mica.ip2region.core.IpInfo;\n import net.dreamlu.mica.ip2region.impl.Ip2regionSearcherImpl;\n+import org.junit.Assert;\n import org.junit.Before;\n import org.junit.Test;\n import org.springframework.context.annotation.AnnotationConfigApplicationContext;\n@@ -35,4 +37,11 @@ public void getRegion() throws Exception {\n \t\tSystem.out.println(searcher.memorySearch(\"223.29.220.0\"));\n \t\tSystem.out.println(searcher.memorySearch(\"82.120.124.0\"));\n \t}\n+\n+\t@Test\n+\tpublic void test2() {\n+\t\tIpInfo ipInfo = searcher.btreeSearch(\"127.0.0.1\");\n+\t\tAssert.assertNotNull(ipInfo);\n+\t}\n+\n }"
  },
  {
    "sha": "2fbe49a01d51a81c08b757e2ab9d02eb4dd04e1a",
    "filename": "mica-redis/src/main/java/net/dreamlu/mica/redis/cache/MicaRedisCache.java",
    "status": "modified",
    "additions": 24,
    "deletions": 20,
    "changes": 44,
    "blob_url": "https://github.com/caixiaomao/mica/blob/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-redis/src/main/java/net/dreamlu/mica/redis/cache/MicaRedisCache.java",
    "raw_url": "https://github.com/caixiaomao/mica/raw/f791a527c2a8f8b7f99591d84f92417cc955f308/mica-redis/src/main/java/net/dreamlu/mica/redis/cache/MicaRedisCache.java",
    "contents_url": "https://api.github.com/repos/caixiaomao/mica/contents/mica-redis/src/main/java/net/dreamlu/mica/redis/cache/MicaRedisCache.java?ref=f791a527c2a8f8b7f99591d84f92417cc955f308",
    "patch": "@@ -224,11 +224,12 @@ public Long del(Collection<String> keys) {\n \t\tfinal Set<String> keySet = new HashSet<>();\n \t\tRedisSerializer<String> keySerializer = (RedisSerializer<String>) redisTemplate.getKeySerializer();\n \t\treturn redisTemplate.execute((RedisCallback<Pair<Long, Set<String>>>) action -> {\n-\t\t\tScanOptions options = ScanOptions.scanOptions()\n-\t\t\t\t.match(pattern)\n-\t\t\t\t.count(count)\n-\t\t\t\t.build();\n-\t\t\ttry (Cursor<byte[]> cursor = action.scan(options)) {\n+\t\t\tScanOptions.ScanOptionsBuilder builder = ScanOptions.scanOptions()\n+\t\t\t\t.match(pattern);\n+\t\t\tif (count != null) {\n+\t\t\t\tbuilder.count(count);\n+\t\t\t}\n+\t\t\ttry (Cursor<byte[]> cursor = action.scan(builder.build())) {\n \t\t\t\tcursor.forEachRemaining((item) -> keySet.add(keySerializer.deserialize(item)));\n \t\t\t\treturn Pair.create(cursor.getPosition(), keySet);\n \t\t\t} catch (IOException e) {\n@@ -259,11 +260,12 @@ public void scan(@Nullable String pattern, Consumer<String> consumer) {\n \tpublic void scan(@Nullable String pattern, @Nullable Long count, Consumer<String> consumer) {\n \t\tRedisSerializer<String> keySerializer = (RedisSerializer<String>) redisTemplate.getKeySerializer();\n \t\tredisTemplate.execute((RedisCallback<Object>) action -> {\n-\t\t\tScanOptions options = ScanOptions.scanOptions()\n-\t\t\t\t.match(pattern)\n-\t\t\t\t.count(count)\n-\t\t\t\t.build();\n-\t\t\ttry (Cursor<byte[]> cursor = action.scan(options)) {\n+\t\t\tScanOptions.ScanOptionsBuilder builder = ScanOptions.scanOptions()\n+\t\t\t\t.match(pattern);\n+\t\t\tif (count != null) {\n+\t\t\t\tbuilder.count(count);\n+\t\t\t}\n+\t\t\ttry (Cursor<byte[]> cursor = action.scan(builder.build())) {\n \t\t\t\tcursor.forEachRemaining((item) -> {\n \t\t\t\t\tString redisKey = keySerializer.deserialize(item);\n \t\t\t\t\tconsumer.accept(redisKey);\n@@ -300,11 +302,12 @@ public void scan(@Nullable String pattern, @Nullable Long count, Consumer<String\n \t\tfinal Set<String> keySet = new HashSet<>();\n \t\tRedisSerializer<String> keySerializer = (RedisSerializer<String>) redisTemplate.getKeySerializer();\n \t\treturn redisTemplate.execute((RedisCallback<Pair<Long, Set<String>>>) action -> {\n-\t\t\tScanOptions options = ScanOptions.scanOptions()\n-\t\t\t\t.match(pattern)\n-\t\t\t\t.count(count)\n-\t\t\t\t.build();\n-\t\t\ttry (Cursor<byte[]> cursor = action.sScan(keySerializer.serialize(key), options)) {\n+\t\t\tScanOptions.ScanOptionsBuilder builder = ScanOptions.scanOptions()\n+\t\t\t\t.match(pattern);\n+\t\t\tif (count != null) {\n+\t\t\t\tbuilder.count(count);\n+\t\t\t}\n+\t\t\ttry (Cursor<byte[]> cursor = action.sScan(keySerializer.serialize(key), builder.build())) {\n \t\t\t\tcursor.forEachRemaining((item) -> keySet.add(keySerializer.deserialize(item)));\n \t\t\t\treturn Pair.create(cursor.getPosition(), keySet);\n \t\t\t} catch (IOException e) {\n@@ -337,11 +340,12 @@ public void sScan(String key, @Nullable String pattern, Consumer<String> consume\n \tpublic void sScan(String key, @Nullable String pattern, @Nullable Long count, Consumer<String> consumer) {\n \t\tRedisSerializer<String> keySerializer = (RedisSerializer<String>) redisTemplate.getKeySerializer();\n \t\tredisTemplate.execute((RedisCallback<Object>) action -> {\n-\t\t\tScanOptions options = ScanOptions.scanOptions()\n-\t\t\t\t.match(pattern)\n-\t\t\t\t.count(count)\n-\t\t\t\t.build();\n-\t\t\ttry (Cursor<byte[]> cursor = action.sScan(keySerializer.serialize(key), options)) {\n+\t\t\tScanOptions.ScanOptionsBuilder builder = ScanOptions.scanOptions()\n+\t\t\t\t.match(pattern);\n+\t\t\tif (count != null) {\n+\t\t\t\tbuilder.count(count);\n+\t\t\t}\n+\t\t\ttry (Cursor<byte[]> cursor = action.sScan(keySerializer.serialize(key), builder.build())) {\n \t\t\t\tcursor.forEachRemaining((item) -> {\n \t\t\t\t\tString redisKey = keySerializer.deserialize(item);\n \t\t\t\t\tconsumer.accept(redisKey);"
  }
]
