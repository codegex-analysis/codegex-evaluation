[
  {
    "sha": "67365771fb604f9b78bc0348f9215bd617f3a12c",
    "filename": "build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/testable/testable-selenium-java/blob/c8d1cb446bddf1dd7849627cfa73a350d96b2d4e/build.gradle",
    "raw_url": "https://github.com/testable/testable-selenium-java/raw/c8d1cb446bddf1dd7849627cfa73a350d96b2d4e/build.gradle",
    "contents_url": "https://api.github.com/repos/testable/testable-selenium-java/contents/build.gradle?ref=c8d1cb446bddf1dd7849627cfa73a350d96b2d4e",
    "patch": "@@ -1,5 +1,5 @@\n group 'io.testable'\n-version '0.0.12'\n+version '0.0.13'\n \n buildscript {\n     repositories {"
  },
  {
    "sha": "4f40042407a97c42138b126ba0b31182fe83a808",
    "filename": "src/main/java/io/testable/selenium/TestableSelenium.java",
    "status": "modified",
    "additions": 69,
    "deletions": 0,
    "changes": 69,
    "blob_url": "https://github.com/testable/testable-selenium-java/blob/c8d1cb446bddf1dd7849627cfa73a350d96b2d4e/src/main/java/io/testable/selenium/TestableSelenium.java",
    "raw_url": "https://github.com/testable/testable-selenium-java/raw/c8d1cb446bddf1dd7849627cfa73a350d96b2d4e/src/main/java/io/testable/selenium/TestableSelenium.java",
    "contents_url": "https://api.github.com/repos/testable/testable-selenium-java/contents/src/main/java/io/testable/selenium/TestableSelenium.java?ref=c8d1cb446bddf1dd7849627cfa73a350d96b2d4e",
    "patch": "@@ -21,6 +21,7 @@\n import java.nio.file.Paths;\n import java.util.Collections;\n import java.util.Map;\n+import java.util.HashMap;\n \n /**\n  * Main entry point for creating a selenium driver for use on the Testable platform as well as a set of useful\n@@ -39,6 +40,9 @@\n     public static final String PROFILE_DIR = System.getProperty(\"TESTABLE_PROFILE_DIR\");\n     public static final String RESULT_FILE = System.getProperty(\"TESTABLE_RESULT_FILE\");\n \n+    public static final String DISPLAY_SIZE = System.getProperty(\"DISPLAY_SIZE\");\n+    public static final String USER_AGENT = System.getProperty(\"USER_AGENT\");\n+    public static final String SCALE_FACTOR = System.getProperty(\"SCALE_FACTOR\");\n \n     private static String RUM_SPEEDINDEXJS;\n     static {\n@@ -105,6 +109,51 @@ else if (browserName.equals(BrowserType.FIREFOX))\n                     if (PROFILE_DIR != null)\n                         opts.addArguments(\"--user-data-dir=\" + PROFILE_DIR);\n                     opts.addArguments(\"--profile-directory=Profile\" + GLOBAL_CLIENT_INDEX);\n+\n+                    opts.addArguments(\"--window-position=0,0\");\n+\n+                    if(SCALE_FACTOR != null) {\n+                        opts.addArguments(\"--force-device-scale-factor=\" + SCALE_FACTOR);\n+                        opts.addArguments(\"--high-dpi-support=\" + SCALE_FACTOR);\n+                    }\n+\n+                    if (DISPLAY_SIZE != null) {\n+                        String[] screenSize = DISPLAY_SIZE.split(\"x\", -1);\n+                        Float width = Float.parseFloat(screenSize[0]);\n+                        Float height = Float.parseFloat(screenSize[1]);\n+\n+                        if (SCALE_FACTOR != null) {\n+                            width = width / Float.parseFloat(SCALE_FACTOR);\n+                            height = height / Float.parseFloat(SCALE_FACTOR);\n+                        }\n+\n+                        opts.addArguments(\"--window-size=\" + Math.round(width) + \",\" + Math.round(height));\n+                    }\n+\n+                    if(USER_AGENT != null){\n+                        String[] screenSize = DISPLAY_SIZE.split(\"x\", -1);\n+                        Float width = Float.parseFloat(screenSize[0]);\n+                        Float height = Float.parseFloat(screenSize[1]);\n+\n+                        if (SCALE_FACTOR != null) {\n+                            width = width / Float.parseFloat(SCALE_FACTOR);\n+                            height = height / Float.parseFloat(SCALE_FACTOR);\n+                        }\n+\n+                        Map<String, Object> deviceMetrics = new HashMap<>();\n+\n+                        deviceMetrics.put(\"width\", Math.round(width));\n+                        deviceMetrics.put(\"height\", Math.round(height));\n+\n+                        deviceMetrics.put(\"pixelRatio\", Float.parseFloat(SCALE_FACTOR));\n+\n+                        Map<String, Object> mobileEmulation = new HashMap<>();\n+                        mobileEmulation.put(\"deviceMetrics\", deviceMetrics);\n+                        mobileEmulation.put(\"userAgent\", USER_AGENT);\n+\n+                        opts.setExperimentalOption(\"mobileEmulation\", mobileEmulation);\n+                    }\n+\n                     if (CHROME_BINARY_PATH != null)\n                         opts.setBinary(CHROME_BINARY_PATH);\n                 } else if (caps instanceof FirefoxOptions) {\n@@ -127,6 +176,26 @@ else if (browserName.equals(BrowserType.FIREFOX))\n                     opts.addPreference(\"services.sync.prefs.sync.browser.newtabpage.activity-stream.feeds.snippets\", false);\n                     if (FIREFOX_BINARY_PATH != null)\n                         opts.setBinary(FIREFOX_BINARY_PATH);\n+\n+                    if(USER_AGENT != null){\n+                        opts.addPreference(\"general.useragent.override\", USER_AGENT);\n+                        opts.addPreference(\"layout.css.devPixelsPerPx\", SCALE_FACTOR);\n+                    }\n+\n+                    if (DISPLAY_SIZE != null) {\n+                        String[] screenSize = DISPLAY_SIZE.split(\"x\", -1);\n+\n+                        Float width = Float.parseFloat(screenSize[0]);\n+                        Float height = Float.parseFloat(screenSize[1]);\n+\n+                        if (SCALE_FACTOR != null) {\n+                            width = width / Float.parseFloat(SCALE_FACTOR);\n+                            height = height / Float.parseFloat(SCALE_FACTOR);\n+                        }\n+\n+                        opts.addArguments(\"--width\", \"\" + Math.round(width));\n+                        opts.addArguments(\"--height\", \"\" + Math.round(height));\n+                    }\n                 }\n             }\n             int port = SELENIUM_PORT > 0 ? SELENIUM_PORT : 4444;"
  }
]
