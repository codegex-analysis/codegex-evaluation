[
  {
    "sha": "b025dda028d31a2b1b3d34bf8e5ff72406485646",
    "filename": "src/main/java/com/parkit/parkingsystem/dao/TicketDAO.java",
    "status": "modified",
    "additions": 78,
    "deletions": 74,
    "changes": 152,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/dao/TicketDAO.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/dao/TicketDAO.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/main/java/com/parkit/parkingsystem/dao/TicketDAO.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,89 +1,93 @@\n package com.parkit.parkingsystem.dao;\n \n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.Timestamp;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n import com.parkit.parkingsystem.config.DataBaseConfig;\n import com.parkit.parkingsystem.constants.DBConstants;\n import com.parkit.parkingsystem.constants.ParkingType;\n import com.parkit.parkingsystem.model.ParkingSpot;\n import com.parkit.parkingsystem.model.Ticket;\n-import org.apache.logging.log4j.LogManager;\n-import org.apache.logging.log4j.Logger;\n-\n-import java.sql.Connection;\n-import java.sql.PreparedStatement;\n-import java.sql.ResultSet;\n-import java.sql.Timestamp;\n \n public class TicketDAO {\n \n-    private static final Logger logger = LogManager.getLogger(\"TicketDAO\");\n+\tprivate static final Logger logger = LogManager.getLogger(\"TicketDAO\");\n \n-    public DataBaseConfig dataBaseConfig = new DataBaseConfig();\n+\tpublic DataBaseConfig dataBaseConfig = new DataBaseConfig();\n \n-    public boolean saveTicket(Ticket ticket){\n-        Connection con = null;\n-        try {\n-            con = dataBaseConfig.getConnection();\n-            PreparedStatement ps = con.prepareStatement(DBConstants.SAVE_TICKET);\n-            //ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME)\n-            //ps.setInt(1,ticket.getId());\n-            ps.setInt(1,ticket.getParkingSpot().getId());\n-            ps.setString(2, ticket.getVehicleRegNumber());\n-            ps.setDouble(3, ticket.getPrice());\n-            ps.setTimestamp(4, new Timestamp(ticket.getInTime().getTime()));\n-            ps.setTimestamp(5, (ticket.getOutTime() == null)?null: (new Timestamp(ticket.getOutTime().getTime())) );\n-            return ps.execute();\n-        }catch (Exception ex){\n-            logger.error(\"Error fetching next available slot\",ex);\n-        }finally {\n-            dataBaseConfig.closeConnection(con);\n-            return false;\n-        }\n-    }\n+\tpublic boolean saveTicket(Ticket ticket) {\n+\t\tConnection con = null;\n+\t\ttry {\n+\t\t\tcon = dataBaseConfig.getConnection();\n+\t\t\tPreparedStatement ps = con.prepareStatement(DBConstants.SAVE_TICKET);\n+\t\t\t// ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME, DISCOUNT)\n+\t\t\t// ps.setInt(1,ticket.getId());\n+\t\t\tps.setInt(1, ticket.getParkingSpot().getId());\n+\t\t\tps.setString(2, ticket.getVehicleRegNumber());\n+\t\t\tps.setDouble(3, ticket.getPrice());\n+\t\t\tps.setTimestamp(4, new Timestamp(ticket.getInTime().getTime()));\n+\t\t\tps.setTimestamp(5, (ticket.getOutTime() == null) ? null : (new Timestamp(ticket.getOutTime().getTime())));\n+\t\t\tps.setBoolean(6, ticket.isDiscount()); // add discount line\n+\t\t\treturn ps.execute();\n+\t\t} catch (Exception ex) {\n+\t\t\tlogger.error(\"Error fetching next available slot\", ex);\n+\t\t} finally {\n+\t\t\tdataBaseConfig.closeConnection(con);\n+\t\t\treturn false;\n+\t\t}\n+\t}\n \n-    public Ticket getTicket(String vehicleRegNumber) {\n-        Connection con = null;\n-        Ticket ticket = null;\n-        try {\n-            con = dataBaseConfig.getConnection();\n-            PreparedStatement ps = con.prepareStatement(DBConstants.GET_TICKET);\n-            //ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME)\n-            ps.setString(1,vehicleRegNumber);\n-            ResultSet rs = ps.executeQuery();\n-            if(rs.next()){\n-                ticket = new Ticket();\n-                ParkingSpot parkingSpot = new ParkingSpot(rs.getInt(1), ParkingType.valueOf(rs.getString(6)),false);\n-                ticket.setParkingSpot(parkingSpot);\n-                ticket.setId(rs.getInt(2));\n-                ticket.setVehicleRegNumber(vehicleRegNumber);\n-                ticket.setPrice(rs.getDouble(3));\n-                ticket.setInTime(rs.getTimestamp(4));\n-                ticket.setOutTime(rs.getTimestamp(5));\n-            }\n-            dataBaseConfig.closeResultSet(rs);\n-            dataBaseConfig.closePreparedStatement(ps);\n-        }catch (Exception ex){\n-            logger.error(\"Error fetching next available slot\",ex);\n-        }finally {\n-            dataBaseConfig.closeConnection(con);\n-            return ticket;\n-        }\n-    }\n+\tpublic Ticket getTicket(String vehicleRegNumber) {\n+\t\tConnection con = null;\n+\t\tTicket ticket = null;\n+\t\ttry {\n+\t\t\tcon = dataBaseConfig.getConnection();\n+\t\t\tPreparedStatement ps = con.prepareStatement(DBConstants.GET_TICKET);\n+\t\t\t// ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME, DISCOUNT)\n+\t\t\tps.setString(1, vehicleRegNumber);\n+\t\t\tResultSet rs = ps.executeQuery();\n+\t\t\tif (rs.next()) {\n+\t\t\t\tticket = new Ticket();\n+\t\t\t\tParkingSpot parkingSpot = new ParkingSpot(rs.getInt(1), ParkingType.valueOf(rs.getString(6)), false);\n+\t\t\t\tticket.setParkingSpot(parkingSpot);\n+\t\t\t\tticket.setId(rs.getInt(2));\n+\t\t\t\tticket.setVehicleRegNumber(vehicleRegNumber);\n+\t\t\t\tticket.setPrice(rs.getDouble(3));\n+\t\t\t\tticket.setInTime(rs.getTimestamp(4));\n+\t\t\t\tticket.setOutTime(rs.getTimestamp(5));\n+\t\t\t\tticket.setDiscount(rs.getBoolean(6)); // add discount line\n+\t\t\t}\n+\t\t\tdataBaseConfig.closeResultSet(rs);\n+\t\t\tdataBaseConfig.closePreparedStatement(ps);\n+\t\t} catch (Exception ex) {\n+\t\t\tlogger.error(\"Error fetching next available slot\", ex);\n+\t\t} finally {\n+\t\t\tdataBaseConfig.closeConnection(con);\n+\t\t\treturn ticket;\n+\t\t}\n+\t}\n \n-    public boolean updateTicket(Ticket ticket) {\n-        Connection con = null;\n-        try {\n-            con = dataBaseConfig.getConnection();\n-            PreparedStatement ps = con.prepareStatement(DBConstants.UPDATE_TICKET);\n-            ps.setDouble(1, ticket.getPrice());\n-            ps.setTimestamp(2, new Timestamp(ticket.getOutTime().getTime()));\n-            ps.setInt(3,ticket.getId());\n-            ps.execute();\n-            return true;\n-        }catch (Exception ex){\n-            logger.error(\"Error saving ticket info\",ex);\n-        }finally {\n-            dataBaseConfig.closeConnection(con);\n-        }\n-        return false;\n-    }\n+\tpublic boolean updateTicket(Ticket ticket) {\n+\t\tConnection con = null;\n+\t\ttry {\n+\t\t\tcon = dataBaseConfig.getConnection();\n+\t\t\tPreparedStatement ps = con.prepareStatement(DBConstants.UPDATE_TICKET);\n+\t\t\tps.setDouble(1, ticket.getPrice());\n+\t\t\tps.setTimestamp(2, new Timestamp(ticket.getOutTime().getTime()));\n+\t\t\tps.setInt(3, ticket.getId());\n+\t\t\tps.setTimestamp(4, new Timestamp(ticket.getInTime().getTime())); // Add line for update ticket\n+\t\t\tps.execute();\n+\t\t\treturn true;\n+\t\t} catch (Exception ex) {\n+\t\t\tlogger.error(\"Error saving ticket info\", ex);\n+\t\t} finally {\n+\t\t\tdataBaseConfig.closeConnection(con);\n+\t\t}\n+\t\treturn false;\n+\t}\n }"
  },
  {
    "sha": "f2093842201dbdf205a0cc6062ce508d5d12e2b9",
    "filename": "src/main/java/com/parkit/parkingsystem/model/Ticket.java",
    "status": "modified",
    "additions": 63,
    "deletions": 55,
    "changes": 118,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/model/Ticket.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/model/Ticket.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/main/java/com/parkit/parkingsystem/model/Ticket.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,61 +1,69 @@\n package com.parkit.parkingsystem.model;\n \n-import java.util.Calendar;\n import java.util.Date;\n \n public class Ticket {\n-    private int id;\n-    private ParkingSpot parkingSpot;\n-    private String vehicleRegNumber;\n-    private double price;\n-    private Date inTime;\n-    private Date outTime;\n-\n-    public int getId() {\n-        return id;\n-    }\n-\n-    public void setId(int id) {\n-        this.id = id;\n-    }\n-\n-    public ParkingSpot getParkingSpot() {\n-        return parkingSpot;\n-    }\n-\n-    public void setParkingSpot(ParkingSpot parkingSpot) {\n-        this.parkingSpot = parkingSpot;\n-    }\n-\n-    public String getVehicleRegNumber() {\n-        return vehicleRegNumber;\n-    }\n-\n-    public void setVehicleRegNumber(String vehicleRegNumber) {\n-        this.vehicleRegNumber = vehicleRegNumber;\n-    }\n-\n-    public double getPrice() {\n-        return price;\n-    }\n-\n-    public void setPrice(double price) {\n-        this.price = price;\n-    }\n-\n-    public Date getInTime() {\n-        return inTime;\n-    }\n-\n-    public void setInTime(Date inTime) {\n-        this.inTime = inTime;\n-    }\n-\n-    public Date getOutTime() {\n-        return outTime;\n-    }\n-\n-    public void setOutTime(Date outTime) {\n-        this.outTime = outTime;\n-    }\n+\tprivate int id;\n+\tprivate ParkingSpot parkingSpot;\n+\tprivate String vehicleRegNumber;\n+\tprivate double price;\n+\tprivate Date inTime;\n+\tprivate Date outTime;\n+\tprivate boolean discount;\n+\n+\tpublic int getId() {\n+\t\treturn id;\n+\t}\n+\n+\tpublic void setId(int id) {\n+\t\tthis.id = id;\n+\t}\n+\n+\tpublic ParkingSpot getParkingSpot() {\n+\t\treturn parkingSpot;\n+\t}\n+\n+\tpublic void setParkingSpot(ParkingSpot parkingSpot) {\n+\t\tthis.parkingSpot = parkingSpot;\n+\t}\n+\n+\tpublic String getVehicleRegNumber() {\n+\t\treturn vehicleRegNumber;\n+\t}\n+\n+\tpublic void setVehicleRegNumber(String vehicleRegNumber) {\n+\t\tthis.vehicleRegNumber = vehicleRegNumber;\n+\t}\n+\n+\tpublic double getPrice() {\n+\t\treturn price;\n+\t}\n+\n+\tpublic void setPrice(double price) {\n+\t\tthis.price = price;\n+\t}\n+\n+\tpublic Date getInTime() {\n+\t\treturn inTime;\n+\t}\n+\n+\tpublic void setInTime(Date inTime) {\n+\t\tthis.inTime = inTime;\n+\t}\n+\n+\tpublic Date getOutTime() {\n+\t\treturn outTime;\n+\t}\n+\n+\tpublic void setOutTime(Date outTime) {\n+\t\tthis.outTime = outTime;\n+\t}\n+\n+\tpublic boolean isDiscount() {\n+\t\treturn discount;\n+\t}\n+\n+\tpublic void setDiscount(boolean discount) {\n+\t\tthis.discount = discount;\n+\t}\n }"
  },
  {
    "sha": "f2106056eaa3a4e9b7ad6eaaead7f3c597ee659f",
    "filename": "src/main/java/com/parkit/parkingsystem/service/FareCalculatorService.java",
    "status": "modified",
    "additions": 26,
    "deletions": 20,
    "changes": 46,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/service/FareCalculatorService.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/service/FareCalculatorService.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/main/java/com/parkit/parkingsystem/service/FareCalculatorService.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,31 +1,37 @@\n package com.parkit.parkingsystem.service;\n \n+import static java.time.temporal.ChronoUnit.SECONDS;\n+\n import com.parkit.parkingsystem.constants.Fare;\n import com.parkit.parkingsystem.model.Ticket;\n \n public class FareCalculatorService {\n \n-    public void calculateFare(Ticket ticket){\n-        if( (ticket.getOutTime() == null) || (ticket.getOutTime().before(ticket.getInTime())) ){\n-            throw new IllegalArgumentException(\"Out time provided is incorrect:\"+ticket.getOutTime().toString());\n-        }\n+\tpublic void calculateFare(Ticket ticket) {\n+\t\tif ((ticket.getOutTime() == null) || (ticket.getOutTime().before(ticket.getInTime()))) {\n+\t\t\tthrow new IllegalArgumentException(\"Out time provided is incorrect:\" + ticket.getOutTime().toString());\n+\t\t}\n \n-        int inHour = ticket.getInTime().getHours();\n-        int outHour = ticket.getOutTime().getHours();\n+\t\tdouble duration = SECONDS.between(ticket.getInTime().toInstant(), ticket.getOutTime().toInstant());\n \n-        //TODO: Some tests are failing here. Need to check if this logic is correct\n-        int duration = outHour - inHour;\n+\t\tswitch (ticket.getParkingSpot().getParkingType()) {\n+\t\tcase CAR: {\n+\t\t\tif (duration > 1800) {\n+\t\t\t\tticket.setPrice(duration / 3600 * Fare.CAR_RATE_PER_HOUR);\n+\t\t\t}\n+\t\t\tbreak;\n+\t\t}\n+\t\tcase BIKE: {\n+\t\t\tif (duration > 1800) {\n+\t\t\t\tticket.setPrice(duration / 3600 * Fare.BIKE_RATE_PER_HOUR);\n+\t\t\t}\n+\t\t\tbreak;\n+\t\t}\n+\t\tdefault:\n+\t\t\tthrow new IllegalArgumentException(\"Unkown Parking Type\");\n+\t\t}\n+\t\tif (ticket.isDiscount())\n+\t\t\tticket.setPrice(ticket.getPrice() * 0.95);\n \n-        switch (ticket.getParkingSpot().getParkingType()){\n-            case CAR: {\n-                ticket.setPrice(duration * Fare.CAR_RATE_PER_HOUR);\n-                break;\n-            }\n-            case BIKE: {\n-                ticket.setPrice(duration * Fare.BIKE_RATE_PER_HOUR);\n-                break;\n-            }\n-            default: throw new IllegalArgumentException(\"Unkown Parking Type\");\n-        }\n-    }\n+\t}\n }\n\\ No newline at end of file"
  },
  {
    "sha": "fc9f78424c16abf87c1021ed7ce019f50c04916e",
    "filename": "src/main/java/com/parkit/parkingsystem/service/ParkingService.java",
    "status": "modified",
    "additions": 119,
    "deletions": 108,
    "changes": 227,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/service/ParkingService.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/main/java/com/parkit/parkingsystem/service/ParkingService.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/main/java/com/parkit/parkingsystem/service/ParkingService.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,120 +1,131 @@\n package com.parkit.parkingsystem.service;\n \n+import java.util.Date;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n import com.parkit.parkingsystem.constants.ParkingType;\n import com.parkit.parkingsystem.dao.ParkingSpotDAO;\n import com.parkit.parkingsystem.dao.TicketDAO;\n import com.parkit.parkingsystem.model.ParkingSpot;\n import com.parkit.parkingsystem.model.Ticket;\n import com.parkit.parkingsystem.util.InputReaderUtil;\n-import org.apache.logging.log4j.LogManager;\n-import org.apache.logging.log4j.Logger;\n-\n-import java.util.Date;\n \n public class ParkingService {\n \n-    private static final Logger logger = LogManager.getLogger(\"ParkingService\");\n-\n-    private static FareCalculatorService fareCalculatorService = new FareCalculatorService();\n-\n-    private InputReaderUtil inputReaderUtil;\n-    private ParkingSpotDAO parkingSpotDAO;\n-    private  TicketDAO ticketDAO;\n-\n-    public ParkingService(InputReaderUtil inputReaderUtil, ParkingSpotDAO parkingSpotDAO, TicketDAO ticketDAO){\n-        this.inputReaderUtil = inputReaderUtil;\n-        this.parkingSpotDAO = parkingSpotDAO;\n-        this.ticketDAO = ticketDAO;\n-    }\n-\n-    public void processIncomingVehicle() {\n-        try{\n-            ParkingSpot parkingSpot = getNextParkingNumberIfAvailable();\n-            if(parkingSpot !=null && parkingSpot.getId() > 0){\n-                String vehicleRegNumber = getVehichleRegNumber();\n-                parkingSpot.setAvailable(false);\n-                parkingSpotDAO.updateParking(parkingSpot);//allot this parking space and mark it's availability as false\n-\n-                Date inTime = new Date();\n-                Ticket ticket = new Ticket();\n-                //ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME)\n-                //ticket.setId(ticketID);\n-                ticket.setParkingSpot(parkingSpot);\n-                ticket.setVehicleRegNumber(vehicleRegNumber);\n-                ticket.setPrice(0);\n-                ticket.setInTime(inTime);\n-                ticket.setOutTime(null);\n-                ticketDAO.saveTicket(ticket);\n-                System.out.println(\"Generated Ticket and saved in DB\");\n-                System.out.println(\"Please park your vehicle in spot number:\"+parkingSpot.getId());\n-                System.out.println(\"Recorded in-time for vehicle number:\"+vehicleRegNumber+\" is:\"+inTime);\n-            }\n-        }catch(Exception e){\n-            logger.error(\"Unable to process incoming vehicle\",e);\n-        }\n-    }\n-\n-    private String getVehichleRegNumber() throws Exception {\n-        System.out.println(\"Please type the vehicle registration number and press enter key\");\n-        return inputReaderUtil.readVehicleRegistrationNumber();\n-    }\n-\n-    public ParkingSpot getNextParkingNumberIfAvailable(){\n-        int parkingNumber=0;\n-        ParkingSpot parkingSpot = null;\n-        try{\n-            ParkingType parkingType = getVehichleType();\n-            parkingNumber = parkingSpotDAO.getNextAvailableSlot(parkingType);\n-            if(parkingNumber > 0){\n-                parkingSpot = new ParkingSpot(parkingNumber,parkingType, true);\n-            }else{\n-                throw new Exception(\"Error fetching parking number from DB. Parking slots might be full\");\n-            }\n-        }catch(IllegalArgumentException ie){\n-            logger.error(\"Error parsing user input for type of vehicle\", ie);\n-        }catch(Exception e){\n-            logger.error(\"Error fetching next available parking slot\", e);\n-        }\n-        return parkingSpot;\n-    }\n-\n-    private ParkingType getVehichleType(){\n-        System.out.println(\"Please select vehicle type from menu\");\n-        System.out.println(\"1 CAR\");\n-        System.out.println(\"2 BIKE\");\n-        int input = inputReaderUtil.readSelection();\n-        switch(input){\n-            case 1: {\n-                return ParkingType.CAR;\n-            }\n-            case 2: {\n-                return ParkingType.BIKE;\n-            }\n-            default: {\n-                System.out.println(\"Incorrect input provided\");\n-                throw new IllegalArgumentException(\"Entered input is invalid\");\n-            }\n-        }\n-    }\n-\n-    public void processExitingVehicle() {\n-        try{\n-            String vehicleRegNumber = getVehichleRegNumber();\n-            Ticket ticket = ticketDAO.getTicket(vehicleRegNumber);\n-            Date outTime = new Date();\n-            ticket.setOutTime(outTime);\n-            fareCalculatorService.calculateFare(ticket);\n-            if(ticketDAO.updateTicket(ticket)) {\n-                ParkingSpot parkingSpot = ticket.getParkingSpot();\n-                parkingSpot.setAvailable(true);\n-                parkingSpotDAO.updateParking(parkingSpot);\n-                System.out.println(\"Please pay the parking fare:\" + ticket.getPrice());\n-                System.out.println(\"Recorded out-time for vehicle number:\" + ticket.getVehicleRegNumber() + \" is:\" + outTime);\n-            }else{\n-                System.out.println(\"Unable to update ticket information. Error occurred\");\n-            }\n-        }catch(Exception e){\n-            logger.error(\"Unable to process exiting vehicle\",e);\n-        }\n-    }\n+\tprivate static final Logger logger = LogManager.getLogger(\"ParkingService\");\n+\n+\tprivate static FareCalculatorService fareCalculatorService = new FareCalculatorService();\n+\n+\tprivate InputReaderUtil inputReaderUtil;\n+\tprivate ParkingSpotDAO parkingSpotDAO;\n+\tprivate TicketDAO ticketDAO;\n+\n+\tpublic ParkingService(InputReaderUtil inputReaderUtil, ParkingSpotDAO parkingSpotDAO, TicketDAO ticketDAO) {\n+\t\tthis.inputReaderUtil = inputReaderUtil;\n+\t\tthis.parkingSpotDAO = parkingSpotDAO;\n+\t\tthis.ticketDAO = ticketDAO;\n+\t}\n+\n+\tpublic void processIncomingVehicle() {\n+\t\ttry {\n+\t\t\tParkingSpot parkingSpot = getNextParkingNumberIfAvailable();\n+\t\t\tif (parkingSpot != null && parkingSpot.getId() > 0) {\n+\t\t\t\tString vehicleRegNumber = getVehicleRegNumber();\n+\t\t\t\tparkingSpot.setAvailable(false);\n+\t\t\t\tparkingSpotDAO.updateParking(parkingSpot);// allot this parking space and mark it's availability as\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// false\n+\t\t\t\tDate inTime = new Date();\n+\t\t\t\tTicket ticket = new Ticket();\n+\t\t\t\t// ID, PARKING_NUMBER, VEHICLE_REG_NUMBER, PRICE, IN_TIME, OUT_TIME, DISCOUNT)\n+\t\t\t\t// ticket.setId(ticketID);\n+\t\t\t\tticket.setParkingSpot(parkingSpot);\n+\t\t\t\tticket.setVehicleRegNumber(vehicleRegNumber);\n+\t\t\t\tticket.setPrice(0);\n+\t\t\t\tticket.setInTime(inTime);\n+\t\t\t\tticket.setOutTime(null);\n+\t\t\t\tTicket customer = ticketDAO.getTicket(ticket.getVehicleRegNumber()); // create Ticket customer with\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// reference Database\n+\t\t\t\tticket.setDiscount(customer != null); // if customer is know => discount price\n+\n+\t\t\t\tticketDAO.saveTicket(ticket);\n+\t\t\t\tSystem.out.println(\"Generated Ticket and saved in DB\");\n+\n+\t\t\t\tif (customer != null) // if customer is know => welcome message\n+\t\t\t\t\tSystem.out.println(\"Welcome back! As a customer, you benefit from a 5% discount\");\n+\n+\t\t\t\tSystem.out.println(\"Please park your vehicle in spot number:\" + parkingSpot.getId());\n+\t\t\t\tSystem.out.println(\"Recorded in-time for vehicle number:\" + vehicleRegNumber + \" is:\" + inTime);\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlogger.error(\"Unable to process incoming vehicle\", e);\n+\t\t}\n+\t}\n+\n+\tprivate String getVehicleRegNumber() throws Exception {\n+\t\tSystem.out.println(\"Please type the vehicle registration number and press enter key\");\n+\t\treturn inputReaderUtil.readVehicleRegistrationNumber();\n+\t}\n+\n+\tpublic ParkingSpot getNextParkingNumberIfAvailable() {\n+\t\tint parkingNumber = 0;\n+\t\tParkingSpot parkingSpot = null;\n+\t\ttry {\n+\t\t\tParkingType parkingType = getVehicleType();\n+\t\t\tparkingNumber = parkingSpotDAO.getNextAvailableSlot(parkingType);\n+\t\t\tif (parkingNumber > 0) {\n+\t\t\t\tparkingSpot = new ParkingSpot(parkingNumber, parkingType, true);\n+\t\t\t} else {\n+\t\t\t\tthrow new Exception(\"Error fetching parking number from DB. Parking slots might be full\");\n+\t\t\t}\n+\t\t} catch (IllegalArgumentException ie) {\n+\t\t\tlogger.error(\"Error parsing user input for type of vehicle\", ie);\n+\t\t} catch (Exception e) {\n+\t\t\tlogger.error(\"Error fetching next available parking slot\", e);\n+\t\t}\n+\t\treturn parkingSpot;\n+\t}\n+\n+\tprivate ParkingType getVehicleType() {\n+\t\tSystem.out.println(\"Please select vehicle type from menu\");\n+\t\tSystem.out.println(\"1 CAR\");\n+\t\tSystem.out.println(\"2 BIKE\");\n+\t\tint input = inputReaderUtil.readSelection();\n+\t\tswitch (input) {\n+\t\tcase 1: {\n+\t\t\treturn ParkingType.CAR;\n+\t\t}\n+\t\tcase 2: {\n+\t\t\treturn ParkingType.BIKE;\n+\t\t}\n+\t\tdefault: {\n+\t\t\tSystem.out.println(\"Incorrect input provided\");\n+\t\t\tthrow new IllegalArgumentException(\"Entered input is invalid\");\n+\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic void processExitingVehicle() {\n+\t\ttry {\n+\t\t\tString vehicleRegNumber = getVehicleRegNumber();\n+\t\t\tTicket ticket = ticketDAO.getTicket(vehicleRegNumber);\n+\t\t\tDate outTime = new Date();\n+\t\t\toutTime.setTime(outTime.getTime());\n+\t\t\tticket.setOutTime(outTime);\n+\t\t\tfareCalculatorService.calculateFare(ticket);\n+\t\t\tif (ticketDAO.updateTicket(ticket)) {\n+\t\t\t\tParkingSpot parkingSpot = ticket.getParkingSpot();\n+\t\t\t\tparkingSpot.setAvailable(true);\n+\t\t\t\tparkingSpotDAO.updateParking(parkingSpot);\n+\t\t\t\tSystem.out.println(\"Please pay the parking fare:\" + ticket.getPrice());\n+\t\t\t\tSystem.out.println(\n+\t\t\t\t\t\t\"Recorded out-time for vehicle number:\" + ticket.getVehicleRegNumber() + \" is:\" + outTime);\n+\t\t\t} else {\n+\t\t\t\tSystem.out.println(\"Unable to update ticket information. Error occurred\");\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlogger.error(\"Unable to process exiting vehicle\", e);\n+\t\t}\n+\t}\n }"
  },
  {
    "sha": "085e8ee3265e1d27cd47ad4bf0150a67db2b3173",
    "filename": "src/test/java/com/parkit/parkingsystem/FareCalculatorServiceTest.java",
    "status": "modified",
    "additions": 187,
    "deletions": 115,
    "changes": 302,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/test/java/com/parkit/parkingsystem/FareCalculatorServiceTest.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/test/java/com/parkit/parkingsystem/FareCalculatorServiceTest.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/test/java/com/parkit/parkingsystem/FareCalculatorServiceTest.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,127 +1,199 @@\n package com.parkit.parkingsystem;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.util.Date;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n import com.parkit.parkingsystem.constants.Fare;\n import com.parkit.parkingsystem.constants.ParkingType;\n import com.parkit.parkingsystem.model.ParkingSpot;\n import com.parkit.parkingsystem.model.Ticket;\n import com.parkit.parkingsystem.service.FareCalculatorService;\n-import org.junit.jupiter.api.BeforeAll;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Test;\n-\n-import static org.junit.jupiter.api.Assertions.*;\n-\n-import java.util.Date;\n \n public class FareCalculatorServiceTest {\n \n-    private static FareCalculatorService fareCalculatorService;\n-    private Ticket ticket;\n-\n-    @BeforeAll\n-    private static void setUp() {\n-        fareCalculatorService = new FareCalculatorService();\n-    }\n-\n-    @BeforeEach\n-    private void setUpPerTest() {\n-        ticket = new Ticket();\n-    }\n-\n-    @Test\n-    public void calculateFareCar(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  60 * 60 * 1000) );\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        fareCalculatorService.calculateFare(ticket);\n-        assertEquals(ticket.getPrice(), Fare.CAR_RATE_PER_HOUR);\n-    }\n-\n-    @Test\n-    public void calculateFareBike(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  60 * 60 * 1000) );\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        fareCalculatorService.calculateFare(ticket);\n-        assertEquals(ticket.getPrice(), Fare.BIKE_RATE_PER_HOUR);\n-    }\n-\n-    @Test\n-    public void calculateFareUnkownType(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  60 * 60 * 1000) );\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, null,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        assertThrows(NullPointerException.class, () -> fareCalculatorService.calculateFare(ticket));\n-    }\n-\n-    @Test\n-    public void calculateFareBikeWithFutureInTime(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() + (  60 * 60 * 1000) );\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        assertThrows(IllegalArgumentException.class, () -> fareCalculatorService.calculateFare(ticket));\n-    }\n-\n-    @Test\n-    public void calculateFareBikeWithLessThanOneHourParkingTime(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  45 * 60 * 1000) );//45 minutes parking time should give 3/4th parking fare\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        fareCalculatorService.calculateFare(ticket);\n-        assertEquals((0.75 * Fare.BIKE_RATE_PER_HOUR), ticket.getPrice() );\n-    }\n-\n-    @Test\n-    public void calculateFareCarWithLessThanOneHourParkingTime(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  45 * 60 * 1000) );//45 minutes parking time should give 3/4th parking fare\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        fareCalculatorService.calculateFare(ticket);\n-        assertEquals( (0.75 * Fare.CAR_RATE_PER_HOUR) , ticket.getPrice());\n-    }\n-\n-    @Test\n-    public void calculateFareCarWithMoreThanADayParkingTime(){\n-        Date inTime = new Date();\n-        inTime.setTime( System.currentTimeMillis() - (  24 * 60 * 60 * 1000) );//24 hours parking time should give 24 * parking fare per hour\n-        Date outTime = new Date();\n-        ParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR,false);\n-\n-        ticket.setInTime(inTime);\n-        ticket.setOutTime(outTime);\n-        ticket.setParkingSpot(parkingSpot);\n-        fareCalculatorService.calculateFare(ticket);\n-        assertEquals( (24 * Fare.CAR_RATE_PER_HOUR) , ticket.getPrice());\n-    }\n+\tprivate static FareCalculatorService fareCalculatorService;\n+\tprivate Ticket ticket;\n+\n+\t@BeforeAll\n+\tprivate static void setUp() {\n+\t\tfareCalculatorService = new FareCalculatorService();\n+\t}\n+\n+\t@BeforeEach\n+\tprivate void setUpPerTest() {\n+\t\tticket = new Ticket();\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareCar() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (60 * 60 * 1000));\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals(ticket.getPrice(), Fare.CAR_RATE_PER_HOUR);\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareBike() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (60 * 60 * 1000));\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals(ticket.getPrice(), Fare.BIKE_RATE_PER_HOUR);\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareUnkownType() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (60 * 60 * 1000));\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, null, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tassertThrows(NullPointerException.class, () -> fareCalculatorService.calculateFare(ticket));\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareBikeWithFutureInTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() + (60 * 60 * 1000));\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tassertThrows(IllegalArgumentException.class, () -> fareCalculatorService.calculateFare(ticket));\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareBikeWithLessThanOneHourParkingTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (45 * 60 * 1000));// 45 minutes parking time should give 3/4th\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// parking fare\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0.75 * Fare.BIKE_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareCarWithLessThanOneHourParkingTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (45 * 60 * 1000));// 45 minutes parking time should give 3/4th\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// parking fare\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0.75 * Fare.CAR_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareCarWithMoreThanADayParkingTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (24 * 60 * 60 * 1000));// 24 hours parking time should give 24h\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// parking fare per hour\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((24 * Fare.CAR_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareCarWithLessThanThrityMinutesParkingTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (25 * 60 * 1000));// 25 minutes parking free time\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0 * Fare.CAR_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareBikeWithLessThanThrityMinutesParkingTime() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (25 * 60 * 1000));// 25 minutes parking free time\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0 * Fare.BIKE_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareCarWithDiscountForCustomer() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (60 * 60 * 1000)); // 60 minutes Discount customer\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\t\tticket.setDiscount(true);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0.95 * Fare.CAR_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n+\n+\t@Test\n+\tpublic void calculateFareBikeWithDiscountForCustomer() {\n+\t\tDate inTime = new Date();\n+\t\tinTime.setTime(System.currentTimeMillis() - (60 * 60 * 1000)); // 60 minutes Discount customer\n+\t\tDate outTime = new Date();\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.BIKE, false);\n+\t\tticket.setInTime(inTime);\n+\t\tticket.setOutTime(outTime);\n+\t\tticket.setParkingSpot(parkingSpot);\n+\t\tticket.setDiscount(true);\n+\n+\t\tfareCalculatorService.calculateFare(ticket);\n+\n+\t\tassertEquals((0.95 * Fare.BIKE_RATE_PER_HOUR), ticket.getPrice());\n+\t}\n \n }"
  },
  {
    "sha": "eb8710032779f70800802b59c91094f3c6a51524",
    "filename": "src/test/java/com/parkit/parkingsystem/integration/ParkingDataBaseIT.java",
    "status": "modified",
    "additions": 91,
    "deletions": 50,
    "changes": 141,
    "blob_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/blob/376111133940d5631cd74917e135ae325011e81c/src/test/java/com/parkit/parkingsystem/integration/ParkingDataBaseIT.java",
    "raw_url": "https://github.com/OpenClassrooms-Student-Center/parkingsystem/raw/376111133940d5631cd74917e135ae325011e81c/src/test/java/com/parkit/parkingsystem/integration/ParkingDataBaseIT.java",
    "contents_url": "https://api.github.com/repos/OpenClassrooms-Student-Center/parkingsystem/contents/src/test/java/com/parkit/parkingsystem/integration/ParkingDataBaseIT.java?ref=376111133940d5631cd74917e135ae325011e81c",
    "patch": "@@ -1,65 +1,106 @@\n package com.parkit.parkingsystem.integration;\n \n-import com.parkit.parkingsystem.dao.ParkingSpotDAO;\n-import com.parkit.parkingsystem.dao.TicketDAO;\n-import com.parkit.parkingsystem.integration.config.DataBaseTestConfig;\n-import com.parkit.parkingsystem.integration.service.DataBasePrepareService;\n-import com.parkit.parkingsystem.service.ParkingService;\n-import com.parkit.parkingsystem.util.InputReaderUtil;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Date;\n+\n import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.Assertions;\n import org.junit.jupiter.api.BeforeAll;\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n import org.mockito.Mock;\n+import org.mockito.Mockito;\n import org.mockito.junit.jupiter.MockitoExtension;\n-import static org.mockito.Mockito.when;\n+\n+import com.parkit.parkingsystem.constants.ParkingType;\n+import com.parkit.parkingsystem.dao.ParkingSpotDAO;\n+import com.parkit.parkingsystem.dao.TicketDAO;\n+import com.parkit.parkingsystem.integration.config.DataBaseTestConfig;\n+import com.parkit.parkingsystem.integration.service.DataBasePrepareService;\n+import com.parkit.parkingsystem.model.ParkingSpot;\n+import com.parkit.parkingsystem.model.Ticket;\n+import com.parkit.parkingsystem.service.ParkingService;\n+import com.parkit.parkingsystem.util.InputReaderUtil;\n \n @ExtendWith(MockitoExtension.class)\n public class ParkingDataBaseIT {\n \n-    private static DataBaseTestConfig dataBaseTestConfig = new DataBaseTestConfig();\n-    private static ParkingSpotDAO parkingSpotDAO;\n-    private static TicketDAO ticketDAO;\n-    private static DataBasePrepareService dataBasePrepareService;\n-\n-    @Mock\n-    private static InputReaderUtil inputReaderUtil;\n-\n-    @BeforeAll\n-    private static void setUp() throws Exception{\n-        parkingSpotDAO = new ParkingSpotDAO();\n-        parkingSpotDAO.dataBaseConfig = dataBaseTestConfig;\n-        ticketDAO = new TicketDAO();\n-        ticketDAO.dataBaseConfig = dataBaseTestConfig;\n-        dataBasePrepareService = new DataBasePrepareService();\n-    }\n-\n-    @BeforeEach\n-    private void setUpPerTest() throws Exception {\n-        when(inputReaderUtil.readSelection()).thenReturn(1);\n-        when(inputReaderUtil.readVehicleRegistrationNumber()).thenReturn(\"ABCDEF\");\n-        dataBasePrepareService.clearDataBaseEntries();\n-    }\n-\n-    @AfterAll\n-    private static void tearDown(){\n-\n-    }\n-\n-    @Test\n-    public void testParkingACar(){\n-        ParkingService parkingService = new ParkingService(inputReaderUtil, parkingSpotDAO, ticketDAO);\n-        parkingService.processIncomingVehicle();\n-        //TODO: check that a ticket is actualy saved in DB and Parking table is updated with availability\n-    }\n-\n-    @Test\n-    public void testParkingLotExit(){\n-        testParkingACar();\n-        ParkingService parkingService = new ParkingService(inputReaderUtil, parkingSpotDAO, ticketDAO);\n-        parkingService.processExitingVehicle();\n-        //TODO: check that the fare generated and out time are populated correctly in the database\n-    }\n+\tprivate static final String VehiculeRegNumber = \"ABCDEF\";\n+\n+\tprivate static DataBaseTestConfig dataBaseTestConfig = new DataBaseTestConfig();\n+\tprivate static DataBasePrepareService dataBasePrepareService;\n+\n+\t@Mock\n+\tprivate static ParkingSpotDAO parkingSpotDAO;\n+\n+\t@Mock\n+\tprivate static TicketDAO ticketDAO;\n+\n+\t@Mock\n+\tprivate static Ticket ticket;\n+\n+\t@Mock\n+\tprivate static InputReaderUtil inputReaderUtil;\n+\n+\t@BeforeAll\n+\tprivate static void setUp() throws Exception {\n+\n+\t\tdataBasePrepareService = new DataBasePrepareService();\n+\t}\n+\n+\t@AfterAll\n+\tprivate static void tearDown() {\n+\t}\n+\n+\t@BeforeEach\n+\tprivate void setUpPerTest() throws Exception {\n+\t\twhen(inputReaderUtil.readSelection()).thenReturn(1);\n+\t\twhen(inputReaderUtil.readVehicleRegistrationNumber()).thenReturn(VehiculeRegNumber);\n+\t\tdataBasePrepareService.clearDataBaseEntries();\n+\t}\n+\n+\t@Test\n+\tpublic void testParkingACar() {\n+\t\tParkingService parkingService = new ParkingService(inputReaderUtil, parkingSpotDAO, ticketDAO);\n+\t\tMockito.when(parkingSpotDAO.getNextAvailableSlot(Mockito.any())).thenReturn(1);\n+\n+\t\tparkingService.processIncomingVehicle();\n+\n+\t\tMockito.verify(ticketDAO).saveTicket(Mockito.any(Ticket.class));\n+\t\tMockito.verify(parkingSpotDAO).updateParking(Mockito.any(ParkingSpot.class));\n+\n+\t\t// TODO: check that a ticket is actually saved in DB and Parking table is\n+\t\t// updated with availability\n+\t}\n+\n+\t@Test\n+\tpublic void testParkingLotExit() {\n+\t\tParkingService parkingService = new ParkingService(inputReaderUtil, parkingSpotDAO, ticketDAO);\n+\t\tparkingService.processIncomingVehicle();\n+\n+\t\tParkingSpot parkingSpot = new ParkingSpot(1, ParkingType.CAR, false);\n+\t\tTicket ticket = new Ticket();\n+\t\tticket.setParkingSpot(parkingSpot);\n+\t\tticket.setVehicleRegNumber(VehiculeRegNumber);\n+\t\tticket.setPrice(0);\n+\t\tticket.setInTime(new Date(System.currentTimeMillis() - (60 * 60 * 1000)));\n+\t\tticket.setOutTime(null);\n+\t\tticketDAO.saveTicket(ticket);\n+\t\tMockito.when(ticketDAO.getTicket(anyString())).thenReturn(ticket);\n+\t\tMockito.when(ticketDAO.updateTicket(any(Ticket.class))).thenReturn(true);\n+\t\tMockito.when(parkingSpotDAO.updateParking(any(ParkingSpot.class))).thenReturn(true);\n+\n+\t\tParkingService parkingServiceOut = new ParkingService(inputReaderUtil, parkingSpotDAO, ticketDAO);\n+\t\tparkingServiceOut.processExitingVehicle();\n+\n+\t\tMockito.verify(parkingSpotDAO).updateParking(Mockito.any(ParkingSpot.class));\n+\t\tAssertions.assertEquals(1.5, ticket.getPrice());\n+\t\t// TODO: check that the fare generated and out time are populated correctly in\n+\t\t// the database\n+\t}\n \n }"
  }
]
