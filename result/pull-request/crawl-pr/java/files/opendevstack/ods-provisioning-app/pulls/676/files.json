[
  {
    "sha": "e615576cefad27624c7a2f41c6c8c3ee6ef12392",
    "filename": "CHANGELOG.md",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/CHANGELOG.md",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/CHANGELOG.md",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/CHANGELOG.md?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -4,6 +4,7 @@\n \n ### Added\n \n+- Handle logout in SPA ([#675](https://github.com/opendevstack/ods-provisioning-app/issues/675)) \n - Handle form based auth in SPA ([#637](https://github.com/opendevstack/ods-provisioning-app/issues/637)) \n - Add default permissions to project groups on project creation ([#636](https://github.com/opendevstack/ods-provisioning-app/pull/636))\n - Add support for odsbox for local development([#579](https://github.com/opendevstack/ods-provisioning-app/issues/579))"
  },
  {
    "sha": "def88c9f8668b4e6f212eaf969c45c1061342539",
    "filename": "client/src/app/app.component.html",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/app.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/app.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/app.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -4,7 +4,7 @@\n       <div class=\"logo\">\n         <h1>ODS Provisioning</h1>\n       </div>\n-      <div class=\"user-area\" hidden>\n+      <div class=\"user-area\" *ngIf=\"showLogoutButton()\">\n         <div class=\"user-area__logout\">\n           <a\n             mat-mini-fab"
  },
  {
    "sha": "22f03bb23f332b21790e469ec880aa30520f116d",
    "filename": "client/src/app/app.component.ts",
    "status": "modified",
    "additions": 14,
    "deletions": 4,
    "changes": 18,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/app.component.ts",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/app.component.ts",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/app.component.ts?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -10,6 +10,7 @@ import { ActivatedRoute, NavigationStart, Router } from '@angular/router';\n import { ProjectService } from './modules/project/services/project.service';\n import { ProjectData, ProjectStorage } from './domain/project';\n import { AuthenticationService } from './modules/authentication/services/authentication.service';\n+import { HttpErrorResponse } from '@angular/common/http';\n \n @Component({\n   selector: 'app-root',\n@@ -65,8 +66,13 @@ export class AppComponent implements OnInit {\n     });\n   }\n \n-  private isSsoActive() {\n-    return this.authenticationService.sso;\n+  showLogoutButton() {\n+    this.router.events.subscribe(event => {\n+      if (event instanceof NavigationStart && (event.url === 'login' || event.url === 'logout')) {\n+        return false;\n+      }\n+      return true;\n+    });\n   }\n \n   getEditModeStatus() {\n@@ -99,10 +105,14 @@ export class AppComponent implements OnInit {\n     this.projectService\n       .getAllProjects()\n       .pipe(\n-        catchError(() => {\n+        catchError((response: HttpErrorResponse) => {\n+          if (response.error.status === 401) {\n+            // interceptor takes control and redirects to login\n+            return EMPTY;\n+          }\n+          // show generic error page\n           this.isLoading = false;\n           this.isError = true;\n-          return EMPTY;\n         })\n       )\n       .subscribe((response: ProjectData[]) => {"
  },
  {
    "sha": "4623512226092f8bce89167608971259056234ec",
    "filename": "client/src/app/modules/authentication/services/authentication.service.ts",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/authentication/services/authentication.service.ts",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/authentication/services/authentication.service.ts",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/authentication/services/authentication.service.ts?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -34,6 +34,6 @@ export class AuthenticationService {\n   }\n \n   logout(): any {\n-    return this.httpClient.post<any>(this.apiLogoutUrl, '');\n+    return this.httpClient.get<any>(this.apiLogoutUrl);\n   }\n }"
  },
  {
    "sha": "f0d2d76a5c762f9fb97f122683e4fe90bfb4b831",
    "filename": "client/src/app/modules/general-error-page/components/general-error-page.component.html",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/general-error-page/components/general-error-page.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/general-error-page/components/general-error-page.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/general-error-page/components/general-error-page.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -1,7 +1,7 @@\n <div class=\"empty-content\">\n   <div class=\"infobox\">\n     <div class=\"infobox__img\">\n-      <img src=\"assets/icons/project-not-found.svg\" alt=\"General error\" />\n+      <img src=\"assets/icons/error.svg\" alt=\"General error\" />\n     </div>\n     <div class=\"infobox__headline\">General error</div>\n     <div class=\"infobox__subline\">There was a problem fetching initial data. Please try again soon.</div>"
  },
  {
    "sha": "fa0679c114c1c229202fb8129e208d9f355ca875",
    "filename": "client/src/app/modules/logout/components/logout.component.html",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/logout/components/logout.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/logout/components/logout.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/logout/components/logout.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -5,7 +5,7 @@\n <div class=\"empty-content\" data-test-login *ngIf=\"!isLoading\">\n   <div class=\"infobox\">\n     <div class=\"infobox__img\">\n-      <img src=\"assets/icons/quickstarter-not-found.svg\" alt=\"Logged out\" />\n+      <img src=\"assets/icons/quickstarters.svg\" alt=\"Logged out\" />\n     </div>\n     <div class=\"infobox__headline\">Logout successfully</div>\n     <div class=\"infobox__subline\">You might login again</div>"
  },
  {
    "sha": "429a2277af1340094ebcc57b40d0978923f64ef6",
    "filename": "client/src/app/modules/new-project/components/new-project.component.html",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/new-project/components/new-project.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/new-project/components/new-project.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/new-project/components/new-project.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -7,7 +7,7 @@\n     <div class=\"empty-content\">\n       <div class=\"infobox\">\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/project-empty.svg\" alt=\"Project template data could not be retrieved\" />\n+          <img src=\"assets/icons/error.svg\" alt=\"Project template data could not be retrieved\" />\n         </div>\n         <div class=\"infobox__headline\">Project template data could not be retrieved</div>\n         <div class=\"infobox__subline\">Please try again soon</div>"
  },
  {
    "sha": "20b9c4001ea45eb09522336843e859843f59a0e3",
    "filename": "client/src/app/modules/project-page/components/project-page.component.html",
    "status": "modified",
    "additions": 3,
    "deletions": 3,
    "changes": 6,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/project-page/components/project-page.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/project-page/components/project-page.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/project-page/components/project-page.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -7,21 +7,21 @@\n     <div class=\"empty-content\">\n       <div class=\"infobox\" *ngIf=\"errorType === 'NOT_FOUND'\">\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/project-not-found.svg\" alt=\"Project was not found\" />\n+          <img src=\"assets/icons/error.svg\" alt=\"Project was not found\" />\n         </div>\n         <div class=\"infobox__headline\">Project was not found</div>\n         <div class=\"infobox__subline\">Please check URL or select another project.</div>\n       </div>\n       <div class=\"infobox\" *ngIf=\"errorType === 'NO_PROJECT_KEY'\">\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/project-empty.svg\" alt=\"No project selected\" />\n+          <img src=\"assets/icons/error.svg\" alt=\"No project selected\" />\n         </div>\n         <div class=\"infobox__headline\">No project selected</div>\n         <div class=\"infobox__subline\">Select or create a project to see more detail.</div>\n       </div>\n       <div class=\"infobox\" *ngIf=\"errorType === 'TECHNICAL_ERROR'\">\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/project-empty.svg\" alt=\"Technical error\" />\n+          <img src=\"assets/icons/error.svg\" alt=\"Technical error\" />\n         </div>\n         <div class=\"infobox__headline\">Technical error</div>\n         <div class=\"infobox__subline\">There was a technical error retrieving the project. Please try again soon.</div>"
  },
  {
    "sha": "f24cfbf0527e783c6ed9a35a1e30bd1cdd215725",
    "filename": "client/src/app/modules/project-page/components/quickstarter-list.component.html",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/project-page/components/quickstarter-list.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/project-page/components/quickstarter-list.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/project-page/components/quickstarter-list.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -75,7 +75,7 @@\n     <ng-container *ngIf=\"hasPlatformRuntime; else noPlatformRuntime\">\n       <div class=\"infobox\" data-test-qs-list-platform-runtime-yes>\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/quickstarter-not-found.svg\" alt=\"No quickstarters applied yet\" />\n+          <img src=\"assets/icons/quickstarters.svg\" alt=\"No quickstarters applied yet\" />\n         </div>\n         <div class=\"infobox__headline\">No quickstarters applied yet</div>\n         <div class=\"infobox__subline\">Add new components to your project</div>\n@@ -93,7 +93,7 @@\n     <ng-template #noPlatformRuntime>\n       <div class=\"infobox\" data-test-qs-list-platform-runtime-no>\n         <div class=\"infobox__img\">\n-          <img src=\"assets/icons/quickstarter-not-found.svg\" alt=\"No quickstarters possible\" />\n+          <img src=\"assets/icons/quickstarters.svg\" alt=\"No quickstarters possible\" />\n         </div>\n         <div class=\"infobox__headline\">No quickstarters possible in this project</div>\n         <div class=\"infobox__subline\">Quickstarters can only be applied in OpenShift projects</div>"
  },
  {
    "sha": "87c14715806356448345f9362f70d11945212295",
    "filename": "client/src/app/modules/sidebar/components/sidebar.component.html",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/sidebar/components/sidebar.component.html",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/app/modules/sidebar/components/sidebar.component.html",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/app/modules/sidebar/components/sidebar.component.html?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -60,7 +60,7 @@\n   <div class=\"empty-content\" *ngIf=\"(filteredProjects | async).length === 0\">\n     <div class=\"infobox\">\n       <div class=\"infobox__img\">\n-        <img src=\"assets/icons/search-empty.svg\" alt=\"Sorry, no results found\" />\n+        <img src=\"assets/icons/error.svg\" alt=\"Sorry, no results found\" />\n       </div>\n       <div class=\"infobox__headline\">Sorry, no results found</div>\n       <div class=\"infobox__subline\">Try searching another keyword</div>"
  },
  {
    "sha": "ee61611bf4ef7114efbe4f406d3031c7ab00d19d",
    "filename": "client/src/assets/icons/error.svg",
    "status": "renamed",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/assets/icons/error.svg",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/assets/icons/error.svg",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/assets/icons/error.svg?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "previous_filename": "client/src/assets/icons/project-empty.svg"
  },
  {
    "sha": "df4c80fa09f7463d11833f4ef6144fa32dea290e",
    "filename": "client/src/assets/icons/project-not-found.svg",
    "status": "removed",
    "additions": 0,
    "deletions": 11,
    "changes": 11,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/37e7260bff72e64434ecdd099bafec0d5c389cae/client/src/assets/icons/project-not-found.svg",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/37e7260bff72e64434ecdd099bafec0d5c389cae/client/src/assets/icons/project-not-found.svg",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/assets/icons/project-not-found.svg?ref=37e7260bff72e64434ecdd099bafec0d5c389cae",
    "patch": "@@ -1,11 +0,0 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 240 220\">\n-  <g transform=\"translate(0 -8)\" fill=\"none\" fill-rule=\"evenodd\">\n-    <g transform=\"translate(0 51.918)\">\n-      <ellipse fill=\"#E2E6E8\" cx=\"120\" cy=\"129.747\" rx=\"120\" ry=\"46.041\"/>\n-      <path fill=\"#FFF\" fill-rule=\"nonzero\" d=\"M187.102 139.102H52.898V35.265h134.204zM55.837 28.408L74.568 0h90.864l18.731 28.408H55.837z\"/>\n-    </g>\n-    <path d=\"M72.67 44.082h94.66c1.24 0 2.404.587 3.147 1.577l.134.19 23.665 35.718c.384.579.609 1.248.654 1.94l.009.26V194.89c0 2.124-1.657 3.857-3.741 3.963l-.203.005H49.005c-2.11 0-3.833-1.667-3.939-3.764l-.005-.204V83.768c0-.697.183-1.38.526-1.98l.137-.22L69.389 45.85a3.939 3.939 0 013.05-1.762l.231-.006h94.66zm114.38 43.654H52.95V190.92h134.1V87.736zm-83.163 71.937h31.504a3.969 3.969 0 01.198 7.933l-.198.005h-31.504a3.969 3.969 0 01-.198-7.933l.198-.005h31.504zM71.509 56.955L56.373 79.799h15.136V56.955zm98.94 2.956v19.888h13.178l-13.179-19.888zm-7.837-7.892H79.346v27.78h83.266v-27.78zm47.936-12.135a3.918 3.918 0 01-2.342 5.022l-11.046 4.02a3.918 3.918 0 01-2.68-7.363l11.046-4.02a3.918 3.918 0 015.022 2.341zm-23.699-21.148a3.918 3.918 0 116.42 4.495l-6.743 9.629a3.918 3.918 0 11-6.42-4.495zm-20.613-9.88a3.918 3.918 0 013.919 3.92V24.53a3.918 3.918 0 01-7.837 0V12.775a3.918 3.918 0 013.918-3.918z\" fill=\"#B8C2CA\" fill-rule=\"nonzero\"/>\n-    <circle fill=\"#B6C2CB\" cx=\"95.559\" cy=\"117.11\" r=\"5.437\"/>\n-    <circle fill=\"#B6C2CB\" cx=\"141.6\" cy=\"117.11\" r=\"5.437\"/>\n-  </g>\n-</svg>"
  },
  {
    "sha": "27b8747c8052bb78acf79997207cfcfff07db1ae",
    "filename": "client/src/assets/icons/quickstarters.svg",
    "status": "renamed",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/assets/icons/quickstarters.svg",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/client/src/assets/icons/quickstarters.svg",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/assets/icons/quickstarters.svg?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "previous_filename": "client/src/assets/icons/quickstarter-not-found.svg"
  },
  {
    "sha": "9ab78611d1ae8489ca3416e3588373b954c39ed4",
    "filename": "client/src/assets/icons/search-empty.svg",
    "status": "removed",
    "additions": 0,
    "deletions": 11,
    "changes": 11,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/37e7260bff72e64434ecdd099bafec0d5c389cae/client/src/assets/icons/search-empty.svg",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/37e7260bff72e64434ecdd099bafec0d5c389cae/client/src/assets/icons/search-empty.svg",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/client/src/assets/icons/search-empty.svg?ref=37e7260bff72e64434ecdd099bafec0d5c389cae",
    "patch": "@@ -1,11 +0,0 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 200 183\">\n-  <g transform=\"translate(0 -7)\" fill=\"none\" fill-rule=\"evenodd\">\n-    <g transform=\"translate(0 43.265)\">\n-      <ellipse fill=\"#E2E6E8\" cx=\"100\" cy=\"108.122\" rx=\"100\" ry=\"38.367\"/>\n-      <path fill=\"#FFF\" fill-rule=\"nonzero\" d=\"M155.918 115.918H44.082v-86.53h111.836zM46.53 23.673L62.14 0h75.72l15.61 23.673H46.53z\"/>\n-    </g>\n-    <path d=\"M60.559 36.735h78.882a3.28 3.28 0 012.616 1.305l.12.168 19.72 29.765c.32.482.507 1.04.545 1.616l.007.217v92.601a3.298 3.298 0 01-3.1 3.302l-.187.005H40.838a3.295 3.295 0 01-3.282-3.12l-.005-.187v-92.6c0-.581.152-1.15.438-1.65l.114-.184 19.72-29.765a3.282 3.282 0 012.53-1.467l.206-.006h78.882zm95.316 36.379H44.125V159.1h111.75V73.114zM86.572 133.06h26.254a3.307 3.307 0 01.188 6.61l-.188.005H86.572a3.307 3.307 0 01-.187-6.61l.187-.005h26.254zm-26.981-85.6L46.978 66.5H59.59V47.462zm75.919-4.112H66.122v23.15h69.388v-23.15zm6.53 6.576v16.574h10.982L142.04 49.925zm33.417-16.688a3.265 3.265 0 01-1.952 4.185l-9.205 3.35a3.265 3.265 0 11-2.234-6.136l9.205-3.35a3.265 3.265 0 014.186 1.95zm-19.75-17.624a3.265 3.265 0 115.35 3.746l-5.618 8.024a3.265 3.265 0 11-5.35-3.745zM138.53 7.381a3.265 3.265 0 013.265 3.265v9.796a3.265 3.265 0 01-6.53 0v-9.796a3.265 3.265 0 013.265-3.265z\" fill=\"#B8C2CA\" fill-rule=\"nonzero\"/>\n-    <circle fill=\"#B6C2CB\" cx=\"79.633\" cy=\"97.592\" r=\"4.531\"/>\n-    <circle fill=\"#B6C2CB\" cx=\"118\" cy=\"97.592\" r=\"4.531\"/>\n-  </g>\n-</svg>"
  },
  {
    "sha": "1041cc0f90cd01bf5e37e4465cb141811c664f61",
    "filename": "src/main/java/org/opendevstack/provision/authentication/crowd/CrowdSecurityConfiguration.java",
    "status": "modified",
    "additions": 14,
    "deletions": 6,
    "changes": 20,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/crowd/CrowdSecurityConfiguration.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/crowd/CrowdSecurityConfiguration.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/main/java/org/opendevstack/provision/authentication/crowd/CrowdSecurityConfiguration.java?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -142,7 +142,7 @@ protected void configure(HttpSecurity http) throws Exception {\n         .permitAll()\n         .and()\n         .logout()\n-        .addLogoutHandler(crowdLogoutHandler())\n+        .addLogoutHandler(logoutHandler())\n         .permitAll()\n         .and();\n   }\n@@ -162,11 +162,19 @@ public Properties getProps() throws IOException {\n   }\n \n   @Bean\n-  @ConditionalOnProperty(name = \"provision.auth.provider\", havingValue = \"crowd\")\n-  public CrowdLogoutHandler crowdLogoutHandler() throws IOException {\n-    CrowdLogoutHandler clh = new CrowdLogoutHandler();\n-    clh.setHttpAuthenticator(httpAuthenticator());\n-    return clh;\n+  //  @ConditionalOnProperty(name = \"provision.auth.provider\", havingValue = \"crowd\")\n+  public CrowdLogoutHandler logoutHandler() throws IOException {\n+\n+    if (spafrontendEnabled) {\n+      OKResponseCrowdLogoutHandler handler = new OKResponseCrowdLogoutHandler();\n+      handler.setHttpAuthenticator(httpAuthenticator());\n+      return handler;\n+\n+    } else {\n+      CrowdLogoutHandler clh = new CrowdLogoutHandler();\n+      clh.setHttpAuthenticator(httpAuthenticator());\n+      return clh;\n+    }\n   }\n \n   @Bean"
  },
  {
    "sha": "b9c0a6f569fe78fe96a0ef36238e9e725fb7fb92",
    "filename": "src/main/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandler.java",
    "status": "added",
    "additions": 23,
    "deletions": 0,
    "changes": 23,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandler.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandler.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/main/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandler.java?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -0,0 +1,23 @@\n+package org.opendevstack.provision.authentication.crowd;\n+\n+import com.atlassian.crowd.integration.springsecurity.CrowdLogoutHandler;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.security.core.Authentication;\n+\n+public class OKResponseCrowdLogoutHandler extends CrowdLogoutHandler {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(CrowdSecurityConfiguration.class);\n+\n+  public void logout(\n+      HttpServletRequest request, HttpServletResponse response, Authentication authentication) {\n+    try {\n+      super.logout(request, response, authentication);\n+      response.setStatus(HttpServletResponse.SC_OK);\n+    } catch (Exception ex) {\n+      logger.error(\"could not set status OK to response!\", ex);\n+    }\n+  }\n+}"
  },
  {
    "sha": "623028d1b7b4a789e5757082caaca9ee7d8dde48",
    "filename": "src/main/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandler.java",
    "status": "modified",
    "additions": 39,
    "deletions": 22,
    "changes": 61,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandler.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/main/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandler.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/main/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandler.java?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -22,51 +22,58 @@\n   private static final Logger LOG = LoggerFactory.getLogger(Oauth2LogoutHandler.class);\n \n   public static final String LOGOUT_PATH = Oauth2SecurityConfiguration.LOGIN_URI + \"?logout\";\n+  public static final String PROTOCOL_OPENID_CONNECT_LOGOUT_REDIRECT_URI =\n+      \"/protocol/openid-connect/logout?redirect_uri=\";\n+\n+  private boolean spafrontendEnabled;\n \n-  @Value(\"${idmanager.url}\")\n   private String idManagerUrl;\n \n-  @Value(\"${idmanager.realm}\")\n   private String idManagerRealm;\n \n-  @Value(\"${idmanager.disable-logout-from-idm:false}\")\n-  private boolean disableRedirectLogoutToIdentityManager;\n+  private boolean logoutFromIDP;\n \n   public Oauth2LogoutHandler() {\n-    LOG.info(\n-        \"Logout from identity manager is {}!\",\n-        disableRedirectLogoutToIdentityManager ? \"enabled\" : \"disabled\");\n+    LOG.info(\"Logout from identity manager is {}!\", logoutFromIDP ? \"enabled\" : \"disabled\");\n+  }\n+\n+  public Oauth2LogoutHandler(\n+      @Value(\"${frontend.spa.enabled:false}\") boolean spafrontendEnabled,\n+      @Value(\"${idmanager.disable-logout-from-idm:false}\") boolean logoutFromIDP,\n+      @Value(\"${idmanager.url}\") String idManagerUrl,\n+      @Value(\"${idmanager.realm}\") String idManagerRealm) {\n+    this.spafrontendEnabled = spafrontendEnabled;\n+    this.logoutFromIDP = logoutFromIDP;\n+    this.idManagerUrl = idManagerUrl;\n+    this.idManagerRealm = idManagerRealm;\n   }\n \n   @Override\n   public void logout(\n       HttpServletRequest httpServletRequest,\n-      HttpServletResponse httpServletResponse,\n+      HttpServletResponse response,\n       Authentication authentication) {\n     try {\n \n-      if (disableRedirectLogoutToIdentityManager) {\n+      if (logoutFromIDP()) {\n+        response.sendRedirect(buildIDPLogoutUrl(httpServletRequest, response));\n \n-        httpServletResponse.sendRedirect(LOGOUT_PATH);\n+      } else if (spafrontendEnabled) {\n+        response.setStatus(HttpServletResponse.SC_OK);\n \n       } else {\n-\n-        String redirectUri = buildRedirectUri(httpServletRequest, httpServletResponse);\n-\n-        String logoutUrl =\n-            idManagerUrl\n-                + \"/auth/realms/\"\n-                + idManagerRealm\n-                + \"/protocol/openid-connect/logout?redirect_uri=\"\n-                + redirectUri;\n-        httpServletResponse.sendRedirect(logoutUrl);\n+        response.sendRedirect(LOGOUT_PATH);\n       }\n \n     } catch (IOException e) {\n       LOG.warn(\"Cannot send redirect\", e);\n     }\n   }\n \n+  private boolean logoutFromIDP() {\n+    return logoutFromIDP;\n+  }\n+\n   /**\n    * Builds the uri that is used from the identity manager to redirect the call after the logout url\n    * was called from the provision app\n@@ -75,7 +82,7 @@ public void logout(\n    * @param httpServletResponse servlet response\n    * @return the redirect uri\n    */\n-  private String buildRedirectUri(\n+  private String buildIDPLogoutUrl(\n       HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\n     StringBuilder url = new StringBuilder();\n     url.append(httpServletRequest.getScheme())\n@@ -86,6 +93,16 @@ private String buildRedirectUri(\n       url.append(\":\").append(serverPort);\n     }\n     url.append(httpServletRequest.getContextPath()).append(\"/login\");\n-    return httpServletResponse.encodeRedirectURL(url.toString());\n+\n+    String redirectUri = httpServletResponse.encodeRedirectURL(url.toString());\n+\n+    String logoutUrl =\n+        idManagerUrl\n+            + \"/auth/realms/\"\n+            + idManagerRealm\n+            + PROTOCOL_OPENID_CONNECT_LOGOUT_REDIRECT_URI\n+            + redirectUri;\n+\n+    return logoutUrl;\n   }\n }"
  },
  {
    "sha": "4afa70465bc7333982ecd986fadc822aab5c127b",
    "filename": "src/test/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandlerTest.java",
    "status": "added",
    "additions": 33,
    "deletions": 0,
    "changes": 33,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/test/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandlerTest.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/test/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandlerTest.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/test/java/org/opendevstack/provision/authentication/crowd/OKResponseCrowdLogoutHandlerTest.java?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -0,0 +1,33 @@\n+package org.opendevstack.provision.authentication.crowd;\n+\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+\n+import com.atlassian.crowd.integration.http.HttpAuthenticator;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.springframework.security.core.Authentication;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class OKResponseCrowdLogoutHandlerTest {\n+\n+  @Mock private HttpServletRequest request;\n+  @Mock private HttpServletResponse response;\n+  @Mock private HttpAuthenticator authenticator;\n+  @Mock private Authentication authentication;\n+\n+  @Test\n+  void logout() {\n+\n+    OKResponseCrowdLogoutHandler handler = new OKResponseCrowdLogoutHandler();\n+    handler.setHttpAuthenticator(authenticator);\n+\n+    handler.logout(request, response, authentication);\n+\n+    verify(response, times(1)).setStatus(HttpServletResponse.SC_OK);\n+  }\n+}"
  },
  {
    "sha": "6e4aea2b4cc6ea0e0cfa8993c4b2500e4080e1cc",
    "filename": "src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerLogoutFromIDMTest.java",
    "status": "removed",
    "additions": 0,
    "deletions": 58,
    "changes": 58,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/37e7260bff72e64434ecdd099bafec0d5c389cae/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerLogoutFromIDMTest.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/37e7260bff72e64434ecdd099bafec0d5c389cae/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerLogoutFromIDMTest.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerLogoutFromIDMTest.java?ref=37e7260bff72e64434ecdd099bafec0d5c389cae",
    "patch": "@@ -1,58 +0,0 @@\n-package org.opendevstack.provision.authentication.oauth2;\n-\n-import static org.mockito.ArgumentMatchers.contains;\n-import static org.mockito.Mockito.*;\n-\n-import java.io.IOException;\n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-import org.junit.jupiter.api.Test;\n-import org.junit.jupiter.api.extension.ExtendWith;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.beans.factory.annotation.Value;\n-import org.springframework.boot.test.mock.mockito.MockBean;\n-import org.springframework.security.core.Authentication;\n-import org.springframework.test.context.ContextConfiguration;\n-import org.springframework.test.context.TestPropertySource;\n-import org.springframework.test.context.junit.jupiter.SpringExtension;\n-\n-@ExtendWith(SpringExtension.class)\n-@ContextConfiguration(classes = Oauth2LogoutHandler.class)\n-@TestPropertySource(\n-    properties = {\n-      \"provision.auth.provider=oauth2\",\n-      \"idmanager.url=url\",\n-      \"idmanager.realm=realm\",\n-      \"idmanager.disable-logout-from-idm=false\"\n-    })\n-public class Oauth2LogoutHandlerLogoutFromIDMTest {\n-\n-  @Autowired private Oauth2LogoutHandler logoutHandler;\n-\n-  @MockBean private HttpServletRequest request;\n-\n-  @MockBean private HttpServletResponse response;\n-\n-  @MockBean private Authentication authentication;\n-\n-  @Value(\"${idmanager.url}\")\n-  private String idManagerUrl;\n-\n-  @Value(\"${idmanager.realm}\")\n-  private String idManagerRealm;\n-\n-  @Test\n-  public void whenLogoutFromIDMIsDisableThenRedirectToLogoutPath() throws IOException {\n-\n-    when(request.getScheme()).thenReturn(\"scheme\");\n-    when(request.getServerName()).thenReturn(\"name\");\n-    when(request.getServerPort()).thenReturn(8000);\n-    when(request.getContextPath()).thenReturn(\"context\");\n-    when(response.encodeRedirectURL(anyString())).thenReturn(\"encoded\");\n-\n-    logoutHandler.logout(request, response, authentication);\n-\n-    verify(response, times(1)).sendRedirect(contains(idManagerUrl));\n-    verify(response, times(1)).sendRedirect(contains(idManagerRealm));\n-  }\n-}"
  },
  {
    "sha": "5a4321b6a2a462d0b00c1a37bd6121c1788363de",
    "filename": "src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerTest.java",
    "status": "modified",
    "additions": 54,
    "deletions": 23,
    "changes": 77,
    "blob_url": "https://github.com/opendevstack/ods-provisioning-app/blob/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerTest.java",
    "raw_url": "https://github.com/opendevstack/ods-provisioning-app/raw/b2c2693cc3a8a1a78fee1a813ea96cdda645a410/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerTest.java",
    "contents_url": "https://api.github.com/repos/opendevstack/ods-provisioning-app/contents/src/test/java/org/opendevstack/provision/authentication/oauth2/Oauth2LogoutHandlerTest.java?ref=b2c2693cc3a8a1a78fee1a813ea96cdda645a410",
    "patch": "@@ -1,42 +1,73 @@\n package org.opendevstack.provision.authentication.oauth2;\n \n-import static org.mockito.Mockito.times;\n-import static org.mockito.Mockito.verify;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.ArgumentMatchers.contains;\n+import static org.mockito.Mockito.*;\n+import static org.mockito.Mockito.when;\n \n import java.io.IOException;\n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n import org.springframework.security.core.Authentication;\n-import org.springframework.test.context.ContextConfiguration;\n-import org.springframework.test.context.TestPropertySource;\n-import org.springframework.test.context.junit.jupiter.SpringExtension;\n-\n-@ExtendWith(SpringExtension.class)\n-@ContextConfiguration(classes = Oauth2LogoutHandler.class)\n-@TestPropertySource(\n-    properties = {\n-      \"provision.auth.provider=oauth2\",\n-      \"idmanager.url=url\",\n-      \"idmanager.realm=realm\",\n-      \"idmanager.disable-logout-from-idm=true\"\n-    })\n+\n+@ExtendWith(MockitoExtension.class)\n public class Oauth2LogoutHandlerTest {\n \n-  @Autowired private Oauth2LogoutHandler logoutHandler;\n+  @Mock private HttpServletRequest request;\n+  @Mock private HttpServletResponse response;\n+  @Mock private Authentication authentication;\n \n-  @MockBean private HttpServletRequest request;\n-  @MockBean private HttpServletResponse response;\n-  @MockBean private Authentication authentication;\n+  private String idManagerUrl = \"testUrl\";\n+  private String idManagerRealm = \"testRealm\";\n \n   @Test\n-  public void whenLogoutFromIDMIsDisableThenRedirectToLogoutPath() throws IOException {\n+  public void whenLogoutFromIDMIsEnabled_thenRedirectToIDP() throws IOException {\n+\n+    String idManagerUrl = \"testUrl\";\n+\n+    String idManagerRealm = \"testRealm\";\n+\n+    when(request.getScheme()).thenReturn(\"scheme\");\n+    when(request.getServerName()).thenReturn(\"name\");\n+    when(request.getServerPort()).thenReturn(8000);\n+    when(request.getContextPath()).thenReturn(\"context\");\n+    when(response.encodeRedirectURL(anyString())).thenReturn(\"encoded\");\n+\n+    Oauth2LogoutHandler logoutHandler =\n+        new Oauth2LogoutHandler(false, true, idManagerUrl, idManagerRealm);\n+\n+    logoutHandler.logout(request, response, authentication);\n+\n+    verify(response, times(1))\n+        .sendRedirect(contains(Oauth2LogoutHandler.PROTOCOL_OPENID_CONNECT_LOGOUT_REDIRECT_URI));\n+    verify(response, times(1)).sendRedirect(contains(idManagerUrl));\n+    verify(response, times(1)).sendRedirect(contains(idManagerRealm));\n+  }\n+\n+  @Test\n+  public void whenLogoutFromIDMIsDisabledAndClientIsNotSPA_thenRedirectToLogoutPath()\n+      throws IOException {\n+\n+    Oauth2LogoutHandler logoutHandler =\n+        new Oauth2LogoutHandler(false, false, idManagerUrl, idManagerRealm);\n+\n+    logoutHandler.logout(request, response, authentication);\n+\n+    verify(response, times(1)).sendRedirect(Oauth2LogoutHandler.LOGOUT_PATH);\n+  }\n+\n+  @Test\n+  public void whenLogoutFromIDMIsDisabledAndClientIsSPA_thenReturnOK() throws IOException {\n+\n+    Oauth2LogoutHandler logoutHandler =\n+        new Oauth2LogoutHandler(true, false, idManagerUrl, idManagerRealm);\n \n     logoutHandler.logout(request, response, authentication);\n \n-    verify(response, times(1)).sendRedirect(\"/login?logout\");\n+    verify(response, times(1)).setStatus(HttpServletResponse.SC_OK);\n   }\n }"
  }
]
