[
  {
    "sha": "b2d944be6fb639bc5bd159a1bdc1dbe64777c8fc",
    "filename": "property-services/src/main/java/org/egov/pt/repository/NiveshMitraReportsRepository.java",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/Transerve-PwC/municipal-services-egov/blob/f38d680cfd2c21ccbb826cfeabe0157cb681a16d/property-services/src/main/java/org/egov/pt/repository/NiveshMitraReportsRepository.java",
    "raw_url": "https://github.com/Transerve-PwC/municipal-services-egov/raw/f38d680cfd2c21ccbb826cfeabe0157cb681a16d/property-services/src/main/java/org/egov/pt/repository/NiveshMitraReportsRepository.java",
    "contents_url": "https://api.github.com/repos/Transerve-PwC/municipal-services-egov/contents/property-services/src/main/java/org/egov/pt/repository/NiveshMitraReportsRepository.java?ref=f38d680cfd2c21ccbb826cfeabe0157cb681a16d",
    "patch": "@@ -24,12 +24,12 @@\n \tprivate NiveshMitraDemandCountMapper demandResultMapper;\n     \n \tpublic List<HashMap<String,String>> getHouseTaxData() {\n-\t\tString query = \"select edv.tenantid ,sum(edv.collectionamount), count(edv.id) from egbs_demanddetail_v1 edv where edv.taxheadcode = 'PT_HOUSE_TAX' and edv.collectionamount > 0 GROUP BY edv.tenantid\";\n+\t\tString query = \"select edv.tenantid ,sum(edv.collectionamount), count(edv.id) from egbs_demanddetail_v1 edv inner join egbs_demand_v1 edd on edd.id=edv.demandid  where edv.taxheadcode = 'PT_HOUSE_TAX' and edv.collectionamount > 0 and edd.status='ACTIVE' and edd.taxperiodfrom = '1554076799000' and edd.taxperiodto = '1585679399000' GROUP BY edv.tenantid\";\n \t\treturn jdbcTemplate.query(query, rowMapper);\n \t}\n \n \tpublic List<HashMap<String,String>> getWaterTaxData() {\n-\t\tString query = \"select edv.tenantid ,sum(edv.collectionamount), count(edv.id) from egbs_demanddetail_v1 edv where edv.taxheadcode = 'PT_WATER_TAX' and edv.collectionamount > 0 GROUP BY edv.tenantid\";\n+\t\tString query = \"select edv.tenantid ,sum(edv.collectionamount), count(edv.id) from egbs_demanddetail_v1 edv inner join egbs_demand_v1 edd on edd.id=edv.demandid  where edv.taxheadcode = 'PT_WATER_TAX' and edv.collectionamount > 0 and edd.status='ACTIVE' and edd.taxperiodfrom = '1554076799000' and edd.taxperiodto = '1585679399000' GROUP BY edv.tenantid\";\n \t\treturn jdbcTemplate.query(query, rowMapper);\n \t}\n "
  },
  {
    "sha": "22fad2701c564116843698a0e71ffb1ff317d98d",
    "filename": "property-services/src/main/java/org/egov/pt/service/Cachebaleservice.java",
    "status": "modified",
    "additions": 83,
    "deletions": 0,
    "changes": 83,
    "blob_url": "https://github.com/Transerve-PwC/municipal-services-egov/blob/f38d680cfd2c21ccbb826cfeabe0157cb681a16d/property-services/src/main/java/org/egov/pt/service/Cachebaleservice.java",
    "raw_url": "https://github.com/Transerve-PwC/municipal-services-egov/raw/f38d680cfd2c21ccbb826cfeabe0157cb681a16d/property-services/src/main/java/org/egov/pt/service/Cachebaleservice.java",
    "contents_url": "https://api.github.com/repos/Transerve-PwC/municipal-services-egov/contents/property-services/src/main/java/org/egov/pt/service/Cachebaleservice.java?ref=f38d680cfd2c21ccbb826cfeabe0157cb681a16d",
    "patch": "@@ -127,6 +127,89 @@\n \t        return null;\n \t    }\n \t \n+\t @Cacheable(value=\"wardname\" ,key =\"#localitycode\" ,sync = true)\n+\t public String getWardNameFromLocalityCode(String localityCode, String tenantId, org.egov.common.contract.request.RequestInfo requestinfo)\n+\t {\n+\t\t \n+\n+         try {\n+\t\t\t\tStringBuilder uri = new StringBuilder(config.getMdmsHost()).append(config.getMdmsEndpoint());\n+\t\t\t\tMdmsCriteriaReq criteriaReq = prepareMdMsRequest(tenantId, \"egov-location\",\n+\t\t\t\t        Arrays.asList(new String[] { \"TenantBoundary\" }), \"$..[?(@.label=='Ward')]\", requestinfo);\n+\t\t\t\tOptional<Object> response = restRepo.fetchResult(uri, criteriaReq);\n+\t\t\t\tList<Map<String, ArrayList<Map<Object, Object>>>> boundaries = JsonPath.read(response.get(),\"$.MdmsRes.egov-location.TenantBoundary\");\n+\t\t\t\t\n+\t\t\t\t\n+\t\t\t\tfor (Map<String, ArrayList<Map<Object, Object>>> wardMap : boundaries) {\n+\t\t\t\t\t\n+\t\t\t\t\tArrayList<Map<Object, Object>> childrenList = (ArrayList<Map<Object, Object>>)wardMap.get(\"children\");\n+\t\t\t\t\t\n+\t\t\t\t\tSystem.out.println(wardMap.get(\"code\"));\n+\t\t\t\t\t\n+\t\t\t\t\tfor (Map<Object, Object> localityMap : childrenList) {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif(String.valueOf(localityMap.get(\"code\")).equalsIgnoreCase(localityCode))\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tSystem.out.println(\" ward name  \"+String.valueOf(wardMap.get(\"wardname\")));\n+\t\t\t\t\t\t\treturn String.valueOf(wardMap.get(\"wardname\"));\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\t\n+\t\t\t\t\t}\n+\t\t\t\t\t\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t} catch (Exception e) {\n+\t\t\t\te.printStackTrace();\n+\t\t\t}\n+\n+\t\treturn \"\";\n+\t\t \n+\t }\n+\t \n+\t @Cacheable(value=\"zonename\" ,key =\"#localitycode\" ,sync = true)\n+\t public String getZoneNameFromLocalityCode(String localityCode, String tenantId, org.egov.common.contract.request.RequestInfo requestinfo)\n+\t {\n+\t\t try {\n+\t\t\t\tStringBuilder uri = new StringBuilder(config.getMdmsHost()).append(config.getMdmsEndpoint());\n+\t\t\t\tMdmsCriteriaReq criteriaReq = prepareMdMsRequest(tenantId, \"egov-location\",\n+\t\t\t\t        Arrays.asList(new String[] { \"TenantBoundary\" }), \"$..[?(@.label=='Zone')]\", requestinfo);\n+\t\t\t\tOptional<Object> response = restRepo.fetchResult(uri, criteriaReq);\n+\t\t\t\tList<Map<String, List<Map<String, ArrayList<Map<Object, Object>>>>>> boundaries = JsonPath.read(response.get(),\"$.MdmsRes.egov-location.TenantBoundary\");\n+\t\t\t\t\n+\t\t\t\t\n+\t\t\t\tfor (Map<String, List<Map<String, ArrayList<Map<Object, Object>>>>> zoneMap : boundaries) {\n+\t\t\t\t\t\n+\t\t\t\t\tSystem.out.println(zoneMap.get(\"code\"));\n+\t\t\t\t\t\n+\t\t\t\t\tfor (Map<String, ArrayList<Map<Object, Object>>> wards : zoneMap.get(\"children\")) {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tArrayList<Map<Object, Object>> childrenList = (ArrayList<Map<Object, Object>>)wards.get(\"children\");\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tSystem.out.println(zoneMap.get(\"code\"));\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tfor (Map<Object, Object> localityMap : childrenList) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tif(String.valueOf(localityMap.get(\"code\")).equalsIgnoreCase(localityCode))\n+\t\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t\tSystem.out.println(\" zone name  \"+String.valueOf(zoneMap.get(\"localname\")));\n+\t\t\t\t\t\t\t\treturn String.valueOf(zoneMap.get(\"localname\"));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\t\n+\t\t\t} catch (Exception e) {\n+\t\t\t\te.printStackTrace();\n+\t\t\t}\n+\t\t \n+\t\t \n+\t\t return \"\";\n+\t }\n+\t \n+\t \n+\t \n \t @Cacheable(value=\"zone\" ,key =\"#tenantId\" ,sync = true)\n \t    public Map<String, String> getZoneMap(String tenantId, org.egov.common.contract.request.RequestInfo requestinfo) {\n \t     "
  }
]
