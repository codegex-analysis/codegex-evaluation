[
  {
    "sha": "f325a7f6bb9a15282716c637547847cac2ac8466",
    "filename": ".github/test-dispatch.sh",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/DataBiosphere/jade-data-repo/blob/6d7ae6cbfe43b3dc81fb44acfe246456c3629435/.github/test-dispatch.sh",
    "raw_url": "https://github.com/DataBiosphere/jade-data-repo/raw/6d7ae6cbfe43b3dc81fb44acfe246456c3629435/.github/test-dispatch.sh",
    "contents_url": "https://api.github.com/repos/DataBiosphere/jade-data-repo/contents/.github/test-dispatch.sh?ref=6d7ae6cbfe43b3dc81fb44acfe246456c3629435",
    "patch": "@@ -2,7 +2,7 @@\n BRANCH=$(git branch --show-current)\n TOKEN=$(cat $HOME/.gh_token)\n REPO=\"DataBiosphere/jade-data-repo\"\n-WORKFLOW=\"test-runner-on-perf.yml\"\n+WORKFLOW=\"gh-docker-test.yaml\"\n \n curl -H \"Accept: application/vnd.github.everest-preview+json\" \\\n     -H \"Authorization: token ${TOKEN}\" \\"
  },
  {
    "sha": "a0fe68630f98482337b9140c48afe15e4c692a9d",
    "filename": ".github/workflows/gh-docker-test.yaml",
    "status": "added",
    "additions": 122,
    "deletions": 0,
    "changes": 122,
    "blob_url": "https://github.com/DataBiosphere/jade-data-repo/blob/6d7ae6cbfe43b3dc81fb44acfe246456c3629435/.github/workflows/gh-docker-test.yaml",
    "raw_url": "https://github.com/DataBiosphere/jade-data-repo/raw/6d7ae6cbfe43b3dc81fb44acfe246456c3629435/.github/workflows/gh-docker-test.yaml",
    "contents_url": "https://api.github.com/repos/DataBiosphere/jade-data-repo/contents/.github/workflows/gh-docker-test.yaml?ref=6d7ae6cbfe43b3dc81fb44acfe246456c3629435",
    "patch": "@@ -0,0 +1,122 @@\n+name: GitHub Docker Test\n+env:\n+  GOOGLE_CLOUD_PROJECT: broad-jade-integration\n+  GOOGLE_REGION: us-central1\n+  K8_CLUSTER: integration-master\n+on:\n+  workflow_dispatch: {}\n+  pull_request:\n+    branches:\n+      - fb-dr-1528-gh-docker\n+jobs:\n+  gh_docker_test:\n+    timeout-minutes: 180\n+    strategy:\n+      matrix:\n+        os: [ubuntu-latest]\n+    runs-on: ${{ matrix.os }}\n+    steps:\n+      - name: Checkout jade-data-repo\n+        uses: actions/checkout@v2\n+      - name: Checkout datarepo-helm-definitions\n+        uses: actions/checkout@v2\n+        with:\n+          repository: \"broadinstitute/datarepo-helm-definitions\"\n+          token: ${{ secrets.BROADBOT_TOKEN }}\n+          path: datarepo-helm-definitions\n+      - name: Import Vault Secrets for Development GCR\n+        uses: hashicorp/vault-action@v2.1.2\n+        with:\n+          url: ${{ secrets.VAULT_ADDR }}\n+          method: approle\n+          roleId: ${{ secrets.ROLE_ID }}\n+          secretId: ${{ secrets.SECRET_ID }}\n+          secrets: |\n+            secret/dsde/datarepo/dev/sa-key-b64 sa | B64_APPLICATION_CREDENTIALS ;\n+      - name: Install Google Cloud SDK\n+        uses: google-github-actions/setup-gcloud@v0.2.1\n+        with:\n+          project_id: ${{ env.GOOGLE_CLOUD_PROJECT }}\n+          service_account_key: ${{ env.B64_APPLICATION_CREDENTIALS }}\n+          export_default_credentials: true\n+      - name: Configure Google Cloud SDK\n+        uses: broadinstitute/datarepo-actions/actions/configure-gcloud-sdk@0.49.0\n+      - name: Add Runner IP to allowlist\n+        uses: broadinstitute/datarepo-actions/actions/add-runner-ip@0.49.0\n+      - name: Lock namespace for use\n+        uses: broadinstitute/datarepo-actions/actions/lock-namespace@0.49.0\n+        env:\n+          K8_NAMESPACES: \"integration-1,integration-2,integration-3,integration-6\"\n+      - name: Gradle build and upload Docker container\n+        uses: broadinstitute/gradle-command-action@v1\n+        with:\n+          arguments: jib\n+      - name: Clean IAM policy\n+        if: always()\n+        uses: broadinstitute/datarepo-actions/actions/clean-iam-policy@0.49.0\n+#      - name: Run Gradle test runner smoke tests\n+#        uses: broadinstitute/datarepo-actions/actions/gradle-test-runner@0.49.0\n+#        env:\n+#          JSON_KEY_FILENAME: jade-dev-account.json\n+      - name: Deploy the latest dev image tag to datarepo-helm-definitions\n+        uses: broadinstitute/datarepo-actions/actions/deploy-tag-update@fb-dr-1681-deploy-tag-update\n+      - name: Wait for deployment\n+        uses: broadinstitute/datarepo-actions/actions/wait-for-deployment@0.49.0\n+      - name: Unlock namespace for use\n+        if: always()\n+        uses: broadinstitute/datarepo-actions/actions/unlock-namespace@0.49.0\n+      - name: Remove Runner IP from allowlist\n+        if: always()\n+        uses: broadinstitute/datarepo-actions/actions/rm-runner-ip@0.49.0\n+#  test_connected:\n+#    timeout-minutes: 180\n+#    strategy:\n+#      matrix:\n+#        os: [ubuntu-latest]\n+#    runs-on: ${{ matrix.os }}\n+#    services:\n+#      postgres:\n+#        image: postgres:11\n+#        env:\n+#          POSTGRES_USER: postgres\n+#          POSTGRES_PASSWORD: postgres\n+#          POSTGRES_DB: postgres\n+#        ports:\n+#          - 5432:5432\n+#        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5\n+#    steps:\n+#      - name: \"Checkout code\"\n+#        uses: actions/checkout@v2\n+#      - name: Import Vault Secrets for Development GCR\n+#        uses: hashicorp/vault-action@v2.1.2\n+#        with:\n+#          url: ${{ secrets.VAULT_ADDR }}\n+#          method: approle\n+#          roleId: ${{ secrets.ROLE_ID }}\n+#          secretId: ${{ secrets.SECRET_ID }}\n+#          secrets: |\n+#            secret/dsde/datarepo/dev/sa-key-b64 sa | B64_APPLICATION_CREDENTIALS ;\n+#      - name: Install Google Cloud SDK\n+#        uses: google-github-actions/setup-gcloud@v0.2.1\n+#        with:\n+#          project_id: ${{ env.GOOGLE_CLOUD_PROJECT }}\n+#          service_account_key: ${{ env.B64_APPLICATION_CREDENTIALS }}\n+#          export_default_credentials: true\n+#      - name: Configure Google Cloud SDK\n+#        uses: broadinstitute/datarepo-actions/actions/configure-gcloud-sdk@0.49.0\n+#      - name: Add Runner IP to allowlist\n+#        uses: broadinstitute/datarepo-actions/actions/add-runner-ip@0.49.0\n+#      - name: Lock namespace for use\n+#        uses: broadinstitute/datarepo-actions/actions/lock-namespace@0.49.0\n+#        env:\n+#          K8_NAMESPACES: \"integration-1,integration-2,integration-3,integration-6\"\n+#      - name: Run Gradle connected tests\n+#        uses: broadinstitute/datarepo-actions/actions/gradle-connected-integration@fb-dr-1686-gradle-connected-int\n+#        env:\n+#          TEST_TO_RUN: testConnected\n+#      - name: Unlock namespace for use\n+#        if: always()\n+#        uses: broadinstitute/datarepo-actions/actions/unlock-namespace@0.49.0\n+#      - name: Remove Runner IP from allowlist\n+#        if: always()\n+#        uses: broadinstitute/datarepo-actions/actions/rm-runner-ip@0.49.0"
  }
]
