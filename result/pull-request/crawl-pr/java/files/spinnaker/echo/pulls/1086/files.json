[
  {
    "sha": "27af172c3b45102086ceb25b3ec0da0b7fafccc5",
    "filename": "echo-notifications/src/main/resources/templates/manualJudgment/body-slack.ftl",
    "status": "modified",
    "additions": 2,
    "deletions": 20,
    "changes": 22,
    "blob_url": "https://github.com/spinnaker/echo/blob/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgment/body-slack.ftl",
    "raw_url": "https://github.com/spinnaker/echo/raw/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgment/body-slack.ftl",
    "contents_url": "https://api.github.com/repos/spinnaker/echo/contents/echo-notifications/src/main/resources/templates/manualJudgment/body-slack.ftl?ref=fe60dbe738ce74b15d32c8c4e47913ec20efc1e0",
    "patch": "@@ -1,25 +1,7 @@\n-<#if (notification.additionalContext.execution.name)??>\n-  <#if (notification.additionalContext.execution.trigger.buildInfo.number)??>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline build ${notification.additionalContext.execution.trigger.buildInfo.number?c} is awaiting manual judgment.\n-  <#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline is awaiting manual judgment.\n-  </#if>\n-<#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application} is awaiting manual judgment.\n-</#if>\n+<#include \"../manualJudgment/variables-slack.ftl\">\n+${stageDescription} is awaiting manual judgment.\n \n <#if (notification.additionalContext.instructions)??>\n *Instructions:*\n ${htmlToText.convert(notification.additionalContext.instructions)}\n-\n-</#if>\n-For more details, please visit:\n-<#if (notification.additionalContext.stageId)??>\n-  <#if (notification.additionalContext.restrictExecutionDuringTimeWindow)??>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}&step=1\n-  <#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}\n-  </#if>\n-<#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}\n </#if>"
  },
  {
    "sha": "4544858b5e951c6ca974d6dfc4ca2f2bd9223d81",
    "filename": "echo-notifications/src/main/resources/templates/manualJudgment/variables-slack.ftl",
    "status": "added",
    "additions": 14,
    "deletions": 0,
    "changes": 14,
    "blob_url": "https://github.com/spinnaker/echo/blob/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgment/variables-slack.ftl",
    "raw_url": "https://github.com/spinnaker/echo/raw/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgment/variables-slack.ftl",
    "contents_url": "https://api.github.com/repos/spinnaker/echo/contents/echo-notifications/src/main/resources/templates/manualJudgment/variables-slack.ftl?ref=fe60dbe738ce74b15d32c8c4e47913ec20efc1e0",
    "patch": "@@ -0,0 +1,14 @@\n+<#assign executionUrl=\"${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}\">\n+<#if (notification.additionalContext.stageId)??>\n+  <#assign executionUrl=\"${executionUrl}?refId=${notification.additionalContext.stageId}\">\n+</#if>\n+<#if (notification.additionalContext.restrictExecutionDuringTimeWindow)??>\n+  <#assign executionUrl=\"${executionUrl}&step=1\">\n+</#if>\n+<#assign stageDescription=\"Stage <${executionUrl}|${notification.additionalContext.stageName}> for *${notification.source.application}*\">\n+<#if (notification.additionalContext.execution.name)??>\n+  <#assign stageDescription=\"${stageDescription}'s *${notification.additionalContext.execution.name}* pipeline\">\n+</#if>\n+<#if (notification.additionalContext.execution.trigger.buildInfo.number)??>\n+  <#assign stageDescription=\"${stageDescription} build #*${notification.additionalContext.execution.trigger.buildInfo.number?c}*\">\n+</#if>"
  },
  {
    "sha": "9dc74ead46a975000b06c96f329bc36ed25d38c4",
    "filename": "echo-notifications/src/main/resources/templates/manualJudgmentContinue/body-slack.ftl",
    "status": "modified",
    "additions": 4,
    "deletions": 21,
    "changes": 25,
    "blob_url": "https://github.com/spinnaker/echo/blob/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgmentContinue/body-slack.ftl",
    "raw_url": "https://github.com/spinnaker/echo/raw/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgmentContinue/body-slack.ftl",
    "contents_url": "https://api.github.com/repos/spinnaker/echo/contents/echo-notifications/src/main/resources/templates/manualJudgmentContinue/body-slack.ftl?ref=fe60dbe738ce74b15d32c8c4e47913ec20efc1e0",
    "patch": "@@ -1,27 +1,10 @@\n-<#if (notification.additionalContext.execution.name)??>\n-  <#if (notification.additionalContext.execution.trigger.buildInfo.number)??>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline build ${notification.additionalContext.execution.trigger.buildInfo.number} was judged to continue by ${notification.additionalContext.judgedBy}.\n-  <#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline was judged to continue by ${notification.additionalContext.judgedBy}.\n-  </#if>\n-<#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application} was judged to continue by ${notification.additionalContext.judgedBy}.\n-</#if>\n+<#include \"../manualJudgment/variables-slack.ftl\">\n+${stageDescription} _was judged to *continue*_ by ${notification.additionalContext.judgedBy}.\n \n <#if (notification.additionalContext.message)??>\n ${htmlToText.convert(notification.additionalContext.message)}\n </#if>\n-<#if (notification.additionalContext.judgmentInput)??>\n-Judgment '${htmlToText.convert(notification.additionalContext.judgmentInput)}' was selected.\n-</#if>\n \n-For more details, please visit:\n-<#if (notification.additionalContext.stageId)??>\n-  <#if (notification.additionalContext.restrictExecutionDuringTimeWindow)??>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}&step=1\n-  <#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}\n-  </#if>\n-<#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}\n+<#if (notification.additionalContext.judgmentInput)??>\n+Judgment '*${htmlToText.convert(notification.additionalContext.judgmentInput)}*' was selected.\n </#if>"
  },
  {
    "sha": "d85fb3c74518442082f9b87442506fdf40d99a69",
    "filename": "echo-notifications/src/main/resources/templates/manualJudgmentStop/body-slack.ftl",
    "status": "modified",
    "additions": 3,
    "deletions": 20,
    "changes": 23,
    "blob_url": "https://github.com/spinnaker/echo/blob/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgmentStop/body-slack.ftl",
    "raw_url": "https://github.com/spinnaker/echo/raw/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/main/resources/templates/manualJudgmentStop/body-slack.ftl",
    "contents_url": "https://api.github.com/repos/spinnaker/echo/contents/echo-notifications/src/main/resources/templates/manualJudgmentStop/body-slack.ftl?ref=fe60dbe738ce74b15d32c8c4e47913ec20efc1e0",
    "patch": "@@ -1,23 +1,6 @@\n-<#if (notification.additionalContext.execution.name)??>\n-  <#if (notification.additionalContext.execution.trigger.buildInfo.number)??>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline build ${notification.additionalContext.execution.trigger.buildInfo.number} was judged to stop.\n-  <#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application}'s ${notification.additionalContext.execution.name} pipeline was judged to stop.\n-  </#if>\n-<#else>\n-Stage ${notification.additionalContext.stageName} for ${notification.source.application} was judged to stop.\n-</#if>\n+<#include \"../manualJudgment/variables-slack.ftl\">\n+${stageDescription} _was judged to *stop*_ by ${notification.additionalContext.judgedBy}.\n+\n <#if (notification.additionalContext.message)??>\n ${htmlToText.convert(notification.additionalContext.message)}\n </#if>\n-\n-For more details, please visit:\n-<#if (notification.additionalContext.stageId)??>\n-  <#if (notification.additionalContext.restrictExecutionDuringTimeWindow)??>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}&step=1\n-  <#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}?refId=${notification.additionalContext.stageId}\n-  </#if>\n-<#else>\n-${baseUrl}/#/applications/${notification.source.application}/executions/details/${notification.source.executionId}\n-</#if>"
  },
  {
    "sha": "f903451fa59106a01dd9bdf26b3e2ac4c25b66d6",
    "filename": "echo-notifications/src/test/groovy/com/netflix/spinnaker/echo/notification/ManualJudgmentTemplateTest.groovy",
    "status": "modified",
    "additions": 5,
    "deletions": 13,
    "changes": 18,
    "blob_url": "https://github.com/spinnaker/echo/blob/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/test/groovy/com/netflix/spinnaker/echo/notification/ManualJudgmentTemplateTest.groovy",
    "raw_url": "https://github.com/spinnaker/echo/raw/fe60dbe738ce74b15d32c8c4e47913ec20efc1e0/echo-notifications/src/test/groovy/com/netflix/spinnaker/echo/notification/ManualJudgmentTemplateTest.groovy",
    "contents_url": "https://api.github.com/repos/spinnaker/echo/contents/echo-notifications/src/test/groovy/com/netflix/spinnaker/echo/notification/ManualJudgmentTemplateTest.groovy?ref=fe60dbe738ce74b15d32c8c4e47913ec20efc1e0",
    "patch": "@@ -38,7 +38,8 @@ class ManualJudgmentTemplateTest extends Specification {\n         )\n     }\n \n-    void \"should handle fully formed notification\"() {\n+\n+  void \"should handle fully formed notification\"() {\n         given:\n         Notification not = buildFullNotification()\n \n@@ -50,13 +51,10 @@ class ManualJudgmentTemplateTest extends Specification {\n \n         where:\n         expected = '''\\\n-        Stage stage-name for testapp's exe-name pipeline build 12345 is awaiting manual judgment.\n+        Stage <SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1|stage-name> for *testapp*'s *exe-name* pipeline build #*12345* is awaiting manual judgment.\n \n         *Instructions:*\n         Do the thing <http://foo>\n-\n-        For more details, please visit:\n-        SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1\n         '''.stripIndent()\n     }\n \n@@ -74,13 +72,10 @@ class ManualJudgmentTemplateTest extends Specification {\n \n         where:\n         expected = '''\\\n-        Stage stage-name for testapp's exe-name pipeline is awaiting manual judgment.\n+        Stage <SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1|stage-name> for *testapp*'s *exe-name* pipeline is awaiting manual judgment.\n \n         *Instructions:*\n         Do the thing <http://foo>\n-\n-        For more details, please visit:\n-        SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1\n         '''.stripIndent()\n \n \n@@ -144,15 +139,12 @@ class ManualJudgmentTemplateTest extends Specification {\n     // Note, there's a whitespace after each new line of the `instructions` because of `Jsoup.parse(...)`.\n     // This is because the field is HTML parsed to plaintext. Which also can contain Slack's psudo-markdown flavor.\n     expected = '''\\\n-        Stage stage-name for testapp's exe-name pipeline build 12345 is awaiting manual judgment.\n+        Stage <SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1|stage-name> for *testapp*'s *exe-name* pipeline build #*12345* is awaiting manual judgment.\n \n         *Instructions:*\n         This is an example message from spinnaker that's more than 80 characters to make sure that we won't wrap it. Note the extra whitespace at the end here: \n \n          ``` This test was added was because code blocks in Slack would word wrap at 80 characters and inject newlines in codeblocks. Note the extra whitespaces after each original newline. ``` \n-\n-        For more details, please visit:\n-        SPINNAKER_URL/#/applications/testapp/executions/details/exec-id?refId=stage-id&step=1\n         '''.stripIndent()\n   }\n }"
  }
]
