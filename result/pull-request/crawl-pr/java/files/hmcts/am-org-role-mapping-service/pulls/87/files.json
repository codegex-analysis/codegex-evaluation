[
  {
    "sha": "a0646da028eed48d163aeb48adb81068ff26edea",
    "filename": "charts/am-org-role-mapping-service/values.preview.template.yaml",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/charts/am-org-role-mapping-service/values.preview.template.yaml",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/charts/am-org-role-mapping-service/values.preview.template.yaml",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/charts/am-org-role-mapping-service/values.preview.template.yaml?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -16,5 +16,5 @@ java:\n     S2S_URL: http://rpe-service-auth-provider-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal\n     CASE_WORKER_REF_APP_URL: http://rd-caseworker-ref-api-aat.service.core-compute-aat.internal\n     AMQP_TOPIC_NAME: rd-caseworker-topic-{{ .Values.global.environment }}/subscriptions/am-orm-preview-functional-test\n-    ROLE_ASSIGNMENT_APP_URL: http://am-role-assignment-service-pr-675.service.core-compute-preview.internal\n+    ROLE_ASSIGNMENT_APP_URL: http://am-role-assignment-service-pr-580.service.core-compute-preview.internal\n     LAUNCH_DARKLY_ENV: pr\n\\ No newline at end of file"
  },
  {
    "sha": "e5b62fde37dfb0ad9feeb4f702b634d7b8542090",
    "filename": "src/functionalTest/resources/features/F-001/F-001.feature",
    "status": "modified",
    "additions": 41,
    "deletions": 78,
    "changes": 119,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/F-001.feature",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/F-001.feature",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/F-001.feature?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -4,20 +4,20 @@ Feature: Create Role Assignments for Users\n   Background:\n     Given an appropriate test context as detailed in the test data source\n \n-#  @S-002 @FeatureToggle(orm-base-flag)\n-#  Scenario: must successfully create org role mapping for a multiple user having single role\n-#    Given a user with [an active IDAM profile with full permissions],\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments01],\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments02],\n-#    And a successful call [to publish an existing CRD user ids to topic] as in [S-002_PushMessageToAzureServiceBus],\n-#    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n-#    And the request [contains the actorIds of the user just published],\n-#    When a request is prepared with appropriate values,\n-#    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n-#    Then a positive response is received,\n-#    And the response has all other details as expected,\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments01],\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments02].\n+  @S-002 @FeatureToggle(orm-base-flag)\n+  Scenario: must successfully create org role mapping for a multiple user having single role\n+    Given a user with [an active IDAM profile with full permissions],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments01],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments02],\n+    And a successful call [to publish an existing CRD user ids to topic] as in [S-002_PushMessageToAzureServiceBus],\n+    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n+    And the request [contains the actorIds of the user just published],\n+    When a request is prepared with appropriate values,\n+    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n+    Then a positive response is received,\n+    And the response has all other details as expected,\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments01],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-002_DeleteDataForRoleAssignments02].\n \n   @S-005 @FeatureToggle(orm-base-flag)\n   Scenario: should not create role assignments when user primary work location is false\n@@ -31,69 +31,32 @@ Feature: Create Role Assignments for Users\n     And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n     Then a positive response is received,\n     And the response has all other details as expected,\n-    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-005_DeleteDataForRoleAssignments01],\n-\n-#  @S-006 @FeatureToggle(orm-base-flag)\n-#  Scenario: must successfully create org role mapping for a user having multiple roles\n-#    Given a user with [an active IDAM profile with full permissions],\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-006_DeleteDataForRoleAssignments01],\n-#    And a successful call [to publish an existing CRD user ids to topic] as in [S-006_PushMessageToAzureServiceBus],\n-#    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n-#    And the request [contains the actorId of the user just published],\n-#    And the request [contains multiple role assignments for the user],\n-#    When a request is prepared with appropriate values,\n-#    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n-#    Then a positive response is received,\n-#    And the response has all other details as expected,\n-#    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-006_DeleteDataForRoleAssignments01],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-005_DeleteDataForRoleAssignments01].\n \n-  #  @S-002 @FeatureToggle(orm-base-flag)\n-  #  Scenario: must successfully generate duplicate records message\n-  #    Given a user with [an active IDAM profile with full permissions],\n-  #    When a request is prepared with appropriate values,\n-  #    And it is submitted to call the [Create Role Assignments] operation of [Organisation Role Mapping Service],\n-  #    And the request [prepared to submit second time with no changes],\n-  #    And it is submitted to call the [Create Role Assignments] operation of [Organisation Role Mapping Service],\n-  #    Then a positive response is received,\n-  #    And the response has all other details as expected,\n-  #    And a successful call [to delete role assignments just created above] as in [S-002_DeleteDataForRoleAssignments].\n-\n-  #Will implement this once ORM integrated with CRD API.\n-  #  @S-006\n-  #  Scenario: must successfully delete org role mapping when delete flag is true\n-  #    Given a user with [an active IDAM profile with full permissions],\n-  #    And a successful call [to get corresponding appointment data from CRD API] as in [Get_Data_from_CRD_API],\n-  #    When a request is prepared with appropriate values,\n-  #    And the request [contains the data received from CRD API got transformed],\n-  #    And the request [contains delete flag is true and has empty assignment records],\n-  #    And it is submitted to call the [Create Role Assignments] operation of [Role Assignments Service],\n-  #    Then a positive response is received,\n-  #    And the response has all other details as expected.\n-\n-  #Will implement this once ORM integrated with CRD API.\n-  #  @S-009\n-  #  Scenario: must successfully create org role mapping for an update of role TCW to STCW\n-  #    Given a user with [an active IDAM profile with full permissions],\n-  #    And a successful call [to get corresponding appointment data from CRD API] as in [Get_Data_from_CRD_API],\n-  #    When a request is prepared with appropriate values,\n-  #    And the request [contains an update of role CTW to SCTW],\n-  #    And the request [contains a single user with multiple role assignments],\n-  #    And it is submitted to call the [Create Role Assignments] operation of [Role Assignments Service],\n-  #    Then a positive response is received,\n-  #    And the response has all other details as expected,\n-  #    And a successful call [to delete role assignments just created above] as in [DeleteDataForRoleAssignments].\n+  @S-006 @FeatureToggle(orm-base-flag)\n+  Scenario: must successfully create org role mapping for a user having multiple roles\n+    Given a user with [an active IDAM profile with full permissions],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-006_DeleteDataForRoleAssignments01],\n+    And a successful call [to publish an existing CRD user ids to topic] as in [S-006_PushMessageToAzureServiceBus],\n+    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n+    And the request [contains the actorId of the user just published],\n+    And the request [contains multiple role assignments for the user],\n+    When a request is prepared with appropriate values,\n+    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n+    Then a positive response is received,\n+    And the response has all other details as expected,\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-006_DeleteDataForRoleAssignments01].\n \n-  #For delete flag, user has to be in Active Status in both UserProfile and IDAM tables.\n-  #  @S-004 @FeatureToggle(orm-base-flag)\n-  #  Scenario: must successfully remove role assignments using delete flag true\n-  #    Given a user with [an active IDAM profile with full permissions],\n-  #    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-004_DeleteDataForRoleAssignments01],\n-  #    And a successful call [to publish an existing CRD user ids to topic] as in [S-004_PushMessageToAzureServiceBus],\n-  #    And the request [contains the CRD user whose delete flag set to true],\n-  #    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n-  #    And the request [contains the actorId of the user just published],\n-  #    When a request is prepared with appropriate values,\n-  #    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n-  #    Then a positive response is received,\n-  #    And the response has all other details as expected,\n-  #    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-004_DeleteDataForRoleAssignments01],\n+  @S-007 @FeatureToggle(orm-base-flag)\n+  Scenario: must successfully generate duplicate records message\n+    Given a user with [an active IDAM profile with full permissions],\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-007_DeleteDataForRoleAssignments01],\n+    And a successful call [to publish an existing CRD user ids to topic] as in [S-007_PushMessageToAzureServiceBus],\n+    And a successful call [to publish an existing CRD user ids to topic] as in [S-007_PushMessageToAzureServiceBus],\n+    And a successful call [to provide adequate time for RAS to create records] as in [WaitForRASProcessing],\n+    And the request [contains the actorId of the user just published],\n+    When a request is prepared with appropriate values,\n+    And it is submitted to call the [Fetch Assignment From Role Assignment Service] operation of [Role Assignment Service],\n+    Then a positive response is received,\n+    And the response has all other details as expected,\n+    And a successful call [to delete existing role assignments corresponding to the test actorId] as in [S-007_DeleteDataForRoleAssignments01]."
  },
  {
    "sha": "199bb72fb923c4d04ea70e765b120f1a9a27143c",
    "filename": "src/functionalTest/resources/features/F-001/S-007.td.json",
    "status": "added",
    "additions": 42,
    "deletions": 0,
    "changes": 42,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007.td.json",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007.td.json",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/S-007.td.json?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -0,0 +1,42 @@\n+{\n+  \"_guid_\": \"S-007\",\n+  \"title\": \"must successfully generate duplicate records message\",\n+  \"_extends_\": \"F-001_Test_Data_Base\",\n+  \"specs\": [\n+    \"contains the actorId of the user just published\"\n+  ],\n+\n+  \"request\": {\n+    \"pathVariables\": {\n+      \"actorId\": \"d50bdb3d-092e-4e74-b492-5d8d51e16585\"\n+   }\n+  },\n+\n+  \"expectedResponse\": {\n+    \"_extends_\": \"Common_200_Response\",\n+    \"headers\": {\n+      \"_extends_\": \"Common_200_Response_Headers\",\n+      \"ETag\" : \"W/\\\"2\\\"\"\n+    },\n+    \"body\": {\n+      \"roleAssignmentResponse\": [\n+        {\n+          \"id\": \"[[ANYTHING_PRESENT]]\",\n+          \"actorIdType\": \"IDAM\",\n+          \"actorId\": \"[[ANYTHING_PRESENT]]\",\n+          \"roleType\": \"ORGANISATION\",\n+          \"roleName\": \"[[ANYTHING_PRESENT]]\",\n+          \"classification\": \"PUBLIC\",\n+          \"grantType\": \"STANDARD\",\n+          \"roleCategory\": \"LEGAL_OPERATIONS\",\n+          \"readOnly\": false,\n+          \"created\": \"[[ANYTHING_PRESENT]]\",\n+          \"attributes\": {\n+            \"primaryLocation\": \"[[ANYTHING_PRESENT]]\",\n+            \"jurisdiction\": \"IA\"\n+          }\n+        }\n+      ]\n+    }\n+  }\n+}"
  },
  {
    "sha": "63d853781d348352dead2ee798570a6505df5e34",
    "filename": "src/functionalTest/resources/features/F-001/S-007_DeleteDataForRoleAssignments01.td.json",
    "status": "added",
    "additions": 39,
    "deletions": 0,
    "changes": 39,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007_DeleteDataForRoleAssignments01.td.json",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007_DeleteDataForRoleAssignments01.td.json",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/S-007_DeleteDataForRoleAssignments01.td.json?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -0,0 +1,39 @@\n+{\n+  \"_guid_\": \"S-007_DeleteDataForRoleAssignments01\",\n+  \"productName\": \"Role Assignment Service\",\n+  \"operationName\": \"Delete Role Assignments by Process\",\n+  \"method\": \"DELETE\",\n+  \"uri\": \"{{ROLE_ASSIGNMENT_URL}}/am/role-assignments?process={process}&reference={reference}\",\n+  \"specs\": [\n+    \"to delete role assignments just created above\",\n+    \"to delete existing role assignments corresponding to the test actorId\"\n+  ],\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"username\": \"[[$TEST_AM_CRD_USER1_BEFTA]]\",\n+      \"password\": \"[[$TEST_AM_USER2_BEFTA_PWD]]\"\n+    }\n+  },\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"[[DEFAULT_AUTO_VALUE]]\",\n+      \"ServiceAuthorization\": \"[[DEFAULT_AUTO_VALUE]]\",\n+      \"X-Correlation-ID\": \"003352d0-e699-48bc-b6f5-5810411e60af\"\n+    },\n+    \"pathVariables\": {\n+      \"process\": \"staff-organisational-role-mapping\",\n+      \"reference\":\"${[scenarioContext][testData][request][body][userIds][0]}\"\n+    },\n+    \"body\": {\n+      \"_extends_\": \"SingleDuplicateUser\"\n+    }\n+  },\n+\n+  \"expectedResponse\": {\n+    \"headers\": {\n+      \"Content-Length\": \"[[ANYTHING_PRESENT]]\",\n+      \"Content-Type\": \"application/json\"\n+    },\n+    \"_extends_\": \"Common_204_Response\"\n+  }\n+}"
  },
  {
    "sha": "9cdea1bb6c2d9297638aae1ccab232ce542debf2",
    "filename": "src/functionalTest/resources/features/F-001/S-007_PushMessageToAzureServiceBus.td.json",
    "status": "added",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007_PushMessageToAzureServiceBus.td.json",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/S-007_PushMessageToAzureServiceBus.td.json",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/S-007_PushMessageToAzureServiceBus.td.json?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -0,0 +1,10 @@\n+{\n+  \"_guid_\": \"S-007_PushMessageToAzureServiceBus\",\n+  \"_extends_\": \"PushMessageToAzureServiceBus\",\n+\n+  \"request\": {\n+    \"body\": {\n+      \"_extends_\": \"SingleDuplicateUser\"\n+    }\n+  }\n+}"
  },
  {
    "sha": "f0c8154918edbe97abe355b5929cfc825dc5589e",
    "filename": "src/functionalTest/resources/features/F-001/SingleDuplicateUser.td.json",
    "status": "added",
    "additions": 7,
    "deletions": 0,
    "changes": 7,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/SingleDuplicateUser.td.json",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/SingleDuplicateUser.td.json",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/SingleDuplicateUser.td.json?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -0,0 +1,7 @@\n+{\n+  \"_guid_\": \"SingleDuplicateUser\",\n+\n+  \"userIds\": [\n+    \"f5bdd3b5-b76d-4460-891e-ab9365669c5d\"\n+  ]\n+}"
  },
  {
    "sha": "e6a62311152875e903da94654fbd029d9aaf8ccb",
    "filename": "src/functionalTest/resources/features/F-001/SingleUserId.td.json",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/hmcts/am-org-role-mapping-service/blob/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/SingleUserId.td.json",
    "raw_url": "https://github.com/hmcts/am-org-role-mapping-service/raw/8c37ae33953e19898532bda30211f1b2734ba337/src/functionalTest/resources/features/F-001/SingleUserId.td.json",
    "contents_url": "https://api.github.com/repos/hmcts/am-org-role-mapping-service/contents/src/functionalTest/resources/features/F-001/SingleUserId.td.json?ref=8c37ae33953e19898532bda30211f1b2734ba337",
    "patch": "@@ -2,7 +2,7 @@\n   \"_guid_\": \"SingleUserId\",\n \n   \"userIds\": [\n-    \"d7813e3d-6159-4feb-a6f6-7315645cf2b6\",\n-    \"f5bdd3b5-b76d-4460-891e-ab9365669c5d\"\n+    \"f5bdd3b5-b76d-4460-891e-ab9365669c5d\",\n+    \"d7813e3d-6159-4feb-a6f6-7315645cf2b6\"\n   ]\n }"
  }
]
