[
  {
    "sha": "fc371ebe30c61f577fb421be9f16a0924c37cdee",
    "filename": "azure-pipelines.yml",
    "status": "modified",
    "additions": 34,
    "deletions": 2,
    "changes": 36,
    "blob_url": "https://github.com/hmcts/hmi-api-gateway-fh/blob/12669c43e422dad9e67fb3a58aa18a7d1d58c9ed/azure-pipelines.yml",
    "raw_url": "https://github.com/hmcts/hmi-api-gateway-fh/raw/12669c43e422dad9e67fb3a58aa18a7d1d58c9ed/azure-pipelines.yml",
    "contents_url": "https://api.github.com/repos/hmcts/hmi-api-gateway-fh/contents/azure-pipelines.yml?ref=12669c43e422dad9e67fb3a58aa18a7d1d58c9ed",
    "patch": "@@ -88,24 +88,45 @@ stages:\n         group: HMI-APIM-BUILD-TEST\n \n   - stage: PlanSTG\n-    dependsOn: Validate\n+    dependsOn: TestTEST\n     condition: and(succeeded(), or(eq('${{ parameters.stage }}', 'STG'), contains('${{ parameters.stage }}', 'PRODUCTION'), contains('${{ parameters.stage }}', 'ALL')))\n     jobs:\n     - template: pipeline/jobs/terraform-plan.yaml\n       parameters:\n         displayName: Plan STG\n         subscription: DTS-SHAREDSERVICES-STG\n         group: HMI-APIM-BUILD-STG\n+    - job: waitForValidation\n+      displayName: Wait for external validation  \n+      pool: server    \n+      timeoutInMinutes: 4320 # job times out in 3 days\n+      steps:   \n+      - task: ManualValidation@0\n+        timeoutInMinutes: 1440 # task times out in 1 day\n+        inputs:\n+            instructions: 'Please validate the Terraform Plan for STG environment to resume'\n+            onTimeout: 'resume'\n+    \n \n   - stage: PlanPROD\n-    dependsOn: Validate\n+    dependsOn: BuildSTG\n     condition: and(succeeded(), or(eq('${{ parameters.stage }}', 'PROD'), contains('${{ parameters.stage }}', 'PRODUCTION'), contains('${{ parameters.stage }}', 'ALL')))\n     jobs:\n     - template: pipeline/jobs/terraform-plan.yaml\n       parameters:\n         displayName: Plan PROD\n         subscription: DTS-SHAREDSERVICES-PROD\n         group: HMI-APIM-BUILD-PROD\n+    - job: waitForValidation\n+      displayName: Wait for external validation  \n+      pool: server    \n+      timeoutInMinutes: 4320 # job times out in 3 days\n+      steps:   \n+      - task: ManualValidation@0\n+        timeoutInMinutes: 1440 # task times out in 1 day\n+        inputs:\n+            instructions: 'Please validate the Terraform Plan for PROD environment to resume'\n+            onTimeout: 'resume'\n \n   - stage: BuildSBOX\n     dependsOn: PlanSbox\n@@ -424,6 +445,17 @@ stages:\n           dependsOn:\n           - AcceptanceTest\n \n+      - job: waitForValidation\n+        displayName: Wait for external validation  \n+        pool: server    \n+        timeoutInMinutes: 4320 # job times out in 3 days\n+        steps:   \n+        - task: ManualValidation@0\n+          timeoutInMinutes: 1440 # task times out in 1 day\n+          inputs:\n+              instructions: 'Please validate the Test environment to resume'\n+              onTimeout: 'resume'\n+\n   - stage: BuildSTG\n     dependsOn:\n       - PlanStg"
  }
]
