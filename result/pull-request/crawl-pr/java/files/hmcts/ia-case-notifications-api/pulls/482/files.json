[
  {
    "sha": "fad5b2f772b28e236df5e022f80c465012f65cf2",
    "filename": "src/functionalTest/resources/scenarios/RIA-3731-remove-representation-notifications.json",
    "status": "added",
    "additions": 26,
    "deletions": 0,
    "changes": 26,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/functionalTest/resources/scenarios/RIA-3731-remove-representation-notifications.json",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/functionalTest/resources/scenarios/RIA-3731-remove-representation-notifications.json",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/functionalTest/resources/scenarios/RIA-3731-remove-representation-notifications.json?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,26 @@\n+{\n+  \"description\": \"RIA-3731 Send remove representation notification to legal rep, case officer and home office\",\n+  \"request\": {\n+    \"uri\": \"/asylum/ccdSubmitted\",\n+    \"credentials\": \"LegalRepresentative\",\n+    \"input\": {\n+      \"id\": 3731,\n+      \"eventId\": \"removeRepresentation\",\n+      \"state\": \"appealSubmitted\",\n+      \"caseData\": {\n+        \"template\": \"minimal-appeal-submitted.json\",\n+        \"replacements\": {\n+          \"hearingCentre\": \"manchester\"\n+        }\n+      }\n+    }\n+  },\n+  \"expectation\": {\n+    \"status\": 200,\n+    \"errors\": [],\n+    \"confirmation\": {\n+      \"confirmation_header\": \"anything\",\n+      \"confirmation_body\": \"anything\"\n+    }\n+  }\n+}"
  },
  {
    "sha": "156c630f9ab82860ea70a8641b5f48db92ffee1b",
    "filename": "src/functionalTest/resources/scenarios/RIA-4104-send-apply-notice-of-change-notification-to-legal-rep.json",
    "status": "added",
    "additions": 26,
    "deletions": 0,
    "changes": 26,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/functionalTest/resources/scenarios/RIA-4104-send-apply-notice-of-change-notification-to-legal-rep.json",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/functionalTest/resources/scenarios/RIA-4104-send-apply-notice-of-change-notification-to-legal-rep.json",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/functionalTest/resources/scenarios/RIA-4104-send-apply-notice-of-change-notification-to-legal-rep.json?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,26 @@\n+{\n+  \"description\": \"RIA-4104 Send apply notice of change notification to legal rep\",\n+  \"request\": {\n+    \"uri\": \"/asylum/ccdSubmitted\",\n+    \"credentials\": \"LegalRepresentative\",\n+    \"input\": {\n+      \"id\": 4104,\n+      \"eventId\": \"applyNocDecision\",\n+      \"state\": \"appealSubmitted\",\n+      \"caseData\": {\n+        \"template\": \"minimal-appeal-submitted.json\",\n+        \"replacements\": {\n+          \"hearingCentre\": \"manchester\"\n+        }\n+      }\n+    }\n+  },\n+  \"expectation\": {\n+    \"status\": 200,\n+    \"errors\": [],\n+    \"confirmation\": {\n+      \"confirmation_header\": \"success\",\n+      \"confirmation_body\": \"success\"\n+    }\n+  }\n+}"
  },
  {
    "sha": "a405ccc5237ffe11063072c67762cf0b376257dd",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/AsylumCaseDefinition.java",
    "status": "modified",
    "additions": 9,
    "deletions": 1,
    "changes": 10,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/AsylumCaseDefinition.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/AsylumCaseDefinition.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/AsylumCaseDefinition.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -214,7 +214,6 @@\n     FTPA_RESPONDENT_DECISION_REMADE_RULE_32(\n         \"ftpaRespondentDecisionRemadeRule32\", new TypeReference<FtpaDecisionOutcomeType>(){}),\n \n-\n     FTPA_APPELLANT_SUBMITTED(\n         \"ftpaAppellantSubmitted\", new TypeReference<YesOrNo>(){}),\n \n@@ -307,6 +306,15 @@\n     HOME_OFFICE_FTPA_RESPONDENT_DECIDED_INSTRUCT_STATUS(\n         \"homeOfficeFtpaRespondentDecidedInstructStatus\", new TypeReference<String>() {}),\n \n+    APPELLANT_DATE_OF_BIRTH(\n+        \"appellantDateOfBirth\", new TypeReference<String>() {}),\n+\n+    EMAIL(\n+        \"email\", new TypeReference<String>(){}),\n+\n+    MOBILE_NUMBER(\n+        \"mobileNumber\", new TypeReference<String>(){}),\n+\n     ;\n \n     private final String value;"
  },
  {
    "sha": "702b7bf3bce2a6ca68e6cee5bbc1846e8e5ce196",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/Event.java",
    "status": "modified",
    "additions": 2,
    "deletions": 0,
    "changes": 2,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/Event.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/Event.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/Event.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -75,6 +75,8 @@\n     DECIDE_AN_APPLICATION(\"decideAnApplication\"),\n     REQUEST_NEW_HEARING_REQUIREMENTS(\"requestNewHearingRequirements\"),\n     RECORD_REMISSION_DECISION(\"recordRemissionDecision\"),\n+    APPLY_NOC_DECISION(\"applyNocDecision\"),\n+    REMOVE_REPRESENTATION(\"removeRepresentation\"),\n \n     @JsonEnumDefaultValue\n     UNKNOWN(\"unknown\");"
  },
  {
    "sha": "0cb888dc2bb3d4529f90981dee0892c5c684f471",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStage.java",
    "status": "added",
    "additions": 17,
    "deletions": 0,
    "changes": 17,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStage.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStage.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStage.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,17 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback;\n+\n+public enum PostSubmitCallbackStage {\n+\n+    CCD_SUBMITTED(\"ccdSubmitted\");\n+\n+    private final String id;\n+\n+    PostSubmitCallbackStage(String id) {\n+        this.id = id;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return id;\n+    }\n+}"
  },
  {
    "sha": "718a92a7eb3e39242a7b2f20a054433414ae5ec1",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/PostSubmitCallbackHandler.java",
    "status": "added",
    "additions": 20,
    "deletions": 0,
    "changes": 20,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/PostSubmitCallbackHandler.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/PostSubmitCallbackHandler.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/PostSubmitCallbackHandler.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,20 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers;\n+\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseData;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackResponse;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n+\n+public interface PostSubmitCallbackHandler<T extends CaseData> {\n+\n+    boolean canHandle(\n+        PostSubmitCallbackStage callbackStage,\n+        Callback<T> callback\n+    );\n+\n+    PostSubmitCallbackResponse handle(\n+        PostSubmitCallbackStage callbackStage,\n+        Callback<T> callback\n+    );\n+}\n+"
  },
  {
    "sha": "1b674679affa17bd63f12421adf03d9216dd23cd",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandler.java",
    "status": "added",
    "additions": 83,
    "deletions": 0,
    "changes": 83,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandler.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandler.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandler.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.postsubmit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.BiPredicate;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.Event;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.*;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.ErrorHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.PostSubmitCallbackHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.service.NotificationGenerator;\n+\n+public class PostSubmitNotificationHandler implements PostSubmitCallbackHandler<AsylumCase> {\n+\n+    private final BiPredicate<PostSubmitCallbackStage, Callback<AsylumCase>> canHandleFunction;\n+    private final List<? extends NotificationGenerator> notificationGenerators;\n+    private final Optional<ErrorHandler> errorHandling;\n+\n+    public PostSubmitNotificationHandler(BiPredicate<PostSubmitCallbackStage, Callback<AsylumCase>> canHandleFunction,\n+                                         List<? extends NotificationGenerator> notificationGenerator\n+    ) {\n+        this.canHandleFunction = canHandleFunction;\n+        this.notificationGenerators = notificationGenerator;\n+        this.errorHandling = Optional.empty();\n+    }\n+\n+    public PostSubmitNotificationHandler(BiPredicate<PostSubmitCallbackStage, Callback<AsylumCase>> canHandleFunction,\n+                                         List<? extends NotificationGenerator> notificationGenerator,\n+                                         ErrorHandler errorHandling\n+    ) {\n+        this.canHandleFunction = canHandleFunction;\n+        this.notificationGenerators = notificationGenerator;\n+        this.errorHandling = Optional.ofNullable(errorHandling);\n+    }\n+\n+    @Override\n+    public boolean canHandle(PostSubmitCallbackStage callbackStage, Callback<AsylumCase> callback) {\n+        requireNonNull(callbackStage, \"callbackStage must not be null\");\n+        requireNonNull(callback, \"callback must not be null\");\n+\n+        return canHandleFunction.test(callbackStage, callback);\n+    }\n+\n+    @Override\n+    public PostSubmitCallbackResponse handle(PostSubmitCallbackStage callbackStage, Callback<AsylumCase> callback) {\n+        if (!canHandle(callbackStage, callback)) {\n+            throw new IllegalStateException(\"Cannot handle callback\");\n+        }\n+        PostSubmitCallbackResponse postSubmitCallbackResponse = new PostSubmitCallbackResponse();\n+        try {\n+            notificationGenerators.forEach(notificationGenerator -> notificationGenerator.generate(callback));\n+\n+            if (callback.getEvent() == Event.REMOVE_REPRESENTATION) {\n+                setRemoveRepresentationHeaderAndBody(postSubmitCallbackResponse);\n+            } else {\n+                postSubmitCallbackResponse.setConfirmationHeader(\"success\");\n+                postSubmitCallbackResponse.setConfirmationBody(\"success\");\n+            }\n+        } catch (Exception e) {\n+            if (errorHandling.isPresent()) {\n+                errorHandling.get().accept(callback, e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        return postSubmitCallbackResponse;\n+    }\n+\n+    void setRemoveRepresentationHeaderAndBody(PostSubmitCallbackResponse postSubmitCallbackResponse) {\n+        postSubmitCallbackResponse.setConfirmationHeader(\n+            \"# You have stopped representing this client\"\n+        );\n+\n+        postSubmitCallbackResponse.setConfirmationBody(\n+            \"#### What happens next\\n\\n\"\n+            + \"We've sent you an email confirming you're no longer representing this client.\\n\"\n+            + \"You have been removed from this case and no longer have access to it.\\n\\n\"\n+            + \"[View case list](/cases)\"\n+        );\n+    }\n+}"
  },
  {
    "sha": "54d2aa3bfabbcd53155088fece515935551ed143",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmail.java",
    "status": "added",
    "additions": 67,
    "deletions": 0,
    "changes": 67,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmail.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmail.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmail.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,67 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.appellant.email;\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.EmailNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@Service\n+public class AppellantRemoveRepresentationPersonalisationEmail implements EmailNotificationPersonalisation {\n+\n+    private final String removeRepresentationAppellantEmailTemplateId;\n+    private final CustomerServicesProvider customerServicesProvider;\n+\n+    public AppellantRemoveRepresentationPersonalisationEmail(\n+        @Value(\"${govnotify.template.removeRepresentation.appellant.email}\") String removeRepresentationAppellantEmailTemplateId,\n+        CustomerServicesProvider customerServicesProvider\n+    ) {\n+        this.removeRepresentationAppellantEmailTemplateId = removeRepresentationAppellantEmailTemplateId;\n+        this.customerServicesProvider = customerServicesProvider;\n+    }\n+\n+    @Override\n+    public String getTemplateId() {\n+        return removeRepresentationAppellantEmailTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(final AsylumCase asylumCase) {\n+        return Collections.singleton(asylumCase\n+            .read(EMAIL, String.class)\n+            .orElseThrow(() -> new IllegalStateException(\"appellantEmailAddress is not present\")));\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_REMOVE_REPRESENTATION_APPELLANT_EMAIL\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(Callback<AsylumCase> callback) {\n+        requireNonNull(callback, \"callback must not be null\");\n+\n+        AsylumCase asylumCase = callback.getCaseDetails().getCaseData();\n+        requireNonNull(asylumCase, \"asylumCase must not be null\");\n+\n+        return\n+            ImmutableMap\n+                .<String, String>builder()\n+                .putAll(customerServicesProvider.getCustomerServicesPersonalisation())\n+                .put(\"appellantGivenNames\", asylumCase.read(AsylumCaseDefinition.APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+                .put(\"appellantFamilyName\", asylumCase.read(AsylumCaseDefinition.APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+                .put(\"appellantDateOfBirth\", asylumCase.read(AsylumCaseDefinition.APPELLANT_DATE_OF_BIRTH, String.class).orElse(\"\"))\n+                .put(\"ccdCaseId\", String.valueOf(callback.getCaseDetails().getId()))\n+                .put(\"legalRepReferenceNumber\", asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+                .build();\n+    }\n+}"
  },
  {
    "sha": "aea9ac5a4c5caf060312a25eeea210e589948830",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSms.java",
    "status": "added",
    "additions": 69,
    "deletions": 0,
    "changes": 69,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSms.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSms.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSms.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,69 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.appellant.sms;\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.SmsNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+\n+@Service\n+public class AppellantRemoveRepresentationPersonalisationSms implements SmsNotificationPersonalisation {\n+\n+    private final String removeRepresentationAppellantSmsTemplateId;\n+    private final CustomerServicesProvider customerServicesProvider;\n+\n+\n+    public AppellantRemoveRepresentationPersonalisationSms(\n+        @Value(\"${govnotify.template.removeRepresentation.appellant.sms}\") String removeRepresentationAppellantSmsTemplateId,\n+        CustomerServicesProvider customerServicesProvider\n+    ) {\n+        this.removeRepresentationAppellantSmsTemplateId = removeRepresentationAppellantSmsTemplateId;\n+        this.customerServicesProvider = customerServicesProvider;\n+    }\n+\n+    @Override\n+    public String getTemplateId() {\n+        return removeRepresentationAppellantSmsTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(AsylumCase asylumCase) {\n+\n+        return Collections.singleton(asylumCase\n+            .read(MOBILE_NUMBER, String.class)\n+            .orElseThrow(() -> new IllegalStateException(\"appellantMobileNumber is not present\")));\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_REMOVE_REPRESENTATION_APPELLANT_SMS\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(Callback<AsylumCase> callback) {\n+        requireNonNull(callback, \"callback must not be null\");\n+\n+        AsylumCase asylumCase = callback.getCaseDetails().getCaseData();\n+\n+        return\n+            ImmutableMap\n+                .<String, String>builder()\n+                .putAll(customerServicesProvider.getCustomerServicesPersonalisation())\n+                .put(\"appellantGivenNames\", asylumCase.read(AsylumCaseDefinition.APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+                .put(\"appellantFamilyName\", asylumCase.read(AsylumCaseDefinition.APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+                .put(\"appellantDateOfBirth\", asylumCase.read(AsylumCaseDefinition.APPELLANT_DATE_OF_BIRTH, String.class).orElse(\"\"))\n+                .put(\"ccdCaseId\", String.valueOf(callback.getCaseDetails().getId()))\n+                .put(\"legalRepReferenceNumber\", asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+                .build();\n+    }\n+}"
  },
  {
    "sha": "1e227b93c9d21f484789df4220f5920e31c5e0f6",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisation.java",
    "status": "added",
    "additions": 73,
    "deletions": 0,
    "changes": 73,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisation.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisation.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisation.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,73 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.caseofficer;\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import javax.validation.constraints.NotNull;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.EmailNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.EmailAddressFinder;\n+\n+@Service\n+public class CaseOfficerRemoveRepresentationPersonalisation implements EmailNotificationPersonalisation {\n+\n+    private final String removeRepresentationCaseOfficerBeforeListingTemplateId;\n+    private final String removeRepresentationCaseOfficerAfterListingTemplateId;\n+    private final String iaExUiFrontendUrl;\n+    private final AppealService appealService;\n+    private final EmailAddressFinder emailAddressFinder;\n+\n+    public CaseOfficerRemoveRepresentationPersonalisation(\n+        @NotNull(message = \"removeRepresentationCaseOfficerBeforeListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.caseOfficer.beforeListing.email}\") String removeRepresentationCaseOfficerBeforeListingTemplateId,\n+        @NotNull(message = \"removeRepresentationCaseOfficerAfterListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.caseOfficer.afterListing.email}\") String removeRepresentationCaseOfficerAfterListingTemplateId,\n+        @Value(\"${iaExUiFrontendUrl}\") String iaExUiFrontendUrl,\n+        AppealService appealService,\n+        EmailAddressFinder emailAddressFinder\n+    ) {\n+        this.removeRepresentationCaseOfficerBeforeListingTemplateId = removeRepresentationCaseOfficerBeforeListingTemplateId;\n+        this.removeRepresentationCaseOfficerAfterListingTemplateId = removeRepresentationCaseOfficerAfterListingTemplateId;\n+        this.iaExUiFrontendUrl = iaExUiFrontendUrl;\n+        this.appealService = appealService;\n+        this.emailAddressFinder = emailAddressFinder;\n+    }\n+\n+    @Override\n+    public String getTemplateId(AsylumCase asylumCase) {\n+        return appealService.isAppealListed(asylumCase)\n+            ? removeRepresentationCaseOfficerAfterListingTemplateId\n+            : removeRepresentationCaseOfficerBeforeListingTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(AsylumCase asylumCase) {\n+        return Collections.singleton(emailAddressFinder.getHearingCentreEmailAddress(asylumCase));\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_REMOVE_REPRESENTATION_CASE_OFFICER\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(AsylumCase asylumCase) {\n+        requireNonNull(asylumCase, \"asylumCase must not be null\");\n+\n+        return\n+            ImmutableMap\n+                .<String, String>builder()\n+                .put(\"appealReferenceNumber\", asylumCase.read(AsylumCaseDefinition.APPEAL_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+                .put(\"ariaListingReference\", asylumCase.read(AsylumCaseDefinition.ARIA_LISTING_REFERENCE, String.class).orElse(\"\"))\n+                .put(\"appellantGivenNames\", asylumCase.read(APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+                .put(\"appellantFamilyName\", asylumCase.read(APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+                .put(\"linkToOnlineService\", iaExUiFrontendUrl)\n+                .build();\n+    }\n+}"
  },
  {
    "sha": "2135962f4413de869f35cd7613d1b42a06ecb8e9",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisation.java",
    "status": "added",
    "additions": 157,
    "deletions": 0,
    "changes": 157,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisation.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisation.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisation.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,157 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.homeoffice;\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import javax.validation.constraints.NotNull;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.field.AddressUk;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.EmailNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+\n+@Service\n+public class HomeOfficeRemoveRepresentationPersonalisation implements EmailNotificationPersonalisation {\n+\n+    private final String removeRepresentationHomeOfficeBeforeListingTemplateId;\n+    private final String removeRepresentationHomeOfficeAfterListingTemplateId;\n+    private final String apcPrivateBetaInboxHomeOfficeEmailAddress;\n+    private final String iaExUiFrontendUrl;\n+    private final AppealService appealService;\n+    private final CustomerServicesProvider customerServicesProvider;\n+\n+    public HomeOfficeRemoveRepresentationPersonalisation(\n+        @NotNull(message = \"removeRepresentationHomeOfficeBeforeListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.homeOffice.beforeListing.email}\") String removeRepresentationHomeOfficeBeforeListingTemplateId,\n+        @NotNull(message = \"removeRepresentationHomeOfficeAfterListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.homeOffice.afterListing.email}\") String removeRepresentationHomeOfficeAfterListingTemplateId,\n+        @Value(\"${apcPrivateHomeOfficeEmailAddress}\") String apcPrivateBetaInboxHomeOfficeEmailAddress,\n+        @Value(\"${iaExUiFrontendUrl}\") String iaExUiFrontendUrl,\n+        AppealService appealService,\n+        CustomerServicesProvider customerServicesProvider\n+    ) {\n+        this.removeRepresentationHomeOfficeBeforeListingTemplateId = removeRepresentationHomeOfficeBeforeListingTemplateId;\n+        this.removeRepresentationHomeOfficeAfterListingTemplateId = removeRepresentationHomeOfficeAfterListingTemplateId;\n+        this.apcPrivateBetaInboxHomeOfficeEmailAddress = apcPrivateBetaInboxHomeOfficeEmailAddress;\n+        this.iaExUiFrontendUrl = iaExUiFrontendUrl;\n+        this.appealService = appealService;\n+        this.customerServicesProvider = customerServicesProvider;\n+    }\n+\n+    @Override\n+    public String getTemplateId(AsylumCase asylumCase) {\n+        return appealService.isAppealListed(asylumCase)\n+            ? removeRepresentationHomeOfficeAfterListingTemplateId\n+            : removeRepresentationHomeOfficeBeforeListingTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(AsylumCase asylumCase) {\n+        return Collections.singleton(apcPrivateBetaInboxHomeOfficeEmailAddress);\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_REMOVE_REPRESENTATION_HOME_OFFICE\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(AsylumCase asylumCase) {\n+        requireNonNull(asylumCase, \"asylumCase must not be null\");\n+\n+        return ImmutableMap\n+            .<String, String>builder()\n+            .putAll(customerServicesProvider.getCustomerServicesPersonalisation())\n+            .put(\"appealReferenceNumber\", asylumCase.read(AsylumCaseDefinition.APPEAL_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+            .put(\"homeOfficeReferenceNumber\", asylumCase.read(AsylumCaseDefinition.HOME_OFFICE_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+            .put(\"appellantGivenNames\", asylumCase.read(AsylumCaseDefinition.APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+            .put(\"appellantFamilyName\", asylumCase.read(AsylumCaseDefinition.APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+            .put(\"linkToOnlineService\", iaExUiFrontendUrl)\n+            .put(\"legalRepresentativeName\", asylumCase.read(AsylumCaseDefinition.LEGAL_REPRESENTATIVE_NAME, String.class).orElse(\"\"))\n+            .put(\"legalRepCompanyAddress\", formatCompanyAddress(asylumCase))\n+            .put(\"legalRepresentativeEmailAddress\", asylumCase.read(AsylumCaseDefinition.LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class).orElse(\"\"))\n+            .build();\n+    }\n+\n+    public String formatCompanyAddress(AsylumCase asylumCase) {\n+\n+        StringBuilder str = new StringBuilder();\n+\n+        if (asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class).isPresent()) {\n+\n+            final String addressLine1 =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getAddressLine1).orElse(\"\");\n+\n+            final String addressLine2 =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getAddressLine2).orElse(\"\");\n+\n+            final String addressLine3 =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getAddressLine3).orElse(\"\");\n+\n+            final String postTown =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getPostTown).orElse(\"\");\n+\n+            final String county =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getCounty).orElse(\"\");\n+\n+            final String postCode =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getPostCode).orElse(\"\");\n+\n+            final String country =\n+                asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)\n+                    .flatMap(AddressUk::getCountry).orElse(\"\");\n+\n+            if (!Optional.of(addressLine1).get().equals(\"\")) {\n+                str.append(addressLine1);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(addressLine2).get().isEmpty()) {\n+                str.append(addressLine2);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(addressLine3).get().isEmpty()) {\n+                str.append(addressLine3);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(postTown).get().isEmpty()) {\n+                str.append(postTown);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(county).get().isEmpty()) {\n+                str.append(county);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(postCode).get().isEmpty()) {\n+                str.append(postCode);\n+                str.append(\", \");\n+            }\n+\n+            if (!Optional.of(country).get().isEmpty()) {\n+                str.append(country);\n+            }\n+\n+        } else {\n+            return \"\";\n+        }\n+\n+        return str.toString();\n+    }\n+}"
  },
  {
    "sha": "0da0512b1d68ea88b2d3d18c7157aa50594d74f6",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisation.java",
    "status": "added",
    "additions": 67,
    "deletions": 0,
    "changes": 67,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisation.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisation.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisation.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,67 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.legalrepresentative;\n+\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.LEGAL_REPRESENTATIVE_EMAIL_ADDRESS;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import javax.validation.constraints.NotNull;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.EmailNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@Service\n+public class LegalRepresentativeApplyNocDecisionPersonalisation implements EmailNotificationPersonalisation {\n+\n+    private final String applyNocDecisionLegalRepresentativeTemplateId;\n+    private final String iaExUiFrontendUrl;\n+    private final CustomerServicesProvider customerServicesProvider;\n+\n+\n+    public LegalRepresentativeApplyNocDecisionPersonalisation(\n+            @NotNull(message = \"applyNocDecisionLegalRepresentativeTemplateId cannot be null\")\n+            @Value(\"${govnotify.template.applyNoticeOfChangeDecision.legalRep.email}\") String applyNocDecisionLegalRepresentativeTemplateId,\n+            @Value(\"${iaExUiFrontendUrl}\") String iaExUiFrontendUrl,\n+            CustomerServicesProvider customerServicesProvider\n+    ) {\n+        this.applyNocDecisionLegalRepresentativeTemplateId = applyNocDecisionLegalRepresentativeTemplateId;\n+        this.iaExUiFrontendUrl = iaExUiFrontendUrl;\n+        this.customerServicesProvider = customerServicesProvider;\n+    }\n+\n+    @Override\n+    public String getTemplateId() {\n+        return applyNocDecisionLegalRepresentativeTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(AsylumCase asylumCase) {\n+        return Collections.singleton(asylumCase\n+                .read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class)\n+                .orElseThrow(() -> new IllegalStateException(\"legalRepresentativeEmailAddress is not present\")));\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_APPLY_NOC_DECISION_LEGAL_REP\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(AsylumCase asylumCase) {\n+        requireNonNull(asylumCase, \"asylumCase must not be null\");\n+\n+        return ImmutableMap\n+                .<String, String>builder()\n+                .putAll(customerServicesProvider.getCustomerServicesPersonalisation())\n+                .put(\"appellantGivenNames\", asylumCase.read(AsylumCaseDefinition.APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+                .put(\"appellantFamilyName\", asylumCase.read(AsylumCaseDefinition.APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+                .put(\"linkToOnlineService\", iaExUiFrontendUrl)\n+                .build();\n+    }\n+}"
  },
  {
    "sha": "954e55c6e7417037fe6a25ade6c06cbbfa9de3de",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisation.java",
    "status": "added",
    "additions": 82,
    "deletions": 0,
    "changes": 82,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisation.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisation.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisation.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,82 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.legalrepresentative;\n+\n+\n+import static java.util.Objects.requireNonNull;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.LEGAL_REP_REFERENCE_NUMBER;\n+\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import javax.validation.constraints.NotNull;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.EmailNotificationPersonalisation;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@Service\n+public class LegalRepresentativeRemoveRepresentationPersonalisation implements EmailNotificationPersonalisation {\n+\n+    private final String removeRepresentationLegalRepresentativeBeforeListingTemplateId;\n+    private final String removeRepresentationLegalRepresentativeAfterListingTemplateId;\n+    private final AppealService appealService;\n+    private final String iaExUiFrontendUrl;\n+    private final CustomerServicesProvider customerServicesProvider;\n+\n+    public LegalRepresentativeRemoveRepresentationPersonalisation(\n+        @NotNull(message = \"removeRepresentationLegalRepresentativeBeforeListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.legalRep.beforeListing.email}\") String removeRepresentationLegalRepresentativeBeforeListingTemplateId,\n+        @NotNull(message = \"removeRepresentationLegalRepresentativeAfterListingTemplateId cannot be null\") @Value(\"${govnotify.template.removeRepresentation.legalRep.afterListing.email}\") String removeRepresentationLegalRepresentativeAfterListingTemplateId,\n+        @Value(\"${iaExUiFrontendUrl}\") String iaExUiFrontendUrl,\n+        AppealService appealService,\n+        CustomerServicesProvider customerServicesProvider\n+    ) {\n+        this.removeRepresentationLegalRepresentativeBeforeListingTemplateId = removeRepresentationLegalRepresentativeBeforeListingTemplateId;\n+        this.removeRepresentationLegalRepresentativeAfterListingTemplateId = removeRepresentationLegalRepresentativeAfterListingTemplateId;\n+        this.iaExUiFrontendUrl = iaExUiFrontendUrl;\n+        this.appealService = appealService;\n+        this.customerServicesProvider = customerServicesProvider;\n+    }\n+\n+    @Override\n+    public String getTemplateId(AsylumCase asylumCase) {\n+        return appealService.isAppealListed(asylumCase)\n+            ? removeRepresentationLegalRepresentativeAfterListingTemplateId\n+            : removeRepresentationLegalRepresentativeBeforeListingTemplateId;\n+    }\n+\n+    @Override\n+    public Set<String> getRecipientsList(AsylumCase asylumCase) {\n+        return Collections.singleton(asylumCase\n+            .read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class)\n+            .orElseThrow(() -> new IllegalStateException(\"legalRepresentativeEmailAddress is not present\")));\n+    }\n+\n+    @Override\n+    public String getReferenceId(Long caseId) {\n+        return caseId + \"_REMOVE_REPRESENTATION_LEGAL_REP\";\n+    }\n+\n+    @Override\n+    public Map<String, String> getPersonalisation(Callback<AsylumCase> callback) {\n+        requireNonNull(callback, \"callback must not be null\");\n+\n+        AsylumCase asylumCase = callback.getCaseDetails().getCaseData();\n+\n+        return ImmutableMap\n+            .<String, String>builder()\n+            .putAll(customerServicesProvider.getCustomerServicesPersonalisation())\n+            .put(\"ccdCaseId\", String.valueOf(callback.getCaseDetails().getId()))\n+            .put(\"appealReferenceNumber\", asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+            .put(\"ariaListingReference\", asylumCase.read(ARIA_LISTING_REFERENCE, String.class).orElse(\"\"))\n+            .put(\"legalRepReferenceNumber\", asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class).orElse(\"\"))\n+            .put(\"appellantGivenNames\", asylumCase.read(AsylumCaseDefinition.APPELLANT_GIVEN_NAMES, String.class).orElse(\"\"))\n+            .put(\"appellantFamilyName\", asylumCase.read(AsylumCaseDefinition.APPELLANT_FAMILY_NAME, String.class).orElse(\"\"))\n+            .put(\"linkToOnlineService\", iaExUiFrontendUrl)\n+            .build();\n+    }\n+}"
  },
  {
    "sha": "4e35c10d448a91fc2e754e4d7ddbfd58421e5c7d",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcher.java",
    "status": "added",
    "additions": 64,
    "deletions": 0,
    "changes": 64,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcher.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcher.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcher.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,64 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseData;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackResponse;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.PostSubmitCallbackHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.security.CcdEventAuthorizor;\n+\n+\n+@Component\n+public class PostSubmitCallbackDispatcher<T extends CaseData> {\n+    private final CcdEventAuthorizor ccdEventAuthorizor;\n+    private final List<PostSubmitCallbackHandler<T>> sortedCallbackHandlers;\n+\n+    public PostSubmitCallbackDispatcher(\n+        CcdEventAuthorizor ccdEventAuthorizor,\n+        List<PostSubmitCallbackHandler<T>> callbackHandlers\n+    ) {\n+        requireNonNull(ccdEventAuthorizor, \"ccdEventAuthorizor must not be null\");\n+        requireNonNull(callbackHandlers, \"callbackHandlers must not be null\");\n+        this.ccdEventAuthorizor = ccdEventAuthorizor;\n+        this.sortedCallbackHandlers = callbackHandlers.stream()\n+            // sorting handlers by handler class name\n+            .sorted(Comparator.comparing(h -> h.getClass().getSimpleName()))\n+            .collect(Collectors.toList());\n+    }\n+\n+    public PostSubmitCallbackResponse handle(PostSubmitCallbackStage callbackStage,\n+                                             Callback<T> callback\n+    ) {\n+        requireNonNull(callbackStage, \"callbackStage must not be null\");\n+        requireNonNull(callback, \"callback must not be null\");\n+        ccdEventAuthorizor.throwIfNotAuthorized(callback.getEvent());\n+\n+        PostSubmitCallbackResponse callbackResponse =\n+            new PostSubmitCallbackResponse();\n+\n+        for (PostSubmitCallbackHandler<T> callbackHandler : sortedCallbackHandlers) {\n+\n+            if (callbackHandler.canHandle(callbackStage, callback)) {\n+\n+                PostSubmitCallbackResponse callbackResponseFromHandler =\n+                    callbackHandler.handle(callbackStage, callback);\n+\n+                callbackResponseFromHandler\n+                    .getConfirmationHeader()\n+                    .ifPresent(callbackResponse::setConfirmationHeader);\n+\n+                callbackResponseFromHandler\n+                    .getConfirmationBody()\n+                    .ifPresent(callbackResponse::setConfirmationBody);\n+            }\n+        }\n+\n+        return callbackResponse;\n+    }\n+}"
  },
  {
    "sha": "5be91ac3a4cd659442cb3a1e780b45a7f7749bc4",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationGeneratorConfiguration.java",
    "status": "modified",
    "additions": 74,
    "deletions": 0,
    "changes": 74,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationGeneratorConfiguration.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationGeneratorConfiguration.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationGeneratorConfiguration.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -1638,4 +1638,78 @@\n             )\n         );\n     }\n+\n+    @Bean(\"applyNocDecisionNotificationGenerator\")\n+    public List<NotificationGenerator> applyNocDecisionNotificationHandler(\n+        LegalRepresentativeApplyNocDecisionPersonalisation legalRepresentativeApplyNocDecisionPersonalisation,\n+        NotificationSender notificationSender,\n+        NotificationIdAppender notificationIdAppender\n+    ) {\n+\n+        return Collections.singletonList(\n+            new EmailNotificationGenerator(\n+                newArrayList(\n+                    legalRepresentativeApplyNocDecisionPersonalisation\n+                ),\n+                notificationSender,\n+                notificationIdAppender\n+            )\n+        );\n+    }\n+\n+    @Bean(\"removeRepresentationNotificationGenerator\")\n+    public List<NotificationGenerator> removeRepresentationNotificationHandler(\n+        LegalRepresentativeRemoveRepresentationPersonalisation legalRepresentativeRemoveRepresentationPersonalisation,\n+        CaseOfficerRemoveRepresentationPersonalisation caseOfficerRemoveRepresentationPersonalisation,\n+        HomeOfficeRemoveRepresentationPersonalisation homeOfficeRemoveRepresentationPersonalisation,\n+        NotificationSender notificationSender,\n+        NotificationIdAppender notificationIdAppender\n+    ) {\n+\n+        return Collections.singletonList(\n+            new EmailNotificationGenerator(\n+                newArrayList(\n+                    legalRepresentativeRemoveRepresentationPersonalisation,\n+                    caseOfficerRemoveRepresentationPersonalisation,\n+                    homeOfficeRemoveRepresentationPersonalisation\n+                ),\n+                notificationSender,\n+                notificationIdAppender\n+            )\n+        );\n+    }\n+\n+    @Bean(\"removeRepresentationAppellantEmailNotificationGenerator\")\n+    public List<NotificationGenerator> removeRepresentationAppellantEmailNotificationHandler(\n+        AppellantRemoveRepresentationPersonalisationEmail appellantRemoveRepresentationPersonalisationEmail,\n+        NotificationSender notificationSender,\n+        NotificationIdAppender notificationIdAppender\n+    ) {\n+\n+        return Collections.singletonList(\n+            new EmailNotificationGenerator(\n+                newArrayList(\n+                    appellantRemoveRepresentationPersonalisationEmail\n+                ),\n+                notificationSender,\n+                notificationIdAppender\n+            )\n+        );\n+    }\n+\n+    @Bean(\"removeRepresentationAppellantSmsNotificationGenerator\")\n+    public List<NotificationGenerator> removeRepresentationAppellantSmsNotificationHandler(\n+        AppellantRemoveRepresentationPersonalisationSms appellantRemoveRepresentationPersonalisationSms,\n+        NotificationSender notificationSender,\n+        NotificationIdAppender notificationIdAppender\n+    ) {\n+\n+        return Collections.singletonList(\n+            new SmsNotificationGenerator(\n+                newArrayList(appellantRemoveRepresentationPersonalisationSms),\n+                notificationSender,\n+                notificationIdAppender\n+            )\n+        );\n+    }\n }"
  },
  {
    "sha": "a983d30905a77044366939949e5235537c570224",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationHandlerConfiguration.java",
    "status": "modified",
    "additions": 61,
    "deletions": 0,
    "changes": 61,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationHandlerConfiguration.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationHandlerConfiguration.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/config/NotificationHandlerConfiguration.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -26,12 +26,15 @@\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.Event;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.State;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PreSubmitCallbackStage;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.field.IdValue;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.field.PaymentStatus;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.field.YesOrNo;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.em.Bundle;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.PostSubmitCallbackHandler;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.PreSubmitCallbackHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.postsubmit.PostSubmitNotificationHandler;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.presubmit.NotificationHandler;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.service.DirectionFinder;\n import uk.gov.hmcts.reform.iacasenotificationsapi.domain.service.NotificationGenerator;\n@@ -1890,6 +1893,64 @@ private boolean isRemissionOptedForEaOrHuOrPaAppeal(Callback<AsylumCase> callbac\n         );\n     }\n \n+    @Bean\n+    public PostSubmitCallbackHandler<AsylumCase> applyNocDecisionNotificationHandler(\n+        @Qualifier(\"applyNocDecisionNotificationGenerator\")\n+            List<NotificationGenerator> notificationGenerators) {\n+\n+        return new PostSubmitNotificationHandler(\n+            (callbackStage, callback) -> {\n+                return callbackStage == PostSubmitCallbackStage.CCD_SUBMITTED\n+                       && callback.getEvent() == Event.APPLY_NOC_DECISION;\n+            },\n+            notificationGenerators\n+        );\n+    }\n+\n+    @Bean\n+    public PostSubmitCallbackHandler<AsylumCase> removeRepresentationNotificationHandler(\n+        @Qualifier(\"removeRepresentationNotificationGenerator\")\n+            List<NotificationGenerator> notificationGenerators) {\n+\n+        return new PostSubmitNotificationHandler(\n+            (callbackStage, callback) -> {\n+                return callbackStage == PostSubmitCallbackStage.CCD_SUBMITTED\n+                       && callback.getEvent() == Event.REMOVE_REPRESENTATION;\n+            },\n+            notificationGenerators\n+        );\n+    }\n+\n+    @Bean\n+    public PostSubmitCallbackHandler<AsylumCase> removeRepresentationAppellantEmailNotificationHandler(\n+        @Qualifier(\"removeRepresentationAppellantEmailNotificationGenerator\")\n+            List<NotificationGenerator> notificationGenerators) {\n+\n+        return new PostSubmitNotificationHandler(\n+            (callbackStage, callback) -> {\n+                return callbackStage == PostSubmitCallbackStage.CCD_SUBMITTED\n+                       && callback.getEvent() == Event.REMOVE_REPRESENTATION\n+                       && callback.getCaseDetails().getCaseData().read(EMAIL, String.class).isPresent();\n+            },\n+            notificationGenerators\n+        );\n+    }\n+\n+    @Bean\n+    public PostSubmitCallbackHandler<AsylumCase> removeRepresentationAppellantSmsNotificationHandler(\n+        @Qualifier(\"removeRepresentationAppellantSmsNotificationGenerator\")\n+            List<NotificationGenerator> notificationGenerators) {\n+\n+        return new PostSubmitNotificationHandler(\n+            (callbackStage, callback) -> {\n+                return callbackStage == PostSubmitCallbackStage.CCD_SUBMITTED\n+                       && callback.getEvent() == Event.REMOVE_REPRESENTATION\n+                       && callback.getCaseDetails().getCaseData().read(MOBILE_NUMBER, String.class).isPresent();\n+            },\n+            notificationGenerators\n+        );\n+    }\n+\n }\n \n "
  },
  {
    "sha": "476bbb2a173293dbeffeb376feeec693bb75a868",
    "filename": "src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackController.java",
    "status": "added",
    "additions": 105,
    "deletions": 0,
    "changes": 105,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackController.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackController.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackController.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,105 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.controllers;\n+\n+\n+import static java.util.Objects.requireNonNull;\n+import static org.slf4j.LoggerFactory.getLogger;\n+import static org.springframework.http.ResponseEntity.ok;\n+\n+import io.swagger.annotations.*;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackResponse;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.PostSubmitCallbackDispatcher;\n+\n+@Slf4j\n+@Api(\n+    value = \"/asylum\",\n+    consumes = MediaType.APPLICATION_JSON_VALUE,\n+    produces = MediaType.APPLICATION_JSON_VALUE\n+)\n+@RequestMapping(\n+    path = \"/asylum\",\n+    consumes = MediaType.APPLICATION_JSON_VALUE,\n+    produces = MediaType.APPLICATION_JSON_VALUE\n+)\n+@RestController\n+public class PostSubmitCallbackController {\n+\n+    private static final org.slf4j.Logger LOG = getLogger(PostSubmitCallbackController.class);\n+\n+    private final PostSubmitCallbackDispatcher<AsylumCase> callbackDispatcher;\n+\n+    public PostSubmitCallbackController(\n+        PostSubmitCallbackDispatcher<AsylumCase> callbackDispatcher\n+    ) {\n+        requireNonNull(callbackDispatcher, \"callbackDispatcher must not be null\");\n+\n+        this.callbackDispatcher = callbackDispatcher;\n+    }\n+\n+    @ApiOperation(\n+        value = \"Handles 'SubmittedEvent' callbacks from CCD\",\n+        response = PostSubmitCallbackResponse.class,\n+        authorizations =\n+            {\n+            @Authorization(value = \"Authorization\"),\n+            @Authorization(value = \"ServiceAuthorization\")\n+            }\n+    )\n+    @ApiResponses({\n+        @ApiResponse(\n+            code = 200,\n+            message = \"Optional confirmation text for CCD UI\",\n+            response = PostSubmitCallbackResponse.class\n+            ),\n+        @ApiResponse(\n+            code = 400,\n+            message = \"Bad Request\",\n+            response = PostSubmitCallbackResponse.class\n+            ),\n+        @ApiResponse(\n+            code = 403,\n+            message = \"Forbidden\",\n+            response = PostSubmitCallbackResponse.class\n+            ),\n+        @ApiResponse(\n+            code = 415,\n+            message = \"Unsupported Media Type\",\n+            response = PostSubmitCallbackResponse.class\n+            ),\n+        @ApiResponse(\n+            code = 500,\n+            message = \"Internal Server Error\",\n+            response = PostSubmitCallbackResponse.class\n+            )\n+    })\n+    @PostMapping(path = \"/ccdSubmitted\")\n+    public ResponseEntity<PostSubmitCallbackResponse> ccdSubmitted(\n+        @ApiParam(value = \"Asylum case data\", required = true) @RequestBody Callback<AsylumCase> callback\n+    ) {\n+        LOG.info(\n+            \"Asylum Case CCD `ccdSubmitted` event `{}` received for Case ID `{}`\",\n+            callback.getEvent(),\n+            callback.getCaseDetails().getId()\n+        );\n+\n+        PostSubmitCallbackResponse callbackResponse =\n+            callbackDispatcher.handle(PostSubmitCallbackStage.CCD_SUBMITTED, callback);\n+\n+        LOG.info(\n+            \"Asylum Case CCD `ccdSubmitted` event `{}` handled for Case ID `{}`\",\n+            callback.getEvent(),\n+            callback.getCaseDetails().getId()\n+        );\n+\n+        return ok(callbackResponse);\n+    }\n+}"
  },
  {
    "sha": "3ec36d656062d1cf4b64be6790fd02ecbf7ea7db",
    "filename": "src/main/resources/application.yaml",
    "status": "modified",
    "additions": 31,
    "deletions": 3,
    "changes": 34,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/resources/application.yaml",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/main/resources/application.yaml",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/main/resources/application.yaml?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -109,7 +109,6 @@ govnotify:\n     pendingPayment:\n       legalRep:\n         paid:\n-\n           email: 91cf84fe-55f0-41a4-9d0f-fe13ae45fb8c\n         paidAfterAppealSubmitted:\n           beforeListing:\n@@ -602,8 +601,28 @@ govnotify:\n     requestNewHearingRequirements:\n       legalRep:\n         email: fd709bf4-095c-4734-8f88-9a9feba9fd81\n-\n-\n+    applyNoticeOfChangeDecision:\n+      legalRep:\n+        email: 4959e6f4-2a40-44a0-af09-b1fbe5bc1be3\n+    removeRepresentation:\n+      legalRep:\n+        beforeListing:\n+          email: 54a430cb-d0f0-4170-bd5a-0bd62f06fc76\n+        afterListing:\n+          email: 31ecd8c7-ee85-4b3b-9805-739d378da597\n+      caseOfficer:\n+        beforeListing:\n+          email: 09a83871-901b-41ed-b3bd-2b72cee73236\n+        afterListing:\n+          email: 76bad58b-a6ea-4311-ae33-f7e596cc793b\n+      homeOffice:\n+        beforeListing:\n+          email: f924cae0-289a-42f4-bb2e-70164f9c924f\n+        afterListing:\n+          email: 2199e053-5ff7-46a2-9cf4-58864265d516\n+      appellant:\n+        email: cfb76737-b805-483f-81ec-9d1365eb3260\n+        sms: ffef5cda-ec06-43e4-bd82-5d7fc266a000\n \n notificationSender.deduplicateSendsWithinSeconds: 60\n \n@@ -631,6 +650,9 @@ security:\n     - \"caseworker-ia\"\n     - \"citizen\"\n   roleEventAccess:\n+    caseworker-approver:\n+      - \"applyNocDecision\"\n+      - \"removeRepresentation\"\n     citizen:\n       - \"startAppeal\"\n       - \"editAppeal\"\n@@ -653,6 +675,8 @@ security:\n       - \"payAndSubmitAppeal\"\n       - \"paymentAppeal\"\n       - \"makeAnApplication\"\n+      - \"applyNocDecision\"\n+      - \"removeRepresentation\"\n     caseworker-ia-caseofficer:\n       - \"sendDirection\"\n       - \"changeDirectionDueDate\"\n@@ -697,6 +721,7 @@ security:\n       - \"reinstateAppeal\"\n       - \"decideAnApplication\"\n       - \"requestNewHearingRequirements\"\n+      - \"removeRepresentation\"\n     caseworker-ia-admofficer:\n       - \"listCase\"\n       - \"editCaseListing\"\n@@ -716,16 +741,19 @@ security:\n       - \"uploadAdditionalEvidenceHomeOffice\"\n       - \"uploadAddendumEvidenceHomeOffice\"\n       - \"makeAnApplication\"\n+      - \"removeRepresentation\"\n     caseworker-ia-homeofficelart:\n       - \"uploadHomeOfficeAppealResponse\"\n       - \"uploadAdditionalEvidenceHomeOffice\"\n       - \"uploadAddendumEvidenceHomeOffice\"\n       - \"makeAnApplication\"\n+      - \"removeRepresentation\"\n     caseworker-ia-homeofficepou:\n       - \"uploadAdditionalEvidenceHomeOffice\"\n       - \"uploadAddendumEvidenceHomeOffice\"\n       - \"applyForFTPARespondent\"\n       - \"makeAnApplication\"\n+      - \"removeRepresentation\"\n     caseworker-ia-respondentofficer:\n       - \"uploadHomeOfficeBundle\"\n       - \"addAppealResponse\""
  },
  {
    "sha": "b910c99643ab3587453d0c4958b21b1cbb93f94c",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/EventTest.java",
    "status": "modified",
    "additions": 2,
    "deletions": 1,
    "changes": 3,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/EventTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/EventTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/EventTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -79,11 +79,12 @@ public void has_correct_values() {\n         assertEquals(\"decideAnApplication\", Event.DECIDE_AN_APPLICATION.toString());\n         assertEquals(\"requestNewHearingRequirements\", Event.REQUEST_NEW_HEARING_REQUIREMENTS.toString());\n         assertEquals(\"recordRemissionDecision\", RECORD_REMISSION_DECISION.toString());\n+        assertEquals(\"removeRepresentation\", REMOVE_REPRESENTATION.toString());\n         assertEquals(\"unknown\", Event.UNKNOWN.toString());\n     }\n \n     @Test\n     public void if_this_test_fails_it_is_because_it_needs_updating_with_your_changes() {\n-        assertEquals(72, Event.values().length);\n+        assertEquals(74, Event.values().length);\n     }\n }"
  },
  {
    "sha": "e8990157f27da94e779b39ba57b44d4a20eb3318",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStageTest.java",
    "status": "added",
    "additions": 21,
    "deletions": 0,
    "changes": 21,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStageTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStageTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/entities/ccd/callback/PostSubmitCallbackStageTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,21 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+@ExtendWith(MockitoExtension.class)\n+class PostSubmitCallbackStageTest {\n+\n+    @Test\n+    void has_correct_case_event_ids() {\n+        assertEquals(\"ccdSubmitted\", PostSubmitCallbackStage.CCD_SUBMITTED.toString());\n+    }\n+\n+    @Test\n+    void if_this_test_fails_it_is_because_it_needs_updating_with_your_changes() {\n+        assertEquals(1, PostSubmitCallbackStage.values().length);\n+    }\n+}"
  },
  {
    "sha": "8fa38364496a4cd3b51db05a4b1b916b47c33582",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandlerTest.java",
    "status": "added",
    "additions": 135,
    "deletions": 0,
    "changes": 135,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandlerTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandlerTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/handlers/postsubmit/PostSubmitNotificationHandlerTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,135 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.postsubmit;\n+\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.*;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.function.BiPredicate;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.Event;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackResponse;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.ErrorHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.service.NotificationGenerator;\n+\n+@ExtendWith(MockitoExtension.class)\n+class PostSubmitNotificationHandlerTest {\n+\n+    @Mock\n+    Callback<AsylumCase> callback;\n+    @Mock\n+    CaseDetails<AsylumCase> caseDetails;\n+    @Mock\n+    AsylumCase asylumCase;\n+\n+    @Mock\n+    NotificationGenerator notificationGenerator;\n+    @Mock\n+    BiPredicate<PostSubmitCallbackStage, Callback<AsylumCase>> canHandle;\n+    @Mock\n+    ErrorHandler errorHandler;\n+    private PostSubmitCallbackStage callbackStage = PostSubmitCallbackStage.CCD_SUBMITTED;\n+    private PostSubmitNotificationHandler notificationHandler;\n+    private PostSubmitCallbackResponse postSubmitCallbackResponse = new PostSubmitCallbackResponse();\n+\n+    @BeforeEach\n+    void setUp() {\n+        notificationHandler = new PostSubmitNotificationHandler(canHandle, Collections.singletonList(notificationGenerator));\n+    }\n+\n+    @Test\n+    void should_generate_notification_when_event_can_be_handled() {\n+\n+        when(canHandle.test(callbackStage, callback)).thenReturn(true);\n+        PostSubmitCallbackResponse response = notificationHandler.handle(callbackStage, callback);\n+\n+        assertEquals(Optional.ofNullable(\"success\"), response.getConfirmationHeader());\n+        assertEquals(Optional.ofNullable(\"success\"), response.getConfirmationBody());\n+        verify(notificationGenerator).generate(callback);\n+    }\n+\n+    @Test\n+    void should_generate_notification_and_set_appropriate_response_header_and_body_when_remove_representation_event_handled() {\n+\n+        when(canHandle.test(callbackStage, callback)).thenReturn(true);\n+        when(callback.getEvent()).thenReturn(Event.REMOVE_REPRESENTATION);\n+\n+        PostSubmitCallbackResponse response = notificationHandler.handle(callbackStage, callback);\n+\n+        assertEquals(Optional.ofNullable(\"# You have stopped representing this client\"), response.getConfirmationHeader());\n+        assertEquals(Optional.ofNullable(\"#### What happens next\\n\\n\"\n+                                         + \"We've sent you an email confirming you're no longer representing this client.\\n\"\n+                                         + \"You have been removed from this case and no longer have access to it.\\n\\n\"\n+                                         + \"[View case list](/cases)\"), response.getConfirmationBody());\n+        verify(notificationGenerator).generate(callback);\n+    }\n+\n+    @Test\n+    void should_not_generate_notification_when_cannot_handle_event() {\n+        when(canHandle.test(callbackStage, callback)).thenReturn(false);\n+\n+        assertThatThrownBy(() -> notificationHandler.handle(callbackStage, callback))\n+            .isExactlyInstanceOf(IllegalStateException.class)\n+            .hasMessage(\"Cannot handle callback\");\n+\n+        verifyNoInteractions(notificationGenerator);\n+    }\n+\n+    @Test\n+    void should_return_false_when_cannot_handle_event() {\n+        when(canHandle.test(callbackStage, callback)).thenReturn(false);\n+\n+        assertEquals(false, notificationHandler.canHandle(callbackStage, callback));\n+    }\n+\n+    @Test\n+    void should_throw_exception_when_callback_stage_is_null() {\n+        assertThatThrownBy(() -> notificationHandler.canHandle(null, callback))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"callbackStage must not be null\");\n+    }\n+\n+    @Test\n+    void should_throw_exception_when_callback_is_null() {\n+        assertThatThrownBy(() -> notificationHandler.canHandle(callbackStage, null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"callback must not be null\");\n+    }\n+\n+    @Test\n+    void should_catch_exception_and_invoke_error_handler() {\n+        when(canHandle.test(callbackStage, callback)).thenReturn(true);\n+        String message = \"exception happened\";\n+        Throwable exception = new RuntimeException(message);\n+        doThrow(exception).when(notificationGenerator).generate(callback);\n+        notificationHandler =\n+            new PostSubmitNotificationHandler(canHandle, Collections.singletonList(notificationGenerator), errorHandler);\n+\n+        notificationHandler.handle(callbackStage, callback);\n+\n+        verify(errorHandler).accept(callback, exception);\n+    }\n+\n+    @Test\n+    void should_re_throw_exception_from_generator() {\n+\n+        when(canHandle.test(callbackStage, callback)).thenReturn(true);\n+        String message = \"exception happened\";\n+        doThrow(new RuntimeException(message)).when(notificationGenerator).generate(callback);\n+        notificationHandler = new PostSubmitNotificationHandler(canHandle, Collections.singletonList(notificationGenerator));\n+\n+        assertThatThrownBy(() -> notificationHandler.handle(callbackStage, callback))\n+            .isExactlyInstanceOf(RuntimeException.class)\n+            .hasMessage(message);\n+    }\n+}"
  },
  {
    "sha": "3268d4a6483640ff9d409f421fb5c9c57fc5759a",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmailTest.java",
    "status": "added",
    "additions": 120,
    "deletions": 0,
    "changes": 120,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmailTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmailTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/email/AppellantRemoveRepresentationPersonalisationEmailTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,120 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.appellant.email;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class AppellantRemoveRepresentationPersonalisationEmailTest {\n+\n+    @Mock\n+    Callback<AsylumCase> callback;\n+    @Mock\n+    CaseDetails<AsylumCase> caseDetails;\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    CustomerServicesProvider customerServicesProvider;\n+\n+    private Long caseId = 12345L;\n+    private String emailTemplateId = \"someEmailTemplateId\";\n+    private String appealReferenceNumber = \"someReferenceNumber\";\n+    private String legalRepRefNumber = \"somelegalRepRefNumber\";\n+    private String appellantGivenNames = \"someAppellantGivenNames\";\n+    private String appellantFamilyName = \"someAppellantFamilyName\";\n+    private String customerServicesTelephone = \"555 555 555\";\n+    private String customerServicesEmail = \"cust.services@example.com\";\n+\n+    private AppellantRemoveRepresentationPersonalisationEmail appellantRemoveRepresentationPersonalisationEmail;\n+\n+    @BeforeEach\n+    public void setup() {\n+\n+        when(callback.getCaseDetails()).thenReturn(caseDetails);\n+        when(caseDetails.getCaseData()).thenReturn(asylumCase);\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(legalRepRefNumber));\n+        when((customerServicesProvider.getCustomerServicesTelephone())).thenReturn(customerServicesTelephone);\n+        when((customerServicesProvider.getCustomerServicesEmail())).thenReturn(customerServicesEmail);\n+\n+        appellantRemoveRepresentationPersonalisationEmail = new AppellantRemoveRepresentationPersonalisationEmail(\n+            emailTemplateId,\n+            customerServicesProvider);\n+    }\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        assertEquals(emailTemplateId, appellantRemoveRepresentationPersonalisationEmail.getTemplateId());\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(caseId + \"_REMOVE_REPRESENTATION_APPELLANT_EMAIL\",\n+            appellantRemoveRepresentationPersonalisationEmail.getReferenceId(caseId));\n+    }\n+\n+    @Test\n+    void should_throw_exception_when_cannot_find_email_address_for_appellant() {\n+        when(asylumCase.read(EMAIL, String.class)).thenReturn(Optional.empty());\n+\n+        assertThatThrownBy(() -> appellantRemoveRepresentationPersonalisationEmail.getRecipientsList(asylumCase))\n+            .isExactlyInstanceOf(IllegalStateException.class)\n+            .hasMessage(\"appellantEmailAddress is not present\");\n+    }\n+\n+    @Test\n+    void should_throw_exception_on_personalisation_when_case_is_null() {\n+\n+        assertThatThrownBy(\n+            () -> appellantRemoveRepresentationPersonalisationEmail.getPersonalisation((Callback<AsylumCase>) null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"callback must not be null\");\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation =\n+            appellantRemoveRepresentationPersonalisationEmail.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_mandatory_information_given() {\n+\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_DATE_OF_BIRTH, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+\n+        Map<String, String> personalisation =\n+            appellantRemoveRepresentationPersonalisationEmail.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+}"
  },
  {
    "sha": "e16054b0809689ed83d910ba580ec60f2585d4c0",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSmsTest.java",
    "status": "added",
    "additions": 128,
    "deletions": 0,
    "changes": 128,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSmsTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSmsTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/appellant/sms/AppellantRemoveRepresentationPersonalisationSmsTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,128 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.appellant.sms;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class AppellantRemoveRepresentationPersonalisationSmsTest {\n+\n+    @Mock\n+    Callback<AsylumCase> callback;\n+    @Mock\n+    CaseDetails<AsylumCase> caseDetails;\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    CustomerServicesProvider customerServicesProvider;\n+\n+    private long ccdCaseId = 12345L;\n+    private String mobileNumber = \"555 555 555\";\n+    private String appealReferenceNumber = \"someReferenceNumber\";\n+    private String legalRepReferenceNumber = \"somelegalRepRefNumber\";\n+    private String appellantGivenNames = \"someAppellantGivenNames\";\n+    private String appellantFamilyName = \"someAppellantFamilyName\";\n+    private String appellantDateOfBirth = \"04/01/1978\";\n+    private String customerServicesTelephone = \"555 555 555\";\n+    private String customerServicesEmail = \"cust.services@example.com\";\n+    private String smsTemplateId = \"someTemplateId\";\n+\n+    private AppellantRemoveRepresentationPersonalisationSms appellantRemoveRepresentationPersonalisationSms;\n+\n+    @BeforeEach\n+    public void setup() {\n+\n+        when(callback.getCaseDetails()).thenReturn(caseDetails);\n+        when(caseDetails.getCaseData()).thenReturn(asylumCase);\n+        when(asylumCase.read(MOBILE_NUMBER, String.class)).thenReturn(Optional.of(String.valueOf(mobileNumber)));\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+        when(asylumCase.read(APPELLANT_DATE_OF_BIRTH, String.class)).thenReturn(Optional.of(appellantDateOfBirth));\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(legalRepReferenceNumber));\n+        when((customerServicesProvider.getCustomerServicesTelephone())).thenReturn(customerServicesTelephone);\n+        when((customerServicesProvider.getCustomerServicesEmail())).thenReturn(customerServicesEmail);\n+\n+        appellantRemoveRepresentationPersonalisationSms = new AppellantRemoveRepresentationPersonalisationSms(\n+            smsTemplateId,\n+            customerServicesProvider\n+        );\n+    }\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        assertEquals(smsTemplateId, appellantRemoveRepresentationPersonalisationSms.getTemplateId());\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(ccdCaseId + \"_REMOVE_REPRESENTATION_APPELLANT_SMS\", appellantRemoveRepresentationPersonalisationSms.getReferenceId(ccdCaseId));\n+    }\n+\n+    @Test\n+    void should_return_given_mobile_number() {\n+        assertTrue(\n+            appellantRemoveRepresentationPersonalisationSms.getRecipientsList(asylumCase).contains(mobileNumber));\n+\n+        when(asylumCase.read(MOBILE_NUMBER, String.class)).thenReturn(Optional.empty());\n+\n+        assertThatThrownBy(() -> appellantRemoveRepresentationPersonalisationSms.getRecipientsList(asylumCase))\n+            .isExactlyInstanceOf(IllegalStateException.class)\n+            .hasMessage(\"appellantMobileNumber is not present\");\n+\n+    }\n+\n+    @Test\n+    void should_throw_exception_on_personalisation_when_case_is_null() {\n+\n+        assertThatThrownBy(() -> appellantRemoveRepresentationPersonalisationSms.getPersonalisation((Callback<AsylumCase>) null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"callback must not be null\");\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation =\n+            appellantRemoveRepresentationPersonalisationSms.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_only_mandatory_information_given() {\n+\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_DATE_OF_BIRTH, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+\n+        Map<String, String> personalisation =\n+            appellantRemoveRepresentationPersonalisationSms.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+}"
  },
  {
    "sha": "21ed67d1ff6b75777b99e28a85085499c96da7a5",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisationTest.java",
    "status": "added",
    "additions": 129,
    "deletions": 0,
    "changes": 129,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisationTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisationTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/caseofficer/CaseOfficerRemoveRepresentationPersonalisationTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,129 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.caseofficer;\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.HearingCentre;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.EmailAddressFinder;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class CaseOfficerRemoveRepresentationPersonalisationTest {\n+\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    AppealService appealService;\n+    @Mock\n+    EmailAddressFinder emailAddressFinder;\n+\n+    private final Long caseId = 12345L;\n+    private final String templateIdBeforeListing = \"beforeTemplateId\";\n+    private final String templateIdAfterListing = \"afterTemplateId\";\n+    private final String iaExUiFrontendUrl = \"http://somefrontendurl\";\n+    private final HearingCentre hearingCentre = HearingCentre.TAYLOR_HOUSE;\n+    private final String hearingCentreEmailAddress = \"hearingCentre@example.com\";\n+    private final String hearingDateTime = \"2019-08-27T14:25:15.000\";\n+\n+    private final String appealReferenceNumber = \"someReferenceNumber\";\n+    private final String ariaListingReference = \"someAriaListingReference\";\n+    private final String appellantGivenNames = \"someAppellantGivenNames\";\n+    private final String appellantFamilyName = \"someAppellantFamilyName\";\n+\n+    private CaseOfficerRemoveRepresentationPersonalisation caseOfficerRemoveRepresentationPersonalisation;\n+\n+    @BeforeEach\n+    public void setup() {\n+\n+        when(asylumCase.read(LIST_CASE_HEARING_CENTRE, HearingCentre.class)).thenReturn(Optional.of(hearingCentre));\n+        when(asylumCase.read(LIST_CASE_HEARING_DATE, String.class)).thenReturn(Optional.of(hearingDateTime));\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(ARIA_LISTING_REFERENCE, String.class)).thenReturn(Optional.of(ariaListingReference));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+\n+        when(emailAddressFinder.getHearingCentreEmailAddress(asylumCase)).thenReturn(hearingCentreEmailAddress);\n+\n+        caseOfficerRemoveRepresentationPersonalisation = new CaseOfficerRemoveRepresentationPersonalisation(\n+            templateIdBeforeListing,\n+            templateIdAfterListing,\n+            iaExUiFrontendUrl,\n+            appealService,\n+            emailAddressFinder\n+        );\n+    }\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(false);\n+\n+        assertEquals(templateIdBeforeListing, caseOfficerRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(true);\n+\n+        assertEquals(templateIdAfterListing, caseOfficerRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(caseId + \"_REMOVE_REPRESENTATION_CASE_OFFICER\", caseOfficerRemoveRepresentationPersonalisation.getReferenceId(caseId));\n+    }\n+\n+    @Test\n+    void should_return_given_email_address_from_lookup_map() {\n+        assertTrue(\n+            caseOfficerRemoveRepresentationPersonalisation.getRecipientsList(asylumCase).contains(hearingCentreEmailAddress));\n+    }\n+\n+    @Test\n+    void should_throw_exception_on_personalisation_when_case_is_null() {\n+\n+        assertThatThrownBy(() -> caseOfficerRemoveRepresentationPersonalisation.getPersonalisation((AsylumCase) null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"asylumCase must not be null\");\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation = caseOfficerRemoveRepresentationPersonalisation.getPersonalisation(asylumCase);\n+\n+        assertEquals(appealReferenceNumber, personalisation.get(\"appealReferenceNumber\"));\n+        assertEquals(ariaListingReference, personalisation.get(\"ariaListingReference\"));\n+        assertEquals(appellantGivenNames, personalisation.get(\"appellantGivenNames\"));\n+        assertEquals(appellantFamilyName, personalisation.get(\"appellantFamilyName\"));\n+        assertEquals(iaExUiFrontendUrl, personalisation.get(\"linkToOnlineService\"));\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_mandatory_information_given() {\n+\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(ARIA_LISTING_REFERENCE, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.empty());\n+\n+        Map<String, String> personalisation = caseOfficerRemoveRepresentationPersonalisation.getPersonalisation(asylumCase);\n+\n+        assertEquals(\"\", personalisation.get(\"appealReferenceNumber\"));\n+        assertEquals(\"\", personalisation.get(\"ariaListingReference\"));\n+        assertEquals(\"\", personalisation.get(\"appellantGivenNames\"));\n+        assertEquals(\"\", personalisation.get(\"appellantFamilyName\"));\n+        assertEquals(iaExUiFrontendUrl, personalisation.get(\"linkToOnlineService\"));\n+    }\n+}"
  },
  {
    "sha": "3dff343d847eff1d4b3b51a2951ad595fa4ef065",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisationTest.java",
    "status": "added",
    "additions": 145,
    "deletions": 0,
    "changes": 145,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisationTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisationTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/homeoffice/HomeOfficeRemoveRepresentationPersonalisationTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,145 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.homeoffice;\n+\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.field.AddressUk;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class HomeOfficeRemoveRepresentationPersonalisationTest {\n+\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    AppealService appealService;\n+    @Mock\n+    CustomerServicesProvider customerServicesProvider;\n+\n+    private final Long caseId = 12345L;\n+    private final String templateIdBeforeListing = \"beforeTemplateId\";\n+    private final String templateIdAfterListing = \"afterTemplateId\";\n+    private final String iaExUiFrontendUrl = \"http://somefrontendurl\";\n+    private final String appealReferenceNumber = \"someReferenceNumber\";\n+    private final String ariaListingReference = \"someReferenceNumber\";\n+    private final String homeOfficeRefNumber = \"someHomeOfficeRefNumber\";\n+    private final String appellantGivenNames = \"someAppellantGivenNames\";\n+    private final String appellantFamilyName = \"someAppellantFamilyName\";\n+    private final String homeOfficeEmail = \"apchomeoffice@example.com\";\n+\n+    private final String addressLine1 = \"A\";\n+    private final String addressLine2 = \"B\";\n+    private final String addressLine3 = \"C\";\n+    private final String postTown = \"D\";\n+    private final String county = \"E\";\n+    private final String postCode = \"F\";\n+    private final String country = \"G\";\n+\n+    private AddressUk addressUk = new AddressUk(\n+        addressLine1,\n+        addressLine2,\n+        addressLine3,\n+        postTown,\n+        county,\n+        postCode,\n+        country\n+    );\n+\n+    private HomeOfficeRemoveRepresentationPersonalisation\n+        homeOfficeRemoveRepresentationPersonalisation;\n+\n+    @BeforeEach\n+    public void setUp() {\n+\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(ARIA_LISTING_REFERENCE, String.class)).thenReturn(Optional.of(ariaListingReference));\n+        when(asylumCase.read(HOME_OFFICE_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(homeOfficeRefNumber));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+\n+        homeOfficeRemoveRepresentationPersonalisation =\n+            new HomeOfficeRemoveRepresentationPersonalisation(\n+                templateIdBeforeListing,\n+                templateIdAfterListing,\n+                homeOfficeEmail,\n+                iaExUiFrontendUrl,\n+                appealService,\n+                customerServicesProvider\n+            );\n+    }\n+\n+    @Test\n+    void should_return_given_email_address() {\n+        assertTrue(homeOfficeRemoveRepresentationPersonalisation.getRecipientsList(asylumCase)\n+            .contains(homeOfficeEmail));\n+    }\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(false);\n+\n+        assertEquals(templateIdBeforeListing, homeOfficeRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(true);\n+\n+        assertEquals(templateIdAfterListing, homeOfficeRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(caseId + \"_REMOVE_REPRESENTATION_HOME_OFFICE\",\n+            homeOfficeRemoveRepresentationPersonalisation.getReferenceId(caseId));\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation =\n+            homeOfficeRemoveRepresentationPersonalisation.getPersonalisation(asylumCase);\n+\n+        assertThat(asylumCase).isEqualToComparingOnlyGivenFields(personalisation);\n+    }\n+\n+    @Test\n+    void should_return_correctly_formatted_company_address() {\n+\n+        when(asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)).thenReturn(Optional.of(addressUk));\n+\n+        assertEquals(\"A, B, C, D, E, F, G\", homeOfficeRemoveRepresentationPersonalisation.formatCompanyAddress(asylumCase));\n+    }\n+\n+    @Test\n+    void should_return_correctly_formatted_company_address_for_missing_fields() {\n+\n+        AddressUk addressUk = new AddressUk(\n+            \"\",\n+            \"\",\n+            \"\",\n+            \"\",\n+            \"\",\n+            \"\",\n+            \"\"\n+        );\n+\n+        when(asylumCase.read(LEGAL_REP_COMPANY_ADDRESS, AddressUk.class)).thenReturn(Optional.of(addressUk));\n+\n+        assertEquals(\"\", homeOfficeRemoveRepresentationPersonalisation.formatCompanyAddress(asylumCase));\n+    }\n+\n+}"
  },
  {
    "sha": "419647f76e9a648fc9c4832ef91ba7afca639bfe",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisationTest.java",
    "status": "added",
    "additions": 125,
    "deletions": 0,
    "changes": 125,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisationTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisationTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeApplyNocDecisionPersonalisationTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,125 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.legalrepresentative;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class LegalRepresentativeApplyNocDecisionPersonalisationTest {\n+\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    CustomerServicesProvider customerServicesProvider;\n+\n+    private Long caseId = 12345L;\n+    private String templateId = \"someTemplateId\";\n+    private String iaExUiFrontendUrl = \"http://localhost\";\n+    private String legalRepEmailAddress = \"legalRep@example.com\";\n+    private String appealReferenceNumber = \"someReferenceNumber\";\n+    private String legalRepRefNumber = \"somelegalRepRefNumber\";\n+    private String appellantGivenNames = \"someAppellantGivenNames\";\n+    private String appellantFamilyName = \"someAppellantFamilyName\";\n+    private String customerServicesTelephone = \"555 555 555\";\n+    private String customerServicesEmail = \"cust.services@example.com\";\n+\n+    private LegalRepresentativeApplyNocDecisionPersonalisation legalRepresentativeApplyNocDecisionPersonalisation;\n+\n+    @BeforeEach\n+    void setup() {\n+\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(legalRepRefNumber));\n+        when(asylumCase.read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class))\n+            .thenReturn(Optional.of(legalRepEmailAddress));\n+        when((customerServicesProvider.getCustomerServicesTelephone())).thenReturn(customerServicesTelephone);\n+        when((customerServicesProvider.getCustomerServicesEmail())).thenReturn(customerServicesEmail);\n+\n+        legalRepresentativeApplyNocDecisionPersonalisation = new LegalRepresentativeApplyNocDecisionPersonalisation(\n+            templateId,\n+            iaExUiFrontendUrl,\n+            customerServicesProvider\n+        );\n+    }\n+\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        assertEquals(templateId, legalRepresentativeApplyNocDecisionPersonalisation.getTemplateId());\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(caseId + \"_APPLY_NOC_DECISION_LEGAL_REP\",\n+            legalRepresentativeApplyNocDecisionPersonalisation.getReferenceId(caseId));\n+    }\n+\n+    @Test\n+    void should_return_given_email_address_from_asylum_case() {\n+        assertTrue(legalRepresentativeApplyNocDecisionPersonalisation.getRecipientsList(asylumCase)\n+            .contains(legalRepEmailAddress));\n+    }\n+\n+    @Test\n+    void should_throw_exception_when_cannot_find_email_address_for_legal_rep() {\n+        when(asylumCase.read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class)).thenReturn(Optional.empty());\n+\n+        assertThatThrownBy(() -> legalRepresentativeApplyNocDecisionPersonalisation.getRecipientsList(asylumCase))\n+            .isExactlyInstanceOf(IllegalStateException.class)\n+            .hasMessage(\"legalRepresentativeEmailAddress is not present\");\n+    }\n+\n+    @Test\n+    void should_throw_exception_on_personalisation_when_case_is_null() {\n+\n+        assertThatThrownBy(\n+            () -> legalRepresentativeApplyNocDecisionPersonalisation.getPersonalisation((AsylumCase) null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"asylumCase must not be null\");\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation =\n+            legalRepresentativeApplyNocDecisionPersonalisation.getPersonalisation(asylumCase);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_mandatory_information_given() {\n+\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+\n+        Map<String, String> personalisation =\n+            legalRepresentativeApplyNocDecisionPersonalisation.getPersonalisation(asylumCase);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+}"
  },
  {
    "sha": "bae3762f8f187bd235564b330dc69404d258306b",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisationTest.java",
    "status": "added",
    "additions": 146,
    "deletions": 0,
    "changes": 146,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisationTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisationTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/domain/personalisation/legalrepresentative/LegalRepresentativeRemoveRepresentationPersonalisationTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,146 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.domain.personalisation.legalrepresentative;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCaseDefinition.*;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.AppealService;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.CustomerServicesProvider;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+class LegalRepresentativeRemoveRepresentationPersonalisationTest {\n+\n+    @Mock\n+    Callback<AsylumCase> callback;\n+    @Mock\n+    CaseDetails<AsylumCase> caseDetails;\n+    @Mock\n+    AsylumCase asylumCase;\n+    @Mock\n+    AppealService appealService;\n+    @Mock\n+    CustomerServicesProvider customerServicesProvider;\n+\n+    private final Long caseId = 12345L;\n+    private final String templateIdBeforeListing = \"beforeTemplateId\";\n+    private final String templateIdAfterListing = \"afterTemplateId\";\n+    private final String iaExUiFrontendUrl = \"http://localhost\";\n+    private final String legalRepEmailAddress = \"legalRep@example.com\";\n+    private final String appealReferenceNumber = \"someReferenceNumber\";\n+    private final String ariaListingReference = \"someReferenceNumber\";\n+    private final String legalRepRefNumber = \"somelegalRepRefNumber\";\n+    private final String appellantGivenNames = \"someAppellantGivenNames\";\n+    private final String appellantFamilyName = \"someAppellantFamilyName\";\n+    private final String customerServicesTelephone = \"555 555 555\";\n+    private final String customerServicesEmail = \"cust.services@example.com\";\n+\n+    private LegalRepresentativeRemoveRepresentationPersonalisation legalRepresentativeRemoveRepresentationPersonalisation;\n+\n+    @BeforeEach\n+    void setup() {\n+\n+        when(callback.getCaseDetails()).thenReturn(caseDetails);\n+        when(caseDetails.getCaseData()).thenReturn(asylumCase);\n+        when(asylumCase.read(ARIA_LISTING_REFERENCE, String.class)).thenReturn(Optional.of(ariaListingReference));\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(appealReferenceNumber));\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.of(appellantGivenNames));\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.of(appellantFamilyName));\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.of(legalRepRefNumber));\n+        when(asylumCase.read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class))\n+            .thenReturn(Optional.of(legalRepEmailAddress));\n+        when((customerServicesProvider.getCustomerServicesTelephone())).thenReturn(customerServicesTelephone);\n+        when((customerServicesProvider.getCustomerServicesEmail())).thenReturn(customerServicesEmail);\n+\n+        legalRepresentativeRemoveRepresentationPersonalisation = new LegalRepresentativeRemoveRepresentationPersonalisation(\n+            templateIdBeforeListing,\n+            templateIdAfterListing,\n+            iaExUiFrontendUrl,\n+            appealService,\n+            customerServicesProvider\n+        );\n+    }\n+\n+    @Test\n+    void should_return_given_template_id() {\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(false);\n+\n+        assertEquals(templateIdBeforeListing, legalRepresentativeRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+\n+        when(appealService.isAppealListed(asylumCase)).thenReturn(true);\n+\n+        assertEquals(templateIdAfterListing, legalRepresentativeRemoveRepresentationPersonalisation.getTemplateId(asylumCase));\n+    }\n+\n+    @Test\n+    void should_return_given_reference_id() {\n+        assertEquals(caseId + \"_REMOVE_REPRESENTATION_LEGAL_REP\",\n+            legalRepresentativeRemoveRepresentationPersonalisation.getReferenceId(caseId));\n+    }\n+\n+    @Test\n+    void should_return_given_email_address_from_asylum_case() {\n+        assertTrue(legalRepresentativeRemoveRepresentationPersonalisation.getRecipientsList(asylumCase)\n+            .contains(legalRepEmailAddress));\n+    }\n+\n+    @Test\n+    void should_throw_exception_when_cannot_find_email_address_for_legal_rep() {\n+        when(asylumCase.read(LEGAL_REPRESENTATIVE_EMAIL_ADDRESS, String.class)).thenReturn(Optional.empty());\n+\n+        assertThatThrownBy(() -> legalRepresentativeRemoveRepresentationPersonalisation.getRecipientsList(asylumCase))\n+            .isExactlyInstanceOf(IllegalStateException.class)\n+            .hasMessage(\"legalRepresentativeEmailAddress is not present\");\n+    }\n+\n+    @Test\n+    void should_throw_exception_on_personalisation_when_case_is_null() {\n+\n+        assertThatThrownBy(\n+            () -> legalRepresentativeRemoveRepresentationPersonalisation.getPersonalisation((Callback<AsylumCase>) null))\n+            .isExactlyInstanceOf(NullPointerException.class)\n+            .hasMessage(\"callback must not be null\");\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_information_given() {\n+\n+        Map<String, String> personalisation =\n+            legalRepresentativeRemoveRepresentationPersonalisation.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+\n+    @Test\n+    void should_return_personalisation_when_all_mandatory_information_given() {\n+\n+        when(asylumCase.read(APPEAL_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_GIVEN_NAMES, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(APPELLANT_FAMILY_NAME, String.class)).thenReturn(Optional.empty());\n+        when(asylumCase.read(LEGAL_REP_REFERENCE_NUMBER, String.class)).thenReturn(Optional.empty());\n+\n+        Map<String, String> personalisation =\n+            legalRepresentativeRemoveRepresentationPersonalisation.getPersonalisation(callback);\n+\n+        assertThat(personalisation).isEqualToComparingOnlyGivenFields(asylumCase);\n+        assertEquals(customerServicesTelephone, customerServicesProvider.getCustomerServicesTelephone());\n+        assertEquals(customerServicesEmail, customerServicesProvider.getCustomerServicesEmail());\n+    }\n+}"
  },
  {
    "sha": "8930ba8f83ac8573d59cc5c246cb126c4e35d43b",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcherTest.java",
    "status": "added",
    "additions": 217,
    "deletions": 0,
    "changes": 217,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcherTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcherTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/PostSubmitCallbackDispatcherTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,217 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure;\n+\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.assertj.core.api.Assertions.fail;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.mockito.Mockito.*;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.springframework.security.access.AccessDeniedException;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseData;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.Event;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.Callback;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackResponse;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.PostSubmitCallbackStage;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.handlers.PostSubmitCallbackHandler;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.security.CcdEventAuthorizor;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+@SuppressWarnings(\"unchecked\")\n+class PostSubmitCallbackDispatcherTest {\n+\n+    @Mock\n+    private CcdEventAuthorizor ccdEventAuthorizor;\n+    @Mock\n+    private PostSubmitCallbackHandler<CaseData> handler1;\n+    @Mock\n+    private PostSubmitCallbackHandler<CaseData> handler2;\n+    @Mock\n+    private PostSubmitCallbackHandler<CaseData> handler3;\n+    @Mock\n+    private Callback<CaseData> callback;\n+    @Mock\n+    private CaseDetails<CaseData> caseDetails;\n+    @Mock\n+    private CaseData caseData;\n+\n+\n+    private String header1 = \"Some header 1\";\n+    private String body1 = \"Some body 1\";\n+\n+    private String header2 = \"Some header 2\";\n+    private String body2 = \"Some body 2\";\n+\n+    private String header3 = \"Some header 3\";\n+    private String body3 = \"Some body 3\";\n+\n+\n+    @Mock\n+    private PostSubmitCallbackResponse response1;\n+    @Mock\n+    private PostSubmitCallbackResponse response2;\n+    @Mock\n+    private PostSubmitCallbackResponse response3;\n+\n+    private PostSubmitCallbackDispatcher<CaseData> postSubmitCallbackDispatcher;\n+\n+    @BeforeEach\n+    public void setUp() {\n+        postSubmitCallbackDispatcher = new PostSubmitCallbackDispatcher<>(\n+            ccdEventAuthorizor,\n+            Arrays.asList(\n+                handler1,\n+                handler2,\n+                handler3\n+            )\n+        );\n+    }\n+\n+    @Test\n+    void should_only_dispatch_callback_to_handlers_that_can_handle_it() {\n+\n+        for (PostSubmitCallbackStage callbackStage : PostSubmitCallbackStage.values()) {\n+\n+            when(callback.getEvent()).thenReturn(Event.BUILD_CASE);\n+            when(callback.getCaseDetails()).thenReturn(caseDetails);\n+            when(caseDetails.getCaseData()).thenReturn(caseData);\n+\n+            when(response1.getConfirmationHeader()).thenReturn(Optional.of(header1));\n+            when(response1.getConfirmationBody()).thenReturn(Optional.of(body1));\n+\n+            when(response2.getConfirmationHeader()).thenReturn(Optional.of(header2));\n+            when(response2.getConfirmationBody()).thenReturn(Optional.of(body2));\n+\n+            when(response3.getConfirmationHeader()).thenReturn(Optional.of(header3));\n+            when(response3.getConfirmationBody()).thenReturn(Optional.of(body3));\n+\n+            when(handler1.canHandle(eq(callbackStage), any(Callback.class))).thenReturn(false);\n+            when(handler1.handle(eq(callbackStage), any(Callback.class))).thenReturn(response1);\n+\n+            when(handler2.canHandle(eq(callbackStage), any(Callback.class))).thenReturn(false);\n+            when(handler2.handle(eq(callbackStage), any(Callback.class))).thenReturn(response2);\n+\n+            when(handler3.canHandle(eq(callbackStage), any(Callback.class))).thenReturn(true);\n+            when(handler3.handle(eq(callbackStage), any(Callback.class))).thenReturn(response3);\n+\n+            PostSubmitCallbackResponse callbackResponse =\n+                postSubmitCallbackDispatcher.handle(callbackStage, callback);\n+\n+            assertNotNull(callbackResponse);\n+            //assertEquals(caseData, callbackResponse.getData());\n+            assertEquals(Optional.of(body3), callbackResponse.getConfirmationBody());\n+            //assertTrue(callbackResponse.getErrors().isEmpty());\n+\n+            verify(ccdEventAuthorizor, times(1)).throwIfNotAuthorized(Event.BUILD_CASE);\n+\n+            verify(handler1, times(1)).canHandle(eq(callbackStage), any(Callback.class));\n+            verify(handler1, times(0)).handle(eq(callbackStage), any(Callback.class));\n+\n+            verify(handler2, times(1)).canHandle(eq(callbackStage), any(Callback.class));\n+            verify(handler2, times(0)).handle(eq(callbackStage), any(Callback.class));\n+\n+            verify(handler3, times(1)).canHandle(eq(callbackStage), any(Callback.class));\n+            verify(handler3, times(1)).handle(eq(callbackStage), any(Callback.class));\n+\n+            reset(ccdEventAuthorizor, handler1, handler2, handler3);\n+        }\n+    }\n+\n+    @Test\n+    void should_not_dispatch_to_handlers_if_user_not_authorized_for_event() {\n+\n+        for (PostSubmitCallbackStage callbackStage : PostSubmitCallbackStage.values()) {\n+\n+            when(callback.getEvent()).thenReturn(Event.BUILD_CASE);\n+\n+            doThrow(AccessDeniedException.class)\n+                .when(ccdEventAuthorizor)\n+                .throwIfNotAuthorized(Event.BUILD_CASE);\n+\n+            assertThatThrownBy(() -> postSubmitCallbackDispatcher.handle(callbackStage, callback))\n+                .isExactlyInstanceOf(AccessDeniedException.class);\n+\n+            verify(ccdEventAuthorizor, times(1)).throwIfNotAuthorized(Event.BUILD_CASE);\n+\n+            verify(handler1, never()).canHandle(any(), any());\n+            verify(handler1, never()).handle(any(), any());\n+            verify(handler2, never()).canHandle(any(), any());\n+            verify(handler2, never()).handle(any(), any());\n+            verify(handler3, never()).canHandle(any(), any());\n+            verify(handler3, never()).handle(any(), any());\n+\n+            reset(ccdEventAuthorizor, handler1, handler2, handler3);\n+        }\n+    }\n+\n+    @Test\n+    void should_not_error_if_no_handlers_are_provided() {\n+\n+        PostSubmitCallbackDispatcher<CaseData> postSubmitCallbackDispatcher =\n+            new PostSubmitCallbackDispatcher<>(ccdEventAuthorizor, Collections.emptyList());\n+\n+        for (PostSubmitCallbackStage callbackStage : PostSubmitCallbackStage.values()) {\n+\n+            try {\n+\n+                when(callback.getEvent()).thenReturn(Event.BUILD_CASE);\n+                when(callback.getCaseDetails()).thenReturn(caseDetails);\n+                when(caseDetails.getCaseData()).thenReturn(caseData);\n+\n+                PostSubmitCallbackResponse callbackResponse =\n+                    postSubmitCallbackDispatcher\n+                        .handle(callbackStage, callback);\n+\n+                assertNotNull(callbackResponse);\n+\n+                verify(ccdEventAuthorizor, times(1)).throwIfNotAuthorized(Event.BUILD_CASE);\n+\n+                reset(ccdEventAuthorizor);\n+\n+            } catch (Exception e) {\n+                fail(\"Should not have thrown any exception\");\n+            }\n+        }\n+    }\n+\n+    @Test\n+    void should_not_allow_null_ccd_event_authorizor() {\n+\n+        assertThatThrownBy(() -> new PostSubmitCallbackDispatcher<>(null, Collections.emptyList()))\n+            .hasMessage(\"ccdEventAuthorizor must not be null\")\n+            .isExactlyInstanceOf(NullPointerException.class);\n+    }\n+\n+    @Test\n+    void should_not_allow_null_handlers() {\n+\n+        assertThatThrownBy(() -> new PostSubmitCallbackDispatcher<>(ccdEventAuthorizor, null))\n+            .hasMessage(\"callbackHandlers must not be null\")\n+            .isExactlyInstanceOf(NullPointerException.class);\n+    }\n+\n+    @Test\n+    void should_not_allow_null_arguments() {\n+\n+        assertThatThrownBy(() -> postSubmitCallbackDispatcher.handle(null, callback))\n+            .hasMessage(\"callbackStage must not be null\")\n+            .isExactlyInstanceOf(NullPointerException.class);\n+\n+        assertThatThrownBy(() -> postSubmitCallbackDispatcher.handle(PostSubmitCallbackStage.CCD_SUBMITTED, null))\n+            .hasMessage(\"callback must not be null\")\n+            .isExactlyInstanceOf(NullPointerException.class);\n+    }\n+}"
  },
  {
    "sha": "92b17e1be64e084439b717fd77251a6adfce7bdf",
    "filename": "src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackControllerTest.java",
    "status": "added",
    "additions": 97,
    "deletions": 0,
    "changes": 97,
    "blob_url": "https://github.com/hmcts/ia-case-notifications-api/blob/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackControllerTest.java",
    "raw_url": "https://github.com/hmcts/ia-case-notifications-api/raw/eb6f9a9d8f631485dbc47eb417f826dc0403581a/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackControllerTest.java",
    "contents_url": "https://api.github.com/repos/hmcts/ia-case-notifications-api/contents/src/test/java/uk/gov/hmcts/reform/iacasenotificationsapi/infrastructure/controllers/PostSubmitCallbackControllerTest.java?ref=eb6f9a9d8f631485dbc47eb417f826dc0403581a",
    "patch": "@@ -0,0 +1,97 @@\n+package uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.controllers;\n+\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.springframework.http.ResponseEntity;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.AsylumCase;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.CaseDetails;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.domain.entities.ccd.callback.*;\n+import uk.gov.hmcts.reform.iacasenotificationsapi.infrastructure.PostSubmitCallbackDispatcher;\n+\n+@ExtendWith(MockitoExtension.class)\n+class PostSubmitCallbackControllerTest {\n+\n+\n+\n+    @Test\n+    void ccdSubmitted() {\n+    }\n+\n+    @Mock\n+    private PostSubmitCallbackDispatcher<AsylumCase> callbackDispatcher;\n+    @Mock\n+    private PostSubmitCallbackResponse callbackResponse;\n+    @Mock\n+    private Callback<AsylumCase> callback;\n+    @Mock\n+    private CaseDetails<AsylumCase> caseDetails;\n+\n+    private PostSubmitCallbackController postSubmitCallbackController;\n+\n+    @BeforeEach\n+    public void setUp() {\n+        postSubmitCallbackController =\n+            new PostSubmitCallbackController(\n+                callbackDispatcher\n+            );\n+    }\n+\n+    @Test\n+    void should_deserialize_about_to_start_callback_then_dispatch_then_return_response() {\n+\n+        when(callback.getCaseDetails()).thenReturn(caseDetails);\n+\n+        doReturn(callbackResponse)\n+            .when(callbackDispatcher)\n+            .handle(PostSubmitCallbackStage.CCD_SUBMITTED, callback);\n+\n+        ResponseEntity<PostSubmitCallbackResponse> actualResponse =\n+            postSubmitCallbackController.ccdSubmitted(callback);\n+\n+        assertNotNull(actualResponse);\n+\n+        verify(callbackDispatcher, times(1)).handle(\n+            PostSubmitCallbackStage.CCD_SUBMITTED,\n+            callback\n+        );\n+    }\n+\n+    @Test\n+    void should_deserialize_about_to_submit_callback_then_dispatch_then_return_response() {\n+\n+        when(callback.getCaseDetails()).thenReturn(caseDetails);\n+\n+        doReturn(callbackResponse)\n+            .when(callbackDispatcher)\n+            .handle(PostSubmitCallbackStage.CCD_SUBMITTED, callback);\n+\n+        ResponseEntity<PostSubmitCallbackResponse> actualResponse =\n+            postSubmitCallbackController.ccdSubmitted(callback);\n+\n+        assertNotNull(actualResponse);\n+\n+        verify(callbackDispatcher, times(1)).handle(\n+            PostSubmitCallbackStage.CCD_SUBMITTED,\n+            callback\n+        );\n+    }\n+\n+    @Test\n+    void should_not_allow_null_constructor_arguments() {\n+\n+        assertThatThrownBy(() -> new PostSubmitCallbackController(null))\n+            .hasMessage(\"callbackDispatcher must not be null\")\n+            .isExactlyInstanceOf(NullPointerException.class);\n+    }\n+}"
  }
]
