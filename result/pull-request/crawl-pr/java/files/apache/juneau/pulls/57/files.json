[
  {
    "sha": "aa092bdc3ad6f8d173bf26c1f8325e99b213576b",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializer.java",
    "status": "modified",
    "additions": 106,
    "deletions": 0,
    "changes": 106,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializer.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializer.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializer.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -158,6 +158,84 @@\n \t */\r\n \tpublic static final String HTMLDOC_asideFloat = PREFIX + \".asideFloat.s\";\r\n \r\n+\t/**\r\n+\t * Configuration property:  Content Security Policy (CSP) Hash algorithm name.\r\n+\t *\r\n+\t * <h5 class='section'>Property:</h5>\r\n+\t * <ul class='spaced-list'>\r\n+\t * \t<li><b>ID:</b>  {@link org.apache.juneau.html.HtmlDocSerializer#HTMLDOC_cspHash HTMLDOC_cspHash}\r\n+\t * \t<li><b>Name:</b>  <js>\"HtmlDocSerializer.cspHash.s\"</js>\r\n+\t * \t<li><b>Data type:</b>  {@link org.apache.juneau.html.annotation.CspHash}\r\n+\t * \t<li><b>System property:</b>  <c>HtmlDocSerializer.cspHash</c>\r\n+\t * \t<li><b>Environment variable:</b>  <c>HTMLDOCSERIALIZER_CSPHASH</c>\r\n+\t * \t<li><b>Default:</b>  {@link org.apache.juneau.html.annotation.CspHash#DEFAULT}\r\n+\t * \t<li><b>Session property:</b>  <jk>true</jk>\r\n+\t * \t<li><b>Annotations:</b>\r\n+\t * \t\t<ul>\r\n+\t * \t\t\t<li class='ja'>{@link org.apache.juneau.html.annotation.HtmlDocConfig#cspHash()}\r\n+\t * \t\t</ul>\r\n+\t * \t<li><b>Methods:</b>\r\n+\t * \t\t<ul>\r\n+\t * \t\t\t<li class='jm'>{@link org.apache.juneau.html.HtmlDocSerializerBuilder#cspHash(org.apache.juneau.html.annotation.CspHash)}\r\n+\t * \t\t</ul>\r\n+\t * </ul>\r\n+\t *\r\n+\t * <h5 class='section'>Description:</h5>\r\n+\t * <p>\r\n+\t * Allows you to set a CSP Hash algorithm name.\r\n+\t *\r\n+\t * <p>\r\n+\t * By default, this feature is disabled.\r\n+\t *\r\n+\t * <h5 class='section'>Example:</h5>\r\n+\t * <p class='bcode w800'>\r\n+\t *  <ja>@HtmlDocConfig</ja>(\r\n+\t * \t\tcspHash=<js>\"sha256\"</js>\r\n+\t * \t)\r\n+\t * </p>\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tpublic static final String HTMLDOC_cspHash = PREFIX + \".cspHash.s\";\r\n+\r\n+\t/**\r\n+\t * Configuration property:  Content Security Policy (CSP) nonce algorithm name.\r\n+\t *\r\n+\t * <h5 class='section'>Property:</h5>\r\n+\t * <ul class='spaced-list'>\r\n+\t * \t<li><b>ID:</b>  {@link org.apache.juneau.html.HtmlDocSerializer#HTMLDOC_cspNonce HTMLDOC_cspNonce}\r\n+\t * \t<li><b>Name:</b>  <js>\"HtmlDocSerializer.cspNonce.s\"</js>\r\n+\t * \t<li><b>Data type:</b>  {@link org.apache.juneau.html.annotation.CspNonce}\r\n+\t * \t<li><b>System property:</b>  <c>HtmlDocSerializer.cspNonce</c>\r\n+\t * \t<li><b>Environment variable:</b>  <c>HTMLDOCSERIALIZER_CSPNONCE</c>\r\n+\t * \t<li><b>Default:</b>  {@link org.apache.juneau.html.annotation.CspNonce#DEFAULT}\r\n+\t * \t<li><b>Session property:</b>  <jk>true</jk>\r\n+\t * \t<li><b>Annotations:</b>\r\n+\t * \t\t<ul>\r\n+\t * \t\t\t<li class='ja'>{@link org.apache.juneau.html.annotation.HtmlDocConfig#cspNonce()}\r\n+\t * \t\t</ul>\r\n+\t * \t<li><b>Methods:</b>\r\n+\t * \t\t<ul>\r\n+\t * \t\t\t<li class='jm'>{@link org.apache.juneau.html.HtmlDocSerializerBuilder#cspNonce(org.apache.juneau.html.annotation.CspNonce)}\r\n+\t * \t\t</ul>\r\n+\t * </ul>\r\n+\t *\r\n+\t * <h5 class='section'>Description:</h5>\r\n+\t * <p>\r\n+\t * Allows you to set a CSP nonce algorithm name.\r\n+\t *\r\n+\t * <p>\r\n+\t * By default, this feature is disabled.\r\n+\t *\r\n+\t * <h5 class='section'>Example:</h5>\r\n+\t * <p class='bcode w800'>\r\n+\t *  <ja>@HtmlDocConfig</ja>(\r\n+\t * \t\tcspNonce=<js>\"SecureRandom\"</js>\r\n+\t * \t)\r\n+\t * </p>\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tpublic static final String HTMLDOC_cspNonce = PREFIX + \".cspNonce.s\";\r\n+\r\n \t/**\r\n \t * Configuration property:  Footer section contents.\r\n \t *\r\n@@ -717,6 +795,8 @@\n \t//-------------------------------------------------------------------------------------------------------------------\r\n \r\n \tprivate final String[] style, stylesheet, script, navlinks, head, header, nav, aside, footer;\r\n+\tprivate final CspHash cspHash;\r\n+\tprivate final CspNonce cspNonce;\r\n \tprivate final AsideFloat asideFloat;\r\n \tprivate final String noResultsMessage;\r\n \tprivate final boolean nowrap;\r\n@@ -776,6 +856,9 @@ public HtmlDocSerializer(ContextProperties cp, String produces, String accept) {\n \t\tnavlinks = cp.getArray(HTMLDOC_navlinks, String.class).orElse(new String[0]);\r\n \t\tnoResultsMessage = cp.getString(HTMLDOC_noResultsMessage).orElse(\"<p>no results</p>\");\r\n \t\ttemplate = cp.getInstance(HTMLDOC_template, HtmlDocTemplate.class).orElseGet(BasicHtmlDocTemplate::new);\r\n+\t\t\r\n+\t\tcspHash = cp.get(HTMLDOC_cspHash, CspHash.class).orElse(CspHash.DEFAULT);\r\n+\t\tcspNonce = cp.get(HTMLDOC_cspNonce, CspNonce.class).orElse(CspNonce.DEFAULT);\r\n \r\n \t\twidgets = new HtmlWidgetMap();\r\n \t\twidgets.append(cp.getInstanceArray(HTMLDOC_widgets, HtmlWidget.class).orElse(new HtmlWidget[0]));\r\n@@ -845,6 +928,26 @@ protected final AsideFloat getAsideFloat() {\n \t\treturn asideFloat;\r\n \t}\r\n \r\n+\t/**\r\n+\t * CSP hash algorithm name.\r\n+\t * @return\r\n+\t *  CSP hash algorithm name.\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tprotected final CspHash getCspHash() {\r\n+\t\treturn cspHash;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * CSP nonce algorithm name.\r\n+\t * @return\r\n+\t *  CSP nonce algorithm name.\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tprotected final CspNonce getCspNonce() {\r\n+\t\treturn cspNonce;\r\n+\t}\r\n+\r\n \t/**\r\n \t * Footer section contents.\r\n \t *\r\n@@ -996,6 +1099,8 @@ public OMap toMap() {\n \t\t\t\t\t.a(\"asideFloat\", asideFloat)\r\n \t\t\t\t\t.a(\"footer\", footer)\r\n \t\t\t\t\t.a(\"style\", style)\r\n+\t\t\t\t\t.a(\"cspHash\", cspHash)\r\n+\t\t\t\t\t.a(\"cspNonce\", cspNonce)\r\n \t\t\t\t\t.a(\"head\", head)\r\n \t\t\t\t\t.a(\"stylesheet\", stylesheet)\r\n \t\t\t\t\t.a(\"nowrap\", nowrap)\r\n@@ -1004,4 +1109,5 @@ public OMap toMap() {\n \t\t\t\t\t.a(\"widgets\", widgets.keySet())\r\n \t\t\t);\r\n \t}\r\n+\r\n }\r"
  },
  {
    "sha": "be39e5f3ce2844aec3697dd9b3f1f52bd6a74974",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerBuilder.java",
    "status": "modified",
    "additions": 134,
    "deletions": 13,
    "changes": 147,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerBuilder.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerBuilder.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerBuilder.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -12,19 +12,48 @@\n // ***************************************************************************************************************************\n package org.apache.juneau.html;\n \n-import static org.apache.juneau.html.HtmlDocSerializer.*;\n-\n-import java.lang.annotation.*;\n-import java.lang.reflect.*;\n-import java.nio.charset.*;\n-import java.util.*;\n-\n-import org.apache.juneau.*;\n-import org.apache.juneau.http.header.*;\n-import org.apache.juneau.internal.*;\n-import org.apache.juneau.reflect.*;\n-import org.apache.juneau.svl.*;\n-import org.apache.juneau.xml.*;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_aside;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_asideFloat;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_cspHash;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_cspNonce;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_footer;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_head;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_header;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_nav;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_navlinks;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_navlinks_add;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_noResultsMessage;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_nowrap;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_script;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_script_add;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_style;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_style_add;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_stylesheet;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_stylesheet_add;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_template;\n+import static org.apache.juneau.html.HtmlDocSerializer.HTMLDOC_widgets;\n+\n+import java.lang.annotation.Annotation;\n+import java.lang.reflect.Method;\n+import java.nio.charset.Charset;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.TimeZone;\n+\n+import org.apache.juneau.ContextProperties;\n+import org.apache.juneau.UriContext;\n+import org.apache.juneau.UriRelativity;\n+import org.apache.juneau.UriResolution;\n+import org.apache.juneau.UriResolver;\n+import org.apache.juneau.Visibility;\n+import org.apache.juneau.html.annotation.CspHash;\n+import org.apache.juneau.html.annotation.CspNonce;\n+import org.apache.juneau.http.header.MediaType;\n+import org.apache.juneau.internal.FluentSetter;\n+import org.apache.juneau.internal.FluentSetters;\n+import org.apache.juneau.reflect.AnnotationList;\n+import org.apache.juneau.svl.VarResolverSession;\n+import org.apache.juneau.xml.Namespace;\n \n /**\n  * Builder class for building instances of HTML Doc serializers.\n@@ -624,6 +653,98 @@ public HtmlDocSerializerBuilder applyAnnotations(AnnotationList al, VarResolverS\n \t\treturn this;\n \t}\n \n+\t/**\n+\t * Configuration property:  Content Security Policy (CSP) Hash algorithm name.\n+\t *\n+\t * <h5 class='section'>Property:</h5>\n+\t * <ul class='spaced-list'>\n+\t * \t<li><b>ID:</b>  {@link org.apache.juneau.html.HtmlDocSerializer#HTMLDOC_cspHash HTMLDOC_cspHash}\n+\t * \t<li><b>Name:</b>  <js>\"HtmlDocSerializer.cspHash.s\"</js>\n+\t * \t<li><b>Data type:</b>  {@link org.apache.juneau.html.annotation.CspHash}\n+\t * \t<li><b>System property:</b>  <c>HtmlDocSerializer.cspHash</c>\n+\t * \t<li><b>Environment variable:</b>  <c>HTMLDOCSERIALIZER_CSPHASH</c>\n+\t * \t<li><b>Default:</b>  {@link org.apache.juneau.html.annotation.CspHash#DEFAULT}\n+\t * \t<li><b>Session property:</b>  <jk>true</jk>\n+\t * \t<li><b>Annotations:</b>\n+\t * \t\t<ul>\n+\t * \t\t\t<li class='ja'>{@link org.apache.juneau.html.annotation.HtmlDocConfig#cspHash()}\n+\t * \t\t</ul>\n+\t * \t<li><b>Methods:</b>\n+\t * \t\t<ul>\n+\t * \t\t\t<li class='jm'>{@link org.apache.juneau.html.HtmlDocSerializerBuilder#cspHash(org.apache.juneau.html.annotation.CspHash)}\n+\t * \t\t</ul>\n+\t * </ul>\n+\t *\n+\t * <h5 class='section'>Description:</h5>\n+\t * <p>\n+\t * Allows you to set a CSP Hash algorithm name.\n+\t *\n+\t * <p>\n+\t * By default, this feature is disabled.\n+\t *\n+\t * <h5 class='section'>Example:</h5>\n+\t * <p class='bcode w800'>\n+\t *  <ja>@HtmlDocConfig</ja>(\n+\t * \t\tcspHash=<js>\"sha256\"</js>\n+\t * \t)\n+\t * </p>\n+\t * @param value\n+\t * \tThe new value for this property.\n+\t * @return This object (for method chaining).\n+\t * @since 9.0.0\n+\t */\n+\t@FluentSetter\n+\tpublic HtmlDocSerializerBuilder cspHash(CspHash value) {\n+\t\tset(HTMLDOC_cspHash, value);\n+\t\treturn this;\n+\t}\n+\n+\t/**\n+\t * Configuration property:  Content Security Policy (CSP) nonce algorithm name.\n+\t *\n+\t * <h5 class='section'>Property:</h5>\n+\t * <ul class='spaced-list'>\n+\t * \t<li><b>ID:</b>  {@link org.apache.juneau.html.HtmlDocSerializer#HTMLDOC_cspNonce HTMLDOC_cspNonce}\n+\t * \t<li><b>Name:</b>  <js>\"HtmlDocSerializer.cspNonce.s\"</js>\n+\t * \t<li><b>Data type:</b>  {@link org.apache.juneau.html.annotation.CspNonce}\n+\t * \t<li><b>System property:</b>  <c>HtmlDocSerializer.cspNonce</c>\n+\t * \t<li><b>Environment variable:</b>  <c>HTMLDOCSERIALIZER_CSPNONCE</c>\n+\t * \t<li><b>Default:</b>  {@link org.apache.juneau.html.annotation.CspNonce#DEFAULT}\n+\t * \t<li><b>Session property:</b>  <jk>true</jk>\n+\t * \t<li><b>Annotations:</b>\n+\t * \t\t<ul>\n+\t * \t\t\t<li class='ja'>{@link org.apache.juneau.html.annotation.HtmlDocConfig#cspNonce()}\n+\t * \t\t</ul>\n+\t * \t<li><b>Methods:</b>\n+\t * \t\t<ul>\n+\t * \t\t\t<li class='jm'>{@link org.apache.juneau.html.HtmlDocSerializerBuilder#cspNonce(org.apache.juneau.html.annotation.CspNonce)}\n+\t * \t\t</ul>\n+\t * </ul>\n+\t *\n+\t * <h5 class='section'>Description:</h5>\n+\t * <p>\n+\t * Allows you to set a CSP nonce algorithm name.\n+\t *\n+\t * <p>\n+\t * By default, this feature is disabled.\n+\t *\n+\t * <h5 class='section'>Example:</h5>\n+\t * <p class='bcode w800'>\n+\t *  <ja>@HtmlDocConfig</ja>(\n+\t * \t\tcspNonce=<js>\"SecureRandom\"</js>\n+\t * \t)\n+\t * </p>\n+\t * @param value\n+\t * \tThe new value for this property.\n+\t * @return This object (for method chaining).\n+\t * @since 9.0.0\n+\t */\n+\t@FluentSetter\n+\tpublic HtmlDocSerializerBuilder cspNonce(CspNonce value) {\n+\t\tset(HTMLDOC_cspNonce, value);\n+\t\treturn this;\n+\t}\n+\n \t@Override /* GENERATED - ContextBuilder */\n \tpublic HtmlDocSerializerBuilder debug() {\n \t\tsuper.debug();"
  },
  {
    "sha": "6c18145a576066afa9526cd6eb4c01b45d2f4cc5",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerSession.java",
    "status": "modified",
    "additions": 34,
    "deletions": 0,
    "changes": 34,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerSession.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerSession.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/HtmlDocSerializerSession.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -19,6 +19,8 @@\n \r\n import org.apache.juneau.*;\r\n import org.apache.juneau.collections.*;\r\n+import org.apache.juneau.html.annotation.CspHash;\r\n+import org.apache.juneau.html.annotation.CspNonce;\r\n import org.apache.juneau.serializer.*;\r\n import org.apache.juneau.svl.*;\r\n \r\n@@ -40,6 +42,8 @@\n \tprivate final AsideFloat asideFloat;\r\n \tprivate final Set<String> style, stylesheet, script;\r\n \tprivate final boolean nowrap;\r\n+\tprivate final CspHash cspHash;\r\n+\tprivate final CspNonce cspNonce;\r\n \r\n \t/**\r\n \t * Create a new session using properties specified in the context.\r\n@@ -67,6 +71,9 @@ protected HtmlDocSerializerSession(HtmlDocSerializer ctx, SerializerSessionArgs\n \t\tstyle = ASet.of(sp.get(HTMLDOC_style, String[].class).orElse(ctx.getStyle()));\r\n \t\tstylesheet = ASet.of(sp.get(HTMLDOC_stylesheet, String[].class).orElse(ctx.getStylesheet()));\r\n \t\tscript = ASet.of(sp.get(HTMLDOC_script, String[].class).orElse(ctx.getScript()));\r\n+\t\t\r\n+\t\tcspHash = sp.get(HTMLDOC_cspHash, CspHash.class).orElse(ctx.getCspHash());\r\n+\t\tcspNonce = sp.get(HTMLDOC_cspNonce, CspNonce.class).orElse(ctx.getCspNonce());\r\n \r\n \t\thead = sp.get(HTMLDOC_head, String[].class).orElse(ctx.getHead());\r\n \t\tnowrap = sp.get(HTMLDOC_nowrap, boolean.class).orElse(ctx.isNowrap());\r\n@@ -142,6 +149,30 @@ protected final AsideFloat getAsideFloat() {\n \t\treturn asideFloat;\r\n \t}\r\n \r\n+\t/**\r\n+\t * Configuration property:  CSP hash algorithm name.\r\n+\t *\r\n+\t * @see HtmlDocSerializer#HTMLDOC_cspHash\r\n+\t * @return\r\n+\t * \tCSP hash algorithm name.\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tprotected final CspHash getCspHash() {\r\n+\t\treturn cspHash;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * Configuration property:  CSP nonce algorithm name.\r\n+\t *\r\n+\t * @see HtmlDocSerializer#HTMLDOC_cspNonce\r\n+\t * @return\r\n+\t * \tCSP nonce algorithm name.\r\n+\t * @since 9.0.0\r\n+\t */\r\n+\tprotected final CspNonce getCspNonce() {\r\n+\t\treturn cspNonce;\r\n+\t}\r\n+\r\n \t/**\r\n \t * Configuration property:  Footer section contents.\r\n \t *\r\n@@ -294,8 +325,11 @@ public OMap toMap() {\n \t\t\t\t\t.a(\"navlinks\", navlinks)\r\n \t\t\t\t\t.a(\"script\", script)\r\n \t\t\t\t\t.a(\"style\", style)\r\n+\t\t\t\t\t.a(\"cspHash\", cspHash)\r\n+\t\t\t\t\t.a(\"cspNonce\", cspNonce)\r\n \t\t\t\t\t.a(\"stylesheet\", stylesheet)\r\n \t\t\t\t\t.a(\"varResolver\", getVarResolver())\r\n \t\t\t);\r\n \t}\r\n+\r\n }\r"
  },
  {
    "sha": "bb704c2529e1568796446c413ac3fc8e446dd118",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspHash.java",
    "status": "added",
    "additions": 76,
    "deletions": 0,
    "changes": 76,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspHash.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspHash.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspHash.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -0,0 +1,76 @@\n+// ***************************************************************************************************************************\n+// * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file *\n+// * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file        *\n+// * to you under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance            *\n+// * with the License.  You may obtain a copy of the License at                                                              *\n+// *                                                                                                                         *\n+// *  http://www.apache.org/licenses/LICENSE-2.0                                                                             *\n+// *                                                                                                                         *\n+// * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an  *\n+// * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the        *\n+// * specific language governing permissions and limitations under the License.                                              *\n+// ***************************************************************************************************************************\n+\n+package org.apache.juneau.html.annotation;\n+\n+/**\n+ * Hash algorithms defined for\n+ * <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy </a>\n+ * elements {@code script} and {@code style}.\n+ *\n+ * @see <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy\n+ *      Level 2 (W3C Recommendation, 15 December 2016)</a>\n+ * @see <a href=\"https://www.w3.org/TR/CSP2/#source-list-valid-hashes\">CSP 2\n+ *      valid hashes</a>\n+ * @see <a href=\"https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm\">CSP 3\n+ *      valid hashes</a>\n+ * @since 9.0.0\n+ */\n+public enum CspHash {\n+\n+\t/**\n+\t * Don't use a hash algorithm.\n+\t */\n+\tDEFAULT(\"\"),\n+\t\n+\t/**\n+\t * SHA-256 hash algorithm.\n+\t * \n+\t * @see <a href=\"https://www.w3.org/TR/CSP2/#source-list-valid-hashes\">Valid\n+\t *      hashes</a>.\n+\t */\n+\tSHA256(\"sha256\"),\n+\n+\t/**\n+\t * SHA-384 hash algorithm.\n+\t * \n+\t * @see <a href=\"https://www.w3.org/TR/CSP2/#source-list-valid-hashes\">Valid\n+\t *      hashes</a>.\n+\t */\n+\n+\tSHA384(\"sha384\"),\n+\t/**\n+\t * SHA-512 hash algorithm.\n+\t * \n+\t * @see <a href=\"https://www.w3.org/TR/CSP2/#source-list-valid-hashes\">Valid\n+\t *      hashes</a>.\n+\t */\n+\tSHA512(\"sha512\");\n+\n+\t/** Value in HTML. */\n+\tprivate final String value;\n+\n+\t/** Constructs a new instance. */\n+\tCspHash(String value) {\n+\t\tthis.value = value;\n+\t}\n+\n+\t/**\n+\t * Gets the value for HTML.\n+\t * \n+\t * @return the value for HTML.\n+\t */\n+\tpublic String value() {\n+\t\treturn value;\n+\t}\n+}"
  },
  {
    "sha": "aeed0a15eb49838c66f0f3bef1760db9ac89bb97",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspNonce.java",
    "status": "added",
    "additions": 62,
    "deletions": 0,
    "changes": 62,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspNonce.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspNonce.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/CspNonce.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -0,0 +1,62 @@\n+// ***************************************************************************************************************************\n+// * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file *\n+// * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file        *\n+// * to you under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance            *\n+// * with the License.  You may obtain a copy of the License at                                                              *\n+// *                                                                                                                         *\n+// *  http://www.apache.org/licenses/LICENSE-2.0                                                                             *\n+// *                                                                                                                         *\n+// * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an  *\n+// * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the        *\n+// * specific language governing permissions and limitations under the License.                                              *\n+// ***************************************************************************************************************************\n+\n+package org.apache.juneau.html.annotation;\n+\n+/**\n+ * Nonce algorithms defined for use with\n+ * <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy </a>\n+ * elements {@code script} and {@code style}.\n+ *\n+ * @see <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy\n+ *      Level 2 (W3C Recommendation, 15 December 2016)</a>\n+ * @see <a href=\"https://www.w3.org/TR/CSP3/#intro\">Content Security Policy\n+ *      Level 3 (W3C Working Draft, 15 October 2018)</a>\n+ * @see <a href=\"https://www.w3.org/TR/CSP3/#security-nonces\">Nonce reuse</a>\n+ * @since 9.0.0\n+ */\n+public enum CspNonce {\n+\n+\t/**\n+\t * Don't use a nonce.\n+\t */\n+\tDEFAULT(\"\"),\n+\n+\t/**\n+\t * The secure random algorithm.\n+\t * \n+\t * @see <a href=\"https://www.w3.org/TR/CSP2/#source-list-valid-hashes\">Valid\n+\t *      hashes</a>.\n+\t * @see <a href=\"https://www.w3.org/TR/CSP3/#security-nonces\">Nonce reuse</a>\n+\t */\n+\t// Assumes we are using java.security.SecureRandom as opposed to java.util.Random\n+\t// But leave room for other sources of randomness.\n+\tSECURE_RANDOM(\"SecureRandom\");\n+\n+\t/** Value in HTML. */\n+\tprivate final String value;\n+\n+\t/** Constructs a new instance. */\n+\tCspNonce(String value) {\n+\t\tthis.value = value;\n+\t}\n+\n+\t/**\n+\t * Gets the value for HTML.\n+\t * \n+\t * @return the value for HTML.\n+\t */\n+\tpublic String value() {\n+\t\treturn value;\n+\t}\n+}"
  },
  {
    "sha": "e3139f0931cbe0feaaf63387aa0883b311f9dfa5",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfig.java",
    "status": "modified",
    "additions": 86,
    "deletions": 0,
    "changes": 86,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfig.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfig.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfig.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -142,6 +142,92 @@\n \t */\n \tString asideFloat() default \"DEFAULT\";\n \n+\t/**\n+\t * Configuration property: A hash algorithm defined in\n+\t * <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy</a> for\n+\t * the elements {@code script} and {@code style}.\n+\t * <p>\n+\t * The possible algorithm names from {@link CspHash} are:\n+\t * <ul>\n+\t *   <li><js>\"sha256\"</js>\n+\t *   <li><js>\"sha384\"</js>\n+\t *   <li><js>\"sha512\"</js>\n+\t * </ul>\n+\t * </p>\n+\t * <p>\n+\t * Adds the HTTP header in the form:\n+\t * <p class='bcode w800'>\n+\t * <ja>Content-Security-Policy: script-src 'ALGORITHM-base64 encoded hash'</ja>\n+\t * </p>\n+\t * Note that the header can carry the directives:\n+\t * <ul>\n+\t *   <li>{@code script-src}, {@code script-src-attr}, and {@code script-src-elem}</li>\n+\t *   <li>{@code style-src}, {@code style-src-attr}, and {@code style-src-elem}</li>\n+\t * </ul>\n+\t * </p>\n+\t *\n+\t * <h5 class='section'>Example:</h5>\n+\t * <p>\n+\t * The annotation:\n+\t * <p class='bcode w800'>\n+\t * <ja>@HtmlDocConfig</ja>(\n+\t *   cspHash=<js>\"sha256\"</js>\n+\t * )\n+\t * </p>\n+\t * For the SHA-256 hash for the script {@code alert('Hello, world.');} is\n+\t * {@code qznLcsROx4GACP2dm0UCKCzCG+HiZ1guq6ZZDob/Tng=}.\n+\t * </p>\n+\t * Generates the HTTP header:\n+\t * <p class='bcode w800'>\n+\t * <ja>Content-Security-Policy: script-src 'sha256-qznLcsROx4GACP2dm0UCKCzCG+HiZ1guq6ZZDob/Tng='</ja>\n+\t * </p>\n+\t * </p>\n+\t * \n+\t * @since 9.0.0\n+\t */\n+\tString cspHash() default \"DEFAULT\";\n+\t\n+\t/**\n+\t * Configuration property:  Nonce algorithms defined for use with\n+\t * <a href=\"https://www.w3.org/TR/CSP2/#intro\">Content Security Policy</a>\n+\t * for the elements {@code script} and {@code style}.\n+\t * <p>\n+\t * The possible algorithm names from {@link CspNonce} are:\n+\t * <ul>\n+\t *   <li><js>\"SecureRandom\"</js>\n+\t * </ul>\n+\t * </p>\n+\t * <p>\n+\t * Adds the HTTP header in the form:\n+\t * <p class='bcode w800'>\n+\t * <ja>Content-Security-Policy: script-src 'nonce-$RANDOM'</ja>\n+\t * </p>\n+\t * Note that the header can carry the directives:\n+\t * <ul>\n+\t *   <li>{@code script-src}, {@code script-src-attr}, and {@code script-src-elem}</li>\n+\t *   <li>{@code style-src}, {@code style-src-attr}, and {@code style-src-elem}</li>\n+\t * </ul>\n+\t * </p>\n+\t *\n+\t * <h5 class='section'>Example:</h5>\n+\t * <p>\n+\t * The annotation:\n+\t * <p class='bcode w800'>\n+\t * <ja>@HtmlDocConfig</ja>(\n+\t *   cspNonce=<js>\"SecureRandom\"</js>\n+\t * )\n+\t * </p>\n+\t * </p>\n+\t * Generates the HTTP header like:\n+\t * <p class='bcode w800'>\n+\t * <ja>Content-Security-Policy: script-src 'nonce-Nc3n83cnSAd3wc3Sasdfn939hc3'</ja>\n+\t * </p>\n+\t * </p>\n+\t * \n+\t * @since 9.0.0\n+\t */\n+\tString cspNonce() default \"DEFAULT\";\n+\t\n \t/**\n \t * Configuration property:  Footer section contents.\n \t *"
  },
  {
    "sha": "8670c8f7eb9fcec55dc349bef70378dd8b6dd386",
    "filename": "juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfigAnnotation.java",
    "status": "modified",
    "additions": 2,
    "deletions": 0,
    "changes": 2,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfigAnnotation.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfigAnnotation.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-core/juneau-marshall/src/main/java/org/apache/juneau/html/annotation/HtmlDocConfigAnnotation.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -50,6 +50,8 @@ public void apply(AnnotationInfo<HtmlDocConfig> ai, ContextPropertiesBuilder cpb\n \n \t\t\tcpb.setIf(a.aside().length > 0, HTMLDOC_aside, resolveList(a.aside(), cpb.peek(String[].class, HTMLDOC_aside)));\n \t\t\tcpb.setIf(! \"DEFAULT\".equalsIgnoreCase(a.asideFloat()), HTMLDOC_asideFloat, a.asideFloat().toUpperCase());\n+\t\t\tcpb.setIf(! \"DEFAULT\".equalsIgnoreCase(a.cspHash()), HTMLDOC_cspHash, a.cspHash().toUpperCase());\n+\t\t\tcpb.setIf(! \"DEFAULT\".equalsIgnoreCase(a.cspNonce()), HTMLDOC_cspNonce, a.cspNonce().toUpperCase());\n \t\t\tcpb.setIf(a.footer().length > 0, HTMLDOC_footer, resolveList(a.footer(), cpb.peek(String[].class, HTMLDOC_footer)));\n \t\t\tcpb.setIf(a.head().length > 0, HTMLDOC_head, resolveList(a.head(), cpb.peek(String[].class, HTMLDOC_head)));\n \t\t\tcpb.setIf(a.header().length > 0, HTMLDOC_header, resolveList(a.header(), cpb.peek(String[].class, HTMLDOC_header)));"
  },
  {
    "sha": "52ef5a02e99edeb78d8e47c6d1d0858d60de12cd",
    "filename": "juneau-utest/src/test/java/org/apache/juneau/html/HtmlDocConfigAnnotation_Test.java",
    "status": "modified",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/apache/juneau/blob/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-utest/src/test/java/org/apache/juneau/html/HtmlDocConfigAnnotation_Test.java",
    "raw_url": "https://github.com/apache/juneau/raw/8a5f935fe6b1e2ac834284c05fa7daec3e32409f/juneau-utest/src/test/java/org/apache/juneau/html/HtmlDocConfigAnnotation_Test.java",
    "contents_url": "https://api.github.com/repos/apache/juneau/contents/juneau-utest/src/test/java/org/apache/juneau/html/HtmlDocConfigAnnotation_Test.java?ref=8a5f935fe6b1e2ac834284c05fa7daec3e32409f",
    "patch": "@@ -60,6 +60,9 @@ public String apply(Object t) {\n \n \t@HtmlDocConfig(\n \t\taside=\"$X{foo}\",\n+\t\tasideFloat=\"DEFAULT\",\n+\t\tcspHash=\"sha256\",\n+ \t\tcspNonce=\"SECURE_RANDOM\",\n \t\tfooter=\"$X{foo}\",\n \t\thead=\"$X{foo}\",\n \t\theader=\"$X{foo}\",\n@@ -80,6 +83,9 @@ public void basic() throws Exception {\n \t\tAnnotationList al = a.getAnnotationList();\n \t\tHtmlDocSerializerSession x = HtmlDocSerializer.create().applyAnnotations(al, sr).build().createSession();\n \t\tcheck(\"foo\", x.getAside());\n+\t\tcheck(\"RIGHT\", x.getAsideFloat());\n+\t\tcheck(\"SHA256\", x.getCspHash());\n+\t\tcheck(\"SECURE_RANDOM\", x.getCspNonce());\n \t\tcheck(\"foo\", x.getFooter());\n \t\tcheck(\"foo\", x.getHead());\n \t\tcheck(\"foo\", x.getHeader());\n@@ -106,6 +112,7 @@ public void defaults() throws Exception {\n \t\tAnnotationList al = b.getAnnotationList();\n \t\tHtmlDocSerializerSession x = HtmlDocSerializer.create().applyAnnotations(al, sr).build().createSession();\n \t\tcheck(\"\", x.getAside());\n+\t\tcheck(\"RIGHT\", x.getAsideFloat());\n \t\tcheck(\"\", x.getFooter());\n \t\tcheck(\"\", x.getHead());\n \t\tcheck(\"\", x.getHeader());\n@@ -131,6 +138,9 @@ public void noAnnotation() throws Exception {\n \t\tAnnotationList al = c.getAnnotationList();\n \t\tHtmlDocSerializerSession x = HtmlDocSerializer.create().applyAnnotations(al, sr).build().createSession();\n \t\tcheck(\"\", x.getAside());\n+\t\tcheck(\"RIGHT\", x.getAsideFloat());\n+\t\tcheck(\"DEFAULT\", x.getCspHash());\n+\t\tcheck(\"DEFAULT\", x.getCspNonce());\n \t\tcheck(\"\", x.getFooter());\n \t\tcheck(\"\", x.getHead());\n \t\tcheck(\"\", x.getHeader());"
  }
]
