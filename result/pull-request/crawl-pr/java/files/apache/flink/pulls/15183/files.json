[
  {
    "sha": "4eacf09101b6c5edc77fe08b443e31a2bf36402a",
    "filename": "flink-core/src/test/java/org/apache/flink/api/common/eventtime/WatermarkStrategyTest.java",
    "status": "modified",
    "additions": 0,
    "deletions": 30,
    "changes": 30,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-core/src/test/java/org/apache/flink/api/common/eventtime/WatermarkStrategyTest.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-core/src/test/java/org/apache/flink/api/common/eventtime/WatermarkStrategyTest.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-core/src/test/java/org/apache/flink/api/common/eventtime/WatermarkStrategyTest.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -180,31 +180,16 @@ public MetricGroup getMetricGroup() {\n      */\n     public static class DummyMetricGroup implements MetricGroup {\n \n-        @Override\n-        public Counter counter(int name) {\n-            return null;\n-        }\n-\n         @Override\n         public Counter counter(String name) {\n             return null;\n         }\n \n-        @Override\n-        public <C extends Counter> C counter(int name, C counter) {\n-            return null;\n-        }\n-\n         @Override\n         public <C extends Counter> C counter(String name, C counter) {\n             return null;\n         }\n \n-        @Override\n-        public <T, G extends Gauge<T>> G gauge(int name, G gauge) {\n-            return null;\n-        }\n-\n         @Override\n         public <T, G extends Gauge<T>> G gauge(String name, G gauge) {\n             return null;\n@@ -215,26 +200,11 @@ public Counter counter(String name) {\n             return null;\n         }\n \n-        @Override\n-        public <H extends Histogram> H histogram(int name, H histogram) {\n-            return null;\n-        }\n-\n         @Override\n         public <M extends Meter> M meter(String name, M meter) {\n             return null;\n         }\n \n-        @Override\n-        public <M extends Meter> M meter(int name, M meter) {\n-            return null;\n-        }\n-\n-        @Override\n-        public MetricGroup addGroup(int name) {\n-            return null;\n-        }\n-\n         @Override\n         public MetricGroup addGroup(String name) {\n             return null;"
  },
  {
    "sha": "1a04d8a6eca97673a7e4fa3c719e95ea8b93256b",
    "filename": "flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/LogicalScopeProvider.java",
    "status": "added",
    "additions": 25,
    "deletions": 0,
    "changes": 25,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/LogicalScopeProvider.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/LogicalScopeProvider.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/LogicalScopeProvider.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -0,0 +1,25 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.metrics;\n+\n+/** Extension for metric groups that support logical scopes. */\n+public interface LogicalScopeProvider {\n+    String getLogicalScope(CharacterFilter filter);\n+\n+    String getLogicalScope(CharacterFilter filter, char delimiter);\n+}"
  },
  {
    "sha": "8268ca92269fbc5a44da848b6579efe980c9f1a4",
    "filename": "flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MetricGroup.java",
    "status": "modified",
    "additions": 18,
    "deletions": 6,
    "changes": 24,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MetricGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MetricGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MetricGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -40,7 +40,9 @@\n      * @param name name of the counter\n      * @return the created counter\n      */\n-    Counter counter(int name);\n+    default Counter counter(int name) {\n+        return counter(String.valueOf(name));\n+    }\n \n     /**\n      * Creates and registers a new {@link org.apache.flink.metrics.Counter} with Flink.\n@@ -58,7 +60,9 @@\n      * @param <C> counter type\n      * @return the given counter\n      */\n-    <C extends Counter> C counter(int name, C counter);\n+    default <C extends Counter> C counter(int name, C counter) {\n+        return counter(String.valueOf(name), counter);\n+    }\n \n     /**\n      * Registers a {@link org.apache.flink.metrics.Counter} with Flink.\n@@ -78,7 +82,9 @@\n      * @param <T> return type of the gauge\n      * @return the given gauge\n      */\n-    <T, G extends Gauge<T>> G gauge(int name, G gauge);\n+    default <T, G extends Gauge<T>> G gauge(int name, G gauge) {\n+        return gauge(String.valueOf(name), gauge);\n+    }\n \n     /**\n      * Registers a new {@link org.apache.flink.metrics.Gauge} with Flink.\n@@ -108,7 +114,9 @@\n      * @param <H> histogram type\n      * @return the registered histogram\n      */\n-    <H extends Histogram> H histogram(int name, H histogram);\n+    default <H extends Histogram> H histogram(int name, H histogram) {\n+        return histogram(String.valueOf(name), histogram);\n+    }\n \n     /**\n      * Registers a new {@link Meter} with Flink.\n@@ -128,7 +136,9 @@\n      * @param <M> meter type\n      * @return the registered meter\n      */\n-    <M extends Meter> M meter(int name, M meter);\n+    default <M extends Meter> M meter(int name, M meter) {\n+        return meter(String.valueOf(name), meter);\n+    }\n \n     // ------------------------------------------------------------------------\n     // Groups\n@@ -140,7 +150,9 @@\n      * @param name name of the group\n      * @return the created group\n      */\n-    MetricGroup addGroup(int name);\n+    default MetricGroup addGroup(int name) {\n+        return addGroup(String.valueOf(name));\n+    }\n \n     /**\n      * Creates a new MetricGroup and adds it to this groups sub-groups."
  },
  {
    "sha": "c60d58696becb32ed295d3bcf06c02663ae460f0",
    "filename": "flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/groups/UnregisteredMetricsGroup.java",
    "status": "modified",
    "additions": 0,
    "deletions": 30,
    "changes": 30,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/groups/UnregisteredMetricsGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/groups/UnregisteredMetricsGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/groups/UnregisteredMetricsGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -35,61 +35,31 @@\n  */\n public class UnregisteredMetricsGroup implements MetricGroup {\n \n-    @Override\n-    public Counter counter(int name) {\n-        return new SimpleCounter();\n-    }\n-\n     @Override\n     public Counter counter(String name) {\n         return new SimpleCounter();\n     }\n \n-    @Override\n-    public <C extends Counter> C counter(int name, C counter) {\n-        return counter;\n-    }\n-\n     @Override\n     public <C extends Counter> C counter(String name, C counter) {\n         return counter;\n     }\n \n-    @Override\n-    public <T, G extends Gauge<T>> G gauge(int name, G gauge) {\n-        return gauge;\n-    }\n-\n     @Override\n     public <T, G extends Gauge<T>> G gauge(String name, G gauge) {\n         return gauge;\n     }\n \n-    @Override\n-    public <H extends Histogram> H histogram(int name, H histogram) {\n-        return histogram;\n-    }\n-\n     @Override\n     public <M extends Meter> M meter(String name, M meter) {\n         return meter;\n     }\n \n-    @Override\n-    public <M extends Meter> M meter(int name, M meter) {\n-        return meter;\n-    }\n-\n     @Override\n     public <H extends Histogram> H histogram(String name, H histogram) {\n         return histogram;\n     }\n \n-    @Override\n-    public MetricGroup addGroup(int name) {\n-        return addGroup(String.valueOf(name));\n-    }\n-\n     @Override\n     public MetricGroup addGroup(String name) {\n         return new UnregisteredMetricsGroup();"
  },
  {
    "sha": "23033248dbbba37ff76b1b3ff66b10750da26aff",
    "filename": "flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/util/TestMetricGroup.java",
    "status": "added",
    "additions": 159,
    "deletions": 0,
    "changes": 159,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/util/TestMetricGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/util/TestMetricGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/util/TestMetricGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -0,0 +1,159 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.metrics.util;\n+\n+import org.apache.flink.metrics.CharacterFilter;\n+import org.apache.flink.metrics.Counter;\n+import org.apache.flink.metrics.Gauge;\n+import org.apache.flink.metrics.Histogram;\n+import org.apache.flink.metrics.LogicalScopeProvider;\n+import org.apache.flink.metrics.Meter;\n+import org.apache.flink.metrics.MetricGroup;\n+import org.apache.flink.metrics.SimpleCounter;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.BiFunction;\n+\n+/** A customizable test {@link MetricGroup} implementation. */\n+public class TestMetricGroup implements MetricGroup, LogicalScopeProvider {\n+\n+    private final String[] scopeComponents;\n+    private final Map<String, String> variables;\n+    private final BiFunction<String, Optional<CharacterFilter>, String> metricIdentifierFunction;\n+    private final BiFunction<CharacterFilter, Optional<Character>, String> logicalScopeFunction;\n+\n+    public TestMetricGroup(\n+            String[] scopeComponents,\n+            Map<String, String> variables,\n+            BiFunction<String, Optional<CharacterFilter>, String> metricIdentifierFunction,\n+            BiFunction<CharacterFilter, Optional<Character>, String> logicalScopeFunction) {\n+        this.scopeComponents = scopeComponents;\n+        this.variables = variables;\n+        this.metricIdentifierFunction = metricIdentifierFunction;\n+        this.logicalScopeFunction = logicalScopeFunction;\n+    }\n+\n+    public static TestMetricGroupBuilder newBuilder() {\n+        return new TestMetricGroupBuilder();\n+    }\n+\n+    /** Builder for {@link TestMetricGroup}. */\n+    public static final class TestMetricGroupBuilder {\n+        private String[] scopeComponents = new String[] {};\n+        private Map<String, String> variables = Collections.emptyMap();\n+        private BiFunction<String, Optional<CharacterFilter>, String> metricIdentifierFunction =\n+                (name, filter) -> filter.map(f -> f.filterCharacters(name)).orElse(name);\n+\n+        private BiFunction<CharacterFilter, Optional<Character>, String> logicalScopeFunction =\n+                (characterFilter, character) -> \"logicalScope\";\n+\n+        public TestMetricGroupBuilder setScopeComponents(String[] scopeComponents) {\n+            this.scopeComponents = scopeComponents;\n+            return this;\n+        }\n+\n+        public TestMetricGroupBuilder setVariables(Map<String, String> variables) {\n+            this.variables = variables;\n+            return this;\n+        }\n+\n+        public TestMetricGroupBuilder setMetricIdentifierFunction(\n+                BiFunction<String, Optional<CharacterFilter>, String> metricIdentifierFunction) {\n+            this.metricIdentifierFunction = metricIdentifierFunction;\n+            return this;\n+        }\n+\n+        public TestMetricGroupBuilder setLogicalScopeFunction(\n+                BiFunction<CharacterFilter, Optional<Character>, String> logicalScopeFunction) {\n+            this.logicalScopeFunction = logicalScopeFunction;\n+            return this;\n+        }\n+\n+        public TestMetricGroup build() {\n+            return new TestMetricGroup(\n+                    scopeComponents, variables, metricIdentifierFunction, logicalScopeFunction);\n+        }\n+    }\n+\n+    @Override\n+    public Counter counter(String name) {\n+        return new SimpleCounter();\n+    }\n+\n+    @Override\n+    public <C extends Counter> C counter(String name, C counter) {\n+        return counter;\n+    }\n+\n+    @Override\n+    public <T, G extends Gauge<T>> G gauge(String name, G gauge) {\n+        return gauge;\n+    }\n+\n+    @Override\n+    public <H extends Histogram> H histogram(String name, H histogram) {\n+        return histogram;\n+    }\n+\n+    @Override\n+    public <M extends Meter> M meter(String name, M meter) {\n+        return meter;\n+    }\n+\n+    @Override\n+    public MetricGroup addGroup(String name) {\n+        return this;\n+    }\n+\n+    @Override\n+    public MetricGroup addGroup(String key, String value) {\n+        return this;\n+    }\n+\n+    @Override\n+    public String[] getScopeComponents() {\n+        return scopeComponents;\n+    }\n+\n+    @Override\n+    public Map<String, String> getAllVariables() {\n+        return variables;\n+    }\n+\n+    @Override\n+    public String getMetricIdentifier(String metricName) {\n+        return metricIdentifierFunction.apply(metricName, Optional.empty());\n+    }\n+\n+    @Override\n+    public String getMetricIdentifier(String metricName, CharacterFilter filter) {\n+        return metricIdentifierFunction.apply(metricName, Optional.of(filter));\n+    }\n+\n+    @Override\n+    public String getLogicalScope(CharacterFilter filter) {\n+        return logicalScopeFunction.apply(filter, Optional.empty());\n+    }\n+\n+    @Override\n+    public String getLogicalScope(CharacterFilter filter, char delimiter) {\n+        return logicalScopeFunction.apply(filter, Optional.of(delimiter));\n+    }\n+}"
  },
  {
    "sha": "08a9e52192629e2277e69aab5ec712a9717ac81b",
    "filename": "flink-metrics/flink-metrics-dropwizard/pom.xml",
    "status": "modified",
    "additions": 0,
    "deletions": 7,
    "changes": 7,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/pom.xml",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/pom.xml",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-dropwizard/pom.xml?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -71,13 +71,6 @@ under the License.\n \t\t\t<scope>test</scope>\n \t\t</dependency>\n \n-\t\t<dependency>\n-\t\t\t<groupId>org.apache.flink</groupId>\n-\t\t\t<artifactId>flink-runtime_${scala.binary.version}</artifactId>\n-\t\t\t<version>${project.version}</version>\n-\t\t\t<scope>test</scope>\n-\t\t</dependency>\n-\n \t\t<dependency>\n \t\t\t<groupId>org.apache.flink</groupId>\n \t\t\t<artifactId>flink-test-utils-junit</artifactId>"
  },
  {
    "sha": "0c0563667cac309242a3c19c1237bb5c8f367f27",
    "filename": "flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/ScheduledDropwizardReporterTest.java",
    "status": "modified",
    "additions": 26,
    "deletions": 115,
    "changes": 141,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/ScheduledDropwizardReporterTest.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/ScheduledDropwizardReporterTest.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/ScheduledDropwizardReporterTest.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -18,35 +18,22 @@\n \n package org.apache.flink.dropwizard;\n \n-import org.apache.flink.api.common.JobID;\n-import org.apache.flink.configuration.Configuration;\n-import org.apache.flink.configuration.MetricOptions;\n import org.apache.flink.dropwizard.metrics.DropwizardMeterWrapper;\n import org.apache.flink.metrics.Counter;\n import org.apache.flink.metrics.Gauge;\n import org.apache.flink.metrics.Histogram;\n-import org.apache.flink.metrics.HistogramStatistics;\n import org.apache.flink.metrics.Meter;\n import org.apache.flink.metrics.MetricConfig;\n import org.apache.flink.metrics.MetricGroup;\n import org.apache.flink.metrics.SimpleCounter;\n import org.apache.flink.metrics.groups.UnregisteredMetricsGroup;\n-import org.apache.flink.metrics.reporter.MetricReporter;\n-import org.apache.flink.runtime.executiongraph.ExecutionAttemptID;\n-import org.apache.flink.runtime.jobgraph.JobVertexID;\n-import org.apache.flink.runtime.metrics.MetricRegistryConfiguration;\n-import org.apache.flink.runtime.metrics.MetricRegistryImpl;\n-import org.apache.flink.runtime.metrics.ReporterSetup;\n-import org.apache.flink.runtime.metrics.groups.TaskManagerJobMetricGroup;\n-import org.apache.flink.runtime.metrics.groups.TaskManagerMetricGroup;\n-import org.apache.flink.runtime.metrics.groups.TaskMetricGroup;\n+import org.apache.flink.metrics.util.TestHistogram;\n+import org.apache.flink.metrics.util.TestMeter;\n+import org.apache.flink.metrics.util.TestMetricGroup;\n \n import com.codahale.metrics.ScheduledReporter;\n import org.junit.Test;\n \n-import java.lang.reflect.InvocationTargetException;\n-import java.util.Collections;\n-import java.util.List;\n import java.util.Map;\n \n import static org.junit.Assert.assertEquals;\n@@ -56,8 +43,7 @@\n public class ScheduledDropwizardReporterTest {\n \n     @Test\n-    public void testInvalidCharacterReplacement()\n-            throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {\n+    public void testInvalidCharacterReplacement() {\n         ScheduledDropwizardReporter reporter =\n                 new ScheduledDropwizardReporter() {\n                     @Override\n@@ -73,61 +59,29 @@ public ScheduledReporter getReporter(MetricConfig config) {\n \n     /** Tests that the registered metrics' names don't contain invalid characters. */\n     @Test\n-    public void testAddingMetrics() throws Exception {\n-        Configuration configuration = new Configuration();\n-        String taskName = \"test\\\"Ta\\\"..sk\";\n-        String jobName = \"testJ\\\"ob:-!ax..?\";\n-        String hostname = \"loc<>al\\\"::host\\\".:\";\n-        String taskManagerId = \"tas:kMana::ger\";\n-        String counterName = \"testCounter\";\n-\n-        configuration.setString(MetricOptions.SCOPE_NAMING_TASK, \"<host>.<tm_id>.<job_name>\");\n-        configuration.setString(MetricOptions.SCOPE_DELIMITER, \"_\");\n-\n-        MetricRegistryConfiguration metricRegistryConfiguration =\n-                MetricRegistryConfiguration.fromConfiguration(configuration);\n-\n-        MetricRegistryImpl metricRegistry =\n-                new MetricRegistryImpl(\n-                        metricRegistryConfiguration,\n-                        Collections.singletonList(\n-                                ReporterSetup.forReporter(\n-                                        \"test\", new TestingScheduledDropwizardReporter())));\n-\n-        char delimiter = metricRegistry.getDelimiter();\n-\n-        TaskManagerMetricGroup tmMetricGroup =\n-                new TaskManagerMetricGroup(metricRegistry, hostname, taskManagerId);\n-        TaskManagerJobMetricGroup tmJobMetricGroup =\n-                new TaskManagerJobMetricGroup(metricRegistry, tmMetricGroup, new JobID(), jobName);\n-        TaskMetricGroup taskMetricGroup =\n-                new TaskMetricGroup(\n-                        metricRegistry,\n-                        tmJobMetricGroup,\n-                        new JobVertexID(),\n-                        new ExecutionAttemptID(),\n-                        taskName,\n-                        0,\n-                        0);\n+    public void testAddingMetrics() {\n+        final String scope = \"scope\";\n+        final char delimiter = '_';\n+        final String counterName = \"testCounter\";\n+\n+        final MetricGroup metricGroup =\n+                TestMetricGroup.newBuilder()\n+                        .setMetricIdentifierFunction(\n+                                (metricName, characterFilter) ->\n+                                        characterFilter\n+                                                .orElse(s -> s)\n+                                                .filterCharacters(scope + delimiter + metricName))\n+                        .build();\n+\n+        final TestingScheduledDropwizardReporter reporter =\n+                new TestingScheduledDropwizardReporter();\n \n         SimpleCounter myCounter = new SimpleCounter();\n         com.codahale.metrics.Meter dropwizardMeter = new com.codahale.metrics.Meter();\n         DropwizardMeterWrapper meterWrapper = new DropwizardMeterWrapper(dropwizardMeter);\n \n-        taskMetricGroup.counter(counterName, myCounter);\n-        taskMetricGroup.meter(\"meter\", meterWrapper);\n-\n-        List<MetricReporter> reporters = metricRegistry.getReporters();\n-\n-        assertTrue(reporters.size() == 1);\n-        MetricReporter metricReporter = reporters.get(0);\n-\n-        assertTrue(\n-                \"Reporter should be of type ScheduledDropwizardReporter\",\n-                metricReporter instanceof ScheduledDropwizardReporter);\n-\n-        TestingScheduledDropwizardReporter reporter =\n-                (TestingScheduledDropwizardReporter) metricReporter;\n+        reporter.notifyOfAddedMetric(myCounter, counterName, metricGroup);\n+        reporter.notifyOfAddedMetric(meterWrapper, \"meter\", metricGroup);\n \n         Map<Counter, String> counters = reporter.getCounters();\n         assertTrue(counters.containsKey(myCounter));\n@@ -136,17 +90,11 @@ public void testAddingMetrics() throws Exception {\n         assertTrue(meters.containsKey(meterWrapper));\n \n         String expectedCounterName =\n-                reporter.filterCharacters(hostname)\n-                        + delimiter\n-                        + reporter.filterCharacters(taskManagerId)\n-                        + delimiter\n-                        + reporter.filterCharacters(jobName)\n+                reporter.filterCharacters(scope)\n                         + delimiter\n                         + reporter.filterCharacters(counterName);\n \n         assertEquals(expectedCounterName, counters.get(myCounter));\n-\n-        metricRegistry.shutdown().get();\n     }\n \n     /**\n@@ -160,46 +108,9 @@ public void testMetricCleanup() {\n         MetricGroup mp = new UnregisteredMetricsGroup();\n \n         Counter c = new SimpleCounter();\n-        Meter m =\n-                new Meter() {\n-                    @Override\n-                    public void markEvent() {}\n-\n-                    @Override\n-                    public void markEvent(long n) {}\n-\n-                    @Override\n-                    public double getRate() {\n-                        return 0;\n-                    }\n-\n-                    @Override\n-                    public long getCount() {\n-                        return 0;\n-                    }\n-                };\n-        Histogram h =\n-                new Histogram() {\n-                    @Override\n-                    public void update(long value) {}\n-\n-                    @Override\n-                    public long getCount() {\n-                        return 0;\n-                    }\n-\n-                    @Override\n-                    public HistogramStatistics getStatistics() {\n-                        return null;\n-                    }\n-                };\n-        Gauge g =\n-                new Gauge() {\n-                    @Override\n-                    public Object getValue() {\n-                        return null;\n-                    }\n-                };\n+        Meter m = new TestMeter();\n+        Histogram h = new TestHistogram();\n+        Gauge<?> g = () -> null;\n \n         rep.notifyOfAddedMetric(c, \"counter\", mp);\n         assertEquals(1, rep.getCounters().size());"
  },
  {
    "sha": "a6629420d72af1035b160d6a59145f5cdb2df200",
    "filename": "flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/metrics/DropwizardFlinkHistogramWrapperTest.java",
    "status": "modified",
    "additions": 29,
    "deletions": 200,
    "changes": 229,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/metrics/DropwizardFlinkHistogramWrapperTest.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/metrics/DropwizardFlinkHistogramWrapperTest.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-dropwizard/src/test/java/org/apache/flink/dropwizard/metrics/DropwizardFlinkHistogramWrapperTest.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -18,15 +18,11 @@\n \n package org.apache.flink.dropwizard.metrics;\n \n-import org.apache.flink.configuration.ConfigConstants;\n import org.apache.flink.dropwizard.ScheduledDropwizardReporter;\n import org.apache.flink.metrics.AbstractHistogramTest;\n import org.apache.flink.metrics.MetricConfig;\n-import org.apache.flink.metrics.reporter.MetricReporter;\n-import org.apache.flink.runtime.metrics.MetricRegistryConfiguration;\n-import org.apache.flink.runtime.metrics.MetricRegistryImpl;\n-import org.apache.flink.runtime.metrics.ReporterSetup;\n-import org.apache.flink.runtime.metrics.groups.TaskManagerMetricGroup;\n+import org.apache.flink.metrics.MetricGroup;\n+import org.apache.flink.metrics.util.TestMetricGroup;\n \n import com.codahale.metrics.Counter;\n import com.codahale.metrics.Gauge;\n@@ -38,20 +34,12 @@\n import com.codahale.metrics.Timer;\n import org.junit.Test;\n \n-import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.HashMap;\n-import java.util.List;\n import java.util.Map;\n import java.util.SortedMap;\n-import java.util.concurrent.CancellationException;\n-import java.util.concurrent.ExecutionException;\n-import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.TimeoutException;\n \n import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertTrue;\n \n /** Tests for the DropwizardFlinkHistogramWrapper. */\n public class DropwizardFlinkHistogramWrapperTest extends AbstractHistogramTest {\n@@ -72,72 +60,40 @@ public void testDropwizardHistogramWrapper() {\n      */\n     @Test\n     public void testDropwizardHistogramWrapperReporting() throws Exception {\n-        long reportingInterval = 1000;\n-        long timeout = 30000;\n         int size = 10;\n         String histogramMetricName = \"histogram\";\n \n-        MetricConfig config = new MetricConfig();\n-        config.setProperty(\n-                ConfigConstants.METRICS_REPORTER_INTERVAL_SUFFIX,\n-                reportingInterval + \" MILLISECONDS\");\n+        final TestingReporter testingReporter = new TestingReporter();\n+        testingReporter.open(new MetricConfig());\n \n-        MetricRegistryImpl registry = null;\n-\n-        try {\n-            registry =\n-                    new MetricRegistryImpl(\n-                            MetricRegistryConfiguration.defaultMetricRegistryConfiguration(),\n-                            Collections.singletonList(\n-                                    ReporterSetup.forReporter(\n-                                            \"test\", config, new TestingReporter())));\n-            DropwizardHistogramWrapper histogramWrapper =\n-                    new DropwizardHistogramWrapper(\n-                            new com.codahale.metrics.Histogram(new SlidingWindowReservoir(size)));\n-\n-            TaskManagerMetricGroup metricGroup =\n-                    new TaskManagerMetricGroup(registry, \"localhost\", \"tmId\");\n-\n-            metricGroup.histogram(histogramMetricName, histogramWrapper);\n-\n-            String fullMetricName = metricGroup.getMetricIdentifier(histogramMetricName);\n-\n-            assertTrue(registry.getReporters().size() == 1);\n-\n-            MetricReporter reporter = registry.getReporters().get(0);\n-\n-            assertTrue(reporter instanceof TestingReporter);\n-\n-            TestingReporter testingReporter = (TestingReporter) reporter;\n+        DropwizardHistogramWrapper histogramWrapper =\n+                new DropwizardHistogramWrapper(\n+                        new com.codahale.metrics.Histogram(new SlidingWindowReservoir(size)));\n \n-            TestingScheduledReporter scheduledReporter = testingReporter.scheduledReporter;\n+        final MetricGroup metricGroup = TestMetricGroup.newBuilder().build();\n \n-            // check that the metric has been registered\n-            assertEquals(1, testingReporter.getMetrics().size());\n+        testingReporter.notifyOfAddedMetric(histogramWrapper, histogramMetricName, metricGroup);\n \n-            for (int i = 0; i < size; i++) {\n-                histogramWrapper.update(i);\n-            }\n+        // check that the metric has been registered\n+        assertEquals(1, testingReporter.getMetrics().size());\n \n-            Future<Snapshot> snapshotFuture =\n-                    scheduledReporter.getNextHistogramSnapshot(fullMetricName);\n+        for (int i = 0; i < size; i++) {\n+            histogramWrapper.update(i);\n+        }\n \n-            Snapshot snapshot = snapshotFuture.get(timeout, TimeUnit.MILLISECONDS);\n+        testingReporter.report();\n+        String fullMetricName = metricGroup.getMetricIdentifier(histogramMetricName);\n+        Snapshot snapshot = testingReporter.getNextHistogramSnapshot(fullMetricName);\n \n-            assertEquals(0, snapshot.getMin());\n-            assertEquals((size - 1) / 2.0, snapshot.getMedian(), 0.001);\n-            assertEquals(size - 1, snapshot.getMax());\n-            assertEquals(size, snapshot.size());\n+        assertEquals(0, snapshot.getMin());\n+        assertEquals((size - 1) / 2.0, snapshot.getMedian(), 0.001);\n+        assertEquals(size - 1, snapshot.getMax());\n+        assertEquals(size, snapshot.size());\n \n-            registry.unregister(histogramWrapper, \"histogram\", metricGroup);\n+        testingReporter.notifyOfRemovedMetric(histogramWrapper, histogramMetricName, metricGroup);\n \n-            // check that the metric has been de-registered\n-            assertEquals(0, testingReporter.getMetrics().size());\n-        } finally {\n-            if (registry != null) {\n-                registry.shutdown().get();\n-            }\n-        }\n+        // check that the metric has been de-registered\n+        assertEquals(0, testingReporter.getMetrics().size());\n     }\n \n     /** Test reporter. */\n@@ -160,13 +116,15 @@ public ScheduledReporter getReporter(MetricConfig config) {\n         public Map<String, com.codahale.metrics.Metric> getMetrics() {\n             return registry.getMetrics();\n         }\n+\n+        Snapshot getNextHistogramSnapshot(String name) {\n+            return scheduledReporter.histogramSnapshots.get(name);\n+        }\n     }\n \n     static class TestingScheduledReporter extends ScheduledReporter {\n \n         final Map<String, Snapshot> histogramSnapshots = new HashMap<>();\n-        final Map<String, List<CompletableFuture<Snapshot>>> histogramSnapshotFutures =\n-                new HashMap<>();\n \n         protected TestingScheduledReporter(\n                 com.codahale.metrics.MetricRegistry registry,\n@@ -189,137 +147,8 @@ public void report(\n             }\n         }\n \n-        void reportHistogram(String name, com.codahale.metrics.Histogram histogram) {\n+        private void reportHistogram(String name, com.codahale.metrics.Histogram histogram) {\n             histogramSnapshots.put(name, histogram.getSnapshot());\n-\n-            synchronized (histogramSnapshotFutures) {\n-                if (histogramSnapshotFutures.containsKey(name)) {\n-                    List<CompletableFuture<Snapshot>> futures =\n-                            histogramSnapshotFutures.remove(name);\n-\n-                    for (CompletableFuture<Snapshot> future : futures) {\n-                        future.complete(histogram.getSnapshot());\n-                    }\n-                }\n-            }\n-        }\n-\n-        Future<Snapshot> getNextHistogramSnapshot(String name) {\n-            synchronized (histogramSnapshotFutures) {\n-                List<CompletableFuture<Snapshot>> futures;\n-                if (histogramSnapshotFutures.containsKey(name)) {\n-                    futures = histogramSnapshotFutures.get(name);\n-                } else {\n-                    futures = new ArrayList<>();\n-                    histogramSnapshotFutures.put(name, futures);\n-                }\n-\n-                CompletableFuture<Snapshot> future = new CompletableFuture<>();\n-                futures.add(future);\n-\n-                return future;\n-            }\n-        }\n-    }\n-\n-    static class CompletableFuture<T> implements Future<T> {\n-\n-        private Exception exception = null;\n-        private T value = null;\n-\n-        private Object lock = new Object();\n-\n-        @Override\n-        public boolean cancel(boolean mayInterruptIfRunning) {\n-            synchronized (lock) {\n-                if (isDone()) {\n-                    return false;\n-                } else {\n-                    exception = new CancellationException(\"Future was cancelled.\");\n-\n-                    lock.notifyAll();\n-\n-                    return true;\n-                }\n-            }\n-        }\n-\n-        @Override\n-        public boolean isCancelled() {\n-            return exception instanceof CancellationException;\n-        }\n-\n-        @Override\n-        public boolean isDone() {\n-            return value != null || exception != null;\n-        }\n-\n-        @Override\n-        public T get() throws InterruptedException, ExecutionException {\n-            while (!isDone() && !isCancelled()) {\n-                synchronized (lock) {\n-                    lock.wait();\n-                }\n-            }\n-\n-            if (exception != null) {\n-                throw new ExecutionException(exception);\n-            } else if (value != null) {\n-                return value;\n-            } else {\n-                throw new ExecutionException(new Exception(\"Future did not complete correctly.\"));\n-            }\n-        }\n-\n-        @Override\n-        public T get(long timeout, TimeUnit unit)\n-                throws InterruptedException, ExecutionException, TimeoutException {\n-            long timeoutMs = unit.toMillis(timeout);\n-            long timeoutEnd = timeoutMs + System.currentTimeMillis();\n-\n-            while (!isDone() && !isCancelled() && timeoutMs > 0) {\n-                synchronized (lock) {\n-                    lock.wait(unit.toMillis(timeoutMs));\n-                }\n-\n-                timeoutMs = timeoutEnd - System.currentTimeMillis();\n-            }\n-\n-            if (exception != null) {\n-                throw new ExecutionException(exception);\n-            } else if (value != null) {\n-                return value;\n-            } else {\n-                throw new ExecutionException(new Exception(\"Future did not complete correctly.\"));\n-            }\n-        }\n-\n-        public boolean complete(T value) {\n-            synchronized (lock) {\n-                if (!isDone()) {\n-                    this.value = value;\n-\n-                    lock.notifyAll();\n-\n-                    return true;\n-                } else {\n-                    return false;\n-                }\n-            }\n-        }\n-\n-        public boolean fail(Exception exception) {\n-            synchronized (lock) {\n-                if (!isDone()) {\n-                    this.exception = exception;\n-\n-                    lock.notifyAll();\n-\n-                    return true;\n-                } else {\n-                    return false;\n-                }\n-            }\n         }\n     }\n }"
  },
  {
    "sha": "db462a42b486f9d50085410d94ed867ae41b3d58",
    "filename": "flink-metrics/flink-metrics-influxdb/src/main/java/org/apache/flink/metrics/influxdb/MeasurementInfoProvider.java",
    "status": "modified",
    "additions": 2,
    "deletions": 4,
    "changes": 6,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-influxdb/src/main/java/org/apache/flink/metrics/influxdb/MeasurementInfoProvider.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-influxdb/src/main/java/org/apache/flink/metrics/influxdb/MeasurementInfoProvider.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-influxdb/src/main/java/org/apache/flink/metrics/influxdb/MeasurementInfoProvider.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -20,9 +20,8 @@\n \n import org.apache.flink.annotation.VisibleForTesting;\n import org.apache.flink.metrics.CharacterFilter;\n+import org.apache.flink.metrics.LogicalScopeProvider;\n import org.apache.flink.metrics.MetricGroup;\n-import org.apache.flink.runtime.metrics.groups.AbstractMetricGroup;\n-import org.apache.flink.runtime.metrics.groups.FrontMetricGroup;\n \n import java.util.HashMap;\n import java.util.Map;\n@@ -63,7 +62,6 @@ private static String getScopedName(String metricName, MetricGroup group) {\n     }\n \n     private static String getLogicalScope(MetricGroup group) {\n-        return ((FrontMetricGroup<AbstractMetricGroup<?>>) group)\n-                .getLogicalScope(CHARACTER_FILTER, SCOPE_SEPARATOR);\n+        return ((LogicalScopeProvider) group).getLogicalScope(CHARACTER_FILTER, SCOPE_SEPARATOR);\n     }\n }"
  },
  {
    "sha": "e91884a753271ab1a7535487e770bb86048b100a",
    "filename": "flink-metrics/flink-metrics-jmx/src/main/java/org/apache/flink/metrics/jmx/JMXReporter.java",
    "status": "modified",
    "additions": 2,
    "deletions": 4,
    "changes": 6,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-jmx/src/main/java/org/apache/flink/metrics/jmx/JMXReporter.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-jmx/src/main/java/org/apache/flink/metrics/jmx/JMXReporter.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-jmx/src/main/java/org/apache/flink/metrics/jmx/JMXReporter.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -23,15 +23,14 @@\n import org.apache.flink.metrics.Counter;\n import org.apache.flink.metrics.Gauge;\n import org.apache.flink.metrics.Histogram;\n+import org.apache.flink.metrics.LogicalScopeProvider;\n import org.apache.flink.metrics.Meter;\n import org.apache.flink.metrics.Metric;\n import org.apache.flink.metrics.MetricConfig;\n import org.apache.flink.metrics.MetricGroup;\n import org.apache.flink.metrics.reporter.InstantiateViaFactory;\n import org.apache.flink.metrics.reporter.MetricReporter;\n import org.apache.flink.runtime.management.JMXService;\n-import org.apache.flink.runtime.metrics.groups.AbstractMetricGroup;\n-import org.apache.flink.runtime.metrics.groups.FrontMetricGroup;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -198,8 +197,7 @@ public void notifyOfRemovedMetric(Metric metric, String metricName, MetricGroup\n \n     static String generateJmxDomain(String metricName, MetricGroup group) {\n         return JMX_DOMAIN_PREFIX\n-                + ((FrontMetricGroup<AbstractMetricGroup<?>>) group)\n-                        .getLogicalScope(CHARACTER_FILTER, '.')\n+                + ((LogicalScopeProvider) group).getLogicalScope(CHARACTER_FILTER, '.')\n                 + '.'\n                 + metricName;\n     }"
  },
  {
    "sha": "2328b6298b428dba47e0e7933b079a4fef29637b",
    "filename": "flink-metrics/flink-metrics-prometheus/src/main/java/org/apache/flink/metrics/prometheus/AbstractPrometheusReporter.java",
    "status": "modified",
    "additions": 2,
    "deletions": 4,
    "changes": 6,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-prometheus/src/main/java/org/apache/flink/metrics/prometheus/AbstractPrometheusReporter.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-metrics/flink-metrics-prometheus/src/main/java/org/apache/flink/metrics/prometheus/AbstractPrometheusReporter.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-metrics/flink-metrics-prometheus/src/main/java/org/apache/flink/metrics/prometheus/AbstractPrometheusReporter.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -25,13 +25,12 @@\n import org.apache.flink.metrics.Gauge;\n import org.apache.flink.metrics.Histogram;\n import org.apache.flink.metrics.HistogramStatistics;\n+import org.apache.flink.metrics.LogicalScopeProvider;\n import org.apache.flink.metrics.Meter;\n import org.apache.flink.metrics.Metric;\n import org.apache.flink.metrics.MetricConfig;\n import org.apache.flink.metrics.MetricGroup;\n import org.apache.flink.metrics.reporter.MetricReporter;\n-import org.apache.flink.runtime.metrics.groups.AbstractMetricGroup;\n-import org.apache.flink.runtime.metrics.groups.FrontMetricGroup;\n \n import io.prometheus.client.Collector;\n import io.prometheus.client.CollectorRegistry;\n@@ -251,8 +250,7 @@ public void notifyOfRemovedMetric(\n \n     @SuppressWarnings(\"unchecked\")\n     private static String getLogicalScope(MetricGroup group) {\n-        return ((FrontMetricGroup<AbstractMetricGroup<?>>) group)\n-                .getLogicalScope(CHARACTER_FILTER, SCOPE_SEPARATOR);\n+        return ((LogicalScopeProvider) group).getLogicalScope(CHARACTER_FILTER, SCOPE_SEPARATOR);\n     }\n \n     @VisibleForTesting"
  },
  {
    "sha": "c2621a7f16242353b04dcc520d60d733107a2e9d",
    "filename": "flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/AbstractMetricGroup.java",
    "status": "modified",
    "additions": 0,
    "deletions": 30,
    "changes": 30,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/AbstractMetricGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/AbstractMetricGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/AbstractMetricGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -345,54 +345,29 @@ public final boolean isClosed() {\n     //  Metrics\n     // -----------------------------------------------------------------------------------------------------------------\n \n-    @Override\n-    public Counter counter(int name) {\n-        return counter(String.valueOf(name));\n-    }\n-\n     @Override\n     public Counter counter(String name) {\n         return counter(name, new SimpleCounter());\n     }\n \n-    @Override\n-    public <C extends Counter> C counter(int name, C counter) {\n-        return counter(String.valueOf(name), counter);\n-    }\n-\n     @Override\n     public <C extends Counter> C counter(String name, C counter) {\n         addMetric(name, counter);\n         return counter;\n     }\n \n-    @Override\n-    public <T, G extends Gauge<T>> G gauge(int name, G gauge) {\n-        return gauge(String.valueOf(name), gauge);\n-    }\n-\n     @Override\n     public <T, G extends Gauge<T>> G gauge(String name, G gauge) {\n         addMetric(name, gauge);\n         return gauge;\n     }\n \n-    @Override\n-    public <H extends Histogram> H histogram(int name, H histogram) {\n-        return histogram(String.valueOf(name), histogram);\n-    }\n-\n     @Override\n     public <H extends Histogram> H histogram(String name, H histogram) {\n         addMetric(name, histogram);\n         return histogram;\n     }\n \n-    @Override\n-    public <M extends Meter> M meter(int name, M meter) {\n-        return meter(String.valueOf(name), meter);\n-    }\n-\n     @Override\n     public <M extends Meter> M meter(String name, M meter) {\n         addMetric(name, meter);\n@@ -458,11 +433,6 @@ protected void addMetric(String name, Metric metric) {\n     //  Groups\n     // ------------------------------------------------------------------------\n \n-    @Override\n-    public MetricGroup addGroup(int name) {\n-        return addGroup(String.valueOf(name), ChildType.GENERIC);\n-    }\n-\n     @Override\n     public MetricGroup addGroup(String name) {\n         return addGroup(name, ChildType.GENERIC);"
  },
  {
    "sha": "6776c6c3e9760fab7473bfbd55f3637bb5b8663a",
    "filename": "flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/FrontMetricGroup.java",
    "status": "modified",
    "additions": 5,
    "deletions": 1,
    "changes": 6,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/FrontMetricGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/FrontMetricGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/FrontMetricGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -20,6 +20,7 @@\n \n import org.apache.flink.annotation.VisibleForTesting;\n import org.apache.flink.metrics.CharacterFilter;\n+import org.apache.flink.metrics.LogicalScopeProvider;\n \n import java.util.Map;\n \n@@ -32,7 +33,8 @@\n  *\n  * @param <P> parentMetricGroup to {@link AbstractMetricGroup AbstractMetricGroup}\n  */\n-public class FrontMetricGroup<P extends AbstractMetricGroup<?>> extends ProxyMetricGroup<P> {\n+public class FrontMetricGroup<P extends AbstractMetricGroup<?>> extends ProxyMetricGroup<P>\n+        implements LogicalScopeProvider {\n \n     @VisibleForTesting static final char DEFAULT_REPLACEMENT = '_';\n     @VisibleForTesting static final char DEFAULT_REPLACEMENT_ALTERNATIVE = '-';\n@@ -68,11 +70,13 @@ public String getMetricIdentifier(String metricName, CharacterFilter filter) {\n                 this.settings.getReporterIndex(), this.settings.getExcludedVariables());\n     }\n \n+    @Override\n     public String getLogicalScope(CharacterFilter filter) {\n         return parentMetricGroup.getLogicalScope(\n                 getDelimiterFilter(this.settings, filter), this.settings.getDelimiter());\n     }\n \n+    @Override\n     public String getLogicalScope(CharacterFilter filter, char delimiter) {\n         return parentMetricGroup.getLogicalScope(\n                 getDelimiterFilter(this.settings, filter),"
  },
  {
    "sha": "0ca34cf756f6fff9ea0b545e767848d20fbc4b55",
    "filename": "flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/ProxyMetricGroup.java",
    "status": "modified",
    "additions": 0,
    "deletions": 30,
    "changes": 30,
    "blob_url": "https://github.com/apache/flink/blob/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/ProxyMetricGroup.java",
    "raw_url": "https://github.com/apache/flink/raw/b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/ProxyMetricGroup.java",
    "contents_url": "https://api.github.com/repos/apache/flink/contents/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/groups/ProxyMetricGroup.java?ref=b1cdadcdfcd2f3ba4aacbe70187795db2657e4a8",
    "patch": "@@ -42,31 +42,16 @@ public ProxyMetricGroup(P parentMetricGroup) {\n         this.parentMetricGroup = checkNotNull(parentMetricGroup);\n     }\n \n-    @Override\n-    public final Counter counter(int name) {\n-        return parentMetricGroup.counter(name);\n-    }\n-\n     @Override\n     public final Counter counter(String name) {\n         return parentMetricGroup.counter(name);\n     }\n \n-    @Override\n-    public final <C extends Counter> C counter(int name, C counter) {\n-        return parentMetricGroup.counter(name, counter);\n-    }\n-\n     @Override\n     public final <C extends Counter> C counter(String name, C counter) {\n         return parentMetricGroup.counter(name, counter);\n     }\n \n-    @Override\n-    public final <T, G extends Gauge<T>> G gauge(int name, G gauge) {\n-        return parentMetricGroup.gauge(name, gauge);\n-    }\n-\n     @Override\n     public final <T, G extends Gauge<T>> G gauge(String name, G gauge) {\n         return parentMetricGroup.gauge(name, gauge);\n@@ -77,26 +62,11 @@ public final Counter counter(String name) {\n         return parentMetricGroup.histogram(name, histogram);\n     }\n \n-    @Override\n-    public final <H extends Histogram> H histogram(int name, H histogram) {\n-        return parentMetricGroup.histogram(name, histogram);\n-    }\n-\n     @Override\n     public <M extends Meter> M meter(String name, M meter) {\n         return parentMetricGroup.meter(name, meter);\n     }\n \n-    @Override\n-    public <M extends Meter> M meter(int name, M meter) {\n-        return parentMetricGroup.meter(name, meter);\n-    }\n-\n-    @Override\n-    public final MetricGroup addGroup(int name) {\n-        return parentMetricGroup.addGroup(name);\n-    }\n-\n     @Override\n     public final MetricGroup addGroup(String name) {\n         return parentMetricGroup.addGroup(name);"
  }
]
