[
  {
    "sha": "4e4b2558565df43790670b371890316468237941",
    "filename": "app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardBottomSheet.java",
    "status": "modified",
    "additions": 62,
    "deletions": 3,
    "changes": 65,
    "blob_url": "https://github.com/apache/fineract-cn-mobile/blob/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardBottomSheet.java",
    "raw_url": "https://github.com/apache/fineract-cn-mobile/raw/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardBottomSheet.java",
    "contents_url": "https://api.github.com/repos/apache/fineract-cn-mobile/contents/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardBottomSheet.java?ref=3437feaa2029ce29f73d88bac0f014b6ec9d4f67",
    "patch": "@@ -13,6 +13,7 @@\n import android.os.Bundle;\n import android.provider.MediaStore;\n import androidx.annotation.NonNull;\n+\n import com.google.android.material.bottomsheet.BottomSheetBehavior;\n import com.google.android.material.bottomsheet.BottomSheetDialog;\n import com.google.android.material.textfield.TextInputLayout;\n@@ -29,6 +30,7 @@\n import org.apache.fineract.ui.base.Toaster;\n import org.apache.fineract.utils.CheckSelfPermissionAndRequest;\n import org.apache.fineract.utils.ConstantKeys;\n+import org.apache.fineract.utils.FileUtils;\n import org.apache.fineract.utils.ValidateIdentifierUtil;\n import org.apache.fineract.utils.ValidationUtil;\n \n@@ -52,6 +54,7 @@\n     public static final String LOG_TAG = UploadIdentificationCardBottomSheet.class.getSimpleName();\n \n     public static final int REQUEST_IMAGE_CAPTURE = 1;\n+    public static final int REQUEST_PHOTO_FROM_GALLERY = 2;\n \n     @BindView(R.id.et_identifier)\n     EditText etIdentifier;\n@@ -125,11 +128,16 @@ void onCancel() {\n         dismiss();\n     }\n \n-    @OnClick(R.id.btn_browse_document)\n+    @OnClick(R.id.btn_take_photo)\n     void browseDocument() {\n         checkCameraPermission();\n     }\n \n+    @OnClick(R.id.btn_browse_document)\n+    void takePhotoOfDocument() {\n+        checkReadExternalStoragePermission();\n+    }\n+\n     @Override\n     public void checkCameraPermission() {\n         if (CheckSelfPermissionAndRequest.checkSelfPermission(getActivity(),\n@@ -140,6 +148,16 @@ public void checkCameraPermission() {\n         }\n     }\n \n+    @Override\n+    public void checkReadExternalStoragePermission() {\n+        if (CheckSelfPermissionAndRequest.checkSelfPermission(getActivity(),\n+                Manifest.permission.READ_EXTERNAL_STORAGE)) {\n+            viewGallery();\n+        } else {\n+            requestReadExternalStoragePermission();\n+        }\n+    }\n+\n     @Override\n     public void openCamera() {\n \n@@ -162,6 +180,14 @@ public void openCamera() {\n         }\n     }\n \n+    @Override\n+    public void viewGallery() {\n+        Intent intentDocument = new Intent(Intent.ACTION_GET_CONTENT);\n+        intentDocument.setType(\"image/*\");\n+        startActivityForResult(intentDocument, REQUEST_PHOTO_FROM_GALLERY);\n+    }\n+\n+\n     @Override\n     public void onActivityResult(int requestCode, int resultCode, Intent data) {\n         if (requestCode == REQUEST_IMAGE_CAPTURE && resultCode == RESULT_OK) {\n@@ -171,6 +197,18 @@ public void onActivityResult(int requestCode, int resultCode, Intent data) {\n             } catch (IOException e) {\n                 Log.d(UploadIdentificationCardBottomSheet.class.getSimpleName(), e.toString());\n             }\n+        } else if (requestCode == REQUEST_PHOTO_FROM_GALLERY && resultCode == RESULT_OK) {\n+            if (data == null) {\n+                return;\n+            }\n+            etSelectFile.setText(getString(R.string.scan_file));\n+            Uri uri = data.getData();\n+            File file = new File(FileUtils.getPathReal(getActivity(), uri));\n+            try {\n+                compressedImage = imageCompressor.compressToFile(file);\n+            } catch (IOException e) {\n+                Log.d(UploadIdentificationCardBottomSheet.class.getSimpleName(), e.toString());\n+            }\n         }\n     }\n \n@@ -187,18 +225,39 @@ public void requestPermission() {\n                 ConstantKeys.PERMISSIONS_CAMERA_STATUS);\n     }\n \n+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)\n+    @Override\n+    public void requestReadExternalStoragePermission() {\n+        CheckSelfPermissionAndRequest.requestPermission(\n+                (FineractBaseActivity) getActivity(), Manifest.permission.READ_EXTERNAL_STORAGE,\n+                ConstantKeys.PERMISSION_REQUEST_READ_EXTERNAL_STORAGE,\n+                getResources().getString(\n+                        R.string.dialog_message_read_permission_denied_prompt),\n+                getResources().getString(R.string.dialog_message_read_permission_never_ask_again),\n+                ConstantKeys.PERMISSIONS_READ_EXTERNAL_STORAGE_STATUS);\n+    }\n+\n     @Override\n     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,\n             @NonNull int[] grantResults) {\n         switch (requestCode) {\n-            case ConstantKeys.PERMISSIONS_REQUEST_CAMERA: {\n+            case ConstantKeys.PERMISSIONS_REQUEST_CAMERA:\n                 if (grantResults.length > 0\n                         && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n                     openCamera();\n                 } else {\n                     Toaster.show(rootView, getString(R.string.permission_denied_camera));\n                 }\n-            }\n+                break;\n+\n+            case ConstantKeys.PERMISSION_REQUEST_READ_EXTERNAL_STORAGE:\n+                if (grantResults.length > 0\n+                        && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n+                    viewGallery();\n+                } else {\n+                    Toaster.show(rootView, getString(R.string.permission_denied_read));\n+                }\n+                break;\n         }\n     }\n "
  },
  {
    "sha": "ba58713a69bffe5de3fa5f3510bfb168cb57f5fc",
    "filename": "app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardContract.java",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/apache/fineract-cn-mobile/blob/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardContract.java",
    "raw_url": "https://github.com/apache/fineract-cn-mobile/raw/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardContract.java",
    "contents_url": "https://api.github.com/repos/apache/fineract-cn-mobile/contents/app/src/main/java/org/apache/fineract/ui/online/identification/uploadidentificationscan/UploadIdentificationCardContract.java?ref=3437feaa2029ce29f73d88bac0f014b6ec9d4f67",
    "patch": "@@ -16,10 +16,16 @@\n \n         void checkCameraPermission();\n \n+        void checkReadExternalStoragePermission();\n+\n         void openCamera();\n \n+        void viewGallery();\n+\n         void requestPermission();\n \n+        void requestReadExternalStoragePermission();\n+\n         void showScanUploadedSuccessfully();\n \n         void showProgressDialog();"
  },
  {
    "sha": "adaa50011fccf16d67883921c0ceef6832b503f3",
    "filename": "app/src/main/res/layout/bottom_sheet_upload_identification_scan_card.xml",
    "status": "modified",
    "additions": 30,
    "deletions": 13,
    "changes": 43,
    "blob_url": "https://github.com/apache/fineract-cn-mobile/blob/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/layout/bottom_sheet_upload_identification_scan_card.xml",
    "raw_url": "https://github.com/apache/fineract-cn-mobile/raw/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/layout/bottom_sheet_upload_identification_scan_card.xml",
    "contents_url": "https://api.github.com/repos/apache/fineract-cn-mobile/contents/app/src/main/res/layout/bottom_sheet_upload_identification_scan_card.xml?ref=3437feaa2029ce29f73d88bac0f014b6ec9d4f67",
    "patch": "@@ -75,18 +75,16 @@\n                     android:gravity=\"center\"\n                     android:layout_height=\"match_parent\"\n                     android:layout_width=\"match_parent\"\n-                    android:orientation=\"horizontal\"\n+                    android:orientation=\"vertical\"\n                     android:paddingLeft=\"@dimen/layout_padding_24dp\"\n                     android:paddingRight=\"@dimen/layout_padding_24dp\"\n-                    android:paddingTop=\"@dimen/layout_padding_16dp\"\n-                    android:weightSum=\"1\">\n+                    android:paddingTop=\"@dimen/layout_padding_16dp\">\n \n                     <com.google.android.material.textfield.TextInputLayout\n                         android:id=\"@+id/til_selected_file\"\n                         android:gravity=\"center\"\n                         android:layout_height=\"wrap_content\"\n-                        android:layout_weight=\".7\"\n-                        android:layout_width=\"wrap_content\"\n+                        android:layout_width=\"match_parent\"\n                         android:paddingEnd=\"@dimen/layout_padding_8dp\"\n                         android:paddingLeft=\"0dp\"\n                         android:paddingRight=\"@dimen/layout_padding_8dp\"\n@@ -103,15 +101,34 @@\n                             android:scrollbars=\"vertical\"/>\n                     </com.google.android.material.textfield.TextInputLayout>\n \n-                    <Button\n-                        android:drawableLeft=\"@drawable/ic_folder_black_24dp\"\n-                        android:drawableStart=\"@drawable/ic_folder_black_24dp\"\n-                        android:id=\"@+id/btn_browse_document\"\n+                    <LinearLayout\n+                        android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n-                        android:layout_weight=\".3\"\n-                        android:layout_width=\"wrap_content\"\n-                        android:text=\"@string/browse\"\n-                        android:textAllCaps=\"true\"/>\n+                        android:orientation=\"horizontal\"\n+                        android:weightSum=\"1\"\n+                        android:gravity=\"center\">\n+\n+                        <Button\n+                            android:drawableLeft=\"@drawable/ic_folder_black_24dp\"\n+                            android:drawableStart=\"@drawable/ic_folder_black_24dp\"\n+                            android:id=\"@+id/btn_browse_document\"\n+                            android:layout_height=\"wrap_content\"\n+                            android:layout_weight=\".3\"\n+                            android:layout_width=\"wrap_content\"\n+                            android:text=\"@string/browse\"\n+                            android:textAllCaps=\"true\"/>\n+\n+                        <Button\n+                            android:drawableLeft=\"@drawable/ic_camera_enhance_black_24dp\"\n+                            android:drawableStart=\"@drawable/ic_camera_enhance_black_24dp\"\n+                            android:drawableTint=\"@color/white\"\n+                            android:id=\"@+id/btn_take_photo\"\n+                            android:layout_height=\"wrap_content\"\n+                            android:layout_weight=\".3\"\n+                            android:layout_width=\"wrap_content\"\n+                            android:text=\"@string/take_photo_for_btn\"\n+                            android:textAllCaps=\"true\"/>\n+                    </LinearLayout>\n \n                 </LinearLayout>\n "
  },
  {
    "sha": "fb0c9c2c5637d856b02483af5d6ef19a2db51fce",
    "filename": "app/src/main/res/values-ml-rIN/strings.xml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/apache/fineract-cn-mobile/blob/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/values-ml-rIN/strings.xml",
    "raw_url": "https://github.com/apache/fineract-cn-mobile/raw/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/values-ml-rIN/strings.xml",
    "contents_url": "https://api.github.com/repos/apache/fineract-cn-mobile/contents/app/src/main/res/values-ml-rIN/strings.xml?ref=3437feaa2029ce29f73d88bac0f014b6ec9d4f67",
    "patch": "@@ -101,6 +101,7 @@\n     <string name=\"debt_income\">കടം വരുമാനം</string>\n     <string name=\"name\">പേര്</string>\n     <string name=\"browse\">ബ്രൌസ് ചെയ്യുക...</string>\n+    <string name=\"take_photo_for_btn\">ഫോട്ടോ എടുക്കുക</string>\n     <string name=\"fetching_customer_please_wait\">ഉപഭോക്താവിനെ ലഭ്യമാക്കൽ ദയവായി കാത്തിരിക്കുക ...</string>\n     <string name=\"creating_loan_please_wait\">വായ്പ സൃഷ്ടിക്കുന്നു കാത്തിരിക്കൂ…</string>\n     <string name=\"updating_customer_please_wait\">ഉപഭോക്താവിനെ അപ്ഡേറ്റുചെയ്യുന്നത് ദയവായി കാത്തിരിക്കുക ...</string>"
  },
  {
    "sha": "246a4216ce9c53253c5ea7fd41cb3c7cf0580178",
    "filename": "app/src/main/res/values/strings.xml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/apache/fineract-cn-mobile/blob/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/values/strings.xml",
    "raw_url": "https://github.com/apache/fineract-cn-mobile/raw/3437feaa2029ce29f73d88bac0f014b6ec9d4f67/app/src/main/res/values/strings.xml",
    "contents_url": "https://api.github.com/repos/apache/fineract-cn-mobile/contents/app/src/main/res/values/strings.xml?ref=3437feaa2029ce29f73d88bac0f014b6ec9d4f67",
    "patch": "@@ -110,6 +110,7 @@\n     <string name=\"debt_income\">Debt Income</string>\n     <string name=\"name\">Name</string>\n     <string name=\"browse\">Browse…</string>\n+    <string name=\"take_photo_for_btn\">Take Photo</string>\n     <string name=\"fetching_customer_please_wait\">Fetching customer please wait…</string>\n     <string name=\"creating_loan_please_wait\">Creating loan please wait…</string>\n     <string name=\"updating_customer_please_wait\">Updating customer please wait…</string>"
  }
]
