[
  {
    "sha": "77edb2508d0bae7a95d683bf73c854065e07d29c",
    "filename": ".github/workflows/ci.yml",
    "status": "added",
    "additions": 51,
    "deletions": 0,
    "changes": 51,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/.github/workflows/ci.yml",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/.github/workflows/ci.yml",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/.github/workflows/ci.yml?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -0,0 +1,51 @@\n+#\n+# CI build that assembles artifacts and runs tests.\n+# If validation is successful this workflow releases from the main dev branch.\n+#\n+# - skipping CI: add [skip ci] to the commit message\n+# - skipping release: add [skip release] to the commit message\n+#\n+name: CI\n+\n+on:\n+  push:\n+    branches: ['master']\n+    tags-ignore: [v*] # release tags are autogenerated after a successful CI, no need to run CI against them\n+  pull_request:\n+    branches: ['**']\n+\n+jobs:\n+\n+  build:\n+    runs-on: ubuntu-latest\n+    if: \"! contains(toJSON(github.event.commits.*.message), '[skip ci]')\"\n+\n+    steps:\n+\n+      - name: 1. Check out code\n+        uses: actions/checkout@v2 # https://github.com/actions/checkout\n+        with:\n+          fetch-depth: '0' # https://github.com/shipkit/shipkit-changelog#fetch-depth-on-ci\n+\n+      - name: 2. Set up Java\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+\n+      - name: 3. Perform build\n+        run: ./gradlew build\n+\n+      - name: 4. Perform release\n+        # Release job, only for pushes to the main development branch\n+        if: github.event_name == 'push'\n+          && github.ref == 'refs/heads/master'\n+          && github.repository == 'linkedin/coral'\n+          && !contains(toJSON(github.event.commits.*.message), '[skip release]')\n+\n+        run: ./gradlew githubRelease publishToSonatype closeAndReleaseStagingRepository\n+        env:\n+          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}\n+          SONATYPE_USER: ${{secrets.SONATYPE_USER}}\n+          SONATYPE_PWD: ${{secrets.SONATYPE_PWD}}\n+          PGP_KEY: ${{secrets.PGP_KEY}}\n+          PGP_PWD: ${{secrets.PGP_PWD}}\n\\ No newline at end of file"
  },
  {
    "sha": "558181f3bad59858882625992acddad48344a865",
    "filename": ".travis.yml",
    "status": "modified",
    "additions": 8,
    "deletions": 3,
    "changes": 11,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/.travis.yml",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/.travis.yml",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/.travis.yml?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -23,9 +23,14 @@ branches:\n \n #Build and perform release (if needed)\n script:\n-  # Print output every minute to avoid travis timeout\n+\n+  # 1. Print output every minute to avoid travis timeout\n   - while sleep 1m; do echo \"=====[ $SECONDS seconds elapsed -- still running ]=====\"; done &\n-  - ./gradlew build -s && ./gradlew ciPerformRelease -s\n-  # Killing background sleep loop\n+\n+  # 2. Run build (we're moving to GH Actions, this is just to compare build times Travis vs. GH Actions\n+  - >\n+    ./gradlew build\n+\n+  # 3. Killing background sleep loop\n   - kill %1\n "
  },
  {
    "sha": "755111ed93029d2c05352383090eadfda65a355c",
    "filename": "build.gradle",
    "status": "modified",
    "additions": 16,
    "deletions": 1,
    "changes": 17,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -2,12 +2,27 @@\n // Licensed under the BSD-2 Clause license.\n // See LICENSE in the project root for license information.\n \n+buildscript {\n+  repositories {\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+  dependencies {\n+    classpath \"io.github.gradle-nexus:publish-plugin:1.0.0\"\n+    classpath \"org.shipkit:shipkit-auto-version:1.1.1\"\n+    classpath \"org.shipkit:shipkit-changelog:1.1.10\"\n+  }\n+}\n+\n plugins {\n   id \"com.diffplug.spotless\" version \"5.8.2\"\n   id 'com.github.johnrengelman.shadow' version '5.2.0'\n-  id \"org.shipkit.java\" version \"2.3.4\"\n }\n \n+apply from: \"gradle/shipkit.gradle\"\n+\n configurations {\n   provided\n }"
  },
  {
    "sha": "37935f96a52b45e5890b757758afa1e88c10178d",
    "filename": "coral-hive/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-hive/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-hive/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-hive/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,4 +1,4 @@\n-apply plugin: 'java'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n apply plugin: 'antlr'\n \n dependencies {"
  },
  {
    "sha": "2bb29b9a7bc6c567394a24d33a487cce1ffc603f",
    "filename": "coral-pig/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-pig/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-pig/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-pig/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,5 +1,4 @@\n-apply plugin: 'java'\n-apply plugin: 'maven-publish'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n \n dependencies {\n   compile deps.'javax-annotation'"
  },
  {
    "sha": "832acb8fb3d33b0c6fda9ead57cb35f85a39d5dd",
    "filename": "coral-presto/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-presto/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-presto/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-presto/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,4 +1,4 @@\n-apply plugin: 'java'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n \n dependencies {\n   compile deps.'gson'"
  },
  {
    "sha": "38956ed2981ff8f82a62f507ce51b15aeccd6e66",
    "filename": "coral-schema/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-schema/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-schema/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-schema/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,5 +1,4 @@\n-apply plugin: 'java'\n-apply plugin: 'maven-publish'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n \n dependencies {\n   compile deps.'slf4j-api'"
  },
  {
    "sha": "7118269f0b2bbe5ed7b70e3f4953fddb96a496f0",
    "filename": "coral-spark-plan/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-spark-plan/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-spark-plan/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-spark-plan/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,5 +1,4 @@\n-apply plugin:'java'\n-apply plugin: 'maven-publish'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n \n dependencies {\n   compile deps.'gson'"
  },
  {
    "sha": "8eaacd20ea6cc383a4f5ab3c57296e1cd79947d4",
    "filename": "coral-spark/build.gradle",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/coral-spark/build.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/coral-spark/build.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/coral-spark/build.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,5 +1,4 @@\n-apply plugin: 'java'\n-apply plugin: 'maven-publish'\n+apply from: \"$rootDir/gradle/java-publication.gradle\"\n \n dependencies {\n   compile deps.'gson'"
  },
  {
    "sha": "fa40e24824558e779d4222448596dd71ed969d51",
    "filename": "gradle/java-publication.gradle",
    "status": "added",
    "additions": 96,
    "deletions": 0,
    "changes": 96,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/gradle/java-publication.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/gradle/java-publication.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/gradle/java-publication.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -0,0 +1,96 @@\n+apply plugin: \"java\"\n+\n+def licenseSpec = copySpec {\n+  from project.rootDir\n+  include \"LICENSE\"\n+}\n+\n+task sourcesJar(type: Jar, dependsOn: classes) {\n+  classifier 'sources'\n+  from sourceSets.main.allSource\n+  with licenseSpec\n+}\n+\n+task javadocJar(type: Jar, dependsOn: javadoc) {\n+  classifier 'javadoc'\n+  from tasks.javadoc\n+  with licenseSpec\n+}\n+\n+jar {\n+  with licenseSpec\n+}\n+\n+artifacts {\n+  archives sourcesJar\n+  archives javadocJar\n+}\n+\n+apply plugin: \"maven-publish\" //https://docs.gradle.org/current/userguide/publishing_maven.html\n+publishing {\n+  publications {\n+    javaLibrary(MavenPublication) {\n+      from components.java\n+      artifact sourcesJar\n+      artifact javadocJar\n+\n+      artifactId = project.archivesBaseName\n+\n+      pom {\n+        name = artifactId\n+        description = \"A library for analyzing, processing, and rewriting views defined in the Hive Metastore, and sharing them across multiple execution engines\"\n+\n+        url = \"https://github.com/linkedin/coral\"\n+        licenses {\n+          license {\n+            name = 'The MIT License'\n+            url = 'https://github.com/linkedin/coral/blob/master/LICENSE'\n+            distribution = 'repo'\n+          }\n+        }\n+        developers {\n+          [\n+            'wmoustafa:Walaa Eldin Moustafa',\n+            'khaitranq:Khai Tranh',\n+            'funcheetah:Wenye Zhang',\n+            'shardulm94:Shardul Mahadik',\n+            'hotsushi:Sushant Raikar'\n+          ].each { devData ->\n+            developer {\n+              def devInfo = devData.split(':')\n+              id = devInfo[0]\n+              name = devInfo[1]\n+              url = 'https://github.com/' + devInfo[0]\n+              roles = [\"Core developer\"]\n+            }\n+          }\n+        }\n+        scm {\n+          url = 'https://github.com/linkedin/coral.git'\n+        }\n+        issueManagement {\n+          url = 'https://github.com/linkedin/coral/issues'\n+          system = 'GitHub issues'\n+        }\n+        ciManagement {\n+          url = 'https://travis-ci.com/linkedin/coral'\n+          system = 'Travis CI'\n+        }\n+      }\n+    }\n+  }\n+\n+  //useful for testing - running \"publish\" will create artifacts/pom in a local dir\n+  repositories { maven { url = \"$rootProject.buildDir/repo\" } }\n+}\n+\n+//fleshes out problems with Maven pom generation when building\n+tasks.build.dependsOn(\"publishJavaLibraryPublicationToMavenLocal\")\n+\n+apply plugin: 'signing' //https://docs.gradle.org/current/userguide/signing_plugin.html\n+signing {\n+  if (System.getenv(\"PGP_KEY\")) {\n+    useInMemoryPgpKeys(System.getenv(\"PGP_KEY\"), System.getenv(\"PGP_PWD\"))\n+    sign publishing.publications.javaLibrary\n+  }\n+}"
  },
  {
    "sha": "05c5c28d32d250be387ad5ded5b5455004b44a26",
    "filename": "gradle/shipkit.gradle",
    "status": "modified",
    "additions": 23,
    "deletions": 42,
    "changes": 65,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/gradle/shipkit.gradle",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/gradle/shipkit.gradle",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/gradle/shipkit.gradle?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,50 +1,31 @@\n-shipkit {\n-  gitHub.repository = \"linkedin/coral\"\n+//Plugin jars are added to the buildscript classpath in the root build.gradle file\n+apply plugin: \"org.shipkit.shipkit-auto-version\" //https://github.com/shipkit/shipkit-auto-version\n \n-  gitHub.readOnlyAuthToken = \"967ad570c37790a939\" + \"366590ca3035ed56b8d2ae\"\n-\n-  // The GitHub write token is required for committing release notes and bumping up project version\n-  // Ensure that the release machine or Travis CI has this env variable exported\n-  gitHub.writeAuthToken = System.getenv(\"GH_WRITE_TOKEN\")\n-\n-  git.releasableBranchRegex = \"master|release/.+\"\n-\n-  team.developers = [\n-    'wmoustafa:Walaa Eldin Moustafa',\n-    'khaitranq:Khai Tranh',\n-    'funcheetah:Wenye Zhang',\n-    'shardulm94:Shardul Mahadik',\n-    'hotsushi:Sushant Raikar'\n-  ]\n+apply plugin: \"org.shipkit.shipkit-changelog\" //https://github.com/shipkit/shipkit-changelog\n+tasks.named(\"generateChangelog\") {\n+  previousRevision = project.ext.'shipkit-auto-version.previous-tag'\n+  githubToken = System.getenv(\"GITHUB_TOKEN\")\n+  repository = \"linkedin/coral\"\n }\n \n-allprojects {\n-  plugins.withId(\"org.shipkit.bintray\") {\n+apply plugin: \"org.shipkit.shipkit-github-release\" //https://github.com/shipkit/shipkit-changelog\n+tasks.named(\"githubRelease\") {\n+  def genTask = tasks.named(\"generateChangelog\").get()\n+  dependsOn genTask\n+  repository = genTask.repository\n+  changelog = genTask.outputFile\n+  githubToken = System.getenv(\"GITHUB_TOKEN\")\n+  newTagRevision = System.getenv(\"GITHUB_SHA\")\n+}\n \n-    //Bintray configuration is handled by JFrog Bintray Gradle Plugin\n-    //For reference see the official documentation: https://github.com/bintray/gradle-bintray-plugin\n-    bintray {\n-      // The Bintray API token is required to publish artifacts to Bintray\n-      // Ensure that the release machine or Travis CI has this env variable exported\n-      key = System.getenv(\"BINTRAY_API_KEY\")\n-      pkg {\n-        repo = 'maven'\n-        user = 'lnkd-apa'\n-        userOrg = 'linkedin'\n-        name = 'coral'\n-        licenses = ['BSD 2-Clause']\n-        labels = [\n-          'coral',\n-          'sql',\n-          'presto',\n-          'spark',\n-          'hive',\n-          'views'\n-        ]\n-        vcsUrl = \"https://github.com/linkedin/coral.git\"\n-        description = \"A library for analyzing, processing, and rewriting views defined in the Hive Metastore, and sharing them across multiple execution engines\"\n+apply plugin: \"io.github.gradle-nexus.publish-plugin\" //https://github.com/gradle-nexus/publish-plugin/\n+nexusPublishing {\n+  repositories {\n+    if (System.getenv(\"SONATYPE_PWD\")) {\n+      sonatype {\n+        username = System.getenv(\"SONATYPE_USER\")\n+        password = System.getenv(\"SONATYPE_PWD\")\n       }\n-      publish = true\n     }\n   }\n }"
  },
  {
    "sha": "7876fce2380de133fd752877386ea8bfff73af5c",
    "filename": "version.properties",
    "status": "modified",
    "additions": 3,
    "deletions": 4,
    "changes": 7,
    "blob_url": "https://github.com/linkedin/coral/blob/533dedc7972dead7706b4480c9ad637eb1041022/version.properties",
    "raw_url": "https://github.com/linkedin/coral/raw/533dedc7972dead7706b4480c9ad637eb1041022/version.properties",
    "contents_url": "https://api.github.com/repos/linkedin/coral/contents/version.properties?ref=533dedc7972dead7706b4480c9ad637eb1041022",
    "patch": "@@ -1,4 +1,3 @@\n-#Version of the produced binaries. This file is intended to be checked-in.\n-#It will be automatically bumped by release automation.\n-version=1.0.28\n-previousVersion=1.0.27\n+# Version of the produced binaries.\n+# The version is inferred by shipkit-auto-version Gradle plugin (https://github.com/shipkit/shipkit-auto-version)\n+version=1.0.*\n\\ No newline at end of file"
  }
]
