[
  {
    "sha": "f5658ceeb12b85bdcdc2780429271f67404d611b",
    "filename": "app/src/main/java/de/wikilab/android/ldapsync/client/Contact.java",
    "status": "modified",
    "additions": 12,
    "deletions": 12,
    "changes": 24,
    "blob_url": "https://github.com/tjmcomp/LDAP-Sync/blob/16cb7181b3bcce2e7515973d5d47060e9ae34891/app/src/main/java/de/wikilab/android/ldapsync/client/Contact.java",
    "raw_url": "https://github.com/tjmcomp/LDAP-Sync/raw/16cb7181b3bcce2e7515973d5d47060e9ae34891/app/src/main/java/de/wikilab/android/ldapsync/client/Contact.java",
    "contents_url": "https://api.github.com/repos/tjmcomp/LDAP-Sync/contents/app/src/main/java/de/wikilab/android/ldapsync/client/Contact.java?ref=16cb7181b3bcce2e7515973d5d47060e9ae34891",
    "patch": "@@ -127,14 +127,14 @@ public static Contact valueOf(ReadOnlyEntry user, SharedPreferences preferences)\n \t\tContact c = new Contact();\n \t\ttry {\n \t\t\tc.setDn(user.getDN());\n-\t\t\tc.setFirstName(getAttributevalue(user, preferences, \"first_name\"));\n-\t\t\tc.setLastName(getAttributevalue(user, preferences, \"last_name\"));\n-\t\t\tif (getAttributevalue(user, preferences, \"last_name\") == null || getAttributevalue(user, preferences, \"first_name\") == null) {\n+\t\t\tc.setFirstName(getAttributeValue(user, preferences, \"first_name\"));\n+\t\t\tc.setLastName(getAttributeValue(user, preferences, \"last_name\"));\n+\t\t\tif (getAttributeValue(user, preferences, \"last_name\") == null || getAttributeValue(user, preferences, \"first_name\") == null) {\n \t\t\t\treturn null;\n \t\t\t}\n-\t\t\tc.setWorkPhone(getAttributevalue(user, preferences, \"office_phone\"));\n-\t\t\tc.setCellWorkPhone(getAttributevalue(user, preferences, \"cell_phone\"));\n-\t\t\tc.setHomePhone(getAttributevalue(user, preferences, \"home_phone\"));\n+\t\t\tc.setWorkPhone(getAttributeValue(user, preferences, \"office_phone\"));\n+\t\t\tc.setCellWorkPhone(getAttributeValue(user, preferences, \"cell_phone\"));\n+\t\t\tc.setHomePhone(getAttributeValue(user, preferences, \"home_phone\"));\n \t\t\tc.setEmails(\n                     user.hasAttribute(preferences.getString(\"email\", \"\"))\n                             ? user.getAttributeValues(preferences.getString(\"email\", \"\"))\n@@ -163,11 +163,11 @@ public static Contact valueOf(ReadOnlyEntry user, SharedPreferences preferences)\n \t\t\t\t\t|| user.hasAttribute(preferences.getString(\"state\", \"\")) || user.hasAttribute(preferences.getString(\"postalCode\", \"\"))\n \t\t\t\t\t|| user.hasAttribute(preferences.getString(\"country\", \"\"))) {\n \t\t\t\tAddress a = new Address();\n-\t\t\t\ta.setStreet(getAttributevalue(user, preferences, \"street\"));\n-\t\t\t\ta.setCity(getAttributevalue(user, preferences, \"city\"));\n-\t\t\t\ta.setState(getAttributevalue(user, preferences, \"state\"));\n-\t\t\t\ta.setZip(getAttributevalue(user, preferences, \"postalCode\"));\n-\t\t\t\ta.setCountry(getAttributevalue(user, preferences, \"country\"));\n+\t\t\t\ta.setStreet(getAttributeValue(user, preferences, \"street\"));\n+\t\t\t\ta.setCity(getAttributeValue(user, preferences, \"city\"));\n+\t\t\t\ta.setState(getAttributeValue(user, preferences, \"state\"));\n+\t\t\t\ta.setZip(getAttributeValue(user, preferences, \"postalCode\"));\n+\t\t\t\ta.setCountry(getAttributeValue(user, preferences, \"country\"));\n \t\t\t\tc.setAddress(a);\n \t\t\t}\n \t\t} catch (final Exception ex) {\n@@ -176,7 +176,7 @@ public static Contact valueOf(ReadOnlyEntry user, SharedPreferences preferences)\n \t\treturn c;\n \t}\n \n-\tprivate static String getAttributevalue(ReadOnlyEntry user, SharedPreferences preferences, String field) {\n+\tprivate static String getAttributeValue(ReadOnlyEntry user, SharedPreferences preferences, String field) {\n \t\treturn user.hasAttribute(preferences.getString(field, \"\")) ? user.getAttributeValue(preferences.getString(field, \"\")) : null;\n \t}\n }"
  },
  {
    "sha": "90ad2070b0366ffbfeed997552e77efe70e2ee35",
    "filename": "app/src/main/java/de/wikilab/android/ldapsync/client/LDAPUtilities.java",
    "status": "modified",
    "additions": 31,
    "deletions": 8,
    "changes": 39,
    "blob_url": "https://github.com/tjmcomp/LDAP-Sync/blob/16cb7181b3bcce2e7515973d5d47060e9ae34891/app/src/main/java/de/wikilab/android/ldapsync/client/LDAPUtilities.java",
    "raw_url": "https://github.com/tjmcomp/LDAP-Sync/raw/16cb7181b3bcce2e7515973d5d47060e9ae34891/app/src/main/java/de/wikilab/android/ldapsync/client/LDAPUtilities.java",
    "contents_url": "https://api.github.com/repos/tjmcomp/LDAP-Sync/contents/app/src/main/java/de/wikilab/android/ldapsync/client/LDAPUtilities.java?ref=16cb7181b3bcce2e7515973d5d47060e9ae34891",
    "patch": "@@ -31,12 +31,16 @@\n import android.text.TextUtils;\n import android.util.Log;\n \n+import com.unboundid.asn1.ASN1OctetString;\n import com.unboundid.ldap.sdk.LDAPConnection;\n import com.unboundid.ldap.sdk.LDAPException;\n+import com.unboundid.ldap.sdk.LDAPSearchException;\n import com.unboundid.ldap.sdk.RootDSE;\n+import com.unboundid.ldap.sdk.SearchRequest;\n import com.unboundid.ldap.sdk.SearchResult;\n import com.unboundid.ldap.sdk.SearchResultEntry;\n import com.unboundid.ldap.sdk.SearchScope;\n+import com.unboundid.ldap.sdk.controls.SimplePagedResultsControl;\n \n import de.wikilab.android.ldapsync.R;\n import de.wikilab.android.ldapsync.activity.SyncErrorActivity;\n@@ -119,15 +123,35 @@ public void run() {\n \t\tLDAPConnection connection = null;\n \t\ttry {\n \t\t\tconnection = ldapServer.getConnection();\n-\t\t\tSearchResult searchResult = connection.search(baseDN, SearchScope.SUB, searchFilter, getUsedAttributes(preferences));\n-\t\t\tLog.i(TAG, searchResult.getEntryCount() + \" entries returned.\");\n-\n-\t\t\tfor (SearchResultEntry e : searchResult.getSearchEntries()) {\n-\t\t\t\tContact u = Contact.valueOf(e, preferences);\n-\t\t\t\tif (u != null) {\n-\t\t\t\t\tfriendList.add(u);\n+\t\t\tSearchRequest searchRequest = new SearchRequest(baseDN, SearchScope.SUB, searchFilter, getUsedAttributes(preferences));\n+\t\t\tASN1OctetString resumeCookie = null;\n+\t\t\tint numSearches = 0;\n+\t\t\tint numEntries = 0;\n+\t\t\twhile (true) {\n+\t\t\t\tsearchRequest.setControls(new SimplePagedResultsControl(500, resumeCookie));\n+\t\t\t\tSearchResult searchResult = connection.search(searchRequest);\n+\t\t\t\tnumSearches++;\n+\t\t\t\tnumEntries += searchResult.getEntryCount();\n+\t\t\t\tfor (SearchResultEntry e : searchResult.getSearchEntries()) {\n+\t\t\t\t\tContact u = Contact.valueOf(e, preferences);\n+\t\t\t\t\tif (u != null) {\n+\t\t\t\t\t\tfriendList.add(u);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tSimplePagedResultsControl responseControl = SimplePagedResultsControl.get(searchResult);\n+\t\t\t\tif (responseControl.moreResultsToReturn()) {\n+\t\t\t\t\tresumeCookie = responseControl.getCookie();\n+\t\t\t\t} else {\n+\t\t\t\t\tbreak;\n \t\t\t\t}\n \t\t\t}\n+\t\t\tLog.i(TAG, numEntries + \" entries returned from \" + numSearches + \" result loops\");\n+\n+\t\t\treturn friendList;\n+\t\t} catch (LDAPSearchException se) {\n+\t\t\tLog.v(TAG, \"LDAPSearchException on fetching contacts\", se);\n+\t\t\tshowErrorNotification(context, se);\n+\t\t\treturn null;\n \t\t} catch (LDAPException e) {\n \t\t\tLog.v(TAG, \"LDAPException on fetching contacts\", e);\n \t\t\tshowErrorNotification(context, e);\n@@ -138,7 +162,6 @@ public void run() {\n \t\t\t}\n \t\t}\n \n-\t\treturn friendList;\n \t}\n \n \tprivate static void showErrorNotification(Context context, Throwable e) {"
  }
]
