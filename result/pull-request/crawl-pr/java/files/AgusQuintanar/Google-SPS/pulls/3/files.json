[
  {
    "sha": "c5f3f6b9c754225a4c577122bc2f9c0b49713e3c",
    "filename": ".theia/settings.json",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/.theia/settings.json",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/.theia/settings.json",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/.theia/settings.json?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -0,0 +1,3 @@\n+{\n+    \"java.configuration.updateBuildConfiguration\": \"interactive\"\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "c5f3f6b9c754225a4c577122bc2f9c0b49713e3c",
    "filename": ".vscode/settings.json",
    "status": "added",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/.vscode/settings.json",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/.vscode/settings.json",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/.vscode/settings.json?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -0,0 +1,3 @@\n+{\n+    \"java.configuration.updateBuildConfiguration\": \"interactive\"\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "4ceded045af135c80908d71ae5ed9323bb7a8410",
    "filename": "portfolio/pom.xml",
    "status": "modified",
    "additions": 19,
    "deletions": 3,
    "changes": 22,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/pom.xml",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/pom.xml",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/pom.xml?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -27,6 +27,13 @@\n       <version>4.0.1</version>\n     </dependency>\n \n+    <!-- Data Store -->\n+    <dependency>\n+      <groupId>com.google.cloud</groupId>\n+      <artifactId>google-cloud-datastore</artifactId>\n+      <version>1.104.0</version>\n+    </dependency>\n+\n     <!-- Jetty -->\n     <dependency>\n       <groupId>org.eclipse.jetty</groupId>\n@@ -39,14 +46,23 @@\n       <version>${jetty.version}</version>\n     </dependency>\n \n+        <!-- jsoup -->\n+    <dependency>\n+      <groupId>org.jsoup</groupId>\n+      <artifactId>jsoup</artifactId>\n+      <version>1.8.3</version>\n+    </dependency>\n \n+    <!-- Gson -->\n     <dependency>\n-        <groupId>com.google.code.gson</groupId>\n-        <artifactId>gson</artifactId>\n-        <version>2.8.6</version>\n+      <groupId>com.google.code.gson</groupId>\n+      <artifactId>gson</artifactId>\n+      <version>2.8.6</version>\n     </dependency>\n   </dependencies>\n \n+\n+\n   <build>\n     <plugins>\n       <!-- Copy static resources like html files into the output jar file. -->"
  },
  {
    "sha": "2ea5cd46ff7fcf781fe155ebcd64be0ffbaba047",
    "filename": "portfolio/src/main/java/com/google/sps/data/Message.class",
    "status": "added",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/data/Message.class",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/data/Message.class",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/java/com/google/sps/data/Message.class?ref=7fee08020ba13937ce12d1ba8aff013309577e21"
  },
  {
    "sha": "2684a92ea65b490f99230a07c81ddbe51452a06c",
    "filename": "portfolio/src/main/java/com/google/sps/data/Message.java",
    "status": "added",
    "additions": 18,
    "deletions": 0,
    "changes": 18,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/data/Message.java",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/data/Message.java",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/java/com/google/sps/data/Message.java?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -0,0 +1,18 @@\n+package com.google.sps.data;\n+\n+/** An item on a message list. */\n+public final class Message {\n+\n+  private final long id;\n+  private final String  name, \n+                        email,\n+                        message;\n+\n+\n+  public Message(long id, String name, String email, String message) {\n+    this.id = id;\n+    this.name = name;\n+    this.email = email;\n+    this.message = message;\n+  }\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "c4f3f4ab044d9aed421d2277d9ce16542e16b232",
    "filename": "portfolio/src/main/java/com/google/sps/servlets/FormHandlerServlet.java",
    "status": "modified",
    "additions": 26,
    "deletions": 6,
    "changes": 32,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/servlets/FormHandlerServlet.java",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/servlets/FormHandlerServlet.java",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/java/com/google/sps/servlets/FormHandlerServlet.java?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -6,23 +6,43 @@\n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n \n+import com.google.cloud.datastore.Datastore;\n+import com.google.cloud.datastore.DatastoreOptions;\n+import com.google.cloud.datastore.Entity;\n+import com.google.cloud.datastore.FullEntity;\n+import com.google.cloud.datastore.KeyFactory;\n+import org.jsoup.Jsoup;\n+import org.jsoup.safety.Whitelist;\n+\n @WebServlet(\"/form-handler\")\n public class FormHandlerServlet extends HttpServlet {\n \n     @Override\n     public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {\n \n-        // Get the value entered in the form.\n-        String  name = request.getParameter(\"name-input\"), \n-                email = request.getParameter(\"email-input\"),\n-                message = request.getParameter(\"message-input\");\n+        // Get the values entered in the form and clean it with jsoup.\n+        String  name = Jsoup.clean(request.getParameter(\"name-input\"), Whitelist.none()), \n+                email = Jsoup.clean(request.getParameter(\"email-input\"), Whitelist.none()),\n+                message = Jsoup.clean(request.getParameter(\"message-input\"), Whitelist.none());\n \n         // Print the value so you can see it in the server logs.\n         System.out.println(\"You submitted: Name: \" + name + \" | Email: \" + email + \" | Message: \" + message);\n \n         // Write the value to the response so the user can see it.\n         response.getWriter().println(\"You submitted: Name: \" + name + \" | Email: \" + email + \" | Message: \" + message);\n \n-        response.sendRedirect(\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\");\n+        // Store the entered values in the database\n+        Datastore datastore = DatastoreOptions.getDefaultInstance().getService();\n+        KeyFactory keyFactory = datastore.newKeyFactory().setKind(\"Contact\");\n+        FullEntity contactEntity = Entity.newBuilder(keyFactory.newKey())\n+                        .set(\"name\", name)\n+                        .set(\"email\", email)\n+                        .set(\"message\", message)\n+                    .build();\n+        datastore.put(contactEntity);\n+\n+        response.sendRedirect(\"/receivedMessages.html\");\n+        //response.sendRedirect(\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\");\n     }\n-}\n\\ No newline at end of file\n+}\n+"
  },
  {
    "sha": "51965c5f218006c06acc51741d6b0d01dc4c6559",
    "filename": "portfolio/src/main/java/com/google/sps/servlets/GetMessages.java",
    "status": "added",
    "additions": 52,
    "deletions": 0,
    "changes": 52,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/servlets/GetMessages.java",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/java/com/google/sps/servlets/GetMessages.java",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/java/com/google/sps/servlets/GetMessages.java?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -0,0 +1,52 @@\n+package com.google.sps.servlets;\n+import com.google.cloud.datastore.Datastore;\n+import com.google.cloud.datastore.DatastoreOptions;\n+import com.google.cloud.datastore.Entity;\n+import com.google.cloud.datastore.Query;\n+import com.google.cloud.datastore.QueryResults;\n+import com.google.cloud.datastore.StructuredQuery.OrderBy;\n+import com.google.gson.Gson;\n+import com.google.sps.data.Message;\n+\n+import java.io.Console;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.servlet.annotation.WebServlet;\n+import javax.servlet.http.HttpServlet;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+/** Servlet responsible for listing tasks. */\n+@WebServlet(\"/getMessagesList\")\n+public class GetMessages extends HttpServlet {\n+\n+  @Override\n+  public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {\n+    Datastore datastore = DatastoreOptions.getDefaultInstance().getService();\n+    Query<Entity> query =\n+            Query.newEntityQueryBuilder().setKind(\"Contact\").setOrderBy(OrderBy.desc(\"__key__\")).build();\n+    QueryResults<Entity> results = datastore.run(query);\n+\n+    List<Message> messages = new ArrayList<>();\n+    while (results.hasNext()) {\n+      Entity entity = results.next();\n+\n+\n+        long id = entity.getKey().getId();\n+        String      name = entity.getString(\"name\"),\n+                    email = entity.getString(\"email\"),\n+                    message = entity.getString(\"message\");\n+      \n+\n+\n+      Message msg = new Message(id, name, email, message);\n+      messages.add(msg);\n+    }\n+\n+    Gson gson = new Gson();\n+\n+    response.setContentType(\"application/json;\");\n+    response.getWriter().println(gson.toJson(messages));\n+  }\n+}"
  },
  {
    "sha": "f930e66c5d210ff6de2d195d06462e0a29d3bd2e",
    "filename": "portfolio/src/main/webapp/receivedMessages.html",
    "status": "added",
    "additions": 25,
    "deletions": 0,
    "changes": 25,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/webapp/receivedMessages.html",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/webapp/receivedMessages.html",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/webapp/receivedMessages.html?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -0,0 +1,25 @@\n+<!DOCTYPE html>\n+<html>\n+\n+<head>\n+    <meta charset=\"UTF-8\">\n+    <title>Messages received</title>\n+    <link rel=\"stylesheet\" href=\"style.css\">\n+    <script src=\"script.js\"></script>\n+</head>\n+\n+<body onload=\"loadMessages();\">\n+    <h1>Received messages</h1>\n+\n+    <table id=\"messages\" style=\"width:100%\">\n+        <tr>\n+            <th>Name</th>\n+            <th>Email</th>\n+            <th>Message</th>\n+        </tr>\n+    </table>\n+\n+\n+</body>\n+\n+</html>\n\\ No newline at end of file"
  },
  {
    "sha": "9ebebe8e064d0f94cc6e8c05edb8002c063b0c49",
    "filename": "portfolio/src/main/webapp/script.js",
    "status": "modified",
    "additions": 32,
    "deletions": 0,
    "changes": 32,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/webapp/script.js",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/portfolio/src/main/webapp/script.js",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/portfolio/src/main/webapp/script.js?ref=7fee08020ba13937ce12d1ba8aff013309577e21",
    "patch": "@@ -9,5 +9,37 @@ async function showRandomPhrase() {\n     const phraseContainer = document.getElementById('phraseContainer');\n     phraseContainer.innerText = phrase\n \n+}\n+\n+function loadMessages() {\n+  fetch('/getMessagesList')\n+    .then(response => response.json())\n+    .then((messages) => {\n+        const messagesElement = document.getElementById('messages');\n+        messages.forEach((message) => {\n+            messagesElement.appendChild(createMessageElement(message));\n+        })\n+    });\n+}\n+\n+/** Creates an element that represents a message */\n+function createMessageElement(message) {\n+    const msgElement = document.createElement('tr');\n+    msgElement.className = 'message';\n+\n+    const nameElement = document.createElement('td');\n+    nameElement.innerText = message.name;\n+\n+    const emailElement = document.createElement('td');\n+    emailElement.innerText = message.email;\n+\n+    const messageElement = document.createElement('td');\n+    messageElement.innerText = message.message;\n+\n+    msgElement.appendChild(nameElement);\n+    msgElement.appendChild(emailElement);\n+    msgElement.appendChild(messageElement);\n \n+    \n+    return msgElement;\n }"
  },
  {
    "sha": null,
    "filename": "walkthroughs/week-3-libraries/libraries-walkthrough.md",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/AgusQuintanar/Google-SPS/blob/7fee08020ba13937ce12d1ba8aff013309577e21/walkthroughs/week-3-libraries/libraries-walkthrough.md",
    "raw_url": "https://github.com/AgusQuintanar/Google-SPS/raw/7fee08020ba13937ce12d1ba8aff013309577e21/walkthroughs/week-3-libraries/libraries-walkthrough.md",
    "contents_url": "https://api.github.com/repos/AgusQuintanar/Google-SPS/contents/walkthroughs/week-3-libraries/libraries-walkthrough.md?ref=7fee08020ba13937ce12d1ba8aff013309577e21"
  }
]
