[
  {
    "sha": "8f108fcaed92876d090167f610aeb98362e27878",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/application/domain/Application.java",
    "status": "modified",
    "additions": 22,
    "deletions": 0,
    "changes": 22,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/domain/Application.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/domain/Application.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/application/domain/Application.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -1,23 +1,32 @@\n package org.synyx.urlaubsverwaltung.application.domain;\n \n+import org.hibernate.annotations.LazyCollection;\n+import org.synyx.urlaubsverwaltung.holidayreplacement.HolidayReplacementEntity;\n import org.synyx.urlaubsverwaltung.period.DayLength;\n import org.synyx.urlaubsverwaltung.period.Period;\n import org.synyx.urlaubsverwaltung.person.Person;\n \n+import javax.persistence.CascadeType;\n+import javax.persistence.CollectionTable;\n import javax.persistence.Entity;\n import javax.persistence.Enumerated;\n+import javax.persistence.FetchType;\n import javax.persistence.GeneratedValue;\n import javax.persistence.Id;\n import javax.persistence.JoinColumn;\n import javax.persistence.ManyToOne;\n+import javax.persistence.OneToMany;\n import java.math.BigDecimal;\n import java.sql.Time;\n import java.time.LocalDate;\n import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.Objects;\n \n import static java.time.ZoneOffset.UTC;\n import static javax.persistence.EnumType.STRING;\n+import static org.hibernate.annotations.LazyCollectionOption.FALSE;\n import static org.synyx.urlaubsverwaltung.application.domain.ApplicationStatus.CANCELLED;\n \n /**\n@@ -109,6 +118,11 @@\n     @JoinColumn(name = \"rep_id\")\n     private Person holidayReplacement;\n     private String holidayReplacementNote;\n+\n+    @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.EAGER)\n+    @CollectionTable(name = \"holiday_replacements\")\n+    private List<HolidayReplacementEntity> holidayReplacements = new ArrayList<>();\n+\n     /**\n      * Further information: address, phone number etc.\n      */\n@@ -393,6 +407,14 @@ public String getHolidayReplacementNote() {\n         return holidayReplacementNote;\n     }\n \n+    public List<HolidayReplacementEntity> getHolidayReplacements() {\n+        return holidayReplacements;\n+    }\n+\n+    public void setHolidayReplacements(List<HolidayReplacementEntity> holidayReplacements) {\n+        this.holidayReplacements = holidayReplacements;\n+    }\n+\n     @Override\n     public String toString() {\n         return \"Application{\" +"
  },
  {
    "sha": "404851a776423751c4ac32bafc7a536b83f706bb",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveForm.java",
    "status": "modified",
    "additions": 50,
    "deletions": 0,
    "changes": 50,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveForm.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveForm.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveForm.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -3,13 +3,22 @@\n import org.synyx.urlaubsverwaltung.application.domain.Application;\n import org.synyx.urlaubsverwaltung.application.domain.VacationCategory;\n import org.synyx.urlaubsverwaltung.application.domain.VacationType;\n+import org.synyx.urlaubsverwaltung.holidayreplacement.HolidayReplacementDto;\n import org.synyx.urlaubsverwaltung.period.DayLength;\n import org.synyx.urlaubsverwaltung.person.Person;\n \n import java.math.BigDecimal;\n import java.sql.Time;\n import java.time.LocalDate;\n import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static java.util.Collections.emptyList;\n+import static java.util.Optional.ofNullable;\n+import static java.util.stream.Collectors.toList;\n \n \n /**\n@@ -44,6 +53,9 @@\n     // Stands in while the person is on holiday\n     private Person holidayReplacement;\n \n+    private Person holidayReplacementToAdd;\n+    private List<HolidayReplacementDto> holidayReplacements = new ArrayList<>();\n+\n     private String holidayReplacementNote;\n \n     // Address and phone number during holiday\n@@ -237,6 +249,30 @@ public void setId(Integer id) {\n         this.id = id;\n     }\n \n+    public List<Person> getHolidayReplacementPersons() {\n+\n+        return ofNullable(holidayReplacements)\n+            .orElse(emptyList()).stream()\n+            .map(HolidayReplacementDto::getPerson)\n+            .collect(toList());\n+    }\n+\n+    public List<HolidayReplacementDto> getHolidayReplacements() {\n+        return holidayReplacements;\n+    }\n+\n+    public void setHolidayReplacements(List<HolidayReplacementDto> holidayReplacements) {\n+        this.holidayReplacements = holidayReplacements;\n+    }\n+\n+    public Person getHolidayReplacementToAdd() {\n+        return holidayReplacementToAdd;\n+    }\n+\n+    public void setHolidayReplacementToAdd(Person holidayReplacementToAdd) {\n+        this.holidayReplacementToAdd = holidayReplacementToAdd;\n+    }\n+\n     public static class Builder {\n \n         private Person person;\n@@ -250,6 +286,8 @@ public void setId(Integer id) {\n         private String reason;\n         private Person holidayReplacement;\n         private String holidayReplacementNote;\n+        private Person holidayReplacementToAdd;\n+        private List<HolidayReplacementDto> holidayReplacements;\n         private String address;\n         private boolean teamInformed;\n         private String comment;\n@@ -330,6 +368,16 @@ public void setId(Integer id) {\n             return this;\n         }\n \n+        public ApplicationForLeaveForm.Builder holidayReplacements(List<HolidayReplacementDto> holidayReplacementDtos) {\n+            this.holidayReplacements = holidayReplacementDtos;\n+            return this;\n+        }\n+\n+        public ApplicationForLeaveForm.Builder holidayReplacementToAdd(Person holidayReplacementToAdd) {\n+            this.holidayReplacementToAdd = holidayReplacementToAdd;\n+            return this;\n+        }\n+\n         public ApplicationForLeaveForm build() {\n \n             final ApplicationForLeaveForm form = new ApplicationForLeaveForm();\n@@ -349,6 +397,8 @@ public ApplicationForLeaveForm build() {\n             form.setTeamInformed(teamInformed);\n             form.setComment(comment);\n             form.setId(id);\n+            form.setHolidayReplacements(holidayReplacements);\n+            form.setHolidayReplacementToAdd(holidayReplacementToAdd);\n \n             return form;\n         }"
  },
  {
    "sha": "e23a89e549e843ca50b9c0bea37186ad36f1ec08",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveFormViewController.java",
    "status": "modified",
    "additions": 180,
    "deletions": 28,
    "changes": 208,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveFormViewController.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveFormViewController.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationForLeaveFormViewController.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -23,9 +23,9 @@\n import org.synyx.urlaubsverwaltung.application.service.ApplicationInteractionService;\n import org.synyx.urlaubsverwaltung.application.service.EditApplicationForLeaveNotAllowedException;\n import org.synyx.urlaubsverwaltung.application.service.VacationTypeService;\n+import org.synyx.urlaubsverwaltung.holidayreplacement.HolidayReplacementDto;\n import org.synyx.urlaubsverwaltung.person.Person;\n import org.synyx.urlaubsverwaltung.person.PersonService;\n-import org.synyx.urlaubsverwaltung.person.UnknownPersonException;\n import org.synyx.urlaubsverwaltung.person.web.PersonPropertyEditor;\n import org.synyx.urlaubsverwaltung.settings.SettingsService;\n import org.synyx.urlaubsverwaltung.web.DateFormatAware;\n@@ -42,10 +42,18 @@\n import java.util.List;\n import java.util.Locale;\n import java.util.Optional;\n+import java.util.function.BooleanSupplier;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n \n import static java.lang.String.format;\n import static java.lang.invoke.MethodHandles.lookup;\n import static java.util.Optional.ofNullable;\n+import static java.util.function.Predicate.not;\n+import static java.util.stream.Collectors.toList;\n+import static java.util.stream.Collectors.toUnmodifiableList;\n import static org.slf4j.LoggerFactory.getLogger;\n import static org.synyx.urlaubsverwaltung.application.domain.ApplicationStatus.WAITING;\n import static org.synyx.urlaubsverwaltung.application.web.ApplicationMapper.mapToApplication;\n@@ -103,40 +111,115 @@ public void initBinder(DataBinder binder, Locale locale) {\n \n \n     @GetMapping(\"/application/new\")\n-    public String newApplicationForm(\n-        @RequestParam(value = PERSON_ATTRIBUTE, required = false) Integer personId,\n-        @RequestParam(value = \"from\", required = false) String startDateString,\n-        @RequestParam(value = \"to\", required = false) String endDateString,\n-        Model model)\n-        throws UnknownPersonException {\n+    public String newApplicationForm(@RequestParam(value = PERSON_ATTRIBUTE, required = false) Integer personId,\n+                                     @RequestParam(value = \"from\", required = false) String startDateString,\n+                                     @RequestParam(value = \"to\", required = false) String endDateString,\n+                                     ApplicationForLeaveForm appForLeaveForm, Model model) {\n \n         final Person signedInUser = personService.getSignedInUser();\n \n-        Person person;\n-        if (personId == null) {\n-            person = signedInUser;\n-        } else {\n-            person = personService.getPersonByID(personId).orElseThrow(() -> new UnknownPersonException(personId));\n+        Person person = ofNullable(appForLeaveForm.getPerson())\n+            .or(getPersonByRequestParam(personId))\n+            .orElse(signedInUser);\n+\n+        boolean isApplyingForOneSelf = person.equals(signedInUser);\n+\n+        if (!isApplyingForOneSelf && !signedInUser.hasRole(OFFICE)) {\n+            throw new AccessDeniedException(format(\"User '%s' has not the correct permissions to apply for leave for user '%s'\", signedInUser.getId(), person.getId()));\n         }\n \n+        final Optional<Account> holidaysAccount = accountService.getHolidaysAccount(ZonedDateTime.now(clock).getYear(), person);\n+        if (holidaysAccount.isPresent()) {\n+\n+            appForLeaveForm.setStartDate(dateFormatAware.parse(startDateString).orElse(appForLeaveForm.getStartDate()));\n+            appForLeaveForm.setEndDate(dateFormatAware.parse(endDateString).orElse(appForLeaveForm.getEndDate()));\n+\n+            prepareApplicationForLeaveForm(person, appForLeaveForm, model);\n+            addSelectableHolidayReplacementsToModel(model, selectableHolidayReplacements());\n+        }\n+\n+        model.addAttribute(\"noHolidaysAccount\", holidaysAccount.isEmpty());\n+\n+        return APP_FORM;\n+    }\n+\n+    @PostMapping(value = { \"/application/new\", \"/application/{applicationId}\" }, params = \"add-holiday-replacement\")\n+    public String addHolidayReplacement(ApplicationForLeaveForm applicationForLeaveForm, Model model) {\n+\n+        final Person signedInUser = personService.getSignedInUser();\n+\n+        Person person = ofNullable(applicationForLeaveForm.getPerson())\n+            .orElse(signedInUser);\n+\n         boolean isApplyingForOneSelf = person.equals(signedInUser);\n \n-        // only office may apply for leave on behalf of other users\n         if (!isApplyingForOneSelf && !signedInUser.hasRole(OFFICE)) {\n             throw new AccessDeniedException(format(\"User '%s' has not the correct permissions to apply for leave for user '%s'\", signedInUser.getId(), person.getId()));\n         }\n \n         final Optional<Account> holidaysAccount = accountService.getHolidaysAccount(ZonedDateTime.now(clock).getYear(), person);\n         if (holidaysAccount.isPresent()) {\n+            final Person replacementPersonToAdd = applicationForLeaveForm.getHolidayReplacementToAdd();\n+            if (replacementPersonToAdd == null) {\n+                final List<SelectableHolidayReplacementDto> selectableHolidayReplacementDtos = selectableHolidayReplacements(\n+                    not(containsPerson(applicationForLeaveForm.getHolidayReplacementPersons()))\n+                );\n+                addSelectableHolidayReplacementsToModel(model, selectableHolidayReplacementDtos);\n+            } else {\n+                // add replacementToAdd to the replacements list\n+                final HolidayReplacementDto replacementDto = new HolidayReplacementDto(replacementPersonToAdd);\n+                applicationForLeaveForm.getHolidayReplacements().add(replacementDto);\n+                // reset holidayReplacement selection element\n+                applicationForLeaveForm.setHolidayReplacementToAdd(null);\n+\n+                // and remove it from the selectable elements\n+                final List<SelectableHolidayReplacementDto> nextSelectableReplacements = selectableHolidayReplacements(\n+                    not(\n+                        personEquals(replacementPersonToAdd)\n+                            .or(containsPerson(applicationForLeaveForm.getHolidayReplacementPersons()))\n+                    )\n+                );\n+                addSelectableHolidayReplacementsToModel(model, nextSelectableReplacements);\n+            }\n+\n+            prepareApplicationForLeaveForm(person, applicationForLeaveForm, model);\n+        }\n+\n+        model.addAttribute(\"noHolidaysAccount\", holidaysAccount.isEmpty());\n+\n+        return APP_FORM;\n+    }\n+\n+    @PostMapping(value = { \"/application/new\", \"/application/{applicationId}\" }, params = \"remove-holiday-replacement\")\n+    public String removeHolidayReplacement(ApplicationForLeaveForm applicationForLeaveForm,\n+                                           @RequestParam(name=\"remove-holiday-replacement\") Integer personIdToRemove,\n+                                           Model model) {\n \n-            final LocalDate startDate = dateFormatAware.parse(startDateString).orElse(null);\n-            final LocalDate endDate = dateFormatAware.parse(endDateString).orElse(startDate);\n+        final Person signedInUser = personService.getSignedInUser();\n+\n+        Person person = ofNullable(applicationForLeaveForm.getPerson())\n+            .orElse(signedInUser);\n+\n+        boolean isApplyingForOneSelf = person.equals(signedInUser);\n+\n+        if (!isApplyingForOneSelf && !signedInUser.hasRole(OFFICE)) {\n+            throw new AccessDeniedException(format(\"User '%s' has not the correct permissions to apply for leave for user '%s'\", signedInUser.getId(), person.getId()));\n+        }\n \n-            final ApplicationForLeaveForm appForm = new ApplicationForLeaveForm();\n-            appForm.setStartDate(startDate);\n-            appForm.setEndDate(endDate);\n+        final Optional<Account> holidaysAccount = accountService.getHolidaysAccount(ZonedDateTime.now(clock).getYear(), person);\n+        if (holidaysAccount.isPresent()) {\n+            final List<HolidayReplacementDto> newList = applicationForLeaveForm.getHolidayReplacements()\n+                .stream()\n+                .filter(holidayReplacementDto -> !holidayReplacementDto.getPerson().getId().equals(personIdToRemove))\n+                .collect(toList());\n+            applicationForLeaveForm.setHolidayReplacements(newList);\n+            prepareApplicationForLeaveForm(person, applicationForLeaveForm, model);\n \n-            prepareApplicationForLeaveForm(person, appForm, model);\n+            final List<SelectableHolidayReplacementDto> selectableHolidayReplacements = selectableHolidayReplacements(\n+                personEquals(personIdToRemove)\n+                    .or(not(containsPerson(applicationForLeaveForm.getHolidayReplacementPersons()))\n+            ));\n+            addSelectableHolidayReplacementsToModel(model, selectableHolidayReplacements);\n         }\n \n         model.addAttribute(\"noHolidaysAccount\", holidaysAccount.isEmpty());\n@@ -172,24 +255,26 @@ public String newApplication(@ModelAttribute(\"application\") ApplicationForLeaveF\n     }\n \n     @GetMapping(\"/application/{applicationId}/edit\")\n-    public String editApplicationForm(@PathVariable(\"applicationId\") Integer applicationId, Model model) throws UnknownApplicationForLeaveException {\n+    public String editApplicationForm(@PathVariable(\"applicationId\") Integer applicationId, ApplicationForLeaveForm appForm,\n+                                      Model model) throws UnknownApplicationForLeaveException {\n \n-        final Optional<Application> maybeApplication = applicationInteractionService.get(applicationId);\n-        if (maybeApplication.isEmpty()) {\n-            throw new UnknownApplicationForLeaveException(applicationId);\n-        }\n \n-        final Application application = maybeApplication.get();\n-        if (WAITING.compareTo(application.getStatus()) != 0) {\n+        final ApplicationForLeaveForm applicationForLeaveForm = getAppFormFromFrontend(appForm)\n+            .orElse(getAppFormFromDB(applicationId));\n+\n+        if (applicationForLeaveForm == null)\n             return \"application/app_notwaiting\";\n-        }\n \n-        final ApplicationForLeaveForm applicationForLeaveForm = mapToApplicationForm(application);\n         final Person person = personService.getSignedInUser();\n \n         final Optional<Account> holidaysAccount = accountService.getHolidaysAccount(Year.now(clock).getValue(), person);\n         if (holidaysAccount.isPresent()) {\n             prepareApplicationForLeaveForm(person, applicationForLeaveForm, model);\n+\n+            final List<SelectableHolidayReplacementDto> selectableHolidayReplacements = selectableHolidayReplacements(\n+                not(containsPerson(applicationForLeaveForm.getHolidayReplacementPersons()))\n+            );\n+            model.addAttribute(\"selectableHolidayReplacements\", selectableHolidayReplacements);\n         }\n         model.addAttribute(\"noHolidaysAccount\", holidaysAccount.isEmpty());\n \n@@ -242,6 +327,34 @@ public String sendEditApplicationForm(@PathVariable(\"applicationId\") Integer app\n         return REDIRECT_WEB_APPLICATION + savedApplicationForLeave.getId();\n     }\n \n+    private Supplier<Optional<? extends Person>> getPersonByRequestParam(Integer personId) {\n+        if (personId == null) {\n+            return Optional::empty;\n+        }\n+        return () -> personService.getPersonByID(personId);\n+    }\n+\n+    private ApplicationForLeaveForm getAppFormFromDB(Integer applicationId) throws UnknownApplicationForLeaveException {\n+\n+        final Optional<Application> maybeApplication = applicationInteractionService.get(applicationId);\n+        if (maybeApplication.isEmpty()) {\n+            throw new UnknownApplicationForLeaveException(applicationId);\n+        }\n+\n+        final Application application = maybeApplication.get();\n+        if (!WAITING.equals(application.getStatus())) {\n+            return null;\n+        }\n+\n+        return mapToApplicationForm(application);\n+    }\n+\n+    private Optional<ApplicationForLeaveForm> getAppFormFromFrontend(ApplicationForLeaveForm appForm) {\n+        if (appForm.getId() == null)\n+            return Optional.empty();\n+        else return Optional.of(appForm);\n+    }\n+\n     private void prepareApplicationForLeaveForm(Person person, ApplicationForLeaveForm appForm, Model model) {\n \n         final List<Person> persons = personService.getActivePersons();\n@@ -259,4 +372,43 @@ private void prepareApplicationForLeaveForm(Person person, ApplicationForLeaveFo\n \n         model.addAttribute(\"application\", appForm);\n     }\n+\n+    private static Predicate<Person> personEquals(Person person) {\n+        return person::equals;\n+    }\n+\n+    private static Predicate<Person> personEquals(Integer personId) {\n+        return p -> p.getId().equals(personId);\n+    }\n+\n+    private static Predicate<Person> containsPerson(List<Person> personList) {\n+        return personList::contains;\n+    }\n+\n+    private List<Person> getAllSelectableReplacementPersons() {\n+        return personService.getActivePersons();\n+    }\n+\n+    private List<SelectableHolidayReplacementDto> selectableHolidayReplacements() {\n+        return getAllSelectableReplacementPersons().stream()\n+            .map(ApplicationForLeaveFormViewController::toSelectableHolidayReplacementDto)\n+            .collect(toUnmodifiableList());\n+    }\n+    private List<SelectableHolidayReplacementDto> selectableHolidayReplacements(Predicate<Person> predicate) {\n+        return getAllSelectableReplacementPersons().stream()\n+            .filter(predicate)\n+            .map(ApplicationForLeaveFormViewController::toSelectableHolidayReplacementDto)\n+            .collect(toUnmodifiableList());\n+    }\n+\n+    private static void addSelectableHolidayReplacementsToModel(Model model, List<SelectableHolidayReplacementDto> dtos) {\n+        model.addAttribute(\"selectableHolidayReplacements\", dtos);\n+    }\n+\n+    private static SelectableHolidayReplacementDto toSelectableHolidayReplacementDto(Person person) {\n+        final SelectableHolidayReplacementDto dto = new SelectableHolidayReplacementDto();\n+        dto.setPersonId(person.getId());\n+        dto.setDisplayName(person.getNiceName());\n+        return dto;\n+    }\n }"
  },
  {
    "sha": "36520dec268c5fa988194522ea799d361f61b078",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationMapper.java",
    "status": "modified",
    "additions": 16,
    "deletions": 0,
    "changes": 16,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationMapper.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationMapper.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/application/web/ApplicationMapper.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -2,7 +2,13 @@\n \n import org.springframework.beans.BeanUtils;\n import org.synyx.urlaubsverwaltung.application.domain.Application;\n+import org.synyx.urlaubsverwaltung.holidayreplacement.HolidayReplacementDto;\n+import org.synyx.urlaubsverwaltung.holidayreplacement.HolidayReplacementEntity;\n \n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static java.util.stream.Collectors.toList;\n import static org.synyx.urlaubsverwaltung.application.domain.VacationCategory.OVERTIME;\n \n final class ApplicationMapper {\n@@ -12,6 +18,9 @@ private ApplicationMapper() {\n     }\n \n     static ApplicationForLeaveForm mapToApplicationForm(Application application) {\n+        List<HolidayReplacementDto> holidayReplacementDtos = application.getHolidayReplacements().stream()\n+            .map(HolidayReplacementDto::from)\n+            .collect(toList());\n         return new ApplicationForLeaveForm.Builder()\n             .id(application.getId())\n             .address(application.getAddress())\n@@ -27,6 +36,7 @@ static ApplicationForLeaveForm mapToApplicationForm(Application application) {\n             .holidayReplacementNote(application.getHolidayReplacementNote())\n             .vacationType(application.getVacationType())\n             .reason(application.getReason())\n+            .holidayReplacements(holidayReplacementDtos)\n             .build();\n     }\n \n@@ -60,6 +70,12 @@ static Application merge(Application applicationForLeave, ApplicationForLeaveFor\n             newApplication.setHours(applicationForLeaveForm.getHours());\n         }\n \n+        List<HolidayReplacementEntity> holidayReplacementEntities = applicationForLeaveForm.getHolidayReplacements().stream()\n+            .map(HolidayReplacementEntity::from)\n+            .collect(toList());\n+\n+        newApplication.setHolidayReplacements(holidayReplacementEntities);\n+\n         return newApplication;\n     }\n }"
  },
  {
    "sha": "8bfaf530e694d4100b2806ad73825564b391d0c7",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementDto.java",
    "status": "added",
    "additions": 49,
    "deletions": 0,
    "changes": 49,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementDto.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementDto.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementDto.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -0,0 +1,49 @@\n+package org.synyx.urlaubsverwaltung.holidayreplacement;\n+\n+import org.springframework.beans.BeanUtils;\n+import org.synyx.urlaubsverwaltung.person.Person;\n+\n+public class HolidayReplacementDto {\n+\n+    private Integer id;\n+    private Person person;\n+    private String note;\n+\n+    public HolidayReplacementDto() {\n+    }\n+\n+    public HolidayReplacementDto(Person person) {\n+        this.person = person;\n+    }\n+\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public Person getPerson() {\n+        return person;\n+    }\n+\n+    public void setPerson(Person person) {\n+        this.person = person;\n+    }\n+\n+    public String getNote() {\n+        return note;\n+    }\n+\n+    public void setNote(String note) {\n+        this.note = note;\n+    }\n+\n+    public static HolidayReplacementDto from(HolidayReplacementEntity holidayReplacementEntity) {\n+        HolidayReplacementDto holidayReplacementDto = new HolidayReplacementDto();\n+        BeanUtils.copyProperties(holidayReplacementEntity, holidayReplacementDto);\n+        return holidayReplacementDto;\n+    }\n+}"
  },
  {
    "sha": "a62e25070f05b107e0039465044addacc0726a1b",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementEntity.java",
    "status": "added",
    "additions": 77,
    "deletions": 0,
    "changes": 77,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementEntity.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementEntity.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/holidayreplacement/HolidayReplacementEntity.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -0,0 +1,77 @@\n+package org.synyx.urlaubsverwaltung.holidayreplacement;\n+\n+import org.springframework.beans.BeanUtils;\n+import org.synyx.urlaubsverwaltung.person.Person;\n+\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.OneToOne;\n+import javax.validation.constraints.NotNull;\n+import java.util.Objects;\n+\n+@Entity(name=\"holiday_replacement\")\n+public class HolidayReplacementEntity {\n+\n+    @Id\n+    @GeneratedValue\n+    private Integer id;\n+\n+    @NotNull\n+    @OneToOne\n+    private Person person;\n+\n+    private String note;\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public Person getPerson() {\n+        return person;\n+    }\n+\n+    public void setPerson(Person person) {\n+        this.person = person;\n+    }\n+\n+    public String getNote() {\n+        return note;\n+    }\n+\n+    public void setNote(String note) {\n+        this.note = note;\n+    }\n+\n+    public static HolidayReplacementEntity from(HolidayReplacementDto holidayReplacementDto) {\n+        HolidayReplacementEntity holidayReplacementEntity = new HolidayReplacementEntity();\n+        BeanUtils.copyProperties(holidayReplacementDto, holidayReplacementEntity);\n+        return holidayReplacementEntity;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) return true;\n+        if (o == null || getClass() != o.getClass()) return false;\n+        HolidayReplacementEntity that = (HolidayReplacementEntity) o;\n+        return Objects.equals(id, that.id) && Objects.equals(person, that.person)\n+            && Objects.equals(note, that.note);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(id);\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"HolidayReplacement{\" +\n+            \", person=\" + person +\n+            \", note='\" + note + '\\'' +\n+            '}';\n+    }\n+}"
  },
  {
    "sha": "550db7e522fcac2faa32092ab0c1ca1f944f84a4",
    "filename": "src/main/java/org/synyx/urlaubsverwaltung/person/web/PersonPropertyEditor.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/person/web/PersonPropertyEditor.java",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/java/org/synyx/urlaubsverwaltung/person/web/PersonPropertyEditor.java",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/java/org/synyx/urlaubsverwaltung/person/web/PersonPropertyEditor.java?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -1,5 +1,6 @@\n package org.synyx.urlaubsverwaltung.person.web;\n \n+import org.springframework.util.StringUtils;\n import org.synyx.urlaubsverwaltung.person.Person;\n import org.synyx.urlaubsverwaltung.person.PersonService;\n \n@@ -33,6 +34,10 @@ public String getAsText() {\n     @Override\n     public void setAsText(String text) {\n \n+        if (!StringUtils.hasText(text)) {\n+            return;\n+        }\n+\n         Integer id = Integer.valueOf(text);\n \n         Optional<Person> person = personService.getPersonByID(id);"
  },
  {
    "sha": "0d257eeab3f355c62e457faefc69ec4ba7b6b797",
    "filename": "src/main/javascript/js/application/app-form.js",
    "status": "modified",
    "additions": 12,
    "deletions": 0,
    "changes": 12,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/javascript/js/application/app-form.js",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/javascript/js/application/app-form.js",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/javascript/js/application/app-form.js?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -86,8 +86,20 @@ $(document).ready(async function () {\n     }\n     applicationSubmitPressed = true;\n   });\n+\n+\n });\n \n+function updateHolidayReplacementDtos() {\n+\n+  let form = document.querySelector(\"#applicationForm\");\n+  form.method = \"get\";\n+  form.action = window.location.pathname;\n+  form.submit();\n+}\n+\n+window.updateHolidayReplacementDtos = updateHolidayReplacementDtos;\n+\n function compose(...functions) {\n   return functions.reduce((a, b) => (...arguments_) => a(b(...arguments_)));\n }"
  },
  {
    "sha": "61726e3a7d2db541d219d3d325c2f3ae6634a23c",
    "filename": "src/main/resources/dbchangelogs/changelog-4.14.0-add-holiday-replacement.xml",
    "status": "added",
    "additions": 32,
    "deletions": 0,
    "changes": 32,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/dbchangelogs/changelog-4.14.0-add-holiday-replacement.xml",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/dbchangelogs/changelog-4.14.0-add-holiday-replacement.xml",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/resources/dbchangelogs/changelog-4.14.0-add-holiday-replacement.xml?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -0,0 +1,32 @@\n+<databaseChangeLog\n+  xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd\">\n+\n+  <changeSet author=\"weigel\" id=\"add-holiday-Replacement-table\">\n+\n+    <createTable tableName=\"holiday_replacement\">\n+      <column autoIncrement=\"true\" name=\"id\" type=\"INT(10)\">\n+        <constraints primaryKey=\"true\"/>\n+      </column>\n+      <column name=\"note\" type=\"VARCHAR(255)\">\n+        <constraints nullable=\"true\"/>\n+      </column>\n+      <column name=\"person_id\" type=\"INT(10))\">\n+        <constraints nullable=\"false\"/>\n+      </column>\n+    </createTable>\n+\n+    <createTable tableName=\"holiday_replacements\">\n+      <column autoIncrement=\"true\" name=\"id\" type=\"INT(10)\">\n+        <constraints primaryKey=\"true\"/>\n+      </column>\n+      <column name=\"holiday_replacements_id\" type=\"INT(10)\">\n+        <constraints nullable=\"false\"/>\n+      </column>\n+      <column name=\"application_id\" type=\"INT(10)\">\n+        <constraints nullable=\"false\"/>\n+      </column>\n+    </createTable>\n+  </changeSet>\n+</databaseChangeLog>"
  },
  {
    "sha": "c2dd91ab1182ffe315beecf90a6d057a5ec4a75d",
    "filename": "src/main/resources/dbchangelogs/changelogmaster.xml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/dbchangelogs/changelogmaster.xml",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/dbchangelogs/changelogmaster.xml",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/resources/dbchangelogs/changelogmaster.xml?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -75,4 +75,5 @@\n   <include file=\"dbchangelogs/changelog-4.12.0-add-department-creation-date-column.xml\"/>\n   <include file=\"dbchangelogs/changelog-4.12.0-default-naming-strategy.xml\"/>\n   <include file=\"dbchangelogs/changelog-4.13.0-add-department-member-accession-date.xml\"/>\n+  <include file=\"dbchangelogs/changelog-4.14.0-add-holiday-replacement.xml\"/>\n </databaseChangeLog>"
  },
  {
    "sha": "92dd4cecb3bf66fa90b70f863a1e5f0f75b78439",
    "filename": "src/main/resources/messages_de.properties",
    "status": "modified",
    "additions": 3,
    "deletions": 2,
    "changes": 5,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/messages_de.properties",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/messages_de.properties",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/resources/messages_de.properties?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -68,8 +68,9 @@ application.data.hours.number=abgebaute Überstunden\n application.data.teamInformed=Mit Team abgesprochen\n application.data.teamInformed.true=Ja\n application.data.teamInformed.false=Nein\n-application.data.holidayReplacement=Vertreter/in\n-application.data.holidayReplacementNote=Notiz an Vertreter/in\n+application.data.holidayReplacement=Urlaubssvertretung\n+application.data.holidayReplacement.add-button.text=hinzufügen\n+application.data.holidayReplacementNote=Notiz an\n application.data.holidayReplacement.none=Keine Vertretung\n application.data.furtherInformation.title=Weitere Informationen\n application.data.furtherInformation.address=Anschrift/Telefon während des Urlaubs"
  },
  {
    "sha": "563c7d5adb4635e38fb2d098d50f2054b96d7e32",
    "filename": "src/main/resources/messages_en.properties",
    "status": "modified",
    "additions": 2,
    "deletions": 1,
    "changes": 3,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/messages_en.properties",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/resources/messages_en.properties",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/resources/messages_en.properties?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -69,7 +69,8 @@ application.data.teamInformed=Agreed with team\n application.data.teamInformed.true=Yes\n application.data.teamInformed.false=No\n application.data.holidayReplacement=Vacation replacement\n-application.data.holidayReplacementNote=Note to vacation replacement\n+application.data.holidayReplacement.add-button.text=add\n+application.data.holidayReplacementNote=Note to\n application.data.holidayReplacement.none=No vacation replacement\n application.data.furtherInformation.title=Optional information\n application.data.furtherInformation.address=Address/phone number"
  },
  {
    "sha": "99106f0162653271b1f853a560625aa9aff6ef64",
    "filename": "src/main/webapp/WEB-INF/assets-manifest.json",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/webapp/WEB-INF/assets-manifest.json",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/webapp/WEB-INF/assets-manifest.json",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/webapp/WEB-INF/assets-manifest.json?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -9,7 +9,7 @@\n   \"account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.js\": \"/assets/account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.64f904c94758b47d4f29.min.js\",\n   \"app_detail.js\": \"/assets/app_detail.7a8db7d60e1cfc805207.min.js\",\n   \"app_detail~app_form~person_overview.js\": \"/assets/app_detail~app_form~person_overview.9c4535bace75e9a8415e.min.js\",\n-  \"app_form.js\": \"/assets/app_form.529cb115a6597d349492.min.js\",\n+  \"app_form.js\": \"/assets/app_form.d9bbc2ac2b577f452897.min.js\",\n   \"app_list.js\": \"/assets/app_list.e9beb9c3ae2f17c212d6.min.js\",\n   \"app_statistics.js\": \"/assets/app_statistics.5a4cf53c211a7eb5e9c9.min.js\",\n   \"common.css\": \"/assets/common.a5f41dc90518194c7542.css\","
  },
  {
    "sha": "b610d3c96379cbc0f9018b89c70566cccdc3c868",
    "filename": "src/main/webapp/WEB-INF/jsp/application/app_form.jsp",
    "status": "modified",
    "additions": 355,
    "deletions": 291,
    "changes": 646,
    "blob_url": "https://github.com/synyx/urlaubsverwaltung/blob/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/webapp/WEB-INF/jsp/application/app_form.jsp",
    "raw_url": "https://github.com/synyx/urlaubsverwaltung/raw/24aaf4729a4fc50ce56d48b307abdf5f2895ff41/src/main/webapp/WEB-INF/jsp/application/app_form.jsp",
    "contents_url": "https://api.github.com/repos/synyx/urlaubsverwaltung/contents/src/main/webapp/WEB-INF/jsp/application/app_form.jsp?ref=24aaf4729a4fc50ce56d48b307abdf5f2895ff41",
    "patch": "@@ -6,7 +6,7 @@\n <%@taglib prefix=\"sec\" uri=\"http://www.springframework.org/security/tags\" %>\n <%@taglib prefix=\"uv\" tagdir=\"/WEB-INF/tags\" %>\n <%@taglib prefix=\"icon\" tagdir=\"/WEB-INF/tags/icons\" %>\n-<%@taglib prefix=\"asset\" uri = \"/WEB-INF/asset.tld\"%>\n+<%@taglib prefix=\"asset\" uri=\"/WEB-INF/asset.tld\" %>\n \n <!DOCTYPE html>\n <html lang=\"${language}\">\n@@ -17,7 +17,7 @@\n     </title>\n     <uv:custom-head/>\n     <script>\n-        if(!window.uv) {\n+        if (!window.uv) {\n             window.uv = {};\n         }\n         window.uv.personId = '<c:out value=\"${person.id}\" />';\n@@ -34,18 +34,23 @@\n         window.uv.i18n['application.applier.day'] = \"<spring:message code='application.applier.day' javaScriptEscape='true' />\";\n         window.uv.i18n['application.applier.days'] = \"<spring:message code='application.applier.days' javaScriptEscape='true' />\";\n     </script>\n-    <uv:datepicker-localisation />\n-    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.css' />\" />\n-    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_notes~workingtime_form.css' />\" />\n-    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='npm.timepicker.css' />\" />\n-    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='npm.duetds.css' />\" />\n+    <uv:datepicker-localisation/>\n+    <link rel=\"stylesheet\" type=\"text/css\"\n+          href=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.css' />\"/>\n+    <link rel=\"stylesheet\" type=\"text/css\"\n+          href=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_notes~workingtime_form.css' />\"/>\n+    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='npm.timepicker.css' />\"/>\n+    <link rel=\"stylesheet\" type=\"text/css\" href=\"<asset:url value='npm.duetds.css' />\"/>\n     <script defer src=\"<asset:url value='npm.duetds.js' />\"></script>\n     <script defer src=\"<asset:url value='npm.date-fns.js' />\"></script>\n     <script defer src=\"<asset:url value='npm.timepicker.js' />\"></script>\n     <script defer src=\"<asset:url value='app_detail~app_form~person_overview.js' />\"></script>\n-    <script defer src=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.js' />\"></script>\n-    <script defer src=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_notes~workingtime_form.js' />\"></script>\n-    <script defer src=\"<asset:url value='account_form~app_detail~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_no~95889e93.js' />\"></script>\n+    <script defer\n+            src=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~sick_note_form~sick_notes~workingtime_form.js' />\"></script>\n+    <script defer\n+            src=\"<asset:url value='account_form~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_notes~workingtime_form.js' />\"></script>\n+    <script defer\n+            src=\"<asset:url value='account_form~app_detail~app_form~app_statistics~overtime_form~person_overview~sick_note_form~sick_no~95889e93.js' />\"></script>\n     <script defer src=\"<asset:url value='app_form.js' />\"></script>\n </head>\n \n@@ -61,18 +66,19 @@\n <c:set var=\"TIME_PATTERN\">\n     <spring:message code=\"pattern.time\"/> <spring:message code=\"application.data.time.placeholder\"/>\n </c:set>\n-<c:set var=\"IS_VACATION_REPLACEMENT_SHOWN\" value=\"${application.holidayReplacement != null ? '' : 'hidden'}\"/>\n <uv:menu/>\n \n <c:choose>\n     <c:when test=\"${application.id == null}\">\n         <c:set var=\"ACTION\" value=\"${URL_PREFIX}/application\"/>\n+        <c:set var=\"ADD_REPLACEMENT_ACTION\" value=\"${URL_PREFIX}/application/new\"/>\n         <c:set var=\"heading\">\n             <spring:message code=\"application.data.title\"/>\n         </c:set>\n     </c:when>\n     <c:otherwise>\n         <c:set var=\"ACTION\" value=\"${URL_PREFIX}/application/${application.id}\"/>\n+        <c:set var=\"ADD_REPLACEMENT_ACTION\" value=\"${URL_PREFIX}/application/${application.id}\"/>\n         <c:set var=\"heading\">\n             <spring:message code=\"application.data.title.edit\"/>\n         </c:set>\n@@ -90,342 +96,400 @@\n                 <spring:message code=\"application.applier.account.none\"/>\n             </c:when>\n             <c:otherwise>\n-                <form:form method=\"POST\" action=\"${ACTION}\" modelAttribute=\"application\" class=\"form-horizontal\" role=\"form\">\n-                <form:hidden path=\"person\" value=\"${person.id}\"/>\n+                <form:form id=\"applicationForm\" method=\"POST\" action=\"${ACTION}\" modelAttribute=\"application\"\n+                           class=\"form-horizontal\" role=\"form\">\n+                    <form:hidden path=\"id\" value=\"${application.id}\"/>\n+                    <form:hidden path=\"person\" value=\"${person.id}\"/>\n \n-                <c:if test=\"${not empty errors.globalErrors}\">\n-                    <div class=\"row\">\n-                        <div class=\"col-xs-12 alert alert-danger\">\n-                            <form:errors/>\n+                    <c:if test=\"${not empty errors.globalErrors}\">\n+                        <div class=\"row\">\n+                            <div class=\"col-xs-12 alert alert-danger\">\n+                                <form:errors/>\n+                            </div>\n                         </div>\n-                    </div>\n-                </c:if>\n+                    </c:if>\n \n-                <div class=\"form-section tw-mb-8\">\n-                    <uv:section-heading>\n-                        <h1>\n-                            ${heading}\n-                        </h1>\n-                    </uv:section-heading>\n+                    <div class=\"form-section tw-mb-8\">\n+                        <uv:section-heading>\n+                            <h1>\n+                                    ${heading}\n+                            </h1>\n+                        </uv:section-heading>\n \n-                    <div class=\"row\">\n-                        <c:if test=\"${IS_OFFICE}\">\n-                        <div class=\"col-md-8\">\n-                            <%-- office applies for a user --%>\n-                            <div class=\"form-group\">\n-                                <label class=\"control-label col-md-3\">\n-                                    <spring:message code=\"application.data.person\"/>\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <uv:select id=\"person-select\" name=\"\" onchange=\"window.location.href=this.options[this.selectedIndex].value\">\n-                                        <c:forEach items=\"${persons}\" var=\"p\">\n-                                            <option value=\"${URL_PREFIX}/application/new?person=${p.id}\" ${person.id == p.id ? 'selected=\"selected\"' : ''}>\n-                                                <c:out value=\"${p.niceName}\"/>\n-                                            </option>\n-                                        </c:forEach>\n-                                    </uv:select>\n+                        <div class=\"row\">\n+                            <c:if test=\"${IS_OFFICE}\">\n+                                <div class=\"col-md-8\">\n+                                        <%-- office applies for a user --%>\n+                                    <div class=\"form-group\">\n+                                        <label class=\"control-label col-md-3\">\n+                                            <spring:message code=\"application.data.person\"/>\n+                                        </label>\n+                                        <div class=\"col-md-9\">\n+                                            <uv:select id=\"person-select\" name=\"\"\n+                                                       onchange=\"window.location.href=this.options[this.selectedIndex].value\">\n+                                                <c:forEach items=\"${persons}\" var=\"p\">\n+                                                    <option\n+                                                        value=\"${URL_PREFIX}/application/new?person=${p.id}\" ${person.id == p.id ? 'selected=\"selected\"' : ''}>\n+                                                        <c:out value=\"${p.niceName}\"/>\n+                                                    </option>\n+                                                </c:forEach>\n+                                            </uv:select>\n+                                        </div>\n+                                    </div>\n                                 </div>\n-                            </div>\n+                            </c:if>\n                         </div>\n-                        </c:if>\n-                    </div>\n \n-                    <%-- Vacation Type--%>\n-                    <div class=\"row\">\n-                        <div class=\"col-md-8\">\n-                            <div class=\"form-group is-required\">\n-                                <label class=\"control-label col-md-3\" for=\"vacationType\">\n-                                    <spring:message code=\"application.data.vacationType\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <uv:select id=\"vacationType\" name=\"vacationType\" onchange=\"vacationTypeChanged(this.value);\">\n-                                        <c:forEach items=\"${vacationTypes}\" var=\"vacationType\">\n-                                            <c:choose>\n-                                                <c:when test=\"${vacationType == application.vacationType}\">\n-                                                    <option value=\"${vacationType.id}\" selected=\"selected\">\n-                                                        <spring:message code=\"${vacationType.messageKey}\"/>\n-                                                    </option>\n-                                                </c:when>\n-                                                <c:otherwise>\n-                                                    <option value=\"${vacationType.id}\">\n-                                                        <spring:message code=\"${vacationType.messageKey}\"/>\n-                                                    </option>\n-                                                </c:otherwise>\n-                                            </c:choose>\n-                                        </c:forEach>\n-                                    </uv:select>\n+                            <%-- Vacation Type--%>\n+                        <div class=\"row\">\n+                            <div class=\"col-md-8\">\n+                                <div class=\"form-group is-required\">\n+                                    <label class=\"control-label col-md-3\" for=\"vacationType\">\n+                                        <spring:message code=\"application.data.vacationType\"/>:\n+                                    </label>\n+                                    <div class=\"col-md-9\">\n+                                        <uv:select id=\"vacationType\" name=\"vacationType\"\n+                                                   onchange=\"vacationTypeChanged(this.value);\">\n+                                            <c:forEach items=\"${vacationTypes}\" var=\"vacationType\">\n+                                                <c:choose>\n+                                                    <c:when test=\"${vacationType == application.vacationType}\">\n+                                                        <option value=\"${vacationType.id}\" selected=\"selected\">\n+                                                            <spring:message code=\"${vacationType.messageKey}\"/>\n+                                                        </option>\n+                                                    </c:when>\n+                                                    <c:otherwise>\n+                                                        <option value=\"${vacationType.id}\">\n+                                                            <spring:message code=\"${vacationType.messageKey}\"/>\n+                                                        </option>\n+                                                    </c:otherwise>\n+                                                </c:choose>\n+                                            </c:forEach>\n+                                        </uv:select>\n+                                    </div>\n                                 </div>\n                             </div>\n                         </div>\n-                    </div>\n \n-                    <%-- start and end date--%>\n-                    <div class=\"row\">\n+                            <%-- start and end date--%>\n+                        <div class=\"row\">\n \n-                        <div class=\"col-md-8\">\n-                            <div class=\"form-group is-required\">\n-                                <label class=\"control-label col-xs-12 col-md-3\" for=\"from\">\n-                                    <spring:message code=\"absence.period.startDate\"/>:\n-                                </label>\n-                                <div class=\"col-xs-8 col-md-5\">\n-                                    <form:input id=\"from\" path=\"startDate\" class=\"form-control\"\n-                                                cssErrorClass=\"form-control error\" placeholder=\"${DATE_PATTERN}\"\n-                                                autocomplete=\"off\" data-iso-value=\"${application.startDateIsoValue}\" />\n-                                </div>\n-                                <div class=\"col-xs-4 col-md-4\">\n-                                    <form:input id=\"startTime\" path=\"startTime\" class=\"form-control\"\n-                                                cssErrorClass=\"form-control error\" placeholder=\"${TIME_PATTERN}\"\n-                                                autocomplete=\"off\"/>\n+                            <div class=\"col-md-8\">\n+                                <div class=\"form-group is-required\">\n+                                    <label class=\"control-label col-xs-12 col-md-3\" for=\"from\">\n+                                        <spring:message code=\"absence.period.startDate\"/>:\n+                                    </label>\n+                                    <div class=\"col-xs-8 col-md-5\">\n+                                        <form:input id=\"from\" path=\"startDate\" class=\"form-control\"\n+                                                    cssErrorClass=\"form-control error\" placeholder=\"${DATE_PATTERN}\"\n+                                                    autocomplete=\"off\"\n+                                                    data-iso-value=\"${application.startDateIsoValue}\"/>\n+                                    </div>\n+                                    <div class=\"col-xs-4 col-md-4\">\n+                                        <form:input id=\"startTime\" path=\"startTime\" class=\"form-control\"\n+                                                    cssErrorClass=\"form-control error\" placeholder=\"${TIME_PATTERN}\"\n+                                                    autocomplete=\"off\"/>\n+                                    </div>\n                                 </div>\n-                            </div>\n \n-                            <div class=\"form-group is-required\">\n-                                <label class=\"control-label col-xs-12 col-md-3\" for=\"to\">\n-                                    <spring:message code=\"absence.period.endDate\"/>:\n-                                </label>\n-                                <div class=\"col-xs-8 col-md-5\">\n-                                    <form:input id=\"to\" path=\"endDate\" class=\"form-control\"\n-                                                cssErrorClass=\"form-control error\" placeholder=\"${DATE_PATTERN}\"\n-                                                autocomplete=\"off\" data-iso-value=\"${application.endDateIsoValue}\" />\n-                                </div>\n-                                <div class=\"col-xs-4 col-md-4\">\n-                                    <form:input id=\"endTime\" path=\"endTime\" class=\"form-control\"\n-                                                cssErrorClass=\"form-control error\" placeholder=\"${TIME_PATTERN}\"\n-                                                autocomplete=\"off\"/>\n+                                <div class=\"form-group is-required\">\n+                                    <label class=\"control-label col-xs-12 col-md-3\" for=\"to\">\n+                                        <spring:message code=\"absence.period.endDate\"/>:\n+                                    </label>\n+                                    <div class=\"col-xs-8 col-md-5\">\n+                                        <form:input id=\"to\" path=\"endDate\" class=\"form-control\"\n+                                                    cssErrorClass=\"form-control error\" placeholder=\"${DATE_PATTERN}\"\n+                                                    autocomplete=\"off\" data-iso-value=\"${application.endDateIsoValue}\"/>\n+                                    </div>\n+                                    <div class=\"col-xs-4 col-md-4\">\n+                                        <form:input id=\"endTime\" path=\"endTime\" class=\"form-control\"\n+                                                    cssErrorClass=\"form-control error\" placeholder=\"${TIME_PATTERN}\"\n+                                                    autocomplete=\"off\"/>\n+                                    </div>\n                                 </div>\n-                            </div>\n \n-                            <div id=\"days-count\" class=\"form-group ${IS_DAYS_COUNT_SHOWN}\">\n-                                <div class=\"col-md-9 col-md-offset-3\">\n-                                    <span class=\"info days tw-text-sm\"></span>\n+                                <div id=\"days-count\" class=\"form-group ${IS_DAYS_COUNT_SHOWN}\">\n+                                    <div class=\"col-md-9 col-md-offset-3\">\n+                                        <span class=\"info days tw-text-sm\"></span>\n+                                    </div>\n                                 </div>\n                             </div>\n-                        </div>\n \n-                        <div class=\"col-md-4\">\n-                            <div class=\"form-group\">\n-                                <div class=\"col-xs-9\">\n-                                    <span id=\"departmentVacations\" class=\"help-block info tw-text-sm\"></span>\n+                            <div class=\"col-md-4\">\n+                                <div class=\"form-group\">\n+                                    <div class=\"col-xs-9\">\n+                                        <span id=\"departmentVacations\" class=\"help-block info tw-text-sm\"></span>\n+                                    </div>\n                                 </div>\n                             </div>\n                         </div>\n-                    </div>\n \n-                    <%-- Absence Period --%>\n-                    <div class=\"row\">\n-                        <div class=\"col-md-8\">\n-                            <div class=\"form-group is-required\">\n-                                <label class=\"control-label col-md-3\">\n-                                    <spring:message code=\"absence.period\"/>:\n-                                </label>\n-                                <div class=\"col-md-9 radio\">\n-                                    <label class=\"thirds\">\n-                                        <form:radiobutton id=\"fullDay\" class=\"dayLength-full\" path=\"dayLength\" checked=\"checked\" value=\"FULL\"/>\n-                                        <spring:message code=\"FULL\"/>\n-                                    </label>\n-                                    <label class=\"thirds\">\n-                                        <form:radiobutton id=\"morning\" class=\"dayLength-half\" path=\"dayLength\" value=\"MORNING\"/>\n-                                        <spring:message code=\"MORNING\"/>\n-                                    </label>\n-                                    <label class=\"thirds\">\n-                                        <form:radiobutton id=\"noon\" class=\"dayLength-half\" path=\"dayLength\" value=\"NOON\"/>\n-                                        <spring:message code=\"NOON\"/>\n+                            <%-- Absence Period --%>\n+                        <div class=\"row\">\n+                            <div class=\"col-md-8\">\n+                                <div class=\"form-group is-required\">\n+                                    <label class=\"control-label col-md-3\">\n+                                        <spring:message code=\"absence.period\"/>:\n                                     </label>\n+                                    <div class=\"col-md-9 radio\">\n+                                        <label class=\"thirds\">\n+                                            <form:radiobutton id=\"fullDay\" class=\"dayLength-full\" path=\"dayLength\"\n+                                                              checked=\"checked\" value=\"FULL\"/>\n+                                            <spring:message code=\"FULL\"/>\n+                                        </label>\n+                                        <label class=\"thirds\">\n+                                            <form:radiobutton id=\"morning\" class=\"dayLength-half\" path=\"dayLength\"\n+                                                              value=\"MORNING\"/>\n+                                            <spring:message code=\"MORNING\"/>\n+                                        </label>\n+                                        <label class=\"thirds\">\n+                                            <form:radiobutton id=\"noon\" class=\"dayLength-half\" path=\"dayLength\"\n+                                                              value=\"NOON\"/>\n+                                            <spring:message code=\"NOON\"/>\n+                                        </label>\n+                                    </div>\n                                 </div>\n                             </div>\n                         </div>\n-                    </div>\n \n-                    <%-- Overtime Information--%>\n-                    <c:if test=\"${overtimeActive}\">\n-                    <div class=\"row ${IS_OVERTIME_SHOWN}\" id=\"overtime\">\n-                        <div class=\"col-md-8\">\n-                            <div class=\"form-group is-required\" id=\"form-group--hours\">\n-                                <label class=\"control-label col-md-3\" for=\"hours\">\n-                                    <spring:message code=\"application.data.hours\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <form:input path=\"hours\" class=\"form-control\" cssErrorClass=\"form-control error\"/>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"hours\" />\n-                                    </uv:error-text>\n+                            <%-- Overtime Information--%>\n+                        <c:if test=\"${overtimeActive}\">\n+                            <div class=\"row ${IS_OVERTIME_SHOWN}\" id=\"overtime\">\n+                                <div class=\"col-md-8\">\n+                                    <div class=\"form-group is-required\" id=\"form-group--hours\">\n+                                        <label class=\"control-label col-md-3\" for=\"hours\">\n+                                            <spring:message code=\"application.data.hours\"/>:\n+                                        </label>\n+                                        <div class=\"col-md-9\">\n+                                            <form:input path=\"hours\" class=\"form-control\"\n+                                                        cssErrorClass=\"form-control error\"/>\n+                                            <uv:error-text>\n+                                                <form:errors path=\"hours\"/>\n+                                            </uv:error-text>\n+                                        </div>\n+                                    </div>\n                                 </div>\n                             </div>\n-                        </div>\n-                    </div>\n-                    </c:if>\n+                        </c:if>\n \n-                    <%-- Special Leave Information --%>\n-                    <div class=\"row ${IS_SPECIALLEAVE_SHOWN}\" id=\"special-leave\">\n-                        <div class=\"col-md-8\">\n-                            <div class=\"form-group is-required\" id=\"form-group--reason\">\n-                                <label class=\"control-label col-md-3\" for=\"reason\">\n-                                    <spring:message code=\"application.data.reason\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <small>\n-                                        <span id=\"text-reason\"></span><spring:message code=\"action.comment.maxChars\"/>\n-                                    </small>\n-                                    <form:textarea id=\"reason\" rows=\"1\" path=\"reason\" class=\"form-control\"\n-                                                   cssErrorClass=\"form-control error\"\n-                                                   onkeyup=\"count(this.value, 'text-reason');\"\n-                                                   onkeydown=\"maxChars(this,200); count(this.value, 'text-reason');\"/>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"reason\" />\n-                                    </uv:error-text>\n+                            <%-- Special Leave Information --%>\n+                        <div class=\"row ${IS_SPECIALLEAVE_SHOWN}\" id=\"special-leave\">\n+                            <div class=\"col-md-8\">\n+                                <div class=\"form-group is-required\" id=\"form-group--reason\">\n+                                    <label class=\"control-label col-md-3\" for=\"reason\">\n+                                        <spring:message code=\"application.data.reason\"/>:\n+                                    </label>\n+                                    <div class=\"col-md-9\">\n+                                        <small>\n+                                            <span id=\"text-reason\"></span><spring:message\n+                                            code=\"action.comment.maxChars\"/>\n+                                        </small>\n+                                        <form:textarea id=\"reason\" rows=\"1\" path=\"reason\" class=\"form-control\"\n+                                                       cssErrorClass=\"form-control error\"\n+                                                       onkeyup=\"count(this.value, 'text-reason');\"\n+                                                       onkeydown=\"maxChars(this,200); count(this.value, 'text-reason');\"/>\n+                                        <uv:error-text>\n+                                            <form:errors path=\"reason\"/>\n+                                        </uv:error-text>\n+                                    </div>\n                                 </div>\n                             </div>\n-                        </div>\n-                        <div class=\"col-md-6 col-md-push-2\">\n+                            <div class=\"col-md-6 col-md-push-2\">\n                             <span class=\"help-block tw-text-sm\">\n-                                <icon:information-circle className=\"tw-w-4 tw-h-4\" solid=\"true\" />\n+                                <icon:information-circle className=\"tw-w-4 tw-h-4\" solid=\"true\"/>\n                                 <spring:message code=\"application.data.description\"/>\n                             </span>\n+                            </div>\n                         </div>\n                     </div>\n-                </div>\n \n-                <div class=\"form-section tw-mb-16\">\n-                    <uv:section-heading>\n-                        <h2>\n-                            <spring:message code=\"application.data.furtherInformation.title\"/>\n-                        </h2>\n-                    </uv:section-heading>\n+                    <div class=\"form-section tw-mb-16\">\n+                        <uv:section-heading>\n+                            <h2>\n+                                <spring:message code=\"application.data.furtherInformation.title\"/>\n+                            </h2>\n+                        </uv:section-heading>\n \n-                    <div class=\"row\">\n-                        <div class=\"col-md-8\">\n+                        <div class=\"row\">\n+                            <div class=\"col-md-8\">\n \n-                            <%-- agreed wiht team --%>\n-                            <div class=\"form-group\">\n-                                <label class=\"control-label col-md-3\">\n-                                    <spring:message code=\"application.data.teamInformed\"/>:\n-                                </label>\n-                                <div class=\"col-md-9 radio\">\n-                                    <label class=\"thirds\">\n-                                        <form:radiobutton id=\"teamInformed\" path=\"teamInformed\" value=\"true\"/>\n-                                        <spring:message code=\"application.data.teamInformed.true\"/>\n+                                    <%-- agreed wiht team --%>\n+                                <div class=\"form-group\">\n+                                    <label class=\"control-label col-md-3\">\n+                                        <spring:message code=\"application.data.teamInformed\"/>:\n                                     </label>\n-                                    <label class=\"thirds\">\n-                                        <form:radiobutton id=\"teamNotInformed\" path=\"teamInformed\" value=\"false\"/>\n-                                        <spring:message code=\"application.data.teamInformed.false\"/>\n-                                    </label>\n-                                    <label class=\"thirds\"></label>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"teamInformed\" />\n-                                    </uv:error-text>\n+                                    <div class=\"col-md-9 radio\">\n+                                        <label class=\"thirds\">\n+                                            <form:radiobutton id=\"teamInformed\" path=\"teamInformed\" value=\"true\"/>\n+                                            <spring:message code=\"application.data.teamInformed.true\"/>\n+                                        </label>\n+                                        <label class=\"thirds\">\n+                                            <form:radiobutton id=\"teamNotInformed\" path=\"teamInformed\" value=\"false\"/>\n+                                            <spring:message code=\"application.data.teamInformed.false\"/>\n+                                        </label>\n+                                        <label class=\"thirds\"></label>\n+                                        <uv:error-text>\n+                                            <form:errors path=\"teamInformed\"/>\n+                                        </uv:error-text>\n+                                    </div>\n                                 </div>\n-                            </div>\n \n-                            <%-- holiday replacement--%>\n-                            <div class=\"form-group\">\n-                                <label class=\"control-label col-md-3\" for=\"holidayReplacement\">\n-                                    <spring:message code=\"application.data.holidayReplacement\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <uv:select id=\"holidayReplacement\" name=\"holidayReplacement\" onchange=\"holidayReplacementChanged(this.value);\">\n-                                        <option value=\"-1\">\n-                                            <spring:message code=\"application.data.holidayReplacement.none\" />\n-                                        </option>\n-                                        <c:forEach items=\"${persons}\" var=\"holidayReplacement\">\n-                                            <c:choose>\n-                                                <c:when test=\"${application.holidayReplacement.id == holidayReplacement.id}\">\n-                                                    <option value=\"${holidayReplacement.id}\" selected=\"selected\">\n-                                                        <c:out value=\"${holidayReplacement.niceName}\"/>\n-                                                    </option>\n-                                                </c:when>\n-                                                <c:otherwise>\n-                                                    <c:if test=\"${person.id != holidayReplacement.id}\">\n-                                                        <option value=\"${holidayReplacement.id}\">\n-                                                            <c:out value=\"${holidayReplacement.niceName}\"/>\n+                                <%-- holiday replacement--%>\n+                                <c:if test=\"${not empty persons}\">\n+                                    <div class=\"form-group\">\n+                                        <label class=\"control-label col-md-3\">\n+                                            <spring:message code=\"application.data.holidayReplacement\"/>\n+                                        </label>\n+                                        <div class=\"col-md-9\">\n+                                            <div class=\"tw-flex\">\n+                                                <uv:select\n+                                                    id=\"holiday-replacement-select\"\n+                                                    name=\"holidayReplacementToAdd\"\n+                                                    cssClass=\"tw-rounded-l tw-rounded-r-none\"\n+                                                >\n+                                                    <option value=\"\"></option>\n+                                                    <c:forEach items=\"${selectableHolidayReplacements}\" var=\"person\">\n+                                                        <option value=\"${person.personId}\">\n+                                                            <c:out value=\"${person.displayName}\"/>\n                                                         </option>\n-                                                    </c:if>\n-                                                </c:otherwise>\n-                                            </c:choose>\n-                                        </c:forEach>\n-                                    </uv:select>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"holidayReplacement\" />\n-                                    </uv:error-text>\n-                                </div>\n-                            </div>\n-\n-                            <%-- holiday replacement note--%>\n-                            <div id=\"holidayReplacementNoteRow\" class=\"form-group ${IS_VACATION_REPLACEMENT_SHOWN}\">\n-                                <label class=\"control-label col-md-3\" for=\"holidayReplacementNote\">\n-                                    <spring:message code=\"application.data.holidayReplacementNote\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <small>\n-                                        <span id=\"text-holiday-replacement-note\"></span><spring:message code=\"action.comment.maxChars\"/>\n-                                    </small>\n-                                    <form:textarea id=\"holidayReplacementNote\" rows=\"1\" path=\"holidayReplacementNote\" class=\"form-control\"\n-                                                   cssErrorClass=\"form-control error\"\n-                                                   onkeyup=\"count(this.value, 'text-holiday-replacement-note');\"\n-                                                   onkeydown=\"maxChars(this,200); count(this.value, 'text-holiday-replacement-note');\"/>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"holidayReplacementNote\" />\n-                                    </uv:error-text>\n-                                </div>\n-                            </div>\n+                                                    </c:forEach>\n+                                                </uv:select>\n+                                                <button\n+                                                    type=\"submit\"\n+                                                    class=\"tw-text-gray-700 tw-border tw-border-l-0 tw-border-gray-300 tw-font-medium tw-rounded-r tw-px-4 hover:tw-bg-gray-200 tw-text-sm\"\n+                                                    name=\"add-holiday-replacement\"\n+                                                    formmethod=\"post\"\n+                                                    formaction=\"${ADD_REPLACEMENT_ACTION}\"\n+                                                >\n+                                                    <spring:message code=\"application.data.holidayReplacement.add-button.text\" />\n+                                                </button>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n \n+                                    <c:if test=\"${not empty application.holidayReplacements}\">\n+                                        <c:forEach items=\"${application.holidayReplacements}\" var=\"holidayReplacement\"\n+                                                   varStatus=\"loop\">\n+                                            <div id=\"holidayReplacementNoteRow\" class=\"form-group\">\n+                                                <label class=\"control-label col-md-3\">\n+                                                </label>\n+                                                <div class=\"col-md-9\">\n+                                                    <div class=\"tw-flex tw-justify-between tw-items-end tw-mb-1\">\n+                                                        <p class=\"tw-m-0\">\n+                                                            <spring:message code=\"application.data.holidayReplacementNote\"/>\n+                                                            <c:out value=\"${holidayReplacement.person.firstName}\"/> <c:out\n+                                                            value=\"${holidayReplacement.person.lastName}\"/>:\n+                                                        </p>\n+                                                        <div>\n+                                                            <button\n+                                                                type=\"submit\"\n+                                                                class=\"tw-bg-transparent tw-text-sm tw-p-0 tw-flex tw-items-center tw-text-black tw-text-opacity-80 hover:tw-text-opacity-100 focus:tw-text-opacity-100 tw-transition-colors\"\n+                                                                name=\"remove-holiday-replacement\"\n+                                                                value=\"${holidayReplacement.person.id}\"\n+                                                                formmethod=\"post\"\n+                                                                formaction=\"${ADD_REPLACEMENT_ACTION}\"\n+                                                            >\n+                                                                <span>\n+                                                                    Vertretung entfernen\n+                                                                </span>\n+                                                                <icon:trash className=\"tw-w-4 tw-h-4\" />\n+                                                            </button>\n+                                                        </div>\n+                                                    </div>\n+                                                    <form:input\n+                                                        path=\"holidayReplacements[${loop.index}].person\"\n+                                                        cssClass=\"hidden\"\n+                                                    />\n+                                                    <form:textarea\n+                                                        rows=\"1\"\n+                                                        path=\"holidayReplacements[${loop.index}].note\"\n+                                                        class=\"form-control\"\n+                                                        cssErrorClass=\"form-control error\"\n+                                                        onkeyup=\"count(this.value, 'text-holiday-replacement-note-${loop.index}');\"\n+                                                        onkeydown=\"maxChars(this,200); count(this.value, 'text-holiday-replacement-note-${loop.index}');\"\n+                                                    />\n+                                                    <div class=\"tw-mt-1\">\n+                                                        <small class=\"tw-flex tw-justify-between tw-text-sm tw-text-black tw-text-opacity-50\">\n+                                                            <span class=\"tw-flex-grow\"></span>\n+                                                            <span id=\"text-holiday-replacement-note-${loop.index}\"></span><spring:message\n+                                                            code=\"action.comment.maxChars\"/>\n+                                                        </small>\n+                                                    </div>\n+                                                    <uv:error-text>\n+                                                        <form:errors path=\"holidayReplacementNote\"/>\n+                                                    </uv:error-text>\n+                                                </div>\n+                                            </div>\n+                                        </c:forEach>\n+                                    </c:if>\n+                                </c:if>\n \n-                            <%-- Address and phone number--%>\n-                            <div class=\"form-group\">\n-                                <label class=\"control-label col-md-3\" for=\"address\">\n-                                    <spring:message code=\"application.data.furtherInformation.address\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <small>\n-                                        <span id=\"text-address\"></span><spring:message code=\"action.comment.maxChars\"/>\n-                                    </small>\n-                                    <form:textarea id=\"address\" rows=\"1\" path=\"address\" class=\"form-control\"\n-                                                   cssErrorClass=\"form-control error\"\n-                                                   onkeyup=\"count(this.value, 'text-address');\"\n-                                                   onkeydown=\"maxChars(this,200); count(this.value, 'text-address');\"/>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"address\" />\n-                                    </uv:error-text>\n+                                    <%-- Address and phone number--%>\n+                                <div class=\"form-group\">\n+                                    <label class=\"control-label col-md-3\" for=\"address\">\n+                                        <spring:message code=\"application.data.furtherInformation.address\"/>:\n+                                    </label>\n+                                    <div class=\"col-md-9\">\n+                                        <form:textarea id=\"address\" rows=\"1\" path=\"address\" class=\"form-control\"\n+                                                       cssErrorClass=\"form-control error\"\n+                                                       onkeyup=\"count(this.value, 'text-address');\"\n+                                                       onkeydown=\"maxChars(this,200); count(this.value, 'text-address');\"/>\n+                                        <div class=\"tw-mt-1\">\n+                                            <small class=\"tw-flex tw-justify-between tw-text-sm tw-text-black tw-text-opacity-50\">\n+                                                <span class=\"tw-flex-grow\"></span>\n+                                                <span id=\"text-address\"></span><spring:message\n+                                                code=\"action.comment.maxChars\"/>\n+                                            </small>\n+                                        </div>\n+                                        <uv:error-text>\n+                                            <form:errors path=\"address\"/>\n+                                        </uv:error-text>\n+                                    </div>\n                                 </div>\n-                            </div>\n \n-                            <%-- Comment --%>\n-                            <div class=\"form-group\">\n-                                <label class=\"control-label col-md-3\" for=\"comment\">\n-                                    <spring:message code=\"application.data.furtherInformation.comment\"/>:\n-                                </label>\n-                                <div class=\"col-md-9\">\n-                                    <small>\n-                                        <span id=\"text-comment\"></span><spring:message code=\"action.comment.maxChars\"/>\n-                                    </small>\n-                                    <form:textarea id=\"comment\" rows=\"1\" path=\"comment\" class=\"form-control\"\n-                                                   cssErrorClass=\"form-control error\"\n-                                                   onkeyup=\"count(this.value, 'text-comment');\"\n-                                                   onkeydown=\"maxChars(this,200); count(this.value, 'text-comment');\"/>\n-                                    <uv:error-text>\n-                                        <form:errors path=\"comment\" />\n-                                    </uv:error-text>\n+                                    <%-- Comment --%>\n+                                <div class=\"form-group\">\n+                                    <label class=\"control-label col-md-3\" for=\"comment\">\n+                                        <spring:message code=\"application.data.furtherInformation.comment\"/>:\n+                                    </label>\n+                                    <div class=\"col-md-9\">\n+                                        <form:textarea id=\"comment\" rows=\"1\" path=\"comment\" class=\"form-control\"\n+                                                       cssErrorClass=\"form-control error\"\n+                                                       onkeyup=\"count(this.value, 'text-comment');\"\n+                                                       onkeydown=\"maxChars(this,200); count(this.value, 'text-comment');\"/>\n+                                        <div class=\"tw-mt-1\">\n+                                            <small class=\"tw-flex tw-justify-between tw-text-sm tw-text-black tw-text-opacity-50\">\n+                                                <span class=\"tw-flex-grow\"></span>\n+                                                <span id=\"text-comment\"></span><spring:message\n+                                                code=\"action.comment.maxChars\"/>\n+                                            </small>\n+                                        </div>\n+                                        <uv:error-text>\n+                                            <form:errors path=\"comment\"/>\n+                                        </uv:error-text>\n+                                    </div>\n                                 </div>\n                             </div>\n                         </div>\n                     </div>\n-                </div>\n \n-                <div class=\"form-section\">\n-                    <div class=\"row\">\n-                        <div class=\"col-xs-12\">\n-                            <hr />\n-                            <button id=\"apply-application\" type=\"submit\" class=\"btn btn-success pull-left col-xs-12 col-sm-5 col-md-2\">\n-                                <spring:message code=\"action.apply.vacation\"/>\n-                            </button>\n-                            <button type=\"button\" class=\"btn btn-default back col-xs-12 col-sm-5 col-md-2 pull-right\">\n-                                <spring:message code=\"action.cancel\"/>\n-                            </button>\n+                    <div class=\"form-section\">\n+                        <div class=\"row\">\n+                            <div class=\"col-xs-12\">\n+                                <hr/>\n+                                <button id=\"apply-application\" type=\"submit\"\n+                                        class=\"btn btn-success pull-left col-xs-12 col-sm-5 col-md-2\">\n+                                    <spring:message code=\"action.apply.vacation\"/>\n+                                </button>\n+                                <button type=\"button\"\n+                                        class=\"btn btn-default back col-xs-12 col-sm-5 col-md-2 pull-right\">\n+                                    <spring:message code=\"action.cancel\"/>\n+                                </button>\n+                            </div>\n                         </div>\n                     </div>\n-                </div>\n-            </form:form>\n-        </c:otherwise>\n-    </c:choose>\n+                </form:form>\n+            </c:otherwise>\n+        </c:choose>\n     </div>\n     <!-- End of grid container -->\n "
  }
]
