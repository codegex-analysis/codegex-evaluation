[
  {
    "sha": "e662b12309349007fceae82cf2a55862dfd16e71",
    "filename": "modules/caldav-sync/caldav-helper-service/bnd.bnd",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/smclab/caldav-sync/blob/675fd258bf7b153a14bab6d8555fca911ae26b36/modules/caldav-sync/caldav-helper-service/bnd.bnd",
    "raw_url": "https://github.com/smclab/caldav-sync/raw/675fd258bf7b153a14bab6d8555fca911ae26b36/modules/caldav-sync/caldav-helper-service/bnd.bnd",
    "contents_url": "https://api.github.com/repos/smclab/caldav-sync/contents/modules/caldav-sync/caldav-helper-service/bnd.bnd?ref=675fd258bf7b153a14bab6d8555fca911ae26b36",
    "patch": "@@ -3,6 +3,6 @@ Bundle-DocURL: http://www.smc.it\n Bundle-License: LGPL\n Bundle-Name: Caldav Helper Service\n Bundle-SymbolicName: it.smc.calendar.caldav.helper.service\n-Bundle-Version: 3.0.2\n+Bundle-Version: 3.0.3\n \n Export-Package: it.smc.calendar.caldav.helper.util"
  },
  {
    "sha": "3fb81979f66ee8b8067f03890be1b4dd53cbcf7c",
    "filename": "modules/caldav-sync/caldav-helper-service/src/main/java/it/smc/calendar/caldav/helper/CalendarListServiceImpl.java",
    "status": "modified",
    "additions": 40,
    "deletions": 17,
    "changes": 57,
    "blob_url": "https://github.com/smclab/caldav-sync/blob/675fd258bf7b153a14bab6d8555fca911ae26b36/modules/caldav-sync/caldav-helper-service/src/main/java/it/smc/calendar/caldav/helper/CalendarListServiceImpl.java",
    "raw_url": "https://github.com/smclab/caldav-sync/raw/675fd258bf7b153a14bab6d8555fca911ae26b36/modules/caldav-sync/caldav-helper-service/src/main/java/it/smc/calendar/caldav/helper/CalendarListServiceImpl.java",
    "contents_url": "https://api.github.com/repos/smclab/caldav-sync/contents/modules/caldav-sync/caldav-helper-service/src/main/java/it/smc/calendar/caldav/helper/CalendarListServiceImpl.java?ref=675fd258bf7b153a14bab6d8555fca911ae26b36",
    "patch": "@@ -38,6 +38,7 @@\n import it.smc.calendar.caldav.helper.util.PropsValues;\n \n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n@@ -75,15 +76,13 @@\n \t\t\t\t\tList<Calendar> userCalendars = getUserCalendars(\n \t\t\t\t\t\tpermissionChecker.getUserId());\n \n-\t\t\t\t\tif (userCalendars != null) {\n-\t\t\t\t\t\tif (_log.isDebugEnabled()) {\n-\t\t\t\t\t\t\tfor (Calendar calendar : userCalendars) {\n-\t\t\t\t\t\t\t\t_log.debug(\" - \" + calendar.getName());\n-\t\t\t\t\t\t\t}\n+\t\t\t\t\tif (_log.isDebugEnabled()) {\n+\t\t\t\t\t\tfor (Calendar calendar : userCalendars) {\n+\t\t\t\t\t\t\t_log.debug(\" - \" + calendar.getName());\n \t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tcalendars.addAll(userCalendars);\n \t\t\t\t\t}\n+\n+\t\t\t\t\tcalendars.addAll(userCalendars);\n \t\t\t\t}\n \t\t\t}\n \n@@ -136,14 +135,22 @@ else if (_log.isDebugEnabled()) {\n \t\t\t\tQueryUtil.ALL_POS, QueryUtil.ALL_POS);\n \n \t\t\tfor (Calendar calendar : allCalendars) {\n-\t\t\t\tif (_calendarModelResourcePermission.contains(\n+\t\t\t\ttry {\n+\t\t\t\t\tif (_calendarModelResourcePermission.contains(\n \t\t\t\t\t\tpermissionChecker, calendar, ActionKeys.VIEW)) {\n \n-\t\t\t\t\tif (_log.isDebugEnabled()) {\n-\t\t\t\t\t\t_log.debug(\" - \" + calendar.getName());\n-\t\t\t\t\t}\n+\t\t\t\t\t\tif (_log.isDebugEnabled()) {\n+\t\t\t\t\t\t\t_log.debug(\" - \" + calendar.getName());\n+\t\t\t\t\t\t}\n \n-\t\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcatch (PortalException pe) {\n+\t\t\t\t\tif (_log.isWarnEnabled()) {\n+\t\t\t\t\t\t_log.warn(\n+\t\t\t\t\t\t\t\"Can not add calendar: \" + calendar.getName(), pe);\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t}\n@@ -178,10 +185,18 @@ else if (_log.isDebugEnabled()) {\n \t\t\t\tcontinue;\n \t\t\t}\n \n-\t\t\tif (_calendarModelResourcePermission.contains(\n+\t\t\ttry {\n+\t\t\t\tif (_calendarModelResourcePermission.contains(\n \t\t\t\t\tpermissionChecker, calendarId, ActionKeys.VIEW)) {\n \n-\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tcatch (PortalException pe) {\n+\t\t\t\tif (_log.isWarnEnabled()) {\n+\t\t\t\t\t_log.warn(\n+\t\t\t\t\t\t\"Can not add calendar: \" + calendar.getName(), pe);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n@@ -205,7 +220,7 @@ else if (_log.isDebugEnabled()) {\n \t\t\t_log.error(pe, pe);\n \t\t}\n \n-\t\treturn null;\n+\t\treturn Collections.emptyList();\n \t}\n \n \tpublic List<Calendar> getUserGroupCalendars(\n@@ -224,10 +239,18 @@ else if (_log.isDebugEnabled()) {\n \n \t\tfor (CalendarResource calendarResource : calendarResources) {\n \t\t\tfor (Calendar calendar : calendarResource.getCalendars()) {\n-\t\t\t\tif (_calendarModelResourcePermission.contains(\n+\t\t\t\ttry {\n+\t\t\t\t\tif (_calendarModelResourcePermission.contains(\n \t\t\t\t\t\tpermissionChecker, calendar, ActionKeys.VIEW)) {\n \n-\t\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t\t\tcalendars.add(calendar);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcatch (PortalException pe) {\n+\t\t\t\t\tif (_log.isWarnEnabled()) {\n+\t\t\t\t\t\t_log.warn(\n+\t\t\t\t\t\t\t\"Can not add calendar: \" + calendar.getName(), pe);\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t}"
  }
]
