[
  {
    "sha": "5bb36020cb18e059bd4391b34d68ff492c29e345",
    "filename": "dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java",
    "status": "modified",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/dockstore/dockstore/blob/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java",
    "raw_url": "https://github.com/dockstore/dockstore/raw/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java",
    "contents_url": "https://api.github.com/repos/dockstore/dockstore/contents/dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java?ref=c47a9d680a14180e10014bd25a1b236c5ba852fc",
    "patch": "@@ -99,6 +99,7 @@\n import io.dockstore.webservice.resources.MetadataResource;\n import io.dockstore.webservice.resources.NotificationResource;\n import io.dockstore.webservice.resources.OrganizationResource;\n+import io.dockstore.webservice.resources.RefererHeaderLengthLimitFilter;\n import io.dockstore.webservice.resources.ServiceResource;\n import io.dockstore.webservice.resources.TemplateHealthCheck;\n import io.dockstore.webservice.resources.TokenResource;\n@@ -430,6 +431,8 @@ private void registerAPIsAndMisc(Environment environment) {\n \n         // Filter used to log every request an admin user makes.\n         environment.jersey().register(new AdminPrivilegesFilter());\n+        // Filter used to deny requests where the referer header exceeds set limit\n+        environment.jersey().register(new RefererHeaderLengthLimitFilter());\n \n         // Swagger providers\n         environment.jersey().register(ApiListingResource.class);"
  },
  {
    "sha": "a270c17afe0793b8678b96cd2dce5e9bd53cea19",
    "filename": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/RefererHeaderLengthLimitFilter.java",
    "status": "added",
    "additions": 39,
    "deletions": 0,
    "changes": 39,
    "blob_url": "https://github.com/dockstore/dockstore/blob/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/RefererHeaderLengthLimitFilter.java",
    "raw_url": "https://github.com/dockstore/dockstore/raw/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/RefererHeaderLengthLimitFilter.java",
    "contents_url": "https://api.github.com/repos/dockstore/dockstore/contents/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/RefererHeaderLengthLimitFilter.java?ref=c47a9d680a14180e10014bd25a1b236c5ba852fc",
    "patch": "@@ -0,0 +1,39 @@\n+package io.dockstore.webservice.resources;\n+\n+import java.util.List;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerRequestFilter;\n+\n+import io.dockstore.webservice.CustomWebApplicationException;\n+import org.apache.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Every request will be filtered through here to determine if the length of the referer header does exceed our limit.\n+ * This is done for two reasons:\n+ * 1. Prevent very long query parameters. For Dockstore, these should be relatively short for the most part.\n+ * 2. The search page/elastic search will begin fail if the search query becomes too long. Although these appear to be query parameters, the UI\n+ * doesn't send them in the request URL. The only way I could see the full url is to look at the referer header.\n+ */\n+public class RefererHeaderLengthLimitFilter implements ContainerRequestFilter {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(AdminPrivilegesFilter.class);\n+    private static final int LENGTH_LIMIT = 500;\n+\n+    @Override\n+    public void filter(ContainerRequestContext requestContext) {\n+        if (requestContext != null) {\n+            List<String> refererHeader = requestContext.getHeaders().get(\"Referer\");\n+            if (refererHeader != null && !refererHeader.isEmpty()) {\n+                String referer = refererHeader.get(0);\n+                if (referer.length() > LENGTH_LIMIT) {\n+                    String msg = \"Request exceeds url length limit.\";\n+                    LOG.info(msg);\n+                    throw new CustomWebApplicationException(msg, HttpStatus.SC_REQUEST_TOO_LONG);\n+                }\n+            }\n+        }\n+    }\n+}"
  },
  {
    "sha": "898e47c1aed3012b77f7ff3ae573bf2fd7b1058e",
    "filename": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml",
    "status": "modified",
    "additions": 139,
    "deletions": 14,
    "changes": 153,
    "blob_url": "https://github.com/dockstore/dockstore/blob/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/resources/openapi3/openapi.yaml",
    "raw_url": "https://github.com/dockstore/dockstore/raw/c47a9d680a14180e10014bd25a1b236c5ba852fc/dockstore-webservice/src/main/resources/openapi3/openapi.yaml",
    "contents_url": "https://api.github.com/repos/dockstore/dockstore/contents/dockstore-webservice/src/main/resources/openapi3/openapi.yaml?ref=c47a9d680a14180e10014bd25a1b236c5ba852fc",
    "patch": "@@ -13,15 +13,143 @@ components:\n           type: object\n       type: object\n     BioWorkflow:\n-      allOf:\n-        - $ref: '#/components/schemas/Workflow'\n-        - properties:\n-            is_checker:\n-              type: boolean\n-            parent_id:\n-              format: int64\n-              type: integer\n+      properties:\n+        aliases:\n+          additionalProperties:\n+            $ref: '#/components/schemas/Alias'\n           type: object\n+        author:\n+          type: string\n+        checker_id:\n+          format: int64\n+          type: integer\n+        conceptDoi:\n+          type: string\n+        dbCreateDate:\n+          format: int64\n+          type: integer\n+        dbUpdateDate:\n+          format: int64\n+          type: integer\n+        defaultTestParameterFilePath:\n+          type: string\n+        defaultVersion:\n+          type: string\n+        description:\n+          type: string\n+        descriptorType:\n+          enum:\n+            - CWL\n+            - WDL\n+            - gxformat2\n+            - SWL\n+            - NFL\n+            - service\n+          type: string\n+        descriptorTypeSubclass:\n+          enum:\n+            - docker-compose\n+            - helm\n+            - swarm\n+            - kubernetes\n+            - n/a\n+          type: string\n+        email:\n+          type: string\n+        forumUrl:\n+          maxLength: 256\n+          minLength: 0\n+          type: string\n+        full_workflow_path:\n+          type: string\n+        gitUrl:\n+          type: string\n+        has_checker:\n+          type: boolean\n+        id:\n+          format: int64\n+          type: integer\n+        input_file_formats:\n+          items:\n+            $ref: '#/components/schemas/FileFormat'\n+          type: array\n+          uniqueItems: true\n+        is_checker:\n+          type: boolean\n+        is_published:\n+          type: boolean\n+        labels:\n+          items:\n+            $ref: '#/components/schemas/Label'\n+          type: array\n+          uniqueItems: true\n+        lastUpdated:\n+          format: int64\n+          type: integer\n+        last_modified:\n+          format: int32\n+          type: integer\n+        last_modified_date:\n+          format: int64\n+          type: integer\n+        licenseInformation:\n+          $ref: '#/components/schemas/LicenseInformation'\n+        metadataFromEntry:\n+          $ref: '#/components/schemas/Workflow'\n+        metadataFromVersion:\n+          $ref: '#/components/schemas/Version'\n+        mode:\n+          enum:\n+            - FULL\n+            - STUB\n+            - HOSTED\n+            - DOCKSTORE_YML\n+          type: string\n+        organization:\n+          type: string\n+        output_file_formats:\n+          items:\n+            $ref: '#/components/schemas/FileFormat'\n+          type: array\n+          uniqueItems: true\n+        parent_id:\n+          format: int64\n+          type: integer\n+        path:\n+          type: string\n+        repository:\n+          type: string\n+        sourceControl:\n+          enum:\n+            - dockstore.org\n+            - github.com\n+            - bitbucket.org\n+            - gitlab.com\n+          type: string\n+        source_control_provider:\n+          type: string\n+        starredUsers:\n+          items:\n+            $ref: '#/components/schemas/User'\n+          type: array\n+          uniqueItems: true\n+        topicId:\n+          format: int64\n+          type: integer\n+        users:\n+          items:\n+            $ref: '#/components/schemas/User'\n+          type: array\n+          uniqueItems: true\n+        workflowName:\n+          type: string\n+        workflowVersions:\n+          items:\n+            $ref: '#/components/schemas/WorkflowVersion'\n+          type: array\n+          uniqueItems: true\n+        workflow_path:\n+          type: string\n       type: object\n     Checksum:\n       description: The checksum value and its type\n@@ -594,6 +722,7 @@ components:\n             - PUSH\n             - DELETE\n             - INSTALL\n+            - PUBLISH\n           type: string\n       type: object\n     Language:\n@@ -1877,7 +2006,7 @@ paths:\n           content:\n             application/json:\n               schema:\n-                $ref: '#/components/schemas/Aliasable'\n+                $ref: '#/components/schemas/WorkflowVersion'\n           description: default response\n       security:\n         - bearer: []\n@@ -6765,11 +6894,7 @@ paths:\n       responses:\n         default:\n           content:\n-            application/json:\n-              schema:\n-                items:\n-                  $ref: '#/components/schemas/Workflow'\n-                type: array\n+            application/json: {}\n           description: default response\n       security:\n         - bearer: []"
  }
]
