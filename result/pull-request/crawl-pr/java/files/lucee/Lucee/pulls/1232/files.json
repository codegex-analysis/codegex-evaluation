[
  {
    "sha": "9bcedd77d949d152f29a4e37ccabd251137c59bb",
    "filename": "test/tickets/LDEV3358.cfc",
    "status": "added",
    "additions": 72,
    "deletions": 0,
    "changes": 72,
    "blob_url": "https://github.com/lucee/Lucee/blob/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358.cfc",
    "raw_url": "https://github.com/lucee/Lucee/raw/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358.cfc",
    "contents_url": "https://api.github.com/repos/lucee/Lucee/contents/test/tickets/LDEV3358.cfc?ref=094988e9ef10df788610092d18d22fc6aa104f12",
    "patch": "@@ -0,0 +1,72 @@\n+component extends = \"org.lucee.cfml.test.LuceeTestCase\" {\n+\n+\tfunction beforeAll(){\n+\t\tvariables.uri = createURI(\"LDEV3358\");\n+\t}\n+\n+\tfunction run ( testResults , testBox ) {\n+\t\tdescribe(\"This testcase for LDEV-3358\",function(){\n+\t\t\t\n+\t\t\tit(title=\"Column with data type SMALLINT signed value max range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_signed',  value=32767 }\n+\t\t\t\t);\n+\t\t\t\texpect(trim(result.filecontent)).toBe(32767);\n+\t\t\t});\n+\n+\t\t\tit(title=\"Column with data type SMALLINT signed value between the range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_signed', value=32222}\n+\t\t\t\t);\n+\t\t\t\texpect(trim(result.filecontent)).toBe(32222);\n+\t\t\t});\n+\n+\t\t\tit(title=\"Column with data type SMALLINT signed value between the range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_signed', value=31000 }\n+\t\t\t\t);\n+\t\t\t\texpect(trim(result.filecontent)).toBe(31000);\n+\t\t\t});\n+\t\t\t\n+\t\t\tit(title=\"Column with data type SMALLINT unsigned value between the range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_unsigned', value=32767}\n+\t\t\t\t\t);\n+\t\t\t\t\texpect(trim(result.filecontent)).toBe(32767);\n+\t\t\t\t});\n+\n+\t\t\tit(title=\"Column with data type SMALLINT unsigned value between the range but higher than signed range without sqltype\",body =function( currentSpec ){\n+\t\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\t\tforms = {scene=2, columnName='id_unsigned', value=32768 }\n+\t\t\t\t\t);\n+\t\t\t\t\texpect(trim(result.filecontent)).toBe(32768);\n+\t\t\t});\n+\n+\t\t\tit(title=\"Column with data type SMALLINT unsigned value between the range but higher than signed range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_unsigned', value=60000 }\n+\t\t\t\t);\n+\t\t\t\texpect(trim(result.filecontent)).toBe(60000);\n+\t\t\t});\t\n+\n+\t\t\tit(title=\"Column with data type SMALLINT unsigned value between the range but higher than signed range\",body =function( currentSpec ){\n+\t\t\t\tlocal.result = _InternalRequest(\n+\t\t\t\t\ttemplate :  \"#uri#/test.cfm\",\n+\t\t\t\t\tforms = {scene=1, columnName='id_unsigned', value=32768 }\n+\t\t\t\t);\n+\t\t\t\texpect(trim(result.filecontent)).toBe(32768);\n+\t\t\t});\n+\t\t});\n+\t}\n+\n+\tprivate string function createURI(string calledName){\n+\t\tvar baseURI = \"/test/#listLast(getDirectoryFromPath(getCurrenttemplatepath()),\"\\/\")#/\";\n+\t\treturn baseURI&\"\"&calledName;\n+\t}\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "12df0d4ce5c6a41f79bf828126247746ceaab8f5",
    "filename": "test/tickets/LDEV3358/Application.cfc",
    "status": "added",
    "additions": 64,
    "deletions": 0,
    "changes": 64,
    "blob_url": "https://github.com/lucee/Lucee/blob/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358/Application.cfc",
    "raw_url": "https://github.com/lucee/Lucee/raw/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358/Application.cfc",
    "contents_url": "https://api.github.com/repos/lucee/Lucee/contents/test/tickets/LDEV3358/Application.cfc?ref=094988e9ef10df788610092d18d22fc6aa104f12",
    "patch": "@@ -0,0 +1,64 @@\n+component {\n+\n+\tmySQL=getCredencials();\n+\tthis.name = \"LDEV3358\";\n+\tthis.datasources[\"LDEV3358\"] = {\n+\t\t  class: 'com.mysql.cj.jdbc.Driver'\n+\t\t, bundleName: 'com.mysql.cj'\n+\t\t, bundleVersion: '8.0.19'\n+\t\t, connectionString: 'jdbc:mysql://'&mySQL.server&':'&mySQL.port&'/'&mySQL.database&'?characterEncoding=UTF-8'\n+\t\t, username: \"root\"\n+\t\t, password: \"\"\n+\t};\n+\tthis.datasource = \"LDEV3358\";\n+\t\n+\tpublic function onRequestStart(){\n+\t\tquery{\n+\t\t\techo('DROP TABLE IF EXISTS LDEV3358');\n+\t\t}\n+\t\tquery{\n+\t\t\techo(\"CREATE TABLE LDEV3358( id_signed smallint, id_unsigned smallint unsigned, value varchar(20) )\");\n+\t\t}\n+\n+\t\tquery{\n+\t\t\techo(\"INSERT into LDEV3358 values( 32767, 32767, 'lucee'), ( 32222, 60000, 'lucee'), ( 31000, 32768, 'lucee')\");\n+\t\t}\n+\t}\n+\n+\tprivate struct function getCredencials() {\n+\t\tvar mySQL={};\n+\t\tif(\n+\t\t\t!isNull(server.system.environment.MYSQL_SERVER) && \n+\t\t\t!isNull(server.system.environment.MYSQL_USERNAME) && \n+\t\t\t!isNull(server.system.environment.MYSQL_PASSWORD) && \n+\t\t\t!isNull(server.system.environment.MYSQL_PORT) && \n+\t\t\t!isNull(server.system.environment.MYSQL_DATABASE)) {\n+\t\t\tmySQL.server=server.system.environment.MYSQL_SERVER;\n+\t\t\tmySQL.username=server.system.environment.MYSQL_USERNAME;\n+\t\t\tmySQL.password=server.system.environment.MYSQL_PASSWORD;\n+\t\t\tmySQL.port=server.system.environment.MYSQL_PORT;\n+\t\t\tmySQL.database=server.system.environment.MYSQL_DATABASE;\n+\n+\t\t}\n+\t\telse if(\n+\t\t\t!isNull(server.system.properties.MYSQL_SERVER) && \n+\t\t\t!isNull(server.system.properties.MYSQL_USERNAME) && \n+\t\t\t!isNull(server.system.properties.MYSQL_PASSWORD) && \n+\t\t\t!isNull(server.system.properties.MYSQL_PORT) && \n+\t\t\t!isNull(server.system.properties.MYSQL_DATABASE)) {\n+\t\t\tmySQL.server=server.system.properties.MYSQL_SERVER;\n+\t\t\tmySQL.username=server.system.properties.MYSQL_USERNAME;\n+\t\t\tmySQL.password=server.system.properties.MYSQL_PASSWORD;\n+\t\t\tmySQL.port=server.system.properties.MYSQL_PORT;\n+\t\t\tmySQL.database=server.system.properties.MYSQL_DATABASE;\n+\t\t\t\n+\t\t}\n+\t\treturn mySQL;\n+\t}\n+\n+\tpublic function onRequestEnd(){\n+\t\tquery{\n+\t\t\techo('DROP TABLE IF EXISTS LDEV3358');\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "e4dc7091dbc7b9c1eb97122adb5b6a5b6a065b14",
    "filename": "test/tickets/LDEV3358/test.cfm",
    "status": "added",
    "additions": 27,
    "deletions": 0,
    "changes": 27,
    "blob_url": "https://github.com/lucee/Lucee/blob/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358/test.cfm",
    "raw_url": "https://github.com/lucee/Lucee/raw/094988e9ef10df788610092d18d22fc6aa104f12/test/tickets/LDEV3358/test.cfm",
    "contents_url": "https://api.github.com/repos/lucee/Lucee/contents/test/tickets/LDEV3358/test.cfm?ref=094988e9ef10df788610092d18d22fc6aa104f12",
    "patch": "@@ -0,0 +1,27 @@\n+<cfparam name=\"FORM.scene\" default=\"2\">\n+<cfparam name=\"FORM.columnName\" default=\"\">\n+<cfparam name=\"FORM.value\" default=\"\">\n+<cfif form.scene EQ 1  AND form.columnName NEQ \"\">\n+\t<cftry>\n+\t\t<cfquery name=\"select\" datasource=\"LDEV3358\">\n+\t\t\tselect * from LDEV3358 where #form.columnName#=<cfqueryparam value=\"#form.value#\" cfsqltype=\"smallint\" maxlength=\"5\">\n+\t\t</cfquery>\n+\t\t<cfoutput>#select[form.columnName]#</cfoutput>\n+\t<cfcatch type=\"any\">\n+\t\t<cfoutput>#cfcatch.message#</cfoutput>\n+\t</cfcatch>\n+\t</cftry>\n+</cfif>\n+\n+<cfif form.scene EQ 2 AND form.columnName NEQ \"\">\n+\t<cftry>\n+\t\t<cfquery name=\"select\" datasource=\"LDEV3358\">\n+\t\t\tselect * from LDEV3358 where #form.columnName#=<cfqueryparam value=\"#form.value#\" maxlength=\"5\">\n+\t\t</cfquery>\n+\t\t<cfoutput>#select[form.columnName]#</cfoutput>\n+\t<cfcatch type=\"any\" name=\"e\">\n+\t\t<cfoutput>#cfcatch.message#</cfoutput>\n+\t</cfcatch>\n+\t</cftry>\n+</cfif>\n+"
  }
]
