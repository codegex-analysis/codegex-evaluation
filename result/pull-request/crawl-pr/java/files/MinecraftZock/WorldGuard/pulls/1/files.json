[
  {
    "sha": "95122545954ef77608c6df187775c6ae2add8630",
    "filename": ".github/workflows/build-CI.yml",
    "status": "added",
    "additions": 31,
    "deletions": 0,
    "changes": 31,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/build-CI.yml",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/build-CI.yml",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/.github/workflows/build-CI.yml?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -0,0 +1,31 @@\n+name: PullRequest\n+\n+on: [pull_request]\n+\n+jobs:\n+  buildMod:\n+    name: build plugin\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v2.3.4\n+        with:\n+          fetch-depth: 0\n+      - name: Find Tag\n+        id: tagger\n+        uses: jimschubert/query-tag-action@v2\n+        with:\n+          skip-unshallow: 'true'\n+          abbrev: false\n+          commit-ish: HEAD\n+      - name: build plugin\n+        run:  ./gradlew build -S\n+      - name: grab artifact\n+        uses: actions/upload-artifact@v2\n+        if: ${{ always() }}\n+        with:\n+          name: WorldGuardPlugin-${{steps.tagger.outputs.tag}}\n+          path: |\n+            ./**/build/libs/*.jar\n+            !buildSrc/build/libs/*.jar\n+          if-no-files-found: error"
  },
  {
    "sha": "fb3f152c9d7a454801b90a2590018f3b888896e9",
    "filename": ".github/workflows/gradle-wrapper-validation.yml",
    "status": "added",
    "additions": 17,
    "deletions": 0,
    "changes": 17,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/gradle-wrapper-validation.yml",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/gradle-wrapper-validation.yml",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/.github/workflows/gradle-wrapper-validation.yml?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -0,0 +1,17 @@\n+name: \"Validate Gradle Wrapper\"\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+  pull_request:\n+    branches:\n+      - master\n+\n+jobs:\n+  validation:\n+    name: \"Validation\"\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@v2.3.4\n+      - uses: gradle/wrapper-validation-action@v1"
  },
  {
    "sha": "75747dfcff8ba9d0dae987cc60c436b206ad1ce4",
    "filename": ".github/workflows/release-CI.yml",
    "status": "added",
    "additions": 41,
    "deletions": 0,
    "changes": 41,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/release-CI.yml",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/release-CI.yml",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/.github/workflows/release-CI.yml?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -0,0 +1,41 @@\n+name: Release\n+\n+on:\n+  push:\n+    tags:\n+      - '*'\n+\n+jobs:\n+  build:\n+    name: Publish release\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v2.3.4\n+        with:\n+          fetch-depth: 0\n+      - name: Find Tag\n+        id: tagger\n+        uses: jimschubert/query-tag-action@v2\n+        with:\n+          skip-unshallow: 'true'\n+          commit-ish: HEAD\n+      - name: Build project\n+        run: ./gradlew build -S\n+#      - name: grab artifact\n+#        uses: actions/upload-artifact@v2\n+#        if: ${{ always() }}\n+#        with:\n+#          name: Worldguard plugin\n+#          path: |\n+#            ./**/build/libs/*.jar\n+#            !buildSrc/build/libs/*.jar\n+#          if-no-files-found: error\n+      - run: |\n+          find . -name \"*${{steps.tagger.outputs.tag}}*.jar\"\n+          find . -name \"*.jar\"\n+          assetsJar=$(find . -name \"*${{steps.tagger.outputs.tag}}*.jar\" | while read -r asset ; do echo \"-a $asset\" ; done)\n+          hub release create ${assetsJar} -m \"${{steps.tagger.outputs.tag}}\" \"${{steps.tagger.outputs.tag}}\"\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+          VERSION: ${{ github.ref }}"
  },
  {
    "sha": "4608393c7b2c0672e480d387dfaed09aa2b05f24",
    "filename": ".github/workflows/update-gradle-wrapper.yml",
    "status": "added",
    "additions": 18,
    "deletions": 0,
    "changes": 18,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/update-gradle-wrapper.yml",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/.github/workflows/update-gradle-wrapper.yml",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/.github/workflows/update-gradle-wrapper.yml?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -0,0 +1,18 @@\n+name: Update Gradle Wrapper\n+\n+on:\n+  schedule:\n+    - cron: \"0 6 * * MON\"\n+\n+jobs:\n+  update-gradle-wrapper:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - uses: actions/checkout@v2.3.4\n+\n+      - name: Update Gradle Wrapper\n+        uses: gradle-update/update-gradle-wrapper-action@v1\n+        with:\n+          repo-token: ${{ secrets.GITHUB_TOKEN }}\n+          set-distribution-checksum: false"
  },
  {
    "sha": "95e3b1cbecdcaf88e403488796ba1db81f27b013",
    "filename": ".travis.yml",
    "status": "removed",
    "additions": 0,
    "deletions": 8,
    "changes": 8,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/528ba32a935c2392eb0ae5c6bf96d973aad36122/.travis.yml",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/528ba32a935c2392eb0ae5c6bf96d973aad36122/.travis.yml",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/.travis.yml?ref=528ba32a935c2392eb0ae5c6bf96d973aad36122",
    "patch": "@@ -1,8 +0,0 @@\n-language: java\n-dist: trusty\n-jdk:\n-  - oraclejdk8\n-notifications:\n-  email: false\n-before_install: chmod +x gradlew\n-script: ./gradlew build -S"
  },
  {
    "sha": "b5c018ef59d0c04629ff879ccea42f15f8629b60",
    "filename": "build.gradle.kts",
    "status": "modified",
    "additions": 23,
    "deletions": 11,
    "changes": 34,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/build.gradle.kts",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/build.gradle.kts",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/build.gradle.kts?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -1,5 +1,3 @@\n-import org.ajoberstar.grgit.Grgit\n-\n logger.lifecycle(\"\"\"\n *******************************************\n  You are building WorldGuard!\n@@ -14,13 +12,27 @@ logger.lifecycle(\"\"\"\n \n applyRootArtifactoryConfig()\n \n-if (!project.hasProperty(\"gitCommitHash\")) {\n-    apply(plugin = \"org.ajoberstar.grgit\")\n-    ext[\"gitCommitHash\"] = try {\n-        (ext[\"grgit\"] as Grgit?)?.head()?.abbreviatedId\n-    } catch (e: Exception) {\n-        logger.warn(\"Error getting commit hash\", e)\n-\n-        \"no.git.id\"\n+fun String.runCommand(\n+    workingDir: File = File(\".\"),\n+    timeoutAmount: Long = 60,\n+    timeoutUnit: TimeUnit = TimeUnit.SECONDS\n+): String = ProcessBuilder(split(\"\\\\s(?=(?:[^'\\\"`]*(['\\\"`])[^'\\\"`]*\\\\1)*[^'\\\"`]*$)\".toRegex()))\n+    .directory(workingDir)\n+    .redirectOutput(ProcessBuilder.Redirect.PIPE)\n+    .redirectError(ProcessBuilder.Redirect.PIPE)\n+    .start()\n+    .apply { waitFor(timeoutAmount, timeoutUnit) }\n+    .run {\n+        val error = errorStream.bufferedReader().readText().trim()\n+        if (error.isNotEmpty()) {\n+            throw Exception(error)\n+        }\n+        inputStream.bufferedReader().readText().trim()\n     }\n-}\n\\ No newline at end of file\n+\n+ext[\"gitVersion\"] = getTag()\n+\n+fun getTag(): String {\n+    val process = \"git describe --tags\".runCommand(workingDir = rootDir)\n+    return process.trim()\n+}"
  },
  {
    "sha": "91a42182e70bd22b3607498efe75916ffc6d4908",
    "filename": "buildSrc/src/main/kotlin/PlatformConfig.kt",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/buildSrc/src/main/kotlin/PlatformConfig.kt",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/buildSrc/src/main/kotlin/PlatformConfig.kt",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/buildSrc/src/main/kotlin/PlatformConfig.kt?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -28,7 +28,7 @@ fun Project.applyPlatformAndCoreConfiguration() {\n     apply(plugin = \"com.jfrog.artifactory\")\n     apply(plugin = \"net.minecrell.licenser\")\n \n-    ext[\"internalVersion\"] = \"$version+${rootProject.ext[\"gitCommitHash\"]}\"\n+    ext[\"internalVersion\"] = \"${rootProject.ext[\"gitVersion\"]}\"\n \n     configure<JavaPluginConvention> {\n         sourceCompatibility = JavaVersion.VERSION_1_8"
  },
  {
    "sha": "e237c0be5dbc0585d111203cbfaf304b179f872e",
    "filename": "gradle.properties",
    "status": "modified",
    "additions": 0,
    "deletions": 1,
    "changes": 1,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/gradle.properties",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/gradle.properties",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/gradle.properties?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -1,2 +1 @@\n group=com.sk89q.worldguard\n-version=7.0.5-SNAPSHOT"
  },
  {
    "sha": "ecd5f690228eca5ae0569b342fdc8a7a013e3ae4",
    "filename": "worldguard-bukkit/build.gradle.kts",
    "status": "modified",
    "additions": 8,
    "deletions": 4,
    "changes": 12,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-bukkit/build.gradle.kts",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-bukkit/build.gradle.kts",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/worldguard-bukkit/build.gradle.kts?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -30,7 +30,7 @@ configurations {\n }\n \n dependencies {\n-    \"compile\"(project(\":worldguard-core\"))\n+    \"implementation\"(project(\":worldguard-core\"))\n     //\"compile\"(project(\":worldguard-libs:bukkit\"))\n     \"api\"(\"com.destroystokyo.paper:paper-api:1.16.2-R0.1-SNAPSHOT\")\n     \"shade\"(\"io.papermc:paperlib:1.0.4\")\n@@ -58,14 +58,18 @@ tasks.named<Upload>(\"install\") {\n \n tasks.named<Copy>(\"processResources\") {\n     val internalVersion = project.ext[\"internalVersion\"]\n+    println(\"internalVersion=$internalVersion\")\n     inputs.property(\"internalVersion\", internalVersion)\n     filesMatching(\"plugin.yml\") {\n         expand(\"internalVersion\" to internalVersion)\n     }\n }\n \n tasks.named<Jar>(\"jar\") {\n-    val projectVersion = project.version\n+    val projectVersion = project.properties[\"gitVersion\"]\n+    version = projectVersion.toString()\n+    println(\"projectVersion=$projectVersion\")\n+    println(\"version=$version\")\n     inputs.property(\"projectVersion\", projectVersion)\n     manifest {\n         attributes(\"Implementation-Version\" to projectVersion)\n@@ -79,10 +83,10 @@ tasks.named<ShadowJar>(\"shadowJar\") {\n         relocate(\"org.bstats\", \"com.sk89q.worldguard.bukkit.bstats\") {\n             include(dependency(\"org.bstats:bstats-bukkit\"))\n         }\n-        relocate (\"io.papermc.lib\", \"com.sk89q.worldguard.bukkit.paperlib\") {\n+        relocate(\"io.papermc.lib\", \"com.sk89q.worldguard.bukkit.paperlib\") {\n             include(dependency(\"io.papermc:paperlib\"))\n         }\n-        relocate (\"co.aikar.timings.lib\", \"com.sk89q.worldguard.bukkit.timingslib\") {\n+        relocate(\"co.aikar.timings.lib\", \"com.sk89q.worldguard.bukkit.timingslib\") {\n             include(dependency(\"co.aikar:minecraft-timings\"))\n         }\n     }"
  },
  {
    "sha": "ad8a079eeedf64dd83863e36eb9a30c3f50bf2b7",
    "filename": "worldguard-core/build.gradle.kts",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-core/build.gradle.kts",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-core/build.gradle.kts",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/worldguard-core/build.gradle.kts?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -30,4 +30,9 @@ sourceSets {\n             srcDir(\"src/main/resources\")\n         }\n     }\n+}\n+\n+tasks.named<Jar>(\"jar\") {\n+    val projectVersion = project.properties[\"gitVersion\"]\n+    version = projectVersion.toString()\n }\n\\ No newline at end of file"
  },
  {
    "sha": "152530cb0879c5fafaa554d4fe4345ffe3c50dea",
    "filename": "worldguard-libs/build.gradle.kts",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/MinecraftZock/WorldGuard/blob/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-libs/build.gradle.kts",
    "raw_url": "https://github.com/MinecraftZock/WorldGuard/raw/0048031e0e2ea97978256a6d8f93a7498c00190b/worldguard-libs/build.gradle.kts",
    "contents_url": "https://api.github.com/repos/MinecraftZock/WorldGuard/contents/worldguard-libs/build.gradle.kts?ref=0048031e0e2ea97978256a6d8f93a7498c00190b",
    "patch": "@@ -1,3 +1,3 @@\n tasks.register(\"build\") {\n     dependsOn(subprojects.map { it.tasks.named(\"build\") })\n-}\n\\ No newline at end of file\n+}"
  }
]
