[
  {
    "sha": "4260702bb0f356c6f3e52c8471d34d65b2be3f9d",
    "filename": "modules/core/src/main/java/org/apache/ignite/internal/processors/odbc/jdbc/JdbcConnectionContext.java",
    "status": "modified",
    "additions": 23,
    "deletions": 16,
    "changes": 39,
    "blob_url": "https://github.com/gridgain/gridgain/blob/d6f5fbfddc7d5c964185bc6e31f1ca863b8683aa/modules/core/src/main/java/org/apache/ignite/internal/processors/odbc/jdbc/JdbcConnectionContext.java",
    "raw_url": "https://github.com/gridgain/gridgain/raw/d6f5fbfddc7d5c964185bc6e31f1ca863b8683aa/modules/core/src/main/java/org/apache/ignite/internal/processors/odbc/jdbc/JdbcConnectionContext.java",
    "contents_url": "https://api.github.com/repos/gridgain/gridgain/contents/modules/core/src/main/java/org/apache/ignite/internal/processors/odbc/jdbc/JdbcConnectionContext.java?ref=d6f5fbfddc7d5c964185bc6e31f1ca863b8683aa",
    "patch": "@@ -24,6 +24,7 @@\n import org.apache.ignite.IgniteLogger;\n import org.apache.ignite.internal.GridKernalContext;\n import org.apache.ignite.internal.binary.BinaryReaderExImpl;\n+import org.apache.ignite.internal.binary.streams.BinaryHeapInputStream;\n import org.apache.ignite.internal.processors.affinity.AffinityTopologyVersion;\n import org.apache.ignite.internal.processors.authentication.AuthorizationContext;\n import org.apache.ignite.internal.processors.odbc.ClientListenerAbstractConnectionContext;\n@@ -185,34 +186,40 @@ public JdbcConnectionContext(GridKernalContext ctx, GridNioSession ses, GridSpin\n         long maxMemory = 0L;\n         EnumSet<JdbcThinFeature> features = EnumSet.noneOf(JdbcThinFeature.class);\n \n-        try {\n-            if (ver.compareTo(VER_2_8_0) >= 0) {\n+        if (ver.compareTo(VER_2_8_0) >= 0) {\n+            BinaryHeapInputStream inStream = (BinaryHeapInputStream)reader.in();\n+\n+            int pos = inStream.position();\n+\n+            try {\n                 dataPageScanEnabled = nullableBooleanFromByte(reader.readByte());\n \n                 updateBatchSize = JdbcUtils.readNullableInteger(reader);\n-\n-                if (ver.compareTo(VER_2_8_1) >= 0) {\n-                    if (reader.readBoolean())\n-                        maxMemory = reader.readLong();\n-                }\n             }\n+            catch (Exception ex) {\n+                if (ver.compareTo(VER_2_8_0) != 0)\n+                    throw ex;\n \n-            if (ver.compareTo(VER_2_8_2) >= 0) {\n-                byte[] cliFeatures = reader.readByteArray();\n+                inStream.position(pos);\n \n-                features = JdbcThinFeature.enumSet(cliFeatures);\n+                // TODO: GG-25595 remove when version 8.7.X support ends\n             }\n+        }\n \n-            if (ver.compareTo(VER_2_8_3) >= 0)\n-                userAttrs = reader.readMap();\n+        if (ver.compareTo(VER_2_8_1) >= 0) {\n+            if (reader.readBoolean())\n+                maxMemory = reader.readLong();\n         }\n-        catch (Exception ex) {\n-            if (ver.compareTo(VER_2_8_0) != 0)\n-                throw ex;\n \n-            // TODO: GG-25595 remove when version 8.7.X support ends\n+        if (ver.compareTo(VER_2_8_2) >= 0) {\n+            byte[] cliFeatures = reader.readByteArray();\n+\n+            features = JdbcThinFeature.enumSet(cliFeatures);\n         }\n \n+        if (ver.compareTo(VER_2_8_3) >= 0)\n+            userAttrs = reader.readMap();\n+\n         if (ver.compareTo(VER_2_5_0) >= 0) {\n             String user = null;\n             String passwd = null;"
  }
]
