[
  {
    "sha": "1416f9fd2c36d497822ec742b6ecd70925edd137",
    "filename": "pom.xml",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/pom.xml",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/pom.xml",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/pom.xml?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -36,5 +36,11 @@\n             <artifactId>gson</artifactId>\n             <version>2.6.2</version>\n         </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter</artifactId>\n+            <version>RELEASE</version>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n </project>\n\\ No newline at end of file"
  },
  {
    "sha": "93de49b789c88202b9c934e89931dbf07e17144f",
    "filename": "src/main/java/ru/sbt/mipt/oop/Action.java",
    "status": "added",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Action.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Action.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Action.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,5 @@\n+package ru.sbt.mipt.oop;\n+\n+public interface Action {\n+    void doAction (HomeComponent homeComponent);\n+}"
  },
  {
    "sha": "c1e47549973579c173bb4f8e26d5ef9b0146737b",
    "filename": "src/main/java/ru/sbt/mipt/oop/Actionable.java",
    "status": "added",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Actionable.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Actionable.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Actionable.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,5 @@\n+package ru.sbt.mipt.oop;\n+\n+public interface Actionable {\n+    void doAction (Action action);\n+}"
  },
  {
    "sha": "7e41cd327bb93034180d5f934ebb574c12097d0c",
    "filename": "src/main/java/ru/sbt/mipt/oop/Application.java",
    "status": "modified",
    "additions": 9,
    "deletions": 71,
    "changes": 80,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Application.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Application.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Application.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,80 +1,18 @@\n package ru.sbt.mipt.oop;\n \n-import com.google.gson.Gson;\n-\n-import java.io.IOException;\n-import java.nio.file.Files;\n-import java.nio.file.Paths;\n-\n-import static ru.sbt.mipt.oop.SensorEventType.*;\n+import ru.sbt.mipt.oop.readers.JSONSmartHomeReader;\n+import ru.sbt.mipt.oop.readers.SmartHomeReader;\n+import ru.sbt.mipt.oop.sensors.SensorEventCreatorImpl;\n \n public class Application {\n \n-    public static void main(String... args) throws IOException {\n+    public static void main(String... args) {\n         // считываем состояние дома из файла\n-        Gson gson = new Gson();\n-        String json = new String(Files.readAllBytes(Paths.get(\"smart-home-1.js\")));\n-        SmartHome smartHome = gson.fromJson(json, SmartHome.class);\n+        String filename = \"smart-home-1.js\";\n+        SmartHomeReader reader = new JSONSmartHomeReader(filename);\n+        SmartHome smartHome = reader.readSmartHome();\n         // начинаем цикл обработки событий\n-        SensorEvent event = getNextSensorEvent();\n-        while (event != null) {\n-            System.out.println(\"Got event: \" + event);\n-            if (event.getType() == LIGHT_ON || event.getType() == LIGHT_OFF) {\n-                // событие от источника света\n-                for (Room room : smartHome.getRooms()) {\n-                    for (Light light : room.getLights()) {\n-                        if (light.getId().equals(event.getObjectId())) {\n-                            if (event.getType() == LIGHT_ON) {\n-                                light.setOn(true);\n-                                System.out.println(\"Light \" + light.getId() + \" in room \" + room.getName() + \" was turned on.\");\n-                            } else {\n-                                light.setOn(false);\n-                                System.out.println(\"Light \" + light.getId() + \" in room \" + room.getName() + \" was turned off.\");\n-                            }\n-                        }\n-                    }\n-                }\n-            }\n-            if (event.getType() == DOOR_OPEN || event.getType() == DOOR_CLOSED) {\n-                // событие от двери\n-                for (Room room : smartHome.getRooms()) {\n-                    for (Door door : room.getDoors()) {\n-                        if (door.getId().equals(event.getObjectId())) {\n-                            if (event.getType() == DOOR_OPEN) {\n-                                door.setOpen(true);\n-                                System.out.println(\"Door \" + door.getId() + \" in room \" + room.getName() + \" was opened.\");\n-                            } else {\n-                                door.setOpen(false);\n-                                System.out.println(\"Door \" + door.getId() + \" in room \" + room.getName() + \" was closed.\");\n-                                // если мы получили событие о закрытие двери в холле - это значит, что была закрыта входная дверь.\n-                                // в этом случае мы хотим автоматически выключить свет во всем доме (это же умный дом!)\n-                                if (room.getName().equals(\"hall\")) {\n-                                    for (Room homeRoom : smartHome.getRooms()) {\n-                                        for (Light light : homeRoom.getLights()) {\n-                                            light.setOn(false);\n-                                            SensorCommand command = new SensorCommand(CommandType.LIGHT_OFF, light.getId());\n-                                            sendCommand(command);\n-                                        }\n-                                    }\n-                                }\n-                            }\n-                        }\n-                    }\n-                }\n-            }\n-            event = getNextSensorEvent();\n-        }\n-    }\n-\n-    private static void sendCommand(SensorCommand command) {\n-        System.out.println(\"Pretent we're sending command \" + command);\n-    }\n-\n-    private static SensorEvent getNextSensorEvent() {\n-        // pretend like we're getting the events from physical world, but here we're going to just generate some random events\n-        if (Math.random() < 0.05) return null; // null means end of event stream\n-        SensorEventType sensorEventType = SensorEventType.values()[(int) (4 * Math.random())];\n-        String objectId = \"\" + ((int) (10 * Math.random()));\n-        return new SensorEvent(sensorEventType, objectId);\n+        EventLoopProcessor eventLoopProcessor = new EventLoopProcessor(new SensorEventCreatorImpl(), new EventProcessor(smartHome));\n+        eventLoopProcessor.loopEvents();\n     }\n }"
  },
  {
    "sha": "c51325f3b02aeb628d5897ce56f3cd03e657ff77",
    "filename": "src/main/java/ru/sbt/mipt/oop/Door.java",
    "status": "modified",
    "additions": 10,
    "deletions": 1,
    "changes": 11,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Door.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Door.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Door.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,6 +1,6 @@\n package ru.sbt.mipt.oop;\n \n-public class Door {\n+public class Door implements Actionable, HomeComponent {\n     private final String id;\n     private boolean isOpen;\n \n@@ -13,7 +13,16 @@ public String getId() {\n         return id;\n     }\n \n+    public boolean isOpen() {\n+        return isOpen;\n+    }\n+\n     public void setOpen(boolean open) {\n         isOpen = open;\n     }\n+\n+    @Override\n+    public void doAction(Action action) {\n+        action.doAction(this);\n+    }\n }"
  },
  {
    "sha": "7041fefea124ad9b9f58af660701ed26d79f23eb",
    "filename": "src/main/java/ru/sbt/mipt/oop/EventLoopProcessor.java",
    "status": "added",
    "additions": 23,
    "deletions": 0,
    "changes": 23,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/EventLoopProcessor.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/EventLoopProcessor.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/EventLoopProcessor.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,23 @@\n+package ru.sbt.mipt.oop;\n+\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+import ru.sbt.mipt.oop.sensors.SensorEventCreator;\n+\n+public class EventLoopProcessor {\n+    private final SensorEventCreator sensorEventCreator;\n+    private final EventProcessor eventProcessor;\n+\n+    public EventLoopProcessor(SensorEventCreator sensorEventCreator, EventProcessor eventProcessor) {\n+        this.sensorEventCreator = sensorEventCreator;\n+        this.eventProcessor = eventProcessor;\n+    }\n+\n+    public void loopEvents() {\n+        SensorEvent event = sensorEventCreator.getNextSensorEvent();\n+\n+        while (event != null) {\n+            eventProcessor.processEvent(event);\n+            event = sensorEventCreator.getNextSensorEvent();\n+        }\n+    }\n+}"
  },
  {
    "sha": "cb2c945505a05ee05875aa5c8750204fd16a2b07",
    "filename": "src/main/java/ru/sbt/mipt/oop/EventProcessor.java",
    "status": "added",
    "additions": 20,
    "deletions": 0,
    "changes": 20,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/EventProcessor.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/EventProcessor.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/EventProcessor.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,20 @@\n+package ru.sbt.mipt.oop;\n+\n+import ru.sbt.mipt.oop.handlers.GeneralSensorEventHandler;\n+import ru.sbt.mipt.oop.handlers.SensorEventHandler;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+\n+public class EventProcessor {\n+    public final SmartHome smartHome;\n+\n+    public EventProcessor(SmartHome smartHome) {\n+        this.smartHome = smartHome;\n+    }\n+\n+    public void processEvent(SensorEvent event) {\n+        System.out.println(\"Got event: \" + event);\n+        SensorEventHandler sensorEventHandler = new GeneralSensorEventHandler(smartHome, event);\n+\n+        sensorEventHandler.handleEvent();\n+    }\n+}"
  },
  {
    "sha": "cb536fdc398c10013b9c60cd34b98aa906f9b107",
    "filename": "src/main/java/ru/sbt/mipt/oop/HomeComponent.java",
    "status": "added",
    "additions": 4,
    "deletions": 0,
    "changes": 4,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/HomeComponent.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/HomeComponent.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/HomeComponent.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,4 @@\n+package ru.sbt.mipt.oop;\n+\n+public interface HomeComponent {\n+}"
  },
  {
    "sha": "4f89ee52ee1c1acb14b5bbcda1a665afa4e22550",
    "filename": "src/main/java/ru/sbt/mipt/oop/Light.java",
    "status": "modified",
    "additions": 7,
    "deletions": 1,
    "changes": 8,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Light.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Light.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Light.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,6 +1,6 @@\n package ru.sbt.mipt.oop;\n \n-public class Light {\n+public class Light implements Actionable, HomeComponent{\n     private boolean isOn;\n     private final String id;\n \n@@ -20,4 +20,10 @@ public String getId() {\n     public void setOn(boolean on) {\n         isOn = on;\n     }\n+\n+\n+    @Override\n+    public void doAction(Action action) {\n+        action.doAction(this);\n+    }\n }"
  },
  {
    "sha": "95b8d8e894940046041b16624169fb05c9e38305",
    "filename": "src/main/java/ru/sbt/mipt/oop/Room.java",
    "status": "modified",
    "additions": 7,
    "deletions": 1,
    "changes": 8,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Room.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/Room.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/Room.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -2,7 +2,7 @@\n \n import java.util.Collection;\n \n-public class Room {\n+public class Room implements Actionable, HomeComponent{\n     private Collection<Light> lights;\n     private Collection<Door> doors;\n     private String name;\n@@ -24,4 +24,10 @@ public Room(Collection<Light> lights, Collection<Door> doors, String name) {\n     public String getName() {\n         return name;\n     }\n+\n+    @Override\n+    public void doAction(Action action) {\n+        lights.forEach(light -> light.doAction(action));\n+        doors.forEach(door -> door.doAction(action));\n+    }\n }"
  },
  {
    "sha": "612b0c38a0f7194d73c459d1fe0b65d92b681567",
    "filename": "src/main/java/ru/sbt/mipt/oop/SmartHome.java",
    "status": "modified",
    "additions": 6,
    "deletions": 1,
    "changes": 7,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/SmartHome.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/SmartHome.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/SmartHome.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -3,7 +3,7 @@\n import java.util.ArrayList;\n import java.util.Collection;\n \n-public class SmartHome {\n+public class SmartHome implements Actionable {\n     Collection<Room> rooms;\n \n     public SmartHome() {\n@@ -21,4 +21,9 @@ public void addRoom(Room room) {\n     public Collection<Room> getRooms() {\n         return rooms;\n     }\n+\n+    @Override\n+    public void doAction(Action action) {\n+        rooms.forEach(room -> room.doAction(action));\n+    }\n }"
  },
  {
    "sha": "1c315b40daa0b366066c193b735c8aa5a2622ac6",
    "filename": "src/main/java/ru/sbt/mipt/oop/handlers/DoorSensorEventHandler.java",
    "status": "added",
    "additions": 59,
    "deletions": 0,
    "changes": 59,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/DoorSensorEventHandler.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/DoorSensorEventHandler.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/handlers/DoorSensorEventHandler.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,59 @@\n+package ru.sbt.mipt.oop.handlers;\n+\n+import ru.sbt.mipt.oop.*;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+\n+import java.util.Collection;\n+\n+import static ru.sbt.mipt.oop.sensors.SensorEventType.DOOR_CLOSED;\n+import static ru.sbt.mipt.oop.sensors.SensorEventType.DOOR_OPEN;\n+\n+public class DoorSensorEventHandler implements SensorEventHandler {\n+    private final Collection<Room> rooms;\n+    private final SensorEvent event;\n+    private final SmartHome smartHome;\n+\n+    public DoorSensorEventHandler(SmartHome smartHome, SensorEvent event) {\n+        this.rooms = smartHome.getRooms();\n+        this.event = event;\n+        this.smartHome = smartHome;\n+    }\n+\n+    @Override\n+    public void handleEvent() {\n+        // событие от двери\n+        if (event.getType() != DOOR_OPEN && event.getType() != DOOR_CLOSED) {\n+            return;\n+        }\n+\n+        // представим, что мы не пытаемся открыть открытую дверь)\n+        boolean openResult = (event.getType() == DOOR_OPEN);\n+        String eventId = event.getObjectId();\n+        \n+        Action lightOffAction = (o)->{\n+            if (o instanceof Light) {\n+                Light light = (Light) o;\n+                light.setOn(false);\n+            }\n+        };\n+        \n+        Action doorAction = (o)-> {\n+            if (o instanceof Room) {\n+                Room room = (Room) o;\n+                if (room.getName().equals(\"hall\")) {\n+                    smartHome.doAction(lightOffAction);\n+                }\n+            }\n+            if (o instanceof Door) {\n+                Door door = (Door) o;\n+                if (door.getId().equals(eventId)) {\n+                    door.setOpen(openResult);\n+                    System.out.print(\"Door \" + door.getId() + \" in room \" + \" was\");\n+                    System.out.println(openResult ? \" opened.\" : \" closed.\");\n+                }\n+            }\n+        };\n+\n+        smartHome.doAction(doorAction);\n+    }\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "530949b3e314e892204d4396584cdc4b87a8d715",
    "filename": "src/main/java/ru/sbt/mipt/oop/handlers/GeneralSensorEventHandler.java",
    "status": "added",
    "additions": 30,
    "deletions": 0,
    "changes": 30,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/GeneralSensorEventHandler.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/GeneralSensorEventHandler.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/handlers/GeneralSensorEventHandler.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,30 @@\n+package ru.sbt.mipt.oop.handlers;\n+\n+import ru.sbt.mipt.oop.SmartHome;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GeneralSensorEventHandler implements SensorEventHandler{\n+    private final SmartHome smartHome;\n+    private final SensorEvent event;\n+    private List<SensorEventHandler> handlers;\n+\n+    public GeneralSensorEventHandler(SmartHome smartHome, SensorEvent event) {\n+        this.smartHome = smartHome;\n+        this.event = event;\n+        setUpHandlers();\n+    }\n+\n+    @Override\n+    public void handleEvent() {\n+        handlers.forEach(SensorEventHandler::handleEvent);\n+    }\n+\n+    private void setUpHandlers() {\n+        handlers = new ArrayList<>();\n+        handlers.add(new LightSensorEventHandler(smartHome, event));\n+        handlers.add(new DoorSensorEventHandler(smartHome, event));\n+    }\n+}"
  },
  {
    "sha": "12d0c36a9d61094b50696a9eee083d0ddac7ee1b",
    "filename": "src/main/java/ru/sbt/mipt/oop/handlers/LightSensorEventHandler.java",
    "status": "added",
    "additions": 49,
    "deletions": 0,
    "changes": 49,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/LightSensorEventHandler.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/LightSensorEventHandler.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/handlers/LightSensorEventHandler.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,49 @@\n+package ru.sbt.mipt.oop.handlers;\n+\n+import ru.sbt.mipt.oop.Action;\n+import ru.sbt.mipt.oop.Light;\n+import ru.sbt.mipt.oop.Room;\n+import ru.sbt.mipt.oop.SmartHome;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+\n+import java.util.Collection;\n+\n+import static ru.sbt.mipt.oop.sensors.SensorEventType.LIGHT_OFF;\n+import static ru.sbt.mipt.oop.sensors.SensorEventType.LIGHT_ON;\n+\n+public class LightSensorEventHandler implements SensorEventHandler {\n+    private final Collection<Room> rooms;\n+    private final SensorEvent event;\n+    private final SmartHome smartHome;\n+\n+    public LightSensorEventHandler(SmartHome smartHome, SensorEvent event) {\n+        this.smartHome = smartHome;\n+        this.rooms = smartHome.getRooms();\n+        this.event = event;\n+    }\n+\n+    @Override\n+    public void handleEvent() {\n+        // событие от источника света\n+        if (event.getType() != LIGHT_ON && event.getType() != LIGHT_OFF) {\n+            return;\n+        }\n+\n+        // представим, что мы не пытаемся включить включенный свет\n+        boolean turnResult = (event.getType() == LIGHT_ON);\n+        String eventId = event.getObjectId();\n+\n+        Action action = (o) -> {\n+            if (o instanceof Light) {\n+                Light light = (Light) o;\n+                String lightId = light.getId();\n+                if (lightId.equals(eventId)) {\n+                    light.setOn(turnResult);\n+                    System.out.print(\"Light \" + light.getId() + \" was turned \");\n+                    System.out.println(turnResult ? \"on.\" : \"off.\");\n+                }\n+            }\n+        };\n+        smartHome.doAction(action);\n+    }\n+}"
  },
  {
    "sha": "87da88f54891b3a4ae9350c3a27163ebe1a18945",
    "filename": "src/main/java/ru/sbt/mipt/oop/handlers/SensorEventHandler.java",
    "status": "added",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/SensorEventHandler.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/handlers/SensorEventHandler.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/handlers/SensorEventHandler.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,5 @@\n+package ru.sbt.mipt.oop.handlers;\n+\n+public interface SensorEventHandler {\n+    void handleEvent();\n+}"
  },
  {
    "sha": "70162acc6f5eafff1ca3b43b345a89c88e0b9ffb",
    "filename": "src/main/java/ru/sbt/mipt/oop/readers/JSONSmartHomeReader.java",
    "status": "added",
    "additions": 30,
    "deletions": 0,
    "changes": 30,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/readers/JSONSmartHomeReader.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/readers/JSONSmartHomeReader.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/readers/JSONSmartHomeReader.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,30 @@\n+package ru.sbt.mipt.oop.readers;\n+\n+import com.google.gson.Gson;\n+import ru.sbt.mipt.oop.SmartHome;\n+import ru.sbt.mipt.oop.readers.SmartHomeReader;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class JSONSmartHomeReader implements SmartHomeReader {\n+\n+    private final String filename;\n+\n+    public JSONSmartHomeReader(String filename) {\n+        this.filename = filename;\n+    }\n+\n+    @Override\n+    public SmartHome readSmartHome() {\n+        Gson gson = new Gson();\n+        String json;\n+        try {\n+            json = new String(Files.readAllBytes(Paths.get(filename)));\n+        } catch (IOException e) {\n+            throw new RuntimeException(\"Could not read file\" + filename, e);\n+        }\n+        return gson.fromJson(json, SmartHome.class);\n+    }\n+}"
  },
  {
    "sha": "9a4744fe842dfb1c3dd8b9f54a1356e8228fa3f3",
    "filename": "src/main/java/ru/sbt/mipt/oop/readers/SmartHomeReader.java",
    "status": "added",
    "additions": 9,
    "deletions": 0,
    "changes": 9,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/readers/SmartHomeReader.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/readers/SmartHomeReader.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/readers/SmartHomeReader.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,9 @@\n+package ru.sbt.mipt.oop.readers;\n+\n+import ru.sbt.mipt.oop.SmartHome;\n+\n+import java.io.IOException;\n+\n+public interface SmartHomeReader {\n+    SmartHome readSmartHome();\n+}"
  },
  {
    "sha": "229694c8fccc5bec29b6a9e8382fdd149666c7d3",
    "filename": "src/main/java/ru/sbt/mipt/oop/sensors/SensorCommand.java",
    "status": "renamed",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorCommand.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorCommand.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/sensors/SensorCommand.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,4 +1,6 @@\n-package ru.sbt.mipt.oop;\n+package ru.sbt.mipt.oop.sensors;\n+\n+import ru.sbt.mipt.oop.CommandType;\n \n public class SensorCommand {\n     private final CommandType type;",
    "previous_filename": "src/main/java/ru/sbt/mipt/oop/SensorCommand.java"
  },
  {
    "sha": "ca8976ab5fd6f54877a4e5bcc187e7384db7dcde",
    "filename": "src/main/java/ru/sbt/mipt/oop/sensors/SensorEvent.java",
    "status": "renamed",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEvent.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEvent.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/sensors/SensorEvent.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,4 +1,4 @@\n-package ru.sbt.mipt.oop;\n+package ru.sbt.mipt.oop.sensors;\n \n public class SensorEvent {\n     private final SensorEventType type;",
    "previous_filename": "src/main/java/ru/sbt/mipt/oop/SensorEvent.java"
  },
  {
    "sha": "737ecac332cd3dca295b44c6217ef9c07b0a8a7d",
    "filename": "src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreator.java",
    "status": "added",
    "additions": 7,
    "deletions": 0,
    "changes": 7,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreator.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreator.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreator.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,7 @@\n+package ru.sbt.mipt.oop.sensors;\n+\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+\n+public interface SensorEventCreator {\n+    SensorEvent getNextSensorEvent();\n+}"
  },
  {
    "sha": "dbffe79a6db42e05cec4accb524c4b99a0ab8302",
    "filename": "src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreatorImpl.java",
    "status": "added",
    "additions": 12,
    "deletions": 0,
    "changes": 12,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreatorImpl.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreatorImpl.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventCreatorImpl.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,12 @@\n+package ru.sbt.mipt.oop.sensors;\n+\n+public class SensorEventCreatorImpl implements SensorEventCreator {\n+    @Override\n+    public SensorEvent getNextSensorEvent() {\n+        // pretend like we're getting the events from physical world, but here we're going to just generate some random events\n+        if (Math.random() < 0.05) return null; // null means end of event stream\n+        SensorEventType sensorEventType = SensorEventType.values()[(int) (4 * Math.random())];\n+        String objectId = \"\" + ((int) (10 * Math.random()));\n+        return new SensorEvent(sensorEventType, objectId);\n+    }\n+}"
  },
  {
    "sha": "1f6daf8f6dc072089f22b581c14967551e9d0741",
    "filename": "src/main/java/ru/sbt/mipt/oop/sensors/SensorEventType.java",
    "status": "renamed",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventType.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventType.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/main/java/ru/sbt/mipt/oop/sensors/SensorEventType.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -1,4 +1,4 @@\n-package ru.sbt.mipt.oop;\n+package ru.sbt.mipt.oop.sensors;\n \n public enum SensorEventType {\n     LIGHT_ON, LIGHT_OFF, DOOR_OPEN, DOOR_CLOSED",
    "previous_filename": "src/main/java/ru/sbt/mipt/oop/SensorEventType.java"
  },
  {
    "sha": "0a1725d9e613bb2d6075103d1f4da909cbc54cc5",
    "filename": "src/test/java/DoorWorkTest.java",
    "status": "added",
    "additions": 61,
    "deletions": 0,
    "changes": 61,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/java/DoorWorkTest.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/java/DoorWorkTest.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/test/java/DoorWorkTest.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,61 @@\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import ru.sbt.mipt.oop.Door;\n+import ru.sbt.mipt.oop.Light;\n+import ru.sbt.mipt.oop.Room;\n+import ru.sbt.mipt.oop.SmartHome;\n+import ru.sbt.mipt.oop.handlers.DoorSensorEventHandler;\n+import ru.sbt.mipt.oop.handlers.LightSensorEventHandler;\n+import ru.sbt.mipt.oop.handlers.SensorEventHandler;\n+import ru.sbt.mipt.oop.readers.JSONSmartHomeReader;\n+import ru.sbt.mipt.oop.readers.SmartHomeReader;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+import ru.sbt.mipt.oop.sensors.SensorEventType;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class DoorWorkTest {\n+    private static SmartHome smartHome;\n+\n+    @BeforeAll\n+    static void init() {\n+        String filename = \"./src/test/resources/smart-home-test.js\";\n+        SmartHomeReader reader = new JSONSmartHomeReader(filename);\n+        smartHome = reader.readSmartHome();\n+    }\n+\n+    @Test\n+    public void lightOffWork() {\n+        Door door = getDoor(\"1\");\n+        assertFalse(door.isOpen());\n+    }\n+\n+    @Test\n+    public void lightOnWork() {\n+        Door door = getDoor(\"3\");\n+        assertTrue(door.isOpen());\n+    }\n+\n+    @Test\n+    public void lightSwitchWork() {\n+        SensorEvent doorSwitch = new SensorEvent(SensorEventType.DOOR_CLOSED,\"3\");\n+        SensorEventHandler eventHandler = new DoorSensorEventHandler(smartHome, doorSwitch);\n+        eventHandler.handleEvent();\n+\n+        Door door = getDoor(\"3\");\n+        assertFalse(door.isOpen());\n+    }\n+\n+    private Door getDoor(String doorId) {\n+        Door doorResult = null;\n+        for (Room room : smartHome.getRooms()) {\n+            for (Door door : room.getDoors()) {\n+                if (door.getId().equals(doorId)) {\n+                    doorResult = door;\n+                }\n+            }\n+        }\n+        return doorResult;\n+    }\n+}"
  },
  {
    "sha": "1a9305ea5d14948e9dd28ddab59a8e351b165b60",
    "filename": "src/test/java/LightWorkTest.java",
    "status": "added",
    "additions": 63,
    "deletions": 0,
    "changes": 63,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/java/LightWorkTest.java",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/java/LightWorkTest.java",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/test/java/LightWorkTest.java?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,63 @@\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import ru.sbt.mipt.oop.CommandType;\n+import ru.sbt.mipt.oop.Light;\n+import ru.sbt.mipt.oop.Room;\n+import ru.sbt.mipt.oop.SmartHome;\n+import ru.sbt.mipt.oop.handlers.LightSensorEventHandler;\n+import ru.sbt.mipt.oop.handlers.SensorEventHandler;\n+import ru.sbt.mipt.oop.readers.JSONSmartHomeReader;\n+import ru.sbt.mipt.oop.readers.SmartHomeReader;\n+import ru.sbt.mipt.oop.sensors.SensorEvent;\n+import ru.sbt.mipt.oop.sensors.SensorEventType;\n+\n+import java.io.File;\n+\n+public class LightWorkTest {\n+    private static SmartHome smartHome;\n+\n+    @BeforeAll\n+    static void init() {\n+        String filename = \"./src/test/resources/smart-home-test.js\";\n+        SmartHomeReader reader = new JSONSmartHomeReader(filename);\n+        smartHome = reader.readSmartHome();\n+    }\n+\n+    @Test\n+    public void lightOffWork() {\n+        Light light = getLight(\"1\");\n+        assertFalse(light.isOn());\n+    }\n+\n+    @Test\n+    public void lightOnWork() {\n+        Light light = getLight(\"3\");\n+        assertTrue(light.isOn());\n+    }\n+\n+    @Test\n+    public void lightSwitchWork() {\n+        SensorEvent lightSwitch = new SensorEvent(SensorEventType.LIGHT_OFF,\"3\");\n+        SensorEventHandler eventHandler = new LightSensorEventHandler(smartHome, lightSwitch);\n+        eventHandler.handleEvent();\n+\n+        Light light = getLight(\"3\");\n+        assertFalse(light.isOn());\n+    }\n+\n+    private Light getLight(String lightId) {\n+        Light lightResult = null;\n+        for (Room room : smartHome.getRooms()) {\n+            for (Light light : room.getLights()) {\n+                if (light.getId().equals(lightId)) {\n+                    lightResult = light;\n+                }\n+            }\n+        }\n+        return lightResult;\n+    }\n+}"
  },
  {
    "sha": "20ffe70dab610c658621d50829bc6521cc1b35a3",
    "filename": "src/test/resources/smart-home-test.js",
    "status": "added",
    "additions": 84,
    "deletions": 0,
    "changes": 84,
    "blob_url": "https://github.com/D1m0000n/smart-home-2021/blob/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/resources/smart-home-test.js",
    "raw_url": "https://github.com/D1m0000n/smart-home-2021/raw/8363901bdb0fa0b177426349c0c6d4f375c5c50d/src/test/resources/smart-home-test.js",
    "contents_url": "https://api.github.com/repos/D1m0000n/smart-home-2021/contents/src/test/resources/smart-home-test.js?ref=8363901bdb0fa0b177426349c0c6d4f375c5c50d",
    "patch": "@@ -0,0 +1,84 @@\n+{\n+    \"rooms\": [\n+    {\n+        \"lights\": [\n+            {\n+                \"isOn\": false,\n+                \"id\": \"1\"\n+            },\n+            {\n+                \"isOn\": true,\n+                \"id\": \"2\"\n+            }\n+        ],\n+        \"doors\": [\n+            {\n+                \"id\": \"1\",\n+                \"isOpen\": false\n+            }\n+        ],\n+        \"name\": \"kitchen\"\n+    },\n+    {\n+        \"lights\": [\n+            {\n+                \"isOn\": true,\n+                \"id\": \"3\"\n+            }\n+        ],\n+        \"doors\": [\n+            {\n+                \"id\": \"2\",\n+                \"isOpen\": false\n+            }\n+        ],\n+        \"name\": \"bathroom\"\n+    },\n+    {\n+        \"lights\": [\n+            {\n+                \"isOn\": false,\n+                \"id\": \"4\"\n+            },\n+            {\n+                \"isOn\": false,\n+                \"id\": \"5\"\n+            },\n+            {\n+                \"isOn\": false,\n+                \"id\": \"6\"\n+            }\n+        ],\n+        \"doors\": [\n+            {\n+                \"id\": \"3\",\n+                \"isOpen\": true\n+            }\n+        ],\n+        \"name\": \"bedroom\"\n+    },\n+    {\n+        \"lights\": [\n+            {\n+                \"isOn\": false,\n+                \"id\": \"7\"\n+            },\n+            {\n+                \"isOn\": false,\n+                \"id\": \"8\"\n+            },\n+            {\n+                \"isOn\": false,\n+                \"id\": \"9\"\n+            }\n+        ],\n+        \"doors\": [\n+            {\n+                \"id\": \"4\",\n+                \"isOpen\": false\n+            }\n+        ],\n+        \"name\": \"hall\"\n+    }\n+]\n+}\n\\ No newline at end of file"
  }
]
