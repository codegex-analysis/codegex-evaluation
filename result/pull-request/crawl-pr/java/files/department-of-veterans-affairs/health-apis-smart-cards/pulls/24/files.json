[
  {
    "sha": "40bbef8f5f375b2d7cfb41e088f865a657bb8d76",
    "filename": "smart-cards-tests/src/test/java/gov/va/api/health/smartcards/tests/WellKnownIT.java",
    "status": "added",
    "additions": 61,
    "deletions": 0,
    "changes": 61,
    "blob_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/blob/c8efc06108f64d50289086193f956a2a9f659946/smart-cards-tests/src/test/java/gov/va/api/health/smartcards/tests/WellKnownIT.java",
    "raw_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/raw/c8efc06108f64d50289086193f956a2a9f659946/smart-cards-tests/src/test/java/gov/va/api/health/smartcards/tests/WellKnownIT.java",
    "contents_url": "https://api.github.com/repos/department-of-veterans-affairs/health-apis-smart-cards/contents/smart-cards-tests/src/test/java/gov/va/api/health/smartcards/tests/WellKnownIT.java?ref=c8efc06108f64d50289086193f956a2a9f659946",
    "patch": "@@ -0,0 +1,61 @@\n+package gov.va.api.health.smartcards.tests;\n+\n+import static gov.va.api.health.sentinel.EnvironmentAssumptions.assumeEnvironmentIn;\n+import static gov.va.api.health.sentinel.ExpectedResponse.logAllWithTruncatedBody;\n+import static gov.va.api.health.smartcards.tests.SystemDefinitions.systemDefinition;\n+\n+import gov.va.api.health.sentinel.Environment;\n+import gov.va.api.health.sentinel.ExpectedResponse;\n+import io.restassured.RestAssured;\n+import io.restassured.http.Method;\n+import io.restassured.specification.RequestSpecification;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+\n+@Slf4j\n+public class WellKnownIT {\n+\n+  @BeforeAll\n+  static void assumeEnvironment() {\n+    assumeEnvironmentIn(\n+        Environment.LOCAL,\n+        Environment.QA,\n+        Environment.STAGING,\n+        Environment.STAGING_LAB,\n+        Environment.LAB);\n+  }\n+\n+  @SneakyThrows\n+  private static ExpectedResponse doGet(\n+      SystemDefinitions.Service svc, String request, String description, Integer expectedStatus) {\n+    RequestSpecification spec =\n+        RestAssured.given()\n+            .baseUri(svc.url())\n+            .port(svc.port())\n+            .relaxedHTTPSValidation()\n+            .header(\"Content-Type\", \"application/json\");\n+    log.info(\n+        \"Expect {} GET '{}' is status code ({})\",\n+        svc.urlWithApiPath() + request,\n+        description,\n+        expectedStatus);\n+    ExpectedResponse response =\n+        ExpectedResponse.of(spec.request(Method.GET, svc.urlWithApiPath() + request))\n+            .logAction(logAllWithTruncatedBody(2000));\n+    if (expectedStatus != null) {\n+      response.expect(expectedStatus);\n+    }\n+    return response;\n+  }\n+\n+  @Test\n+  void read() {\n+    doGet(\n+        systemDefinition().internal(),\n+        \".well-known/smart-configuration\",\n+        \"smart configuration\",\n+        200);\n+  }\n+}"
  },
  {
    "sha": "9b6cd92d119e0fa7129b1545c640cc33c6c6d942",
    "filename": "smart-cards/src/main/java/gov/va/api/health/smartcards/WellKnownController.java",
    "status": "added",
    "additions": 40,
    "deletions": 0,
    "changes": 40,
    "blob_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/blob/c8efc06108f64d50289086193f956a2a9f659946/smart-cards/src/main/java/gov/va/api/health/smartcards/WellKnownController.java",
    "raw_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/raw/c8efc06108f64d50289086193f956a2a9f659946/smart-cards/src/main/java/gov/va/api/health/smartcards/WellKnownController.java",
    "contents_url": "https://api.github.com/repos/department-of-veterans-affairs/health-apis-smart-cards/contents/smart-cards/src/main/java/gov/va/api/health/smartcards/WellKnownController.java?ref=c8efc06108f64d50289086193f956a2a9f659946",
    "patch": "@@ -0,0 +1,40 @@\n+package gov.va.api.health.smartcards;\n+\n+import gov.va.api.health.r4.api.information.WellKnown;\n+import java.util.List;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+@RestController\n+@RequestMapping(\n+    value = {\"/.well-known/smart-configuration\"},\n+    produces = {\"application/json\", \"application/fhir+json\"})\n+@AllArgsConstructor(onConstructor = @__({@Autowired}))\n+@Builder\n+public class WellKnownController {\n+\n+  @GetMapping\n+  WellKnown read() {\n+    return WellKnown.builder()\n+        .capabilities(\n+            List.of(\n+                \"health-cards\",\n+                \"launch-standalone\",\n+                \"context-standalone-patient\",\n+                \"client-confidential-symmetric\"))\n+        .responseTypeSupported(List.of(\"code\", \"refresh_token\"))\n+        .scopesSupported(\n+            List.of(\n+                \"launch\",\n+                \"launch/patient\",\n+                \"patient/Patient.read\",\n+                \"patient/Immunization.read\",\n+                \"patient/Location.read\",\n+                \"offline_access\"))\n+        .build();\n+  }\n+}"
  },
  {
    "sha": "5a98722e43be75a2cbe06eb50740c6ca4f371bf6",
    "filename": "smart-cards/src/test/java/gov/va/api/health/smartcards/WellKnownControllerTest.java",
    "status": "added",
    "additions": 48,
    "deletions": 0,
    "changes": 48,
    "blob_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/blob/c8efc06108f64d50289086193f956a2a9f659946/smart-cards/src/test/java/gov/va/api/health/smartcards/WellKnownControllerTest.java",
    "raw_url": "https://github.com/department-of-veterans-affairs/health-apis-smart-cards/raw/c8efc06108f64d50289086193f956a2a9f659946/smart-cards/src/test/java/gov/va/api/health/smartcards/WellKnownControllerTest.java",
    "contents_url": "https://api.github.com/repos/department-of-veterans-affairs/health-apis-smart-cards/contents/smart-cards/src/test/java/gov/va/api/health/smartcards/WellKnownControllerTest.java?ref=c8efc06108f64d50289086193f956a2a9f659946",
    "patch": "@@ -0,0 +1,48 @@\n+package gov.va.api.health.smartcards;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import gov.va.api.health.autoconfig.configuration.JacksonConfig;\n+import gov.va.api.health.r4.api.information.WellKnown;\n+import java.util.List;\n+import lombok.SneakyThrows;\n+import org.junit.jupiter.api.Test;\n+\n+public class WellKnownControllerTest {\n+  private WellKnown actual() {\n+    List<String> capabilities =\n+        List.of(\n+            \"health-cards\",\n+            \"launch-standalone\",\n+            \"context-standalone-patient\",\n+            \"client-confidential-symmetric\");\n+    List<String> responseTypeSupported = (List.of(\"code\", \"refresh_token\"));\n+    List<String> scopesSupported =\n+        List.of(\n+            \"launch\",\n+            \"launch/patient\",\n+            \"patient/Patient.read\",\n+            \"patient/Immunization.read\",\n+            \"patient/Location.read\",\n+            \"offline_access\");\n+    return WellKnown.builder()\n+        .capabilities(capabilities)\n+        .responseTypeSupported(responseTypeSupported)\n+        .scopesSupported(scopesSupported)\n+        .build();\n+  }\n+\n+  @SneakyThrows\n+  private String pretty(WellKnown wellKnown) {\n+    return JacksonConfig.createMapper()\n+        .writerWithDefaultPrettyPrinter()\n+        .writeValueAsString(wellKnown);\n+  }\n+\n+  @Test\n+  @SneakyThrows\n+  public void read() {\n+    WellKnownController controller = WellKnownController.builder().build();\n+    assertThat(pretty(controller.read())).isEqualTo(pretty(actual()));\n+  }\n+}"
  }
]
