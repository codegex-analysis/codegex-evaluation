[
  {
    "sha": "ee996f84eb36147930bca1dd15ea6b8073b35a3b",
    "filename": "out/artifacts/untitled5_jar/untitled5.jar",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/MaksymenkoIvan/Javalin/blob/500f3224a2a90c8f76704ba26284ccd48190c55f/out/artifacts/untitled5_jar/untitled5.jar",
    "raw_url": "https://github.com/MaksymenkoIvan/Javalin/raw/500f3224a2a90c8f76704ba26284ccd48190c55f/out/artifacts/untitled5_jar/untitled5.jar",
    "contents_url": "https://api.github.com/repos/MaksymenkoIvan/Javalin/contents/out/artifacts/untitled5_jar/untitled5.jar?ref=500f3224a2a90c8f76704ba26284ccd48190c55f"
  },
  {
    "sha": "d5ca2698d3e201c1e38973cf0d1775c7ef4c5581",
    "filename": "pom.xml",
    "status": "modified",
    "additions": 13,
    "deletions": 1,
    "changes": 14,
    "blob_url": "https://github.com/MaksymenkoIvan/Javalin/blob/500f3224a2a90c8f76704ba26284ccd48190c55f/pom.xml",
    "raw_url": "https://github.com/MaksymenkoIvan/Javalin/raw/500f3224a2a90c8f76704ba26284ccd48190c55f/pom.xml",
    "contents_url": "https://api.github.com/repos/MaksymenkoIvan/Javalin/contents/pom.xml?ref=500f3224a2a90c8f76704ba26284ccd48190c55f",
    "patch": "@@ -25,6 +25,11 @@\n       <version>4.11</version>\n       <scope>test</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-databind</artifactId>\n+      <version>2.10.3</version>\n+    </dependency>\n     <dependency>\n       <groupId>io.javalin</groupId>\n       <artifactId>javalin</artifactId>\n@@ -35,11 +40,18 @@\n       <artifactId>jte</artifactId>\n       <version>1.0.0</version>\n     </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-core</artifactId>\n+      <version>2.12.2</version>\n+    </dependency>\n+    <!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind -->\n     <dependency>\n       <groupId>com.fasterxml.jackson.core</groupId>\n       <artifactId>jackson-databind</artifactId>\n-      <version>2.10.3</version>\n+      <version>2.12.2</version>\n     </dependency>\n+\n     <dependency>\n       <groupId>org.slf4j</groupId>\n       <artifactId>slf4j-simple</artifactId>"
  },
  {
    "sha": "efa43dcae22486f506e0f3e77c3519a39d9546a7",
    "filename": "src/main/java/org/example/App.java",
    "status": "modified",
    "additions": 25,
    "deletions": 32,
    "changes": 57,
    "blob_url": "https://github.com/MaksymenkoIvan/Javalin/blob/500f3224a2a90c8f76704ba26284ccd48190c55f/src/main/java/org/example/App.java",
    "raw_url": "https://github.com/MaksymenkoIvan/Javalin/raw/500f3224a2a90c8f76704ba26284ccd48190c55f/src/main/java/org/example/App.java",
    "contents_url": "https://api.github.com/repos/MaksymenkoIvan/Javalin/contents/src/main/java/org/example/App.java?ref=500f3224a2a90c8f76704ba26284ccd48190c55f",
    "patch": "@@ -3,7 +3,9 @@\n import io.javalin.Javalin;\n import io.javalin.http.Context;\n \n+import java.nio.file.attribute.UserPrincipalNotFoundException;\n import java.util.Collections;\n+import java.util.Optional;\n \n \n public class App {\n@@ -29,7 +31,22 @@ public static void main( String[] args )\n             System.out.println(ctx.status());\n             ctx.render(\"login.jte\");\n         });\n-        javalin.get(\"/balance/\" + user.getUserName(), App::balance);\n+        javalin.get(\"/balance/:user_id\", ctx ->{\n+            String userId = ctx.pathParam(\"user_id\");\n+            try{\n+                Optional<Double> balance = data.getBalanceId(userId);\n+                if (balance.isPresent()){\n+                    ctx.json(balance.get());\n+                    ctx.status(200);\n+                }else {\n+                    ctx.json(\"Not Found\");\n+                    ctx.status(404);\n+                }\n+            }catch (Exception e){\n+                ctx.status(400);\n+                ctx.json(\"Unexpected error\" + e.getMessage());\n+            }\n+        });\n         javalin.post(\"/api/auth/\", ctx ->{\n             System.out.println(ctx.formParam(\"login\"));\n             System.out.println(ctx.formParam(\"pass\"));\n@@ -59,8 +76,8 @@ public static void main( String[] args )\n             System.out.println(\"1-st log: \" + log1);\n             String log2 = ctx.formParam(\"log2\");\n             System.out.println(\"2-nd log: \" + log2);\n-            System.out.println(\"Balance 1 log: \" + data.getBalance(log1));\n-            System.out.println(\"Balance 2 log: \" + data.getBalance(log2));\n+            System.out.println(\"Balance 1 log: \" + data.getBalanceName(log1));\n+            System.out.println(\"Balance 2 log: \" + data.getBalanceName(log2));\n             user.sumBalance = data.sum(log1, log2);\n             System.out.println(\"Sum: \" + user.sumBalance);\n             ctx.redirect(\"/fullsum\");\n@@ -71,32 +88,14 @@ public static void main( String[] args )\n         javalin.get(\"/incorrectpass\", ctx ->{\n             ctx.render(\"incorrect_password.jte\");\n         });\n-\n-        /* javalin.post(\"/api/auth/\", ctx ->{\n-            System.out.println(ctx.formParam(\"login\"));\n-            System.out.println(ctx.formParam(\"pass\"));\n-            String login = ctx.formParam(\"login\");\n-            String pass = ctx.formParam(\"pass\");\n-            username = ctx.formParam(login);\n-            data.connect(login);\n-            if (data.auth(login, pass)){\n-                System.out.println(\"GOOD\");\n-                ctx.cookie(\"login\", login);\n-                ctx.redirect(\"/home\");\n-            }else {\n-                System.out.println(\"BAD\");\n-                ctx.redirect(\"/incorrectpass\");\n-            }\n-        });\n-         */\n         javalin.post(\"/api/transfer/\", ctx->{\n            String id = ctx.formParam(\"id\");\n            String balanace = ctx.formParam(\"amount\");\n            if(data.getId(\"login\") != Integer.valueOf(id) &&\n-                   data.getBalance(ctx.cookie(\"login\")) >= Double.valueOf(balanace)){\n+                   data.getBalanceName(ctx.cookie(\"login\")) >= Double.valueOf(balanace)){\n                data.transfer(data.getId(ctx.cookie(\"login\"))\n                        ,Integer.valueOf(id),\n-                       data.getBalance(ctx.cookie(\"login\")),\n+                       data.getBalanceName(ctx.cookie(\"login\")),\n                        Double.valueOf(balanace));\n                ctx.redirect(\"/home\");\n            }else {\n@@ -143,22 +142,16 @@ public static void main( String[] args )\n     public static void renderMainPage(Context ctx){\n         user.userName = data.getUserName(ctx.cookie(\"login\"));\n         user.id = data.getId(ctx.cookie(\"login\"));\n-        user.balance = data.getBalance(ctx.cookie(\"login\"));\n+        user.balance = data.getBalanceName(ctx.cookie(\"login\"));\n         ctx.render(\"home.jte\", Collections.singletonMap(\"user\", user));\n     }\n     public static void renderBillsPage(Context ctx){\n-        user.balance = data.getBalance(ctx.cookie(\"login\"));\n+        user.balance = data.getBalanceName(ctx.cookie(\"login\"));\n         ctx.render(\"mybills.jte\", Collections.singletonMap(\"user\", user));\n     }\n     public static void renderFullSumPage(Context ctx){\n         ctx.render(\"fullsum.jte\", Collections.singletonMap(\"user\", user));\n     }\n-    public static void balance(Context ctx){\n-        System.out.println(data.getUserName(ctx.cookie(\"login\")));\n-        user.userName = data.getUserName(ctx.cookie(\"login\"));\n-        System.out.println(\"name: \" + user.getUserName());\n-        ctx.json(data.getBalance(ctx.cookie(\"login\")));\n-    }\n     public static void renderInfoPage(Context ctx){\n         user.userName = data.getUserName(ctx.cookie(\"login\"));\n         user.id = data.getId(ctx.cookie(\"login\"));\n@@ -167,7 +160,7 @@ public static void renderInfoPage(Context ctx){\n     public static void renderSettingsPage(Context ctx){\n         user.userName = data.getUserName(ctx.cookie(\"login\"));\n         user.id = data.getId(ctx.cookie(\"login\"));\n-        user.balance = data.getBalance(ctx.cookie(\"login\"));\n+        user.balance = data.getBalanceName(ctx.cookie(\"login\"));\n         ctx.render(\"settings.jte\", Collections.singletonMap(\"user\", user));\n     }\n }"
  },
  {
    "sha": "f5dfeaa93080f671e2061e782be96a94cfafcf66",
    "filename": "src/main/java/org/example/Data.java",
    "status": "modified",
    "additions": 19,
    "deletions": 8,
    "changes": 27,
    "blob_url": "https://github.com/MaksymenkoIvan/Javalin/blob/500f3224a2a90c8f76704ba26284ccd48190c55f/src/main/java/org/example/Data.java",
    "raw_url": "https://github.com/MaksymenkoIvan/Javalin/raw/500f3224a2a90c8f76704ba26284ccd48190c55f/src/main/java/org/example/Data.java",
    "contents_url": "https://api.github.com/repos/MaksymenkoIvan/Javalin/contents/src/main/java/org/example/Data.java?ref=500f3224a2a90c8f76704ba26284ccd48190c55f",
    "patch": "@@ -1,13 +1,9 @@\n package org.example;\n \n-import org.hibernate.Session;\n-\n-import java.sql.Connection;\n-import java.sql.DriverManager;\n-import java.sql.PreparedStatement;\n-import java.sql.ResultSet;\n+import java.sql.*;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Optional;\n import java.util.Scanner;\n \n public class Data extends  Config {\n@@ -97,7 +93,7 @@ public int getId(String login){\n         return myid;\n     }\n \n-    public double getBalance(String login){\n+    public double getBalanceName(String login){\n         double balance = 0;\n         try{\n             PreparedStatement select = connection.prepareStatement(\n@@ -112,9 +108,24 @@ public double getBalance(String login){\n         }\n         return balance;\n     }\n+    public Optional<Double> getBalanceId(String id) {\n+        double balance = 0;\n+        try {\n+            PreparedStatement select = connection.prepareStatement(\n+                    \"SELECT balance FROM users WHERE id = ?\");\n+            select.setString(1, id);\n+            ResultSet set = select.executeQuery();\n+            if (set.next()) {\n+                return Optional.of(set.getDouble(1));\n+            }\n+        }catch (SQLException throwables) {\n+            throw new IllegalStateException();\n+        }\n+        return Optional.empty();\n+    }\n \n     public double sum(String login1, String login2){\n-        double sumBalance = getBalance(login1) + getBalance(login2);\n+        double sumBalance = getBalanceName(login1) + getBalanceName(login2);\n         return sumBalance;\n     }\n "
  }
]
