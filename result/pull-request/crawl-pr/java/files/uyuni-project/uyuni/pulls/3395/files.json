[
  {
    "sha": "befeea382218896d3a2cdf31289133a17ea6de1f",
    "filename": "testsuite/config/cucumber.yml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/uyuni-project/uyuni/blob/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/config/cucumber.yml",
    "raw_url": "https://github.com/uyuni-project/uyuni/raw/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/config/cucumber.yml",
    "contents_url": "https://api.github.com/repos/uyuni-project/uyuni/contents/testsuite/config/cucumber.yml?ref=64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5",
    "patch": "@@ -36,3 +36,4 @@ proxy: --tags @scope_proxy\n traditional_client: --tags @scope_traditional_client\n xmlrpc: --tags @scope_xmlrpc\n power_management: --tags @scope_power_management\n+retracted_patches: --tags @scope_retracted_patches"
  },
  {
    "sha": "2266ac2be850cdaf80a75b10ab894b95d1691fc6",
    "filename": "testsuite/features/secondary/min_retracted_patches.feature",
    "status": "added",
    "additions": 115,
    "deletions": 0,
    "changes": 115,
    "blob_url": "https://github.com/uyuni-project/uyuni/blob/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/features/secondary/min_retracted_patches.feature",
    "raw_url": "https://github.com/uyuni-project/uyuni/raw/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/features/secondary/min_retracted_patches.feature",
    "contents_url": "https://api.github.com/repos/uyuni-project/uyuni/contents/testsuite/features/secondary/min_retracted_patches.feature?ref=64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5",
    "patch": "@@ -0,0 +1,115 @@\n+# Copyright (c) 2021 SUSE LLC\n+# Licensed under the terms of the MIT license.\n+\n+@scope_retracted_patches\n+Feature: Retracted patches\n+\n+  Scenario: Installed retracted package should show icon in the system packages list\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I install package \"rute-dummy-2.1-1.1.x86_64\" on this \"sle_minion\"\n+    And I am on the \"Software\" page of this \"sle_minion\"\n+    And I follow \"Packages\"\n+    And I follow \"List / Remove\"\n+    And I enter \"rute-dummy\" as the filtered package name\n+    And I click on the filter button until page does contain \"rute-dummy\" text\n+    Then the table row for \"rute-dummy-2.1-1.1\" should contain \"retracted\" icon\n+    When I remove package \"rute-dummy\" from this \"sle_minion\"\n+    And I wait until refresh package list on \"sle_minion\" is finished\n+\n+  Scenario: Retracted package should not be available for installation\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I am on the \"Software\" page of this \"sle_minion\"\n+    And I follow \"Packages\"\n+    And I follow \"Install\"\n+    Then I should see a \"rute-dummy-2.0-1.2\" text\n+    And I should not see a \"rute-dummy-2.1-1.1\" text\n+\n+  Scenario: Retracted package should not be available for upgrade\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I install package \"rute-dummy-2.0-1.2.x86_64\" on this \"sle_minion\"\n+    And I am on the \"Software\" page of this \"sle_minion\"\n+    And I follow \"Packages\"\n+    And I follow \"Upgrade\"\n+    Then I should not see a \"rute-dummy-2.1-1.1\" text\n+    When I remove package \"rute-dummy\" from this \"sle_minion\"\n+    And I wait until refresh package list on \"sle_minion\" is finished\n+\n+  Scenario: Retracted patch should not affect any system\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I install package \"rute-dummy-2.0-1.2.x86_64\" on this \"sle_minion\"\n+    And I follow the left menu \"Software > Channel List > All\"\n+    And I follow \"Test-Channel-x86_64\"\n+    And I follow \"Patches\" in the content area\n+    And I follow \"rute-dummy-0817\"\n+    And I follow \"Affected Systems\"\n+    Then I should see a \"No systems.\" text\n+    When I remove package \"rute-dummy\" from this \"sle_minion\"\n+    And I wait until refresh package list on \"sle_minion\" is finished\n+   \n+  Scenario: Target systems for stable packages should not be empty\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Software > Channel List > All\"\n+    And I follow \"Test-Channel-x86_64\"\n+    And I follow \"Packages\" in the content area\n+    And I follow \"rute-dummy-2.0-1.2.x86_64\"\n+    And I follow \"Target Systems\"\n+    Then I should see \"sle_minion\" hostname\n+   \n+  Scenario: Target systems for retracted packages should be empty\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Software > Channel List > All\"\n+    And I follow \"Test-Channel-x86_64\"\n+    And I follow \"Packages\" in the content area\n+    And I follow \"rute-dummy-2.1-1.1.x86_64\"\n+    And I follow \"Target Systems\"\n+    Then I should not see \"sle_minion\" hostname\n+\n+  Scenario: Retracted packages in the patch detail\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Patches > Patch List > All\"\n+    And I follow \"rute-dummy-0815\"\n+    Then I should see a \"Status: Retracted\" text\n+    When I go back\n+    And I follow \"rute-dummy-0816\"\n+    Then I should see a \"Status: Stable\" text\n+    When I go back\n+    And I follow \"rute-dummy-0817\"\n+    Then I should see a \"Status: Retracted\" text\n+\n+  Scenario: Retracted packages in the patches list\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Patches > Patch List > All\"\n+    Then the table row for \"rute-dummy-0815\" should contain \"retracted\" icon\n+    And the table row for \"rute-dummy-0816\" should not contain \"retracted\" icon\n+    And the table row for \"rute-dummy-0817\" should contain \"retracted\" icon\n+\n+  Scenario: Retracted patches in the channel patches list\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Software > Channel List > All\"\n+    And I follow \"Test-Channel-x86_64\"\n+    And I follow \"Patches\" in the content area\n+    Then the table row for \"rute-dummy-0815\" should contain \"retracted\" icon\n+    And the table row for \"rute-dummy-0816\" should not contain \"retracted\" icon\n+    And the table row for \"rute-dummy-0817\" should contain \"retracted\" icon\n+ \n+  Scenario: Retracted packages in the channel packages list\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I follow the left menu \"Software > Channel List > All\"\n+    And I follow \"Test-Channel-x86_64\"\n+    And I follow \"Packages\" in the content area\n+    Then the table row for \"rute-dummy-2.0-1.1.x86_64\" should contain \"retracted\" icon\n+    Then the table row for \"rute-dummy-2.0-1.2.x86_64\" should not contain \"retracted\" icon\n+    Then the table row for \"rute-dummy-2.1-1.1.x86_64\" should contain \"retracted\" icon\n+\n+  Scenario: SSM: Retracted package should not be available for installation\n+    Given I am authorized as \"admin\" with password \"admin\"\n+    When I am on the System Overview page\n+    And I follow \"Clear\"\n+    And I check the \"sle_minion\" client \n+    And I am on System Set Manager Overview\n+    And I follow \"Packages\" in the content area\n+    And I follow \"Install\"\n+    And I follow \"Test-Channel-x86_64\"\n+    Then I should see a \"rute-dummy-2.0-1.2\" text\n+    And I should not see a \"rute-dummy-2.1-1.1\" text\n+    And I follow \"Clear\""
  },
  {
    "sha": "45a188a63d746222abca840b7ad7813742d83a12",
    "filename": "testsuite/features/step_definitions/navigation_steps.rb",
    "status": "modified",
    "additions": 23,
    "deletions": 0,
    "changes": 23,
    "blob_url": "https://github.com/uyuni-project/uyuni/blob/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/features/step_definitions/navigation_steps.rb",
    "raw_url": "https://github.com/uyuni-project/uyuni/raw/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/features/step_definitions/navigation_steps.rb",
    "contents_url": "https://api.github.com/repos/uyuni-project/uyuni/contents/testsuite/features/step_definitions/navigation_steps.rb?ref=64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5",
    "patch": "@@ -214,6 +214,11 @@\n   fill_in arg1, with: $no_auth_registry\n end\n \n+# Go back in the browser history\n+When(/^I go back$/) do\n+  page.driver.go_back\n+end\n+\n #\n # Click on a button\n #\n@@ -461,6 +466,24 @@\n   end\n end\n \n+Then(/^the table row for \"([^\"]*)\" should( not)? contain \"([^\"]*)\" icon$/) do |row, should_not, icon|\n+  case icon\n+  when 'retracted'\n+    content_selector = \"i[class*='errata-retracted']\"\n+  else\n+    raise \"Unsupported icon '#{icon}' in the step definition\"\n+  end\n+\n+  xpath_query = \"//div[@class=\\\"table-responsive\\\"]/table/tbody/tr[.//*[contains(.,'#{row}')]]\"\n+  within(:xpath, xpath_query) do\n+    if should_not\n+      raise \"xpath: #{xpath_query} has no icon #{icon}\" unless has_no_css?(content_selector, wait: DEFAULT_TIMEOUT)\n+    else\n+      raise \"xpath: #{xpath_query} has no icon #{icon}\" unless has_css?(content_selector, wait: DEFAULT_TIMEOUT)\n+    end\n+  end\n+end\n+\n When(/^I wait at most ([0-9]+) seconds until table row for \"([^\"]*)\" contains button \"([^\"]*)\"$/) do |timeout, text, button|\n   xpath_query = \"//tr[td[contains(., '#{text}')]]/td/descendant::*[self::a or self::button][@title='#{button}']\"\n   raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: timeout.to_f)"
  },
  {
    "sha": "06abab106671de393f17abbd8d0a79c8bf4ffed8",
    "filename": "testsuite/run_sets/secondary.yml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/uyuni-project/uyuni/blob/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/run_sets/secondary.yml",
    "raw_url": "https://github.com/uyuni-project/uyuni/raw/64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5/testsuite/run_sets/secondary.yml",
    "contents_url": "https://api.github.com/repos/uyuni-project/uyuni/contents/testsuite/run_sets/secondary.yml?ref=64a6dfde2960fb0cb5da915b1898ff6b1ca1cfe5",
    "patch": "@@ -52,5 +52,6 @@\n - features/secondary/min_change_software_channel.feature\n - features/secondary/srv_test_maintenance_windows.feature\n - features/secondary/srv_user_configuration_salt_states.feature\n+- features/secondary/min_retracted_patches.feature\n \n ## Secondary features END ##"
  }
]
