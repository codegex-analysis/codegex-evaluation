[
  {
    "sha": "73dda98c25484527c0dfd59228c329c9415f1214",
    "filename": "extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/extractors/PeertubeAccountExtractor.java",
    "status": "modified",
    "additions": 27,
    "deletions": 4,
    "changes": 31,
    "blob_url": "https://github.com/TeamNewPipe/NewPipeExtractor/blob/9fa08b8d231d15a96bb6ed370734e4edfb52069c/extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/extractors/PeertubeAccountExtractor.java",
    "raw_url": "https://github.com/TeamNewPipe/NewPipeExtractor/raw/9fa08b8d231d15a96bb6ed370734e4edfb52069c/extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/extractors/PeertubeAccountExtractor.java",
    "contents_url": "https://api.github.com/repos/TeamNewPipe/NewPipeExtractor/contents/extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/extractors/PeertubeAccountExtractor.java?ref=9fa08b8d231d15a96bb6ed370734e4edfb52069c",
    "patch": "@@ -1,5 +1,6 @@\n package org.schabi.newpipe.extractor.services.peertube.extractors;\n \n+import com.grack.nanojson.JsonArray;\n import com.grack.nanojson.JsonObject;\n import com.grack.nanojson.JsonParser;\n import com.grack.nanojson.JsonParserException;\n@@ -10,6 +11,7 @@\n import org.schabi.newpipe.extractor.downloader.Response;\n import org.schabi.newpipe.extractor.exceptions.ExtractionException;\n import org.schabi.newpipe.extractor.exceptions.ParsingException;\n+import org.schabi.newpipe.extractor.exceptions.ReCaptchaException;\n import org.schabi.newpipe.extractor.linkhandler.ListLinkHandler;\n import org.schabi.newpipe.extractor.services.peertube.PeertubeParsingHelper;\n import org.schabi.newpipe.extractor.services.peertube.linkHandler.PeertubeChannelLinkHandlerFactory;\n@@ -27,6 +29,7 @@\n public class PeertubeAccountExtractor extends ChannelExtractor {\n     private JsonObject json;\n     private final String baseUrl;\n+    private static final String ACCOUNTS = \"accounts/\";\n \n     public PeertubeAccountExtractor(final StreamingService service, final ListLinkHandler linkHandler) throws ParsingException {\n         super(service, linkHandler);\n@@ -55,8 +58,28 @@ public String getFeedUrl() throws ParsingException {\n     }\n \n     @Override\n-    public long getSubscriberCount() {\n-        return json.getLong(\"followersCount\");\n+    public long getSubscriberCount() throws ParsingException {\n+        long subscribersCount = json.getLong(\"followersCount\");\n+        String accountVideoChannelUrl = baseUrl + PeertubeChannelLinkHandlerFactory.API_ENDPOINT;\n+        if (getId().contains(ACCOUNTS)) {\n+            accountVideoChannelUrl += getId();\n+        } else {\n+            accountVideoChannelUrl += ACCOUNTS + getId();\n+        }\n+        accountVideoChannelUrl += \"/video-channels\";\n+\n+        try {\n+            final String responseBody = getDownloader().get(accountVideoChannelUrl).responseBody();\n+            final JsonObject jsonResponse = JsonParser.object().from(responseBody);\n+            final JsonArray videoChannels = jsonResponse.getArray(\"data\");\n+            for (final Object videoChannel : videoChannels) {\n+                final JsonObject videoChannelJsonObject = (JsonObject) videoChannel;\n+                subscribersCount += videoChannelJsonObject.getInt(\"followersCount\");\n+            }\n+        } catch (final IOException | JsonParserException | ReCaptchaException ignored) {\n+            // something went wrong during video channels extraction, only return subscribers of ownerAccount\n+        }\n+        return subscribersCount;\n     }\n \n     @Override\n@@ -130,10 +153,10 @@ public boolean isVerified() throws ParsingException {\n     public void onFetchPage(@Nonnull final Downloader downloader)\n             throws IOException, ExtractionException {\n         String accountUrl = baseUrl + PeertubeChannelLinkHandlerFactory.API_ENDPOINT;\n-        if (getId().contains(\"accounts/\")) {\n+        if (getId().contains(ACCOUNTS)) {\n             accountUrl += getId();\n         } else {\n-            accountUrl += \"accounts/\" + getId();\n+            accountUrl += ACCOUNTS + getId();\n         }\n \n         final Response response = downloader.get(accountUrl);"
  },
  {
    "sha": "92cf0b8c8889bac8f79dc887f75ad4c46d3657d4",
    "filename": "extractor/src/test/java/org/schabi/newpipe/extractor/services/peertube/PeertubeAccountExtractorTest.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/TeamNewPipe/NewPipeExtractor/blob/9fa08b8d231d15a96bb6ed370734e4edfb52069c/extractor/src/test/java/org/schabi/newpipe/extractor/services/peertube/PeertubeAccountExtractorTest.java",
    "raw_url": "https://github.com/TeamNewPipe/NewPipeExtractor/raw/9fa08b8d231d15a96bb6ed370734e4edfb52069c/extractor/src/test/java/org/schabi/newpipe/extractor/services/peertube/PeertubeAccountExtractorTest.java",
    "contents_url": "https://api.github.com/repos/TeamNewPipe/NewPipeExtractor/contents/extractor/src/test/java/org/schabi/newpipe/extractor/services/peertube/PeertubeAccountExtractorTest.java?ref=9fa08b8d231d15a96bb6ed370734e4edfb52069c",
    "patch": "@@ -102,7 +102,7 @@ public void testFeedUrl() throws ParsingException {\n \n         @Test\n         public void testSubscriberCount() throws ParsingException {\n-            assertTrue(\"Wrong subscriber count\", extractor.getSubscriberCount() >= 500);\n+            assertTrue(\"Wrong subscriber count\", extractor.getSubscriberCount() >= 750);\n         }\n \n         @Override"
  }
]
