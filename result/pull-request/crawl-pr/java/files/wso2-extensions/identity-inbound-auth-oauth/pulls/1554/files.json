[
  {
    "sha": "a8f24846ddd957d0fa8a122bde08c0a87ddfe99a",
    "filename": "components/org.wso2.carbon.identity.oauth/pom.xml",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/blob/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/pom.xml",
    "raw_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/raw/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/pom.xml",
    "contents_url": "https://api.github.com/repos/wso2-extensions/identity-inbound-auth-oauth/contents/components/org.wso2.carbon.identity.oauth/pom.xml?ref=14e192c6d371fb8ded9a45acbc9459c8db1dfdcc",
    "patch": "@@ -305,6 +305,10 @@\n             <groupId>org.wso2.carbon.utils</groupId>\n             <artifactId>org.wso2.carbon.database.utils</artifactId>\n         </dependency>\n+        <dependency>\n+            <groupId>org.wso2.carbon.identity.framework</groupId>\n+            <artifactId>org.wso2.carbon.identity.multi.attribute.login.mgt</artifactId>\n+        </dependency>\n     </dependencies>\n \n     <build>\n@@ -392,6 +396,8 @@\n                             org.wso2.carbon.core.*;version=\"${carbon.kernel.imp.pkg.version.range}\",\n                             org.wso2.carbon.user.core.*;version=\"${carbon.kernel.imp.pkg.version.range}\",\n                             org.wso2.carbon.utils.multitenancy;version=\"${carbon.kernel.imp.pkg.version.range}\",\n+                            org.wso2.carbon.identity.multi.attribute.login.mgt.*;\n+                            version=\"${carbon.identity.framework.imp.pkg.version.range}\",\n                         </Import-Package>\n                         <Export-Package>\n                             !org.wso2.carbon.identity.oauth.internal,"
  },
  {
    "sha": "dfd4147311b2b517037d592d656e7c3295f2c32e",
    "filename": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandler.java",
    "status": "modified",
    "additions": 9,
    "deletions": 0,
    "changes": 9,
    "blob_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/blob/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandler.java",
    "raw_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/raw/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandler.java",
    "contents_url": "https://api.github.com/repos/wso2-extensions/identity-inbound-auth-oauth/contents/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandler.java?ref=14e192c6d371fb8ded9a45acbc9459c8db1dfdcc",
    "patch": "@@ -38,6 +38,7 @@\n import org.wso2.carbon.identity.base.IdentityRuntimeException;\n import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n import org.wso2.carbon.identity.core.util.IdentityUtil;\n+import org.wso2.carbon.identity.multi.attribute.login.mgt.ResolvedUserResult;\n import org.wso2.carbon.identity.oauth.common.OAuthConstants;\n import org.wso2.carbon.identity.oauth.config.OAuthServerConfiguration;\n import org.wso2.carbon.identity.oauth.internal.OAuthComponentServiceHolder;\n@@ -208,6 +209,14 @@ private boolean validateUserCredentials(OAuth2AccessTokenReqDTO tokenReq, Servic\n             }\n             UserStoreManager userStoreManager = getUserStoreManager(tokenReq);\n             String tenantAwareUserName = MultitenantUtils.getTenantAwareUsername(tokenReq.getResourceOwnerUsername());\n+            String userTenantDomain = MultitenantUtils.getTenantDomain(tokenReq.getResourceOwnerUsername());\n+            ResolvedUserResult resolvedUserResult =\n+                    FrameworkUtils.processMultiAttributeLoginIdentification(tenantAwareUserName, userTenantDomain);\n+            if (resolvedUserResult != null &&\n+                    ResolvedUserResult.UserResolvedStatus.SUCCESS.equals(resolvedUserResult.getResolvedStatus())) {\n+                tenantAwareUserName = resolvedUserResult.getUser().getUsername();\n+                tokenReq.setResourceOwnerUsername(tenantAwareUserName + \"@\" + userTenantDomain);\n+            }\n             authenticated = userStoreManager.authenticate(tenantAwareUserName, tokenReq.getResourceOwnerPassword());\n             if (log.isDebugEnabled()) {\n                 log.debug(\"user \" + tokenReq.getResourceOwnerUsername() + \" authenticated: \" + authenticated);"
  },
  {
    "sha": "b0276e245126fae152252f5e2acc9e25adcb8b9b",
    "filename": "components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandlerTest.java",
    "status": "modified",
    "additions": 12,
    "deletions": 3,
    "changes": 15,
    "blob_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/blob/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandlerTest.java",
    "raw_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/raw/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandlerTest.java",
    "contents_url": "https://api.github.com/repos/wso2-extensions/identity-inbound-auth-oauth/contents/components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/token/handlers/grant/PasswordGrantHandlerTest.java?ref=14e192c6d371fb8ded9a45acbc9459c8db1dfdcc",
    "patch": "@@ -24,12 +24,14 @@\n import org.testng.annotations.DataProvider;\n import org.testng.annotations.ObjectFactory;\n import org.testng.annotations.Test;\n+import org.wso2.carbon.identity.application.authentication.framework.util.FrameworkUtils;\n import org.wso2.carbon.identity.application.common.IdentityApplicationManagementException;\n import org.wso2.carbon.identity.application.common.model.LocalAndOutboundAuthenticationConfig;\n import org.wso2.carbon.identity.application.common.model.ServiceProvider;\n import org.wso2.carbon.identity.application.mgt.ApplicationManagementService;\n import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n import org.wso2.carbon.identity.core.util.IdentityUtil;\n+import org.wso2.carbon.identity.multi.attribute.login.mgt.ResolvedUserResult;\n import org.wso2.carbon.identity.oauth.config.OAuthServerConfiguration;\n import org.wso2.carbon.identity.oauth.internal.OAuthComponentServiceHolder;\n import org.wso2.carbon.identity.oauth2.IdentityOAuth2Exception;\n@@ -62,7 +64,8 @@\n                 UserCoreUtil.class,\n                 OAuthComponentServiceHolder.class,\n                 OAuthServerConfiguration.class,\n-                IdentityUtil.class\n+                IdentityUtil.class,\n+                FrameworkUtils.class\n         }\n )\n public class PasswordGrantHandlerTest extends PowerMockIdentityBaseTest {\n@@ -121,7 +124,10 @@ public void testValidateGrant(String username, boolean isSaas) throws Exception\n \n         mockStatic(OAuth2ServiceComponentHolder.class);\n         when(OAuth2ServiceComponentHolder.getApplicationMgtService()).thenReturn(applicationManagementService);\n-\n+        mockStatic(FrameworkUtils.class);\n+        ResolvedUserResult resolvedUserResult = new ResolvedUserResult(ResolvedUserResult.UserResolvedStatus.FAIL);\n+        when(FrameworkUtils.processMultiAttributeLoginIdentification(anyString(), anyString())).\n+                thenReturn(resolvedUserResult);\n         mockStatic(IdentityTenantUtil.class);\n         when(IdentityTenantUtil.getTenantIdOfUser(anyString())).thenReturn(1);\n \n@@ -188,7 +194,10 @@ public void testValidateGrantForException(String tenantDomain, boolean authentic\n         mockStatic(OAuth2ServiceComponentHolder.class);\n         when(OAuth2ServiceComponentHolder.getApplicationMgtService()).thenReturn(applicationManagementService);\n         OAuthComponentServiceHolder.getInstance().setRealmService(realmService);\n-\n+        mockStatic(FrameworkUtils.class);\n+        ResolvedUserResult resolvedUserResult = new ResolvedUserResult(ResolvedUserResult.UserResolvedStatus.FAIL);\n+        when(FrameworkUtils.processMultiAttributeLoginIdentification(anyString(), anyString())).\n+                thenReturn(resolvedUserResult);\n         if (e instanceof IdentityApplicationManagementException) {\n             when(applicationManagementService\n                     .getServiceProviderByClientId(anyString(), anyString(), anyString())).thenThrow(e);"
  },
  {
    "sha": "7b04a5d7b4affa551e6be9215e19a33702c4fd39",
    "filename": "pom.xml",
    "status": "modified",
    "additions": 6,
    "deletions": 2,
    "changes": 8,
    "blob_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/blob/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/pom.xml",
    "raw_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/raw/14e192c6d371fb8ded9a45acbc9459c8db1dfdcc/pom.xml",
    "contents_url": "https://api.github.com/repos/wso2-extensions/identity-inbound-auth-oauth/contents/pom.xml?ref=14e192c6d371fb8ded9a45acbc9459c8db1dfdcc",
    "patch": "@@ -507,7 +507,11 @@\n                 <artifactId>jackson-jaxrs-json-provider</artifactId>\n                 <version>${com.fasterxml.jackson.version}</version>\n             </dependency>\n-\n+            <dependency>\n+                <groupId>org.wso2.carbon.identity.framework</groupId>\n+                <artifactId>org.wso2.carbon.identity.multi.attribute.login.mgt</artifactId>\n+                <version>${carbon.identity.framework.version}</version>\n+            </dependency>\n             <!--Test Dependencies-->\n             <dependency>\n                 <groupId>junit</groupId>\n@@ -877,7 +881,7 @@\n         <carbon.kernel.registry.imp.pkg.version.range>[1.0.1, 2.0.0)</carbon.kernel.registry.imp.pkg.version.range>\n \n         <!-- Carbon Identity Framework version -->\n-        <carbon.identity.framework.version>5.19.32</carbon.identity.framework.version>\n+        <carbon.identity.framework.version>5.19.45</carbon.identity.framework.version>\n         <carbon.identity.framework.imp.pkg.version.range>[5.15.0, 6.0.0)\n         </carbon.identity.framework.imp.pkg.version.range>\n "
  }
]
