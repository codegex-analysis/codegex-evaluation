[
  {
    "sha": "5281902f94e701384c085f3604521d628a89cc81",
    "filename": ".circleci/config.yml",
    "status": "modified",
    "additions": 51,
    "deletions": 51,
    "changes": 102,
    "blob_url": "https://github.com/ekaterinadimitrova2/cassandra/blob/b0808d4496953fac810ae4f84462e980706ecb9a/.circleci/config.yml",
    "raw_url": "https://github.com/ekaterinadimitrova2/cassandra/raw/b0808d4496953fac810ae4f84462e980706ecb9a/.circleci/config.yml",
    "contents_url": "https://api.github.com/repos/ekaterinadimitrova2/cassandra/contents/.circleci/config.yml?ref=b0808d4496953fac810ae4f84462e980706ecb9a",
    "patch": "@@ -3,10 +3,10 @@ jobs:\n   j8_jvm_upgrade_dtests:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 1\n+    parallelism: 2\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -96,10 +96,10 @@ jobs:\n   j8_cqlsh-dtests-py2-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -175,10 +175,10 @@ jobs:\n   j11_unit_tests:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -269,10 +269,10 @@ jobs:\n   j8_cqlsh-dtests-py38-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -348,10 +348,10 @@ jobs:\n   j11_cqlsh-dtests-py3-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -428,10 +428,10 @@ jobs:\n   j11_cqlsh-dtests-py3-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -508,10 +508,10 @@ jobs:\n   j11_cqlsh-dtests-py38-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -588,10 +588,10 @@ jobs:\n   j8_cqlsh-dtests-py3-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -667,10 +667,10 @@ jobs:\n   j8_cqlsh-dtests-py2-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -746,10 +746,10 @@ jobs:\n   j11_cqlsh-dtests-py2-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -826,10 +826,10 @@ jobs:\n   j11_dtests-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -909,10 +909,10 @@ jobs:\n   j8_dtests-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -969,10 +969,10 @@ jobs:\n   j8_upgradetests-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1029,7 +1029,7 @@ jobs:\n   utests_stress:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n     parallelism: 1\n@@ -1076,10 +1076,10 @@ jobs:\n   j8_unit_tests:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1169,10 +1169,10 @@ jobs:\n   j11_jvm_dtests:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 1\n+    parallelism: 2\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1346,10 +1346,10 @@ jobs:\n   j11_cqlsh-dtests-py2-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1465,10 +1465,10 @@ jobs:\n   j8_dtests-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1525,10 +1525,10 @@ jobs:\n   j11_cqlsh-dtests-py38-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1605,10 +1605,10 @@ jobs:\n   j8_jvm_dtests:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 1\n+    parallelism: 5\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1780,10 +1780,10 @@ jobs:\n   j8_cqlsh-dtests-py3-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1859,10 +1859,10 @@ jobs:\n   j8_cqlsh-dtests-py38-with-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -1938,7 +1938,7 @@ jobs:\n   utests_long:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n     parallelism: 1\n@@ -1985,10 +1985,10 @@ jobs:\n   utests_system_keyspace_directory:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -2116,7 +2116,7 @@ jobs:\n   utests_fqltool:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n     parallelism: 1\n@@ -2163,10 +2163,10 @@ jobs:\n   j11_dtests-no-vnodes:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra\n@@ -2246,10 +2246,10 @@ jobs:\n   utests_compression:\n     docker:\n     - image: apache/cassandra-testing-ubuntu2004-java11-w-dependencies:20210304\n-    resource_class: medium\n+    resource_class: xlarge\n     working_directory: ~/\n     shell: /bin/bash -eo pipefail -l\n-    parallelism: 4\n+    parallelism: 100\n     steps:\n     - attach_workspace:\n         at: /home/cassandra"
  },
  {
    "sha": "ff932cdde534e56a0f3013b6a8a284ab51404642",
    "filename": "src/java/org/apache/cassandra/service/StorageService.java",
    "status": "modified",
    "additions": 13,
    "deletions": 0,
    "changes": 13,
    "blob_url": "https://github.com/ekaterinadimitrova2/cassandra/blob/b0808d4496953fac810ae4f84462e980706ecb9a/src/java/org/apache/cassandra/service/StorageService.java",
    "raw_url": "https://github.com/ekaterinadimitrova2/cassandra/raw/b0808d4496953fac810ae4f84462e980706ecb9a/src/java/org/apache/cassandra/service/StorageService.java",
    "contents_url": "https://api.github.com/repos/ekaterinadimitrova2/cassandra/contents/src/java/org/apache/cassandra/service/StorageService.java?ref=b0808d4496953fac810ae4f84462e980706ecb9a",
    "patch": "@@ -4429,6 +4429,19 @@ public void run()\n                     {\n                         logger.info(\"failed to shutdown message service: {}\", ioe);\n                     }\n+\n+                    // wait for miscellaneous tasks like sstable and commitlog segment deletion\n+                    ScheduledExecutors.nonPeriodicTasks.shutdown();\n+                    try\n+                    {\n+                        if (!ScheduledExecutors.nonPeriodicTasks.awaitTermination(1, MINUTES))\n+                            logger.warn(\"Failed to wait for non periodic tasks to shutdown\");\n+                    }\n+                    catch (InterruptedException e)\n+                    {\n+                        e.printStackTrace();\n+                    }\n+\n                     Stage.shutdownNow();\n                     SystemKeyspace.setBootstrapState(SystemKeyspace.BootstrapState.DECOMMISSIONED);\n                     setMode(Mode.DECOMMISSIONED, true);"
  }
]
