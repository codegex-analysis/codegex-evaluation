[
  {
    "sha": "52cfb46946a83be20d8eb682a1f8893f921769fe",
    "filename": "src/main/resources/org/biouno/unochoice/stapler/unochoice/unochoice.js",
    "status": "modified",
    "additions": 264,
    "deletions": 38,
    "changes": 302,
    "blob_url": "https://github.com/jenkinsci/active-choices-plugin/blob/6af8be9d140b5fcd6ce3cacf84597fc01442c4e6/src/main/resources/org/biouno/unochoice/stapler/unochoice/unochoice.js",
    "raw_url": "https://github.com/jenkinsci/active-choices-plugin/raw/6af8be9d140b5fcd6ce3cacf84597fc01442c4e6/src/main/resources/org/biouno/unochoice/stapler/unochoice/unochoice.js",
    "contents_url": "https://api.github.com/repos/jenkinsci/active-choices-plugin/contents/src/main/resources/org/biouno/unochoice/stapler/unochoice/unochoice.js?ref=6af8be9d140b5fcd6ce3cacf84597fc01442c4e6",
    "patch": "@@ -222,14 +222,14 @@ var UnoChoice = UnoChoice || (function($) {\n                     _self.getFilterElement().setOriginalArray(originalArray);\n                 }\n             } else if (parameterElement.tagName === 'DIV') {\n-                if (parameterElement.children.length > 0 && (parameterElement.children[0].tagName === 'TABLE' || parameterElement.children[0].tagName === 'DIV')) {\n+                if (parameterElement.children.length > 0 && parameterElement.children[0].tagName === 'TABLE') {\n                     var table = parameterElement.children[0];\n                     var tbody = table.children[0];\n                     if (tbody) {\n                         jQuery(tbody).empty();\n                     } else {\n-                       tbody = document.createElement('tbody');\n-                       table.appendChild(tbody);\n+                        tbody = document.createElement('tbody');\n+                        table.appendChild(tbody);\n                     }\n                     var originalArray = [];\n                     // Check whether it is a radio or checkbox element\n@@ -255,25 +255,19 @@ var UnoChoice = UnoChoice || (function($) {\n                             if (disabledElements.indexOf(i) >= 0) {\n                                 input.setAttribute('disabled', 'disabled');\n                             }\n+                            input.setAttribute('json', key);\n+                            input.setAttribute('name', 'value');\n+                            input.setAttribute(\"value\", key);\n+                            input.setAttribute(\"class\", \" \");\n+                            input.setAttribute(\"type\", \"checkbox\");\n+                            label.className = \"attach-previous\";\n                             if (!entry instanceof String) {\n-                                input.setAttribute('json', key);\n-                                input.setAttribute('name', 'value');\n-                                input.setAttribute(\"value\", key);\n-                                input.setAttribute(\"class\", \" \");\n-                                input.setAttribute(\"type\", \"checkbox\");\n                                 input.setAttribute(\"title\", JSON.stringify(entry));\n                                 input.setAttribute(\"alt\", JSON.stringify(entry));\n-                                label.className = \"attach-previous\";\n                                 label.innerHTML = JSON.stringify(entry);\n                             } else {\n-                                input.setAttribute('json', key);\n-                                input.setAttribute('name', 'value');\n-                                input.setAttribute(\"value\", key);\n-                                input.setAttribute(\"class\", \" \");\n-                                input.setAttribute(\"type\", \"checkbox\");\n                                 input.setAttribute(\"title\", entry);\n                                 input.setAttribute(\"alt\", entry);\n-                                label.className = \"attach-previous\";\n                                 label.innerHTML = entry;\n                             }\n                             originalArray.push(input);\n@@ -314,27 +308,19 @@ var UnoChoice = UnoChoice || (function($) {\n                             if (disabledElements.indexOf(i) >= 0) {\n                                 input.setAttribute('disabled', 'disabled');\n                             }\n+                            input.setAttribute('json', key);\n+                            input.setAttribute('name', _self.getParameterName());\n+                            input.setAttribute(\"value\", key);\n+                            input.setAttribute(\"class\", \" \");\n+                            input.setAttribute(\"type\", \"radio\");\n+                            input.setAttribute('onchange', 'UnoChoice.fakeSelectRadioButton(\"'+_self.getParameterName()+'\", \"'+idValue+'\")');\n+                            input.setAttribute('otherId', idValue);\n+                            label.className = \"attach-previous\";\n                             if (!entry instanceof String) {\n-                                input.setAttribute('json', key);\n-                                input.setAttribute('name', _self.getParameterName());\n-                                input.setAttribute(\"value\", key);\n-                                input.setAttribute(\"class\", \" \");\n-                                input.setAttribute(\"type\", \"radio\");\n                                 input.setAttribute('alt', JSON.stringify(entry));\n-                                input.setAttribute('onchange', 'UnoChoice.fakeSelectRadioButton(\"'+_self.getParameterName()+'\", \"'+idValue+'\")');\n-                                input.setAttribute('otherId', idValue);\n-                                label.className = \"attach-previous\";\n                                 label.innerHTML = JSON.stringify(entry);\n                             } else {\n-                                input.setAttribute('json', key);\n-                                input.setAttribute('name', _self.getParameterName());\n-                                input.setAttribute(\"value\", key);\n-                                input.setAttribute(\"class\", \" \");\n-                                input.setAttribute(\"type\", \"radio\");\n                                 input.setAttribute('alt', entry);\n-                                input.setAttribute('onchange', 'UnoChoice.fakeSelectRadioButton(\"'+_self.getParameterName()+'\", \"'+idValue+'\")');\n-                                input.setAttribute('otherId', idValue);\n-                                label.className = \"attach-previous\";\n                                 label.innerHTML = entry;\n                             }\n                             hiddenValue.setAttribute('json', key);\n@@ -368,8 +354,137 @@ var UnoChoice = UnoChoice || (function($) {\n                      * This height is equivalent to setting the number of rows displayed in a select/multiple\n                      */\n                     parameterElement.style.height = newValues.length > 10 ? '230px' : 'auto';\n-                } // if (oldSel.children.length > 0 && oldSel.children[0].tagName === 'TABLE')\n-            } // if (oldSel.tagName === 'SELECT') { // else if (oldSel.tagName === 'DIV') {\n+                } // if (parameterElement.children.length > 0 && parameterElement.children[0].tagName === 'TABLE') {\n+                if (parameterElement.children.length > 0 && parameterElement.children[0].tagName === 'DIV') {\n+                    var tbody = parameterElement.children[0];\n+                    jQuery(tbody).empty();\n+                    var originalArray = [];\n+                    // Check whether it is a radio or checkbox element\n+                    if (parameterElement.className === 'dynamic_checkbox') {\n+                        for (i = 0; i < newValues.length; i++) {\n+                            var entry = newValues[i];\n+                            var key = newKeys[i];\n+                            // <TR>\n+                            var tr = document.createElement('div');\n+                            var idValue = 'ecp_' + _self.getRandomName() + '_' + i;\n+                            idValue = idValue.replace(' ', '_');\n+                            tr.setAttribute('id', idValue);\n+                            tr.setAttribute('style', 'white-space:nowrap');\n+                            tr.setAttribute('class', 'tr');\n+                            // <TD>\n+                            var td = document.createElement('div');\n+                            // <INPUT>\n+                            var input = document.createElement('input');\n+                            // <LABEL>\n+                            var label = document.createElement('label');\n+                            if (selectedElements.indexOf(i) >= 0) {\n+                                input.setAttribute('checked', 'checked');\n+                            }\n+                            if (disabledElements.indexOf(i) >= 0) {\n+                                input.setAttribute('disabled', 'disabled');\n+                            }\n+                            input.setAttribute('json', key);\n+                            input.setAttribute('name', 'value');\n+                            input.setAttribute(\"value\", key);\n+                            input.setAttribute(\"class\", \" \");\n+                            input.setAttribute(\"type\", \"checkbox\");\n+                            label.className = \"attach-previous\";\n+                            if (!entry instanceof String) {\n+                                input.setAttribute(\"title\", JSON.stringify(entry));\n+                                input.setAttribute(\"alt\", JSON.stringify(entry));\n+                                label.innerHTML = JSON.stringify(entry);\n+                            } else {\n+                                input.setAttribute(\"title\", entry);\n+                                input.setAttribute(\"alt\", entry);\n+                                label.innerHTML = entry;\n+                            }\n+                            originalArray.push(input);\n+                            // Put everything together\n+                            td.appendChild(input);\n+                            td.appendChild(label);\n+                            tr.appendChild(td);\n+                            tbody.appendChild(tr);\n+                        }\n+                        // Update the values for the filtering\n+                        if (_self.getFilterElement()) {\n+                            _self.getFilterElement().setOriginalArray(originalArray);\n+                        }\n+                    } else { // radio\n+                         for (i = 0; i < newValues.length; i++) {\n+                            var entry = newValues[i];\n+                            var key = newKeys[i];\n+                            // <TR>\n+                            var tr = document.createElement('div');\n+                            var idValue = 'ecp_' + _self.getRandomName() + '_' + i;\n+                            idValue = idValue.replace(' ', '_');\n+                            //tr.setAttribute('id', idValue); // will use the ID for the hidden value element\n+                            tr.setAttribute('style', 'white-space:nowrap');\n+                            tr.setAttribute('class', 'tr');\n+                            // <TD>\n+                            var td = document.createElement('div');\n+                            // <INPUT>\n+                            var input = document.createElement('input');\n+                            // <LABEL>\n+                            var label = document.createElement('label');\n+                            // <HIDDEN>\n+                            var hiddenValue = document.createElement('input');\n+                            if (selectedElements.indexOf(i) >= 0) {\n+                                input.setAttribute('checked', 'checked');\n+                                hiddenValue.setAttribute('name', 'value');\n+                            } else {\n+                                hiddenValue.setAttribute('name', '');\n+                            }\n+                            if (disabledElements.indexOf(i) >= 0) {\n+                                input.setAttribute('disabled', 'disabled');\n+                            }\n+                            input.setAttribute('json', key);\n+                            input.setAttribute('name', _self.getParameterName());\n+                            input.setAttribute(\"value\", key);\n+                            input.setAttribute(\"class\", \" \");\n+                            input.setAttribute(\"type\", \"radio\");\n+                            input.setAttribute('onchange', 'UnoChoice.fakeSelectRadioButton(\"'+_self.getParameterName()+'\", \"'+idValue+'\")');\n+                            input.setAttribute('otherId', idValue);\n+                            label.className = \"attach-previous\";\n+                            if (!entry instanceof String) {\n+                                input.setAttribute('alt', JSON.stringify(entry));\n+                                label.innerHTML = JSON.stringify(entry);\n+                            } else {\n+                                input.setAttribute('alt', entry);\n+                                label.innerHTML = entry;\n+                            }\n+                            hiddenValue.setAttribute('json', key);\n+                            hiddenValue.setAttribute(\"value\", key);\n+                            hiddenValue.setAttribute(\"class\", _self.getParameterName());\n+                            hiddenValue.setAttribute(\"type\", \"hidden\");\n+                            if (!entry instanceof String) {\n+                                hiddenValue.setAttribute('title', JSON.stringify(entry));\n+                            } else {\n+                                hiddenValue.setAttribute('title', entry);\n+                            }\n+                            hiddenValue.setAttribute('id', idValue);\n+                            originalArray.push(input);\n+                            // Put everything together\n+                            td.appendChild(input);\n+                            td.appendChild(label);\n+                            td.appendChild(hiddenValue);\n+                            tr.appendChild(td);\n+                            tbody.appendChild(tr);\n+                            var endTr = document.createElement('div');\n+                            endTr.setAttribute('style', 'display: none');\n+                            endTr.setAttribute('class', 'radio-block-end');\n+                            tbody.appendChild(endTr);\n+                        }\n+                        // Update the values for the filtering\n+                        if (_self.getFilterElement()) {\n+                            _self.getFilterElement().setOriginalArray(originalArray);\n+                        }\n+                    } // if (oldSel.className === 'dynamic_checkbox')\n+                    /*\n+                     * This height is equivalent to setting the number of rows displayed in a select/multiple\n+                     */\n+                    parameterElement.style.height = newValues.length > 10 ? '230px' : 'auto';\n+                } // if (parameterElement.children.length > 0 && parameterElement.children[0].tagName === 'DIV') {\n+            } // if (parameterElement.tagName === 'SELECT') { // } else if (parameterElement.tagName === 'DIV') {\n         });\n         // propagate change\n         // console.log('Propagating change event from ' + this.getParameterName());\n@@ -573,7 +688,7 @@ var UnoChoice = UnoChoice || (function($) {\n                 this.originalArray.push(options[i]);\n             }\n         } else if (paramElement.tagName === 'DIV') { // handle CHECKBOXES\n-            if (jQuery(paramElement).children().length > 0 && (paramElement.children[0].tagName === 'TABLE' || paramElement.children[0].tagName === 'DIV')) {\n+            if (jQuery(paramElement).children().length > 0 && paramElement.children[0].tagName === 'TABLE') {\n                 var table = paramElement.children[0];\n                 var tbody = table.children[0];\n                 if (paramElement.className === 'dynamic_checkbox') {\n@@ -593,7 +708,27 @@ var UnoChoice = UnoChoice || (function($) {\n                         this.originalArray.push(input);\n                     }\n                 }\n-            }\n+            } // if (jQuery(paramElement).children().length > 0 && paramElement.children[0].tagName === 'TABLE') {\n+            if (jQuery(paramElement).children().length > 0 && paramElement.children[0].tagName === 'DIV') {\n+                var tbody = paramElement.children[0];\n+                if (paramElement.className === 'dynamic_checkbox') {\n+                    var trs = jQuery(tbody).find('div');\n+                    for (var i = 0; i < trs.length ; ++i) {\n+                        var tds = jQuery(trs[i]).find('div');\n+                        var inputs = jQuery(tds[0]).find('input');\n+                        var input = inputs[0];\n+                        this.originalArray.push(input);\n+                    }\n+                } else {\n+                    var trs = jQuery(tbody).find('div');\n+                    for (var i = 0; i < trs.length ; ++i) {\n+                        var tds = jQuery(trs[i]).find('div');\n+                        var inputs = jQuery(tds[0]).find('input');\n+                        var input = inputs[0];\n+                        this.originalArray.push(input);\n+                    }\n+                }\n+            } // if (jQuery(paramElement).children().length > 0 && paramElement.children[0].tagName === 'DIV') {\n         }\n         this.initEventHandler();\n     }\n@@ -690,7 +825,7 @@ var UnoChoice = UnoChoice || (function($) {\n                    jQuery(filteredElement).append(opt);\n                }\n             } else if (tagName === 'DIV') { // handle CHECKBOXES, RADIOBOXES and other elements (Jenkins renders them as tables)\n-               if (jQuery(filteredElement).children().length > 0 && (jQuery(filteredElement).children()[0].tagName === 'TABLE' || jQuery(filteredElement).children()[0].tagName === 'DIV')) {\n+                if (jQuery(filteredElement).children().length > 0 && jQuery(filteredElement).children()[0].tagName === 'TABLE') {\n                     var table = filteredElement.children[0];\n                     var tbody = table.children[0];\n                     jQuery(tbody).empty();\n@@ -779,8 +914,99 @@ var UnoChoice = UnoChoice || (function($) {\n                             tbody.appendChild(tr);\n                         }\n                     }\n-                }\n-            }\n+                } // if (jQuery(filteredElement).children().length > 0 && jQuery(filteredElement).children()[0].tagName === 'TABLE') {\n+                if (jQuery(filteredElement).children().length > 0 && jQuery(filteredElement).children()[0].tagName === 'DIV') {\n+                    var tbody = filteredElement.children[0];\n+                    jQuery(tbody).empty();\n+                    if (filteredElement.className === 'dynamic_checkbox') {\n+                        for (var i = 0; i < newOptions.length; i++) {\n+                            var entry = newOptions[i];\n+                            // TR\n+                            var tr = document.createElement('div');\n+                            var idValue = 'ecp_' + e.target.randomName + '_' + i;\n+                            idValue = idValue.replace(' ', '_');\n+                            tr.setAttribute('id', idValue);\n+                            tr.setAttribute('style', 'white-space:nowrap');\n+                            tr.setAttribute('class', 'tr');\n+                            // TD\n+                            var td = document.createElement('div');\n+                            // INPUT\n+                            var input = document.createElement('input');\n+                            // LABEL\n+                            var label = document.createElement('label');\n+                            if (!(entry instanceof String)) {\n+                                label.className = \"attach-previous\";\n+                                if (entry.tagName === 'INPUT') {\n+                                    input = entry;\n+                                    label.innerHTML = input.getAttribute('title');\n+                                    label.title = input.getAttribute('title');\n+                                } else {\n+                                    input.setAttribute('json', JSON.stringify(entry.value));\n+                                    input.setAttribute('name', 'value');\n+                                    input.setAttribute(\"value\", JSON.stringify(entry.value));\n+                                    input.setAttribute(\"type\", \"radio\");\n+                                    label.innerHTML = input;\n+                                }\n+                            } else {\n+                                input.setAttribute('json', entry);\n+                                input.setAttribute('name', 'value');\n+                                input.setAttribute(\"value\", entry);\n+                                input.setAttribute(\"type\", \"checkbox\");\n+                                label.className = \"attach-previous\";\n+                                label.title = entry.getAttribute('title');\n+                                label.innerHTML = entry.getAttribute('title');\n+                            }\n+                            // Put everything together\n+                            td.appendChild(input);\n+                            td.appendChild(label);\n+                            tr.appendChild(td);\n+                            tbody.appendChild(tr);\n+                        }\n+                    } else {\n+                        for (var i = 0; i < newOptions.length; i++) {\n+                            var entry = newOptions[i];\n+                            // TR\n+                            var tr = document.createElement('div');\n+                            var idValue = '';\n+                            if (!(entry instanceof String)) {\n+                                if (entry.tagName === 'INPUT') {\n+                                    idValue = 'ecp_' + entry.getAttribute('name') + '_' + i;\n+                                }\n+                            } else {\n+                                idValue = 'ecp_' + entry + '_' + i;\n+                            }\n+                            idValue = idValue.replace(' ', '_');\n+                            tr.setAttribute('id', idValue);\n+                            tr.setAttribute('style', 'white-space:nowrap');\n+                            tr.setAttribute('class', 'tr');\n+                            // TD\n+                            var td = document.createElement('div');\n+                            // INPUTs\n+                            var jsonInput = document.createElement('input'); // used to help in the selection\n+                            var input = document.createElement('input');\n+                            // LABEL\n+                            var label = document.createElement('label');\n+                            label.className = \"attach-previous\";\n+                            input = entry;\n+                            input.checked = false;\n+                            jsonInput.setAttribute('id', input.getAttribute('otherid'));\n+                            jsonInput.setAttribute('json', input.getAttribute('json'));\n+                            jsonInput.setAttribute('name', '');\n+                            jsonInput.setAttribute(\"value\", input.getAttribute('value'));\n+                            jsonInput.setAttribute(\"class\", input.getAttribute('name'));\n+                            jsonInput.setAttribute(\"type\", \"hidden\");\n+                            jsonInput.setAttribute('title', input.getAttribute('alt'));\n+                            label.innerHTML = input.getAttribute('alt');\n+                            // Put everything together\n+                            td.appendChild(input);\n+                            td.appendChild(label);\n+                            td.appendChild(jsonInput);\n+                            tr.appendChild(td);\n+                            tbody.appendChild(tr);\n+                        }\n+                    }\n+                } // if (jQuery(filteredElement).children().length > 0 && jQuery(filteredElement).children()[0].tagName === 'DIV') {\n+            } // if (tagName === 'SELECT') { // } else if (tagName === 'DIV') {\n             // Propagate the changes made by the filter\n             console.log('Propagating change event after filtering');\n             var e = jQuery.Event('change', {parameterName: 'Filter Element Event'});"
  }
]
