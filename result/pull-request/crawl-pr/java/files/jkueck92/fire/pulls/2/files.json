[
  {
    "sha": "5fc188abd70644c46d5c772a5f6acb9a10831582",
    "filename": "pom.xml",
    "status": "modified",
    "additions": 18,
    "deletions": 0,
    "changes": 18,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/pom.xml",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/pom.xml",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/pom.xml?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -59,9 +59,27 @@\n             <artifactId>spring-boot-starter-test</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>javax.xml.bind</groupId>\n+            <artifactId>jaxb-api</artifactId>\n+            <version>2.3.1</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.glassfish.jaxb</groupId>\n+            <artifactId>jaxb-runtime</artifactId>\n+            <version>2.3.1</version>\n+            <scope>runtime</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <version>4.12</version>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n \n     <build>\n+        <finalName>fire</finalName>\n         <plugins>\n             <plugin>\n                 <groupId>org.springframework.boot</groupId>"
  },
  {
    "sha": "7b5a5881d80aff303f6c3523e2eec3ad7b914751",
    "filename": "src/main/java/de/jkueck/fire/AlertMessage.java",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/AlertMessage.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/AlertMessage.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/AlertMessage.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -48,9 +48,9 @@\n \n         private String remark2;\n \n-        private String completeMessage;\n+        private final String completeMessage;\n \n-        private Date alertTimestamp;\n+        private final Date alertTimestamp;\n \n         public Builder(final String completeMessage, Date alertTimestamp) {\n             this.completeMessage = completeMessage;"
  },
  {
    "sha": "5a65eb9c4a2c29042f7cee42cef12b55221e0e75",
    "filename": "src/main/java/de/jkueck/fire/events/AlertEvent.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/events/AlertEvent.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/events/AlertEvent.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/events/AlertEvent.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -7,7 +7,7 @@\n public class AlertEvent extends ApplicationEvent {\n \n     @Getter\n-    private AlertMessage alertMessage;\n+    private final AlertMessage alertMessage;\n \n     public AlertEvent(Object source, AlertMessage alertMessage) {\n         super(source);"
  },
  {
    "sha": "0835cb9bf5b8433f0817e54f3240b495a29e3c48",
    "filename": "src/main/java/de/jkueck/fire/integrations/divera/DiveraBot.java",
    "status": "renamed",
    "additions": 1,
    "deletions": 3,
    "changes": 4,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/divera/DiveraBot.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/divera/DiveraBot.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/integrations/divera/DiveraBot.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -1,14 +1,12 @@\n-package de.jkueck.fire.bots.divera;\n+package de.jkueck.fire.integrations.divera;\n \n import de.jkueck.fire.events.AlertEvent;\n import de.jkueck.fire.AlertMessage;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.commons.lang3.StringUtils;\n import org.springframework.beans.factory.annotation.Value;\n import org.springframework.context.ApplicationListener;\n-import org.springframework.http.ResponseEntity;\n import org.springframework.stereotype.Component;\n-import org.springframework.web.client.RestTemplate;\n \n @Slf4j\n @Component",
    "previous_filename": "src/main/java/de/jkueck/fire/bots/divera/DiveraBot.java"
  },
  {
    "sha": "e97e64f12c8b78a0ebe3e51893790dc8cc9a6cd2",
    "filename": "src/main/java/de/jkueck/fire/integrations/fireboard/FireboardIntegration.java",
    "status": "added",
    "additions": 98,
    "deletions": 0,
    "changes": 98,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardIntegration.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardIntegration.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardIntegration.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -0,0 +1,98 @@\n+package de.jkueck.fire.integrations.fireboard;\n+\n+import de.jkueck.fire.AlertMessage;\n+import de.jkueck.fire.events.AlertEvent;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationListener;\n+import org.springframework.stereotype.Component;\n+\n+import javax.xml.bind.JAXBContext;\n+import javax.xml.bind.JAXBException;\n+import javax.xml.bind.Marshaller;\n+import java.io.StringWriter;\n+import java.text.SimpleDateFormat;\n+import java.sql.Timestamp;\n+\n+@Slf4j\n+@Component\n+public class FireboardIntegration implements ApplicationListener<AlertEvent> {\n+\n+    @Value(\"${fireboardAccessKey}\")\n+    private String fireboardAccessKey;\n+\n+    private final String fireboardSourceName = \"DME Alarmdaten√ºbernahme\";\n+\n+    private static final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy.MM.dd.HH.mm.ss\");\n+\n+    public void callFireboardApi(AlertMessage alertMessage) throws JAXBException {\n+        FireboardPayload payload = createFBPayload(alertMessage);\n+\n+        StringBuilder fireboardUrlBuilder = new StringBuilder();\n+        fireboardUrlBuilder.append(\"https://login.fireboard.net/api\");\n+        fireboardUrlBuilder.append(\"?\");\n+        fireboardUrlBuilder.append(\"authkey\");\n+        fireboardUrlBuilder.append(\"=\");\n+        fireboardUrlBuilder.append(this.fireboardAccessKey);\n+        fireboardUrlBuilder.append(\"&\");\n+        fireboardUrlBuilder.append(\"call\");\n+        fireboardUrlBuilder.append(\"=\");\n+        fireboardUrlBuilder.append(\"operation_data\");\n+\n+        String fireboardApiUrl = fireboardUrlBuilder.toString();\n+\n+        JAXBContext jc = JAXBContext.newInstance(FireboardPayload.class);\n+        Marshaller marshaller = jc.createMarshaller();\n+        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);\n+        StringWriter stringWriter = new StringWriter();\n+        marshaller.marshal(payload, stringWriter );\n+\n+        log.info(\"call fireboard api from source \"+this.fireboardSourceName+\" with url(\"+fireboardApiUrl+\") and the following payload:\\n\"+stringWriter.toString());\n+/**\n+        RestTemplate restTemplate = new RestTemplate();\n+        HttpHeaders headers = new HttpHeaders();\n+        headers.setContentType(MediaType.APPLICATION_XML);\n+        HttpEntity<FireboardPayload> request = new HttpEntity<FireboardPayload>(payload, headers);\n+\n+        restTemplate.postForObject(fireboardApiUrl, request, String.class);\n+*/\n+    }\n+\n+    /**\n+     * Construct the XML payload for fireboard\n+     * @param alertMessage The AlertMessage received from the input device\n+     * @return FireboardPayload Returns a Fireboard Payload Object which contains the necessary XML structure\n+     */\n+    private FireboardPayload createFBPayload(AlertMessage alertMessage) {\n+        FireboardPayload fbPayload = new FireboardPayload();\n+        PayloadBasicData fbPayloadBasicData = new PayloadBasicData();\n+\n+        fbPayload.setVersion(\"1.01\");\n+        fbPayload.setTest(false);\n+        fbPayload.setSource(this.fireboardSourceName);\n+\n+        Timestamp timestamp = new Timestamp(System.currentTimeMillis());\n+        fbPayload.setUniqueID(sdf.format(timestamp));\n+\n+        fbPayloadBasicData.setKeyword(alertMessage.getCategory()+alertMessage.getKeyword());\n+        fbPayloadBasicData.setAnnouncement(alertMessage.getRemark1()+\",\"+alertMessage.getRemark2());\n+        fbPayloadBasicData.setLocation(alertMessage.getStreet()+\", \"+alertMessage.getCity());\n+\n+        fbPayload.setBasicData(fbPayloadBasicData);\n+\n+        return fbPayload;\n+    }\n+\n+    @SneakyThrows\n+    @Override\n+    public void onApplicationEvent(AlertEvent alertEvent) {\n+        log.info(\"receive alert (\" + alertEvent.getAlertMessage().getCompleteMessage() + \")\");\n+        if (StringUtils.trimToNull(this.fireboardAccessKey) != null) {\n+            this.callFireboardApi(alertEvent.getAlertMessage());\n+        } else {\n+            log.warn(\"fireboard integration is disabled due to no access key\");\n+        }\n+    }\n+}"
  },
  {
    "sha": "118e3f9889dd86600d6e37e2a74b097ffec19fb8",
    "filename": "src/main/java/de/jkueck/fire/integrations/fireboard/FireboardPayload.java",
    "status": "added",
    "additions": 73,
    "deletions": 0,
    "changes": 73,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardPayload.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardPayload.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/integrations/fireboard/FireboardPayload.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -0,0 +1,73 @@\n+package de.jkueck.fire.integrations.fireboard;\n+\n+import lombok.Getter;\n+\n+import javax.xml.bind.annotation.XmlAttribute;\n+import javax.xml.bind.annotation.XmlElement;\n+import javax.xml.bind.annotation.XmlRootElement;\n+\n+/**\n+ * This class represents  the payload for an fireboard api call according to\n+ * https://fireboard.net/wp-content/uploads/2020/07/handbuch_fireboard_schnittstelle_alarmdatenuebernahme.pdf\n+ */\n+\n+@Getter\n+@XmlRootElement(name=\"fireboardOperation\")\n+public class FireboardPayload {\n+\n+    private String version;\n+    private boolean test;\n+    private String uniqueID;\n+    private String source;\n+\n+    private PayloadBasicData basicData;\n+\n+    @XmlAttribute(name=\"version\")\n+    public void setVersion(String version) {\n+        this.version = version;\n+    }\n+\n+    @XmlAttribute(name=\"test\")\n+    public void setTest(boolean test) {\n+        this.test = test;\n+    }\n+\n+    @XmlElement(name=\"uniqueId\")\n+    public void setUniqueID(String uniqueID) {\n+        this.uniqueID = uniqueID;\n+    }\n+\n+    @XmlElement(name=\"source\")\n+    public void setSource(String source) {\n+        this.source = source;\n+    }\n+\n+    @XmlElement(name=\"basicData\")\n+    public void setBasicData(PayloadBasicData basicData) {\n+        this.basicData = basicData;\n+    }\n+}\n+\n+@Getter\n+@XmlRootElement(name=\"basicData\")\n+class PayloadBasicData {\n+\n+    private String keyword;\n+    private String announcement;\n+    private String location;\n+\n+    @XmlElement(name=\"keyword\")\n+    public void setKeyword(String keyword) {\n+        this.keyword = keyword;\n+    }\n+\n+    @XmlElement(name=\"announcement\")\n+    public void setAnnouncement(String announcement) {\n+        this.announcement = announcement;\n+    }\n+\n+    @XmlElement(name=\"location\")\n+    public void setLocation(String location) {\n+        this.location = location;\n+    }\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "0e65ad8b652f2f464532c02d1a685a248af12201",
    "filename": "src/main/java/de/jkueck/fire/integrations/telegram/SendMessage.java",
    "status": "renamed",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/telegram/SendMessage.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/telegram/SendMessage.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/integrations/telegram/SendMessage.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -1,4 +1,4 @@\n-package de.jkueck.fire.bots.telegram;\n+package de.jkueck.fire.integrations.telegram;\n \n import com.fasterxml.jackson.annotation.JsonProperty;\n import lombok.AllArgsConstructor;",
    "previous_filename": "src/main/java/de/jkueck/fire/bots/telegram/SendMessage.java"
  },
  {
    "sha": "d16b6a2059da44e7cdbc62466137a386daa4eb30",
    "filename": "src/main/java/de/jkueck/fire/integrations/telegram/TelegramBot.java",
    "status": "renamed",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/telegram/TelegramBot.java",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/java/de/jkueck/fire/integrations/telegram/TelegramBot.java",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/java/de/jkueck/fire/integrations/telegram/TelegramBot.java?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -1,4 +1,4 @@\n-package de.jkueck.fire.bots.telegram;\n+package de.jkueck.fire.integrations.telegram;\n \n import de.jkueck.fire.AlertMessage;\n import de.jkueck.fire.events.AlertEvent;",
    "previous_filename": "src/main/java/de/jkueck/fire/bots/telegram/TelegramBot.java"
  },
  {
    "sha": "a4043bc1994862bfa81904fca17f7c992f4b9fdf",
    "filename": "src/main/resources/application.properties",
    "status": "modified",
    "additions": 11,
    "deletions": 1,
    "changes": 12,
    "blob_url": "https://github.com/jkueck92/fire/blob/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/resources/application.properties",
    "raw_url": "https://github.com/jkueck92/fire/raw/9755fdfe0f01d3308989fd28498da91b812bedfc/src/main/resources/application.properties",
    "contents_url": "https://api.github.com/repos/jkueck92/fire/contents/src/main/resources/application.properties?ref=9755fdfe0f01d3308989fd28498da91b812bedfc",
    "patch": "@@ -1,4 +1,14 @@\n spring.main.banner-mode=console\n logging.file.path=${user.home}/logs\n \n-spring.banner.image.location=banner.txt\n\\ No newline at end of file\n+spring.banner.image.location=banner.txt\n+\n+spring.application.name=FIRE\n+\n+messageFormat=city,street\n+comPort=/dev/ttyUSB0\n+\n+diveraToken=\n+fireboardAccessKey=\n+botToken=\n+chatIds=\n\\ No newline at end of file"
  }
]
