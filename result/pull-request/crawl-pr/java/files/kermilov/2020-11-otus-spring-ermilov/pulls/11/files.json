[
  {
    "sha": "549e00a2a96fa9d7c5dbc9859664a78d980158c2",
    "filename": "homework11/.gitignore",
    "status": "added",
    "additions": 33,
    "deletions": 0,
    "changes": 33,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/.gitignore",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/.gitignore",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/.gitignore?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,33 @@\n+HELP.md\n+target/\n+!.mvn/wrapper/maven-wrapper.jar\n+!**/src/main/**/target/\n+!**/src/test/**/target/\n+\n+### STS ###\n+.apt_generated\n+.classpath\n+.factorypath\n+.project\n+.settings\n+.springBeans\n+.sts4-cache\n+\n+### IntelliJ IDEA ###\n+.idea\n+*.iws\n+*.iml\n+*.ipr\n+\n+### NetBeans ###\n+/nbproject/private/\n+/nbbuild/\n+/dist/\n+/nbdist/\n+/.nb-gradle/\n+build/\n+!**/src/main/**/build/\n+!**/src/test/**/build/\n+\n+### VS Code ###\n+.vscode/"
  },
  {
    "sha": "82bc7f7715ae2caaa16402500883b25e9d72b223",
    "filename": "homework11/pom.xml",
    "status": "added",
    "additions": 96,
    "deletions": 0,
    "changes": 96,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/pom.xml",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/pom.xml",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/pom.xml?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,96 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\t<modelVersion>4.0.0</modelVersion>\n+\t<parent>\n+\t\t<groupId>org.springframework.boot</groupId>\n+\t\t<artifactId>spring-boot-starter-parent</artifactId>\n+\t\t<version>2.4.1</version>\n+\t\t<relativePath/> <!-- lookup parent from repository -->\n+\t</parent>\n+\t<groupId>ru.otus.spring.kermilov</groupId>\n+\t<artifactId>books</artifactId>\n+\t<version>0.0.1-SNAPSHOT</version>\n+\t<name>books</name>\n+\t<description>books</description>\n+\n+\t<properties>\n+\t\t<java.version>11</java.version>\n+\t</properties>\n+\n+\t<dependencies>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter-data-mongodb</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter-data-mongodb-reactive</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.mongodb</groupId>\n+\t\t\t<artifactId>mongodb-driver-reactivestreams</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>de.flapdoodle.embed</groupId>\n+\t\t\t<artifactId>de.flapdoodle.embed.mongo</artifactId>\n+\t\t\t <scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.projectlombok</groupId>\n+\t\t\t<artifactId>lombok</artifactId>\n+\t\t\t<optional>true</optional>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter-webflux</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n+\t\t\t<scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t<artifactId>spring-boot-starter-thymeleaf</artifactId>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.assertj</groupId>\n+\t\t\t<artifactId>assertj-core</artifactId>\n+\t\t\t<version>3.19.0</version>\n+\t\t\t<scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.webjars</groupId>\n+\t\t\t<artifactId>jquery</artifactId>\n+\t\t\t<version>3.3.1</version>\n+\t\t</dependency>\n+\n+\n+\t</dependencies>\n+\n+\t<build>\n+\t\t<plugins>\n+\t\t\t<plugin>\n+\t\t\t\t<artifactId>maven-enforcer-plugin</artifactId>\n+\t\t\t</plugin>\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.springframework.boot</groupId>\n+\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n+\t\t\t\t<configuration>\n+\t\t\t\t\t<excludes>\n+\t\t\t\t\t\t<exclude>\n+\t\t\t\t\t\t\t<groupId>org.projectlombok</groupId>\n+\t\t\t\t\t\t\t<artifactId>lombok</artifactId>\n+\t\t\t\t\t\t</exclude>\n+\t\t\t\t\t</excludes>\n+\t\t\t\t</configuration>\n+\t\t\t</plugin>\n+\t\t</plugins>\n+\t</build>\n+\n+</project>"
  },
  {
    "sha": "b48c3eba4a61694e46116ccf9edd864af3b841b3",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/BooksApplication.java",
    "status": "added",
    "additions": 13,
    "deletions": 0,
    "changes": 13,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/BooksApplication.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/BooksApplication.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/BooksApplication.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,13 @@\n+package ru.otus.spring.kermilov.books;\n+\n+import org.springframework.boot.SpringApplication;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+\n+@SpringBootApplication\n+public class BooksApplication {\n+\n+\tpublic static void main(String[] args) {\n+\t\tSpringApplication.run(BooksApplication.class, args);\n+\t}\n+\n+}"
  },
  {
    "sha": "96ab2605cb3b2ce1f5928b36dd158dcf6b7ae06b",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentController.java",
    "status": "added",
    "additions": 48,
    "deletions": 0,
    "changes": 48,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentController.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentController.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentController.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,48 @@\n+package ru.otus.spring.kermilov.books.controller;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import org.springframework.stereotype.Controller;\r\n+import org.springframework.ui.Model;\r\n+import org.springframework.web.bind.annotation.GetMapping;\r\n+import org.springframework.web.bind.annotation.RequestParam;\r\n+\r\n+@Controller\r\n+@RequiredArgsConstructor\r\n+public class BookCommentController {\r\n+\r\n+    private static final String VIEW_COMMENT_T = \"comment-table\";\r\n+    private static final String VIEW_COMMENT_F = \"comment-form\";\r\n+    private static final String ATTR_BOOK_COMMENT_ID = \"bookCommentId\";\r\n+    private static final String ATTR_BOOK_ID = \"bookId\";\r\n+    private static final String ATTR_ACTION = \"action\";\r\n+\r\n+    @GetMapping(\"/comment\")\r\n+    public String listPage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        return VIEW_COMMENT_T;\r\n+    }\r\n+\r\n+    @GetMapping(\"/comment/insert\")\r\n+    public String insertPage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_COMMENT_ID, \"\");\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        model.addAttribute(ATTR_ACTION, 1);\r\n+        return VIEW_COMMENT_F;\r\n+    }\r\n+\r\n+    @GetMapping(\"/comment/edit\")\r\n+    public String editPage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_COMMENT_ID, id);\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        model.addAttribute(ATTR_ACTION, 2);\r\n+        return VIEW_COMMENT_F;\r\n+    }\r\n+\r\n+    @GetMapping(\"/comment/delete\")\r\n+    public String deletePage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_COMMENT_ID, id);\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        model.addAttribute(ATTR_ACTION, 3);\r\n+        return VIEW_COMMENT_F;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "92f7cce0e41044245242d45e147c508e00a1f1b9",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentRestController.java",
    "status": "added",
    "additions": 42,
    "deletions": 0,
    "changes": 42,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentRestController.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentRestController.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookCommentRestController.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,42 @@\n+package ru.otus.spring.kermilov.books.controller;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import org.springframework.transaction.annotation.Transactional;\r\n+import org.springframework.web.bind.annotation.*;\r\n+import reactor.core.publisher.Flux;\r\n+import reactor.core.publisher.Mono;\r\n+import ru.otus.spring.kermilov.books.dao.BookCommentReactDao;\r\n+import ru.otus.spring.kermilov.books.dto.BookCommentDto;\r\n+import ru.otus.spring.kermilov.books.transform.BookCommentDtoTransform;\r\n+\r\n+@RestController\r\n+@RequestMapping(\"/book/{bookId}/comment\")\r\n+@RequiredArgsConstructor\r\n+public class BookCommentRestController {\r\n+    private final BookCommentReactDao bookCommentReactDao;\r\n+\r\n+    @GetMapping\r\n+    @Transactional(readOnly=true)\r\n+    public Flux<BookCommentDto> findAll(@PathVariable(\"bookId\") String bookId) {\r\n+        return bookCommentReactDao.getByBookId(bookId).map(BookCommentDtoTransform::getBookCommentDto);\r\n+    }\r\n+\r\n+    @GetMapping(\"/{id}\")\r\n+    @Transactional(readOnly=true)\r\n+    public Mono<BookCommentDto> findById(@PathVariable(\"bookId\") String bookId, @PathVariable(\"id\") String id) {\r\n+        return bookCommentReactDao.findById(id).map(BookCommentDtoTransform::getBookCommentDto);\r\n+    }\r\n+\r\n+    @PostMapping\r\n+    @Transactional\r\n+    public Mono<BookCommentDto> save(@PathVariable(\"bookId\") String bookId, @RequestBody BookCommentDto bookCommentDto) {\r\n+        return bookCommentReactDao.save(BookCommentDtoTransform.getBookComment(bookCommentDto)).map(BookCommentDtoTransform::getBookCommentDto);\r\n+    }\r\n+\r\n+    @DeleteMapping(\"/{id}\")\r\n+    @Transactional\r\n+    public Mono<Void> deleteById(@PathVariable(\"bookId\") String bookId, @PathVariable(\"id\") String id) {\r\n+        return bookCommentReactDao.deleteById(id);\r\n+    }\r\n+\r\n+}\r"
  },
  {
    "sha": "bc0d67f22731077607e8e6fa22db8ff2aa8b2aa0",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookController.java",
    "status": "added",
    "additions": 44,
    "deletions": 0,
    "changes": 44,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookController.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookController.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookController.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,44 @@\n+package ru.otus.spring.kermilov.books.controller;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import org.springframework.stereotype.Controller;\r\n+import org.springframework.ui.Model;\r\n+import org.springframework.web.bind.annotation.GetMapping;\r\n+import org.springframework.web.bind.annotation.RequestParam;\r\n+\r\n+@Controller\r\n+@RequiredArgsConstructor\r\n+public class BookController {\r\n+\r\n+    private static final String VIEW_BOOK_T = \"book-table\";\r\n+    private static final String VIEW_BOOK_F = \"book-form\";\r\n+    private static final String ATTR_BOOK_ID = \"bookId\";\r\n+    private static final String ATTR_ACTION = \"action\";\r\n+\r\n+    @GetMapping(\"/\")\r\n+    public String listPage() {\r\n+        return VIEW_BOOK_T;\r\n+    }\r\n+\r\n+    @GetMapping(\"/book/insert\")\r\n+    public String insertPage(Model model) {\r\n+        model.addAttribute(ATTR_BOOK_ID, 0);\r\n+        model.addAttribute(ATTR_ACTION, 1);\r\n+        return VIEW_BOOK_F;\r\n+    }\r\n+\r\n+    @GetMapping(\"/book/edit\")\r\n+    public String editPage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        model.addAttribute(ATTR_ACTION, 2);\r\n+        return VIEW_BOOK_F;\r\n+    }\r\n+\r\n+    @GetMapping(\"/book/delete\")\r\n+    public String deletePage(@RequestParam(\"id\") String id, Model model) {\r\n+        model.addAttribute(ATTR_BOOK_ID, id);\r\n+        model.addAttribute(ATTR_ACTION, 3);\r\n+        return VIEW_BOOK_F;\r\n+    }\r\n+}\r\n+\r"
  },
  {
    "sha": "66bc90426f54c7887d71bd8f6ebdb2423bf0703e",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookRestController.java",
    "status": "added",
    "additions": 67,
    "deletions": 0,
    "changes": 67,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookRestController.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookRestController.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/controller/BookRestController.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,67 @@\n+package ru.otus.spring.kermilov.books.controller;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import org.springframework.transaction.annotation.Transactional;\r\n+import org.springframework.web.bind.annotation.*;\r\n+import reactor.core.publisher.Flux;\r\n+import reactor.core.publisher.Mono;\r\n+import ru.otus.spring.kermilov.books.dao.BookReactDao;\r\n+import ru.otus.spring.kermilov.books.dto.BookDto;\r\n+import ru.otus.spring.kermilov.books.transform.BookDtoTransform;\r\n+\r\n+@RestController\r\n+@RequestMapping(\"/book\")\r\n+@RequiredArgsConstructor\r\n+public class BookRestController {\r\n+    private final BookReactDao bookReactDao;\r\n+    private final BookDtoTransform bookDtoTransform;\r\n+\r\n+    @GetMapping\r\n+    @Transactional(readOnly=true)\r\n+    public Flux<BookDto> findAll() {\r\n+        return bookReactDao.findAll().map(BookDtoTransform::getBookDto);\r\n+    }\r\n+\r\n+    @GetMapping(\"/{id}\")\r\n+    @Transactional(readOnly=true)\r\n+    public Mono<BookDto> findById(@PathVariable(\"id\") String id) {\r\n+        return bookReactDao.findById(id).map(BookDtoTransform::getBookDto);\r\n+    }\r\n+\r\n+    @PostMapping\r\n+    @Transactional\r\n+    public Mono<BookDto> save(@RequestBody BookDto bookDto) {\r\n+        return bookReactDao.save(bookDtoTransform.getBook(bookDto)).map(BookDtoTransform::getBookDto);\r\n+    }\r\n+\r\n+    @DeleteMapping(\"/{id}\")\r\n+    @Transactional\r\n+    public Mono<Void> deleteById(@PathVariable(\"id\") String id) {\r\n+        return bookReactDao.deleteById(id);\r\n+    }\r\n+\r\n+    // @Bean\r\n+    // public RouterFunction<ServerResponse> composedRoutes(BookReactDao bookReactDao, BookDtoTransform bookDtoTransform) {\r\n+    //     return route()\r\n+    //             .GET(\"/book\",\r\n+    //                     request -> ok()\r\n+    //                             .body(bookReactDao.findAll().map(BookDtoTransform::getBookDto), BookDto.class))\r\n+    //             .GET(\"/book/{id}\", accept(APPLICATION_JSON),\r\n+    //                     request -> bookReactDao.findById(request.pathVariable(\"id\")).map(BookDtoTransform::getBookDto)\r\n+    //                             .flatMap(book -> ok().contentType(APPLICATION_JSON).body(fromObject(book))))\r\n+    //             .GET(\"/book/{id}\", accept(APPLICATION_JSON),\r\n+    //                     request -> ok().body(\r\n+    //                             bookReactDao.findById(request.pathVariable(\"id\")).map(BookDtoTransform::getBookDto),\r\n+    //                             BookDto.class))\r\n+    //             .POST(\"/book\", accept(APPLICATION_JSON),\r\n+    //                     request -> request.body(toMono(BookDto.class))\r\n+    //                             .doOnNext(bookDto -> bookReactDao.save(bookDtoTransform.getBook(bookDto)))\r\n+    //                             .then(ok().build()))\r\n+    //             .DELETE(\"/book/{id}\",\r\n+    //                     request -> ok().body(\r\n+    //                             bookReactDao.deleteById(request.pathVariable(\"id\")),\r\n+    //                             BookDto.class))\r\n+    //             .build();\r\n+    // }\r\n+\r\n+}\r"
  },
  {
    "sha": "4f19d92f67a3f670f243712fd95a025075b3371e",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dao/AuthorDao.java",
    "status": "added",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/AuthorDao.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/AuthorDao.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/AuthorDao.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,10 @@\n+package ru.otus.spring.kermilov.books.dao;\r\n+\r\n+import org.springframework.data.mongodb.repository.MongoRepository;\r\n+import ru.otus.spring.kermilov.books.domain.Author;\r\n+\r\n+import java.util.Optional;\r\n+\r\n+public interface AuthorDao extends MongoRepository<Author, String> {\r\n+    Optional<Author> getByName(String name);\r\n+}\r"
  },
  {
    "sha": "c834e8b19abfdfc4e4c049114e62a2a9c5998764",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentDao.java",
    "status": "added",
    "additions": 8,
    "deletions": 0,
    "changes": 8,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentDao.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentDao.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentDao.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,8 @@\n+package ru.otus.spring.kermilov.books.dao;\r\n+\r\n+import org.springframework.data.mongodb.repository.MongoRepository;\r\n+import ru.otus.spring.kermilov.books.domain.BookComment;\r\n+\r\n+public interface BookCommentDao extends MongoRepository<BookComment, String> {\r\n+    void deleteByBookId(String bookId);\r\n+}\r"
  },
  {
    "sha": "ef984973c73d05b7b4d95f30bf08c302f0c1428e",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentReactDao.java",
    "status": "added",
    "additions": 9,
    "deletions": 0,
    "changes": 9,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentReactDao.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentReactDao.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookCommentReactDao.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,9 @@\n+package ru.otus.spring.kermilov.books.dao;\r\n+\r\n+import org.springframework.data.mongodb.repository.ReactiveMongoRepository;\r\n+import reactor.core.publisher.Flux;\r\n+import ru.otus.spring.kermilov.books.domain.BookComment;\r\n+\r\n+public interface BookCommentReactDao extends ReactiveMongoRepository<BookComment, String> {\r\n+    Flux<BookComment> getByBookId(String bookId);\r\n+}\r"
  },
  {
    "sha": "4a5e16c2a267b11bec3525a9ea2bca0264abd43c",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookReactDao.java",
    "status": "added",
    "additions": 8,
    "deletions": 0,
    "changes": 8,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookReactDao.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookReactDao.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/BookReactDao.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,8 @@\n+package ru.otus.spring.kermilov.books.dao;\r\n+\r\n+import org.springframework.data.mongodb.repository.ReactiveMongoRepository;\r\n+import ru.otus.spring.kermilov.books.domain.Book;\r\n+\r\n+public interface BookReactDao extends ReactiveMongoRepository<Book, String> {\r\n+\r\n+}\r"
  },
  {
    "sha": "bd77b1c63b8cbd8610748164ac65c7c3620dfd36",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dao/GenreDao.java",
    "status": "added",
    "additions": 11,
    "deletions": 0,
    "changes": 11,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/GenreDao.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/GenreDao.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dao/GenreDao.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,11 @@\n+package ru.otus.spring.kermilov.books.dao;\r\n+\r\n+import org.springframework.data.mongodb.repository.MongoRepository;\r\n+import ru.otus.spring.kermilov.books.domain.Genre;\r\n+\r\n+import java.util.Optional;\r\n+\r\n+public interface GenreDao extends MongoRepository<Genre, String> {\r\n+    Optional<Genre> getByName(String name);\r\n+\r\n+}\r"
  },
  {
    "sha": "68ef94eb82a67333245f7fd9d47af8a38bcf329a",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Author.java",
    "status": "added",
    "additions": 24,
    "deletions": 0,
    "changes": 24,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Author.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Author.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Author.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,24 @@\n+package ru.otus.spring.kermilov.books.domain;\r\n+\r\n+import lombok.Data;\r\n+import lombok.NoArgsConstructor;\r\n+import lombok.AllArgsConstructor;\r\n+import org.springframework.data.annotation.Id;\r\n+import org.springframework.data.mongodb.core.mapping.Document;\r\n+import org.springframework.data.mongodb.core.mapping.Field;\r\n+import org.springframework.data.mongodb.core.mapping.MongoId;\r\n+\r\n+@Data\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+@Document(collection = \"Authors\") // Задает имя таблицы, на которую будет отображаться сущность\r\n+public class Author {\r\n+    @Id\r\n+    private String id;\r\n+    @Field\r\n+    private String name;\r\n+\r\n+    public Author(String name) {\r\n+        this.name = name;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "3ef3e36a4c371e25a5a443108bae0c50d2359d89",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Book.java",
    "status": "added",
    "additions": 34,
    "deletions": 0,
    "changes": 34,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Book.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Book.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Book.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,34 @@\n+package ru.otus.spring.kermilov.books.domain;\r\n+\r\n+import lombok.*;\r\n+import org.springframework.data.mongodb.core.mapping.DBRef;\r\n+import org.springframework.data.mongodb.core.mapping.Document;\r\n+import org.springframework.data.mongodb.core.mapping.Field;\r\n+import org.springframework.data.annotation.Id;\r\n+\r\n+import java.util.List;\r\n+\r\n+@Data\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+@Document(collection = \"Books\") // Задает имя таблицы, на которую будет отображаться сущность\r\n+public class Book {\r\n+    @Id\r\n+    private String id;\r\n+    @Field\r\n+    private String name;\r\n+    @DBRef\r\n+    private Author author;\r\n+    @DBRef\r\n+    private List<Genre> genres;\r\n+\r\n+    public Book(String name, Author author, List<Genre> genres) {\r\n+        this.name = name;\r\n+        this.author = author;\r\n+        this.genres = genres;\r\n+    }\r\n+\r\n+    public Book(String id) {\r\n+        this.id = id;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "452c960adc0836d5a89b55d0c0fae29e914c243e",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/domain/BookComment.java",
    "status": "added",
    "additions": 28,
    "deletions": 0,
    "changes": 28,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/BookComment.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/BookComment.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/BookComment.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,28 @@\n+package ru.otus.spring.kermilov.books.domain;\r\n+\r\n+import lombok.AllArgsConstructor;\r\n+import lombok.Data;\r\n+import lombok.NoArgsConstructor;\r\n+import org.springframework.data.annotation.Id;\r\n+import org.springframework.data.mongodb.core.mapping.DBRef;\r\n+import org.springframework.data.mongodb.core.mapping.Document;\r\n+import org.springframework.data.mongodb.core.mapping.Field;\r\n+\r\n+@Data\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+@Document(collection = \"BookComments\") // Задает имя таблицы, на которую будет отображаться сущность\r\n+public class BookComment {\r\n+    @Id\r\n+    private String id;\r\n+    @Field(name = \"book_id\")\r\n+    @DBRef\r\n+    private Book book;\r\n+    @Field\r\n+    private String comment;\r\n+\r\n+    public BookComment(Book book, String comment) {\r\n+        this.book = book;\r\n+        this.comment = comment;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "b4f9f819fa718c078e9e3622de7900371403e251",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Genre.java",
    "status": "added",
    "additions": 21,
    "deletions": 0,
    "changes": 21,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Genre.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Genre.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/domain/Genre.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,21 @@\n+package ru.otus.spring.kermilov.books.domain;\r\n+\r\n+import lombok.*;\r\n+import org.springframework.data.annotation.Id;\r\n+import org.springframework.data.mongodb.core.mapping.Document;\r\n+import org.springframework.data.mongodb.core.mapping.Field;\r\n+\r\n+@Data\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+@Document(collection = \"Genres\") // Задает имя таблицы, на которую будет отображаться сущность\r\n+public class Genre {\r\n+    @Id\r\n+    private String id;\r\n+    @Field\r\n+    private String name;\r\n+\r\n+    public Genre(String name) {\r\n+        this.name = name;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "b5da6928a174e86b89a8c68830604db5408377e1",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookCommentDto.java",
    "status": "added",
    "additions": 17,
    "deletions": 0,
    "changes": 17,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookCommentDto.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookCommentDto.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookCommentDto.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,17 @@\n+package ru.otus.spring.kermilov.books.dto;\r\n+\r\n+import lombok.AllArgsConstructor;\r\n+import lombok.Getter;\r\n+import lombok.NoArgsConstructor;\r\n+import lombok.Setter;\r\n+\r\n+@Getter\r\n+@Setter\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+public class BookCommentDto {\r\n+    private String id;\r\n+    private String bookId;\r\n+    private String book;\r\n+    private String comment;\r\n+}\r"
  },
  {
    "sha": "63ae7be80931b495b4eef33c3aa711018077fb45",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookDto.java",
    "status": "added",
    "additions": 16,
    "deletions": 0,
    "changes": 16,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookDto.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookDto.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/dto/BookDto.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,16 @@\n+package ru.otus.spring.kermilov.books.dto;\r\n+\r\n+import lombok.*;\r\n+\r\n+@Data\r\n+@Builder\r\n+@Getter\r\n+@Setter\r\n+@NoArgsConstructor\r\n+@AllArgsConstructor\r\n+public class BookDto {\r\n+    private String id;\r\n+    private String name;\r\n+    private String author;\r\n+    private String genres;\r\n+}\r"
  },
  {
    "sha": "420afe00b657a550f2e9e93b737054fe91aa65e3",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/event/MongoBookCascadeDeleteEventsListener.java",
    "status": "added",
    "additions": 24,
    "deletions": 0,
    "changes": 24,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/event/MongoBookCascadeDeleteEventsListener.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/event/MongoBookCascadeDeleteEventsListener.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/event/MongoBookCascadeDeleteEventsListener.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,24 @@\n+package ru.otus.spring.kermilov.books.event;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import lombok.val;\r\n+import org.springframework.data.mongodb.core.mapping.event.AbstractMongoEventListener;\r\n+import org.springframework.data.mongodb.core.mapping.event.AfterDeleteEvent;\r\n+import org.springframework.stereotype.Component;\r\n+import ru.otus.spring.kermilov.books.dao.BookCommentDao;\r\n+import ru.otus.spring.kermilov.books.domain.Book;\r\n+\r\n+@Component\r\n+@RequiredArgsConstructor\r\n+public class MongoBookCascadeDeleteEventsListener extends AbstractMongoEventListener<Book> {\r\n+\r\n+    private final BookCommentDao bookCommentDao;\r\n+\r\n+    @Override\r\n+    public void onAfterDelete(AfterDeleteEvent<Book> event) {\r\n+        super.onAfterDelete(event);\r\n+        val source = event.getSource();\r\n+        val id = source.get(\"_id\").toString();\r\n+        bookCommentDao.deleteByBookId(id);\r\n+    }\r\n+}\r"
  },
  {
    "sha": "1c47fbe894ee2e2144d860a104fd8155e41d74f5",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookCommentDtoTransform.java",
    "status": "added",
    "additions": 25,
    "deletions": 0,
    "changes": 25,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookCommentDtoTransform.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookCommentDtoTransform.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookCommentDtoTransform.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,25 @@\n+package ru.otus.spring.kermilov.books.transform;\r\n+\r\n+import ru.otus.spring.kermilov.books.domain.Book;\r\n+import ru.otus.spring.kermilov.books.domain.BookComment;\r\n+import ru.otus.spring.kermilov.books.dto.BookCommentDto;\r\n+\r\n+public class BookCommentDtoTransform {\r\n+\r\n+    public static BookComment getBookComment(BookCommentDto bookCommentDto) {\r\n+        BookComment bookComment = new BookComment();\r\n+        bookComment.setId(bookCommentDto.getId());\r\n+        bookComment.setBook(new Book(bookCommentDto.getBookId()));\r\n+        bookComment.setComment(bookCommentDto.getComment());\r\n+        return bookComment;\r\n+    }\r\n+\r\n+    public static BookCommentDto getBookCommentDto(BookComment bookComment) {\r\n+        BookCommentDto bookCommentDto = new BookCommentDto();\r\n+        bookCommentDto.setId(bookComment.getId());\r\n+        bookCommentDto.setBookId(bookComment.getBook().getId());\r\n+        bookCommentDto.setBook(bookComment.getBook().getName());\r\n+        bookCommentDto.setComment(bookComment.getComment());\r\n+        return bookCommentDto;\r\n+    }\r\n+}\r"
  },
  {
    "sha": "52518de7714000529b7d4cfc5a570124500f3502",
    "filename": "homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookDtoTransform.java",
    "status": "added",
    "additions": 61,
    "deletions": 0,
    "changes": 61,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookDtoTransform.java",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookDtoTransform.java",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/java/ru/otus/spring/kermilov/books/transform/BookDtoTransform.java?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,61 @@\n+package ru.otus.spring.kermilov.books.transform;\r\n+\r\n+import lombok.RequiredArgsConstructor;\r\n+import org.springframework.stereotype.Component;\r\n+import ru.otus.spring.kermilov.books.dao.AuthorDao;\r\n+import ru.otus.spring.kermilov.books.dao.GenreDao;\r\n+import ru.otus.spring.kermilov.books.domain.Author;\r\n+import ru.otus.spring.kermilov.books.domain.Book;\r\n+import ru.otus.spring.kermilov.books.domain.Genre;\r\n+import ru.otus.spring.kermilov.books.dto.BookDto;\r\n+\r\n+import java.util.Arrays;\r\n+import java.util.List;\r\n+import java.util.Optional;\r\n+import java.util.stream.Collectors;\r\n+\r\n+@Component\r\n+@RequiredArgsConstructor\r\n+public class BookDtoTransform {\r\n+    private final AuthorDao authorDao;\r\n+    private final GenreDao genreDao;\r\n+\r\n+    private Genre saveGenre(String genreName) {\r\n+        Optional<Genre> byName = genreDao.getByName(genreName);\r\n+        if (byName.isPresent()) {\r\n+            return byName.get();\r\n+        }\r\n+\r\n+        return genreDao.save(new Genre(genreName));\r\n+    }\r\n+\r\n+    private Author saveAuthor(String authorName) {\r\n+        Optional<Author> byName = authorDao.getByName(authorName);\r\n+        if (byName.isPresent()) {\r\n+            return byName.get();\r\n+        }\r\n+        return authorDao.save(new Author(authorName));\r\n+    }\r\n+\r\n+    public Book getBook(BookDto bookDto) {\r\n+        Book book = new Book();\r\n+        book.setId(bookDto.getId());\r\n+        book.setName(bookDto.getName());\r\n+        book.setAuthor(saveAuthor(bookDto.getAuthor()));\r\n+        List<Genre> genres = Arrays.stream(bookDto.getGenres().split(\",\"))\r\n+                .map(this::saveGenre)\r\n+                .collect(Collectors.toList());\r\n+        book.setGenres(genres);\r\n+        return book;\r\n+    }\r\n+\r\n+    public static BookDto getBookDto(Book book) {\r\n+        BookDto bookDto = new BookDto();\r\n+        bookDto.setId(book.getId());\r\n+        bookDto.setName(book.getName());\r\n+        bookDto.setAuthor(book.getAuthor().getName());\r\n+        bookDto.setGenres(book.getGenres().stream().map(g -> String.valueOf(g.getName())).collect(Collectors.joining(\",\")));\r\n+        return bookDto;\r\n+    }\r\n+\r\n+}\r"
  },
  {
    "sha": "3f14d68eafc64d3fdfd99f3423f517c0c1ae9e4d",
    "filename": "homework11/src/main/resources/application.yml",
    "status": "added",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/application.yml",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/application.yml",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/application.yml?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,6 @@\n+spring:\r\n+  data:\r\n+    mongodb:\r\n+      database: books\r\n+#      port: 27017\r\n+#      host: localhost\n\\ No newline at end of file"
  },
  {
    "sha": "86e3d6c4fbe5a5f862a4a143e68531640e70cbfd",
    "filename": "homework11/src/main/resources/static/js/book-form.js",
    "status": "added",
    "additions": 52,
    "deletions": 0,
    "changes": 52,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/book-form.js",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/book-form.js",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/static/js/book-form.js?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,52 @@\n+function fillForm(bookId, action) {\r\n+\r\n+    if (bookId != '') {\r\n+        $.get('/book/'+bookId).done(function (book) {\r\n+            document.getElementById('id-input').value = book.id;\r\n+            document.getElementById('name-input').value = book.name;\r\n+            document.getElementById('author-input').value = book.author;\r\n+            document.getElementById('genres-input').value = book.genres;\r\n+        });\r\n+    }\r\n+\r\n+    if (action == 3) {\r\n+        document.getElementById('id-input').disabled = true;\r\n+        document.getElementById('name-input').disabled = true;\r\n+        document.getElementById('author-input').disabled = true;\r\n+        document.getElementById('genres-input').disabled = true;\r\n+        document.getElementById('submit-button').innerText = 'Delete';\r\n+    }\r\n+    else {\r\n+        document.getElementById('submit-button').innerText = 'Save';\r\n+    }\r\n+\r\n+}\r\n+function doAction(type) {\r\n+\r\n+    var book = {\r\n+        'id': document.getElementById('id-input').value,\r\n+        'name': document.getElementById('name-input').value,\r\n+        'author': document.getElementById('author-input').value,\r\n+        'genres': document.getElementById('genres-input').value\r\n+    }\r\n+\r\n+    if (type == 1 || type == 2)\r\n+        $.ajax({\r\n+            url: '/book',\r\n+            type: 'POST',\r\n+            data: JSON.stringify(book),\r\n+            contentType: 'application/json; charset=utf-8',\r\n+            dataType: 'json',\r\n+            async: false\r\n+        });\r\n+\r\n+    if (type == 3)\r\n+        $.ajax({\r\n+            url: '/book/'+document.getElementById('id-input').value,\r\n+            type: 'DELETE',\r\n+            async: false\r\n+        });\r\n+\r\n+    window.location.href = '/';\r\n+\r\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "fd42d7eddcab3321da84dc3b692219e2fa6a3cb5",
    "filename": "homework11/src/main/resources/static/js/book-table.js",
    "status": "added",
    "additions": 30,
    "deletions": 0,
    "changes": 30,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/book-table.js",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/book-table.js",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/static/js/book-table.js?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,30 @@\n+function fillForm() {\r\n+\r\n+    $.get('/book').done(function (books) {\r\n+        books.forEach(function (book) {\r\n+            $('tbody').append(`\r\n+                <tr>\r\n+                    <td>${book.id}</td>\r\n+                    <td>${book.name}</td>\r\n+                    <td>${book.author}</td>\r\n+                    <td>${book.genres}</td>\r\n+                    <td>\r\n+                        <a href=\"/comment?id=${book.id}\">Comments</a>\r\n+                    </td>\r\n+                    <td>\r\n+                        <a href=\"/book/edit?id=${book.id}\">Edit</a>\r\n+                    </td>\r\n+                    <td>\r\n+                        <a href=\"/book/delete?id=${book.id}\">Delete</a>\r\n+                    </td>\r\n+                </tr>\r\n+            `)\r\n+        });\r\n+    })\r\n+\r\n+}\r\n+function doAction() {\r\n+\r\n+    window.location.href = '/book/insert';\r\n+\r\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "0172d0cb5cb7d6b83368e606128106d5c920d894",
    "filename": "homework11/src/main/resources/static/js/comment-form.js",
    "status": "added",
    "additions": 63,
    "deletions": 0,
    "changes": 63,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/comment-form.js",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/comment-form.js",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/static/js/comment-form.js?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,63 @@\n+function fillForm(bookCommentId, bookId, action) {\r\n+\r\n+    if (bookCommentId != '') {\r\n+        $.get('/book/'+bookId+'/comment/'+bookCommentId).done(function (bookComment) {\r\n+            document.getElementById('id-input').value = bookComment.id;\r\n+            document.getElementById('bookId-input').value = bookComment.bookId;\r\n+            document.getElementById('book-input').value = bookComment.book;\r\n+            document.getElementById('comment-input').value = bookComment.comment;\r\n+        });\r\n+    }\r\n+    else {\r\n+        $.get('/book/'+bookId).done(function (book) {\r\n+            document.getElementById('bookId-input').value = book.id;\r\n+            document.getElementById('book-input').value = book.name;\r\n+        });\r\n+\r\n+    }\r\n+\r\n+    if (action == 3) {\r\n+        document.getElementById('id-input').disabled = true;\r\n+        document.getElementById('bookId-input').disabled = true;\r\n+        document.getElementById('book-input').disabled = true;\r\n+        document.getElementById('comment-input').disabled = true;\r\n+        document.getElementById('submit-button').innerText = 'Delete';\r\n+    }\r\n+    else {\r\n+        document.getElementById('submit-button').innerText = 'Save';\r\n+    }\r\n+\r\n+}\r\n+function doAction(type) {\r\n+\r\n+    var bookComment = {\r\n+        'id': document.getElementById('id-input').value,\r\n+        'bookId': document.getElementById('bookId-input').value,\r\n+        'book': document.getElementById('book-input').value,\r\n+        'comment': document.getElementById('comment-input').value\r\n+    }\r\n+\r\n+    const bookPath = '/book/' + document.getElementById('bookId-input').value;\r\n+\r\n+    if (type == 1 || type == 2)\r\n+        $.ajax({\r\n+            url: bookPath\r\n+                +'/comment',\r\n+            type: 'POST',\r\n+            data: JSON.stringify(bookComment),\r\n+            contentType: 'application/json; charset=utf-8',\r\n+            dataType: 'json',\r\n+            async: true\r\n+        });\r\n+\r\n+    if (type == 3)\r\n+        $.ajax({\r\n+            url: bookPath\r\n+                +'/comment/'+document.getElementById('id-input').value,\r\n+            type: 'DELETE',\r\n+            async: true\r\n+        });\r\n+\r\n+    window.location.href = '/comment?id='+document.getElementById('bookId-input').value;\r\n+\r\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "90ecbae5a6b325bd8609ccdbbd7d10b034ef18a2",
    "filename": "homework11/src/main/resources/static/js/comment-table.js",
    "status": "added",
    "additions": 29,
    "deletions": 0,
    "changes": 29,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/comment-table.js",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/static/js/comment-table.js",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/static/js/comment-table.js?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,29 @@\n+function fillForm(bookId) {\r\n+\r\n+    $.get('/book/'+bookId).done(function (book) {\r\n+        $('h1').append(book.name + ' Comments:')\r\n+    });\r\n+\r\n+    $.get('book/'+bookId+'/comment').done(function (bookcomments) {\r\n+        bookcomments.forEach(function (bookcomment) {\r\n+            $('tbody').append(`\r\n+               <tr>\r\n+                   <td>${bookcomment.id}</td>\r\n+                   <td>${bookcomment.comment}</td>\r\n+                    <td>\r\n+                        <a href=\"/comment/edit?id=${bookcomment.id}\">Edit</a>\r\n+                    </td>\r\n+                    <td>\r\n+                        <a href=\"/comment/delete?id=${bookcomment.id}\">Delete</a>\r\n+                    </td>\r\n+               </tr>\r\n+           `)\r\n+        });\r\n+    })\r\n+\r\n+}\r\n+function doAction(bookId) {\r\n+\r\n+    window.location.href = '/comment/insert?id='+bookId;\r\n+\r\n+}\n\\ No newline at end of file"
  },
  {
    "sha": "6a464ba91f1e2090ae521d463e9a5ac67e993db6",
    "filename": "homework11/src/main/resources/templates/book-form.html",
    "status": "added",
    "additions": 71,
    "deletions": 0,
    "changes": 71,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/book-form.html",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/book-form.html",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/templates/book-form.html?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,71 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\">\n+<head>\n+    <meta charset=\"UTF-8\"/>\n+    <title>Edit book</title>\n+    <style type=\"text/css\">\n+        body {\n+            padding: 50px;\n+        }\n+\n+        label {\n+            display: inline-block;\n+            width: 100px;\n+        }\n+\n+        input:read-only {\n+            background: lightgray;\n+        }\n+\n+        .row {\n+            margin-top: 10px;\n+        }\n+    </style>\n+<!--    <link rel=\"icon\" href=\"data:;base64,=\">-->\n+    <script src=\"/webjars/jquery/3.3.1/jquery.min.js\"></script>\n+</head>\n+<body>\n+\n+<!-- Book form -->\n+<form id=\"book-form\">\n+    <h1>Book Info:</h1>\n+\n+    <div class=\"row\">\n+        <label for=\"id-input\">ID:</label>\n+        <input id=\"id-input\" name=\"id\" type=\"text\" readonly=\"readonly\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <label for=\"name-input\">Name:</label>\n+        <input id=\"name-input\" name=\"name\" type=\"text\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <label for=\"author-input\">Author:</label>\n+        <input id=\"author-input\" name=\"author\" type=\"text\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <label for=\"genres-input\">Genres:</label>\n+        <input id=\"genres-input\" name=\"genres\" type=\"text\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <button id=\"submit-button\" type=\"submit\">Button</button>\n+    </div>\n+</form>\n+\n+<script type=\"text/javascript\" src=\"/js/book-form.js\"></script>\n+<script>\n+    $(\"#book-form\").ready(function() {\n+        fillForm('[[${bookId}]]', [[${action}]]);\n+    });\n+\n+    $(\"#book-form\").submit(function(event) {\n+        event.preventDefault();\n+        doAction([[${action}]]);\n+    });\n+</script>\n+\n+</body>\n+</html>"
  },
  {
    "sha": "7aca2c354a0d18dfde607abab2323d9d75891bc2",
    "filename": "homework11/src/main/resources/templates/book-table.html",
    "status": "added",
    "additions": 56,
    "deletions": 0,
    "changes": 56,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/book-table.html",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/book-table.html",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/templates/book-table.html?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,56 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\">\n+<head>\n+    <meta charset=\"UTF-8\"/>\n+    <title>List of all books</title>\n+    <style type=\"text/css\">\n+        body {\n+            padding: 50px;\n+        }\n+\n+        .books, .books td {\n+            border: 1px solid lightgray;\n+            padding: 5px;\n+        }\n+    </style>\n+    <script src=\"/webjars/jquery/3.3.1/jquery.min.js\"></script>\n+</head>\n+<form id=\"table-book\">\n+\n+<body>\n+<h1>Books:</h1>\n+\n+<table class=\"books\">\n+    <thead>\n+    <tr>\n+        <th>ID</th>\n+        <th>Name</th>\n+        <th>Author</th>\n+        <th>Genres</th>\n+        <th>Comments</th>\n+        <th>Edit</th>\n+        <th>Delete</th>\n+    </tr>\n+    </thead>\n+    <tbody>\n+    </tbody>\n+</table>\n+\n+<script type=\"text/javascript\" src=\"/js/book-table.js\"></script>\n+<script>\n+    $(\"#table-book\").ready(function() {\n+        fillForm();\n+    });\n+\n+    $(\"#table-book\").submit(function(event) {\n+        event.preventDefault();\n+        doAction();\n+    });\n+</script>\n+\n+<div class=\"row\">\n+    <button type=\"submit\">Insert</button>\n+</div>\n+\n+</form>\n+</html>"
  },
  {
    "sha": "2d98515ce57ded809596f27f146aba5a0d4bf900",
    "filename": "homework11/src/main/resources/templates/comment-form.html",
    "status": "added",
    "additions": 70,
    "deletions": 0,
    "changes": 70,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/comment-form.html",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/comment-form.html",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/templates/comment-form.html?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,70 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\">\n+<head>\n+    <meta charset=\"UTF-8\"/>\n+    <title>Edit book comment</title>\n+    <style type=\"text/css\">\n+        body {\n+            padding: 50px;\n+        }\n+\n+        label {\n+            display: inline-block;\n+            width: 100px;\n+        }\n+\n+        input:read-only {\n+            background: lightgray;\n+        }\n+\n+        .row {\n+            margin-top: 10px;\n+        }\n+    </style>\n+    <script src=\"/webjars/jquery/3.3.1/jquery.min.js\"></script>\n+</head>\n+<body>\n+\n+<!-- Book Comment form -->\n+<form id=\"comment-form\">\n+    <h1>Book Comment:</h1>\n+\n+    <div class=\"row\">\n+        <label for=\"id-input\">ID:</label>\n+        <input id=\"id-input\" type=\"text\" readonly=\"readonly\"/>\n+    </div>\n+\n+    <div class=\"row\" style=\"display: none;\">\n+        <label for=\"bookId-input\">Book ID:</label>\n+        <input id=\"bookId-input\" name=\"bookId\" type=\"text\" readonly=\"readonly\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <label for=\"book-input\">Book:</label>\n+        <input id=\"book-input\" name=\"book\" type=\"text\" readonly=\"readonly\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <label for=\"comment-input\">Comment:</label>\n+        <input id=\"comment-input\" name=\"comment\" type=\"text\"/>\n+    </div>\n+\n+    <div class=\"row\">\n+        <button id=\"submit-button\" type=\"submit\">Button</button>\n+    </div>\n+</form>\n+\n+<script type=\"text/javascript\" src=\"/js/comment-form.js\"></script>\n+<script>\n+    $(\"#comment-form\").ready(function() {\n+        fillForm('[[${bookCommentId}]]', '[[${bookId}]]', [[${action}]]);\n+    });\n+\n+    $(\"#comment-form\").submit(function(event) {\n+        event.preventDefault();\n+        doAction([[${action}]]);\n+    });\n+</script>\n+\n+</body>\n+</html>"
  },
  {
    "sha": "afe0be0cde745cdc094d39b06ab06d4219627397",
    "filename": "homework11/src/main/resources/templates/comment-table.html",
    "status": "added",
    "additions": 53,
    "deletions": 0,
    "changes": 53,
    "blob_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/blob/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/comment-table.html",
    "raw_url": "https://github.com/kermilov/2020-11-otus-spring-ermilov/raw/a129eda2e6ecfc942df7e79f4cadf45d6eb322aa/homework11/src/main/resources/templates/comment-table.html",
    "contents_url": "https://api.github.com/repos/kermilov/2020-11-otus-spring-ermilov/contents/homework11/src/main/resources/templates/comment-table.html?ref=a129eda2e6ecfc942df7e79f4cadf45d6eb322aa",
    "patch": "@@ -0,0 +1,53 @@\n+<!DOCTYPE html>\r\n+<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\">\r\n+<head>\r\n+    <meta charset=\"UTF-8\">\r\n+    <title>Book Comments</title>\r\n+    <style type=\"text/css\">\r\n+        body {\r\n+            padding: 50px;\r\n+        }\r\n+\r\n+        .bookcomments, .bookcomments td {\r\n+            border: 1px solid lightgray;\r\n+            padding: 5px;\r\n+        }\r\n+    </style>\r\n+    <script src=\"/webjars/jquery/3.3.1/jquery.min.js\"></script>\r\n+</head>\r\n+<body>\r\n+\r\n+<form id=\"comment-table\">\r\n+<h1></h1>\r\n+<table class=\"bookcomments\">\r\n+    <thead>\r\n+    <tr>\r\n+        <th>ID</th>\r\n+        <th>Comment</th>\r\n+        <th>Edit</th>\r\n+        <th>Delete</th>\r\n+    </tr>\r\n+    </thead>\r\n+    <tbody>\r\n+    </tbody>\r\n+</table>\r\n+<script type=\"text/javascript\" src=\"/js/comment-table.js\"></script>\r\n+<script>\r\n+    $(\"#comment-table\").ready(function() {\r\n+        fillForm('[[${bookId}]]');\r\n+    });\r\n+\r\n+    $(\"#comment-table\").submit(function(event) {\r\n+        event.preventDefault();\r\n+        doAction('[[${bookId}]]');\r\n+    });\r\n+</script>\r\n+\r\n+<div class=\"row\">\r\n+    <button type=\"submit\">Insert</button>\r\n+</div>\r\n+\r\n+</form>\r\n+\r\n+</body>\r\n+</html>\n\\ No newline at end of file"
  }
]
