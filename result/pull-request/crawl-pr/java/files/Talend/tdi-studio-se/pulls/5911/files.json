[
  {
    "sha": "f38843a7d9b7055b24d3d34c95c2fd549d258744",
    "filename": "main/plugins/org.talend.designer.components.localprovider/components/tFileOutputJSON/tFileOutputJSON_main.javajet",
    "status": "modified",
    "additions": 18,
    "deletions": 6,
    "changes": 24,
    "blob_url": "https://github.com/Talend/tdi-studio-se/blob/dd6b559455ee659976bd35a0bc09c4fe8af3ea37/main/plugins/org.talend.designer.components.localprovider/components/tFileOutputJSON/tFileOutputJSON_main.javajet",
    "raw_url": "https://github.com/Talend/tdi-studio-se/raw/dd6b559455ee659976bd35a0bc09c4fe8af3ea37/main/plugins/org.talend.designer.components.localprovider/components/tFileOutputJSON/tFileOutputJSON_main.javajet",
    "contents_url": "https://api.github.com/repos/Talend/tdi-studio-se/contents/main/plugins/org.talend.designer.components.localprovider/components/tFileOutputJSON/tFileOutputJSON_main.javajet?ref=dd6b559455ee659976bd35a0bc09c4fe8af3ea37",
    "patch": "@@ -33,6 +33,7 @@ for (IConnection conn : conns) {\n \t\t\tfor (int i = 0; i < sizeColumns; i++) {\r\n \t\t\t\t\t\t\r\n \t\t\t\tIMetadataColumn column = columns.get(i);\r\n+                String pattern = column.getPattern();\r\n \t\t\t\tJavaType javaType = JavaTypesManager.getJavaTypeFromId(column.getTalendType());\r\n \t\t\t\tboolean isPrimitive = JavaTypesManager.isJavaPrimitiveType(javaType, column.isNullable());\r\n \t\t\t    if(!isPrimitive){\r\n@@ -41,19 +42,30 @@ for (IConnection conn : conns) {\n \t\t\t    <%\r\n \t\t\t    }\r\n \t\t\t\tif (javaType == JavaTypesManager.DATE && column.getPattern() != null && column.getPattern().trim().length() != 0) {\r\n-\t\t\t\t\tString pattern = column.getPattern();\r\n \t\t\t\t\t%>\r\n \t\t\t\t\tjsonRow<%=cid%>.put(\"<%=column.getLabel()%>\",FormatterUtils.format_Date(<%=conn.getName()%>.<%=column.getLabel()%>, <%=pattern%>));\r\n-\t\t\t\t<%\r\n-\t\t\t\t}else if(javaType == JavaTypesManager.CHARACTER){\r\n+\t\t\t\t<%}\r\n+\t\t\t\telse if(javaType == JavaTypesManager.CHARACTER){\r\n \t\t\t\t%>\r\n \t\t\t\t\tjsonRow<%=cid%>.put(\"<%=column.getLabel()%>\", String.valueOf(<%=conn.getName()%>.<%=column.getLabel()%>));\r\n \t\t\t\t<%\r\n-\t\t\t\t}else{\r\n+\t\t\t\t}\r\n+\t\t\t\t// add dynamic schema support here\r\n+\t\t\t\telse if(column.getTalendType().equals(\"id_Dynamic\")) {\r\n \t\t\t\t%>\r\n-\t\t\t\t\tjsonRow<%=cid%>.put(\"<%=column.getLabel()%>\", <%=conn.getName()%>.<%=column.getLabel()%>);\r\n+\t\t\t\t\tDynamic col= (Dynamic) <%=conn.getName()%>.<%=column.getLabel()%>;\r\n+\t\t\t\t\tfor (int i = 0; i < col.getColumnCount(); i++) {\r\n+\t\t\t\t\t\tDynamicMetadata metadata = col.getColumnMetadata(i);\r\n+\t\t\t\t\t\tObject val=col.getColumnValue(i);\r\n+\t\t\t\t\t\tif(val instanceof Date) val=FormatterUtils.format_Date((Date)val, metadata.getFormat());\r\n+\t\t\t\t\t\tjsonRow<%=cid%>.put(metadata.getName(),val);\r\n+                    }\r\n \t\t\t\t<%\r\n-\t\t\t\t}\r\n+\t\t\t\t} //end of add dynamic support here  (this assumes dynamic datatype does not contain nested dynamic datatype fields)\r\n+\t\t\t\telse {\r\n+\t\t\t\t%>\r\n+\t\t\t\t\tjsonRow<%=cid%>.put(\"<%=column.getLabel()%>\", <%=conn.getName()%>.<%=column.getLabel()%>);\r\n+\t\t\t\t<%}\r\n \t\t\t\tif(!isPrimitive){\r\n \t\t\t\t%>\r\n \t\t\t\t\t}else{\r"
  }
]
