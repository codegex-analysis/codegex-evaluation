[
  {
    "sha": "7b7cf41cf5a8cc4b0dc86d90c1bcdf10e3182d31",
    "filename": "Jenkinsfile",
    "status": "modified",
    "additions": 1,
    "deletions": 2,
    "changes": 3,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/Jenkinsfile",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/Jenkinsfile",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/Jenkinsfile?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -13,8 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-\n-@Library('jenkinsfile-lib')_\n+@Library('jenkinsfile-lib@feature/PAL-976-update-smoke-tests-shared-redis-kafka')_\n \n timestamps {\n     services()"
  },
  {
    "sha": "0083a8314038e901088ce511dfbb2ca51df36da4",
    "filename": "charts/attribute-masking-service/templates/configmap-akka-redis.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/attribute-masking-service/templates/configmap-akka-redis.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/attribute-masking-service/templates/configmap-akka-redis.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/attribute-masking-service/templates/configmap-akka-redis.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,11 +28,14 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}rule {{ end }}\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}masked-resource {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092\n   application-redis.yaml: |\n     {{- if and ($.Values.global.redis.install) ((index $.Values.global \"redis-cluster\").install) }}"
  },
  {
    "sha": "baf28367f7df6cb161b22101b618235a13ad4b3a",
    "filename": "charts/audit-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 2,
    "changes": 6,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/audit-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/audit-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/audit-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -27,8 +27,10 @@ data:\n     akka:\n       kafka:\n         consumer.topics:\n-          error-topic.partitions: {{ .Values.replicaCount }}\n           success-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}success-topic.name: {{ .Values.global.topicPrefix }}success {{ end }}\n+          error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092"
  },
  {
    "sha": "9aa5ad79c9421f142970f6d31a54afa6015c7340",
    "filename": "charts/data-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/data-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/data-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/data-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -52,7 +52,9 @@ data:\n       kafka:\n         producer.topics:\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n           success-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}success-topic.name: {{ .Values.global.topicPrefix }}success {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092"
  },
  {
    "sha": "c08cc7f0811c2007379821081612aa349d56a334",
    "filename": "charts/filtered-resource-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 6,
    "deletions": 1,
    "changes": 7,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/filtered-resource-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/filtered-resource-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/filtered-resource-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,13 +28,18 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}masked-resource {{ end }}\n           offset-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}offset-topic.name: {{ .Values.global.topicPrefix }}masked-resource-offset {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n         producer.topics:\n           success-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}success-topic.name: {{ .Values.global.topicPrefix }}success {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092\n   application-redis.yaml: |\n     {{- if and ($.Values.global.redis.install) ((index $.Values.global \"redis-cluster\").install) }}"
  },
  {
    "sha": "cc8a962ae05299cab4278774a65b605ad3f97ad8",
    "filename": "charts/kafka/charts/zookeeper/values.yaml",
    "status": "modified",
    "additions": 2,
    "deletions": 2,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/charts/zookeeper/values.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/charts/zookeeper/values.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/kafka/charts/zookeeper/values.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -100,9 +100,9 @@ podAnnotations: {}  # Arbitrary non-identifying metadata for zookeeper pods.\n   # prometheus.io/path: \"/metrics\"\n   # prometheus.io/port: \"9141\"\n \n-podLabels: {}  # Key/value pairs that are attached to zookeeper pods.\n+podLabels:  # Key/value pairs that are attached to zookeeper pods.\n   # team: \"developers\"\n-  # service: \"zookeeper\"\n+  service: \"palisade-zookeeper\"\n \n # Zookeeper pod Security Context\n securityContext:"
  },
  {
    "sha": "0f13c4b49c31cc4d82bd7afa9f14f86b3066cd31",
    "filename": "charts/kafka/templates/_helpers.tpl",
    "status": "modified",
    "additions": 3,
    "deletions": 0,
    "changes": 3,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/templates/_helpers.tpl",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/templates/_helpers.tpl",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/kafka/templates/_helpers.tpl?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -97,6 +97,9 @@ Create unified labels for kafka components\n {{- define \"kafka.common.matchLabels\" -}}\n app.kubernetes.io/name: {{ include \"kafka.name\" . }}\n app.kubernetes.io/instance: {{ .Release.Name }}\n+{{- range $key, $value := .Values.podLabels }}\n+{{ $key }}: {{ $value }}\n+{{- end -}}\n {{- end -}}\n \n {{- define \"kafka.common.metaLabels\" -}}"
  },
  {
    "sha": "92f21a6bb89362e48b37d64f1397ddd931ecf14f",
    "filename": "charts/kafka/values.yaml",
    "status": "modified",
    "additions": 2,
    "deletions": 3,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/values.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/kafka/values.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/kafka/values.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -186,9 +186,8 @@ external:\n podAnnotations: {}\n \n # Labels to be added to Kafka pods\n-podLabels: {}\n-  # service: broker\n-  # team: developers\n+podLabels:\n+  service: \"palisade-kafka\"\n \n podDisruptionBudget: {}\n   # maxUnavailable: 1  # Limits how many Kafka pods may be unavailable due to voluntary disruptions."
  },
  {
    "sha": "e6a49344dbb764955ba287bc89ba49b7d8ea6f96",
    "filename": "charts/palisade-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/palisade-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/palisade-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/palisade-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,7 +28,9 @@ data:\n       kafka:\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}request {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092"
  },
  {
    "sha": "03334dc1535a2ef2e2a526e78c8e60d1a8f6ab61",
    "filename": "charts/policy-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/policy-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/policy-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/policy-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,11 +28,14 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}resource {{ end }}\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}rule {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092\n   application-redis.yaml: |\n     {{- if and ($.Values.global.redis.install) ((index $.Values.global \"redis-cluster\").install) }}"
  },
  {
    "sha": "db22405a8fda116ab54138e22c2bbc42581a61ab",
    "filename": "charts/redis-cluster/values-production.yaml",
    "status": "modified",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis-cluster/values-production.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis-cluster/values-production.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/redis-cluster/values-production.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -332,7 +332,9 @@ metrics:\n   podAnnotations:\n     prometheus.io/scrape: \"true\"\n     prometheus.io/port: \"9121\"\n-  # podLabels: {}\n+  podLabels:\n+    # Add label to advertise this POD as providing palisade-redis-cluster services\n+    service: palisade-redis-cluster\n \n   # Enable this if you're using https://github.com/coreos/prometheus-operator\n   serviceMonitor:"
  },
  {
    "sha": "5c3b5e162e2daf2cef4e8dcdc1752d39d675d008",
    "filename": "charts/redis-cluster/values.yaml",
    "status": "modified",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis-cluster/values.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis-cluster/values.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/redis-cluster/values.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -339,7 +339,9 @@ metrics:\n   podAnnotations:\n     prometheus.io/scrape: \"true\"\n     prometheus.io/port: \"9121\"\n-  # podLabels: {}\n+  podLabels:\n+    # Add label to advertise this POD as providing palisade-redis-cluster services\n+    service: palisade-redis-cluster\n \n   # Enable this if you're using https://github.com/coreos/prometheus-operator\n   serviceMonitor:"
  },
  {
    "sha": "2fbac0382a9b7877b6d54dd4bc2d6d6cc41c8fad",
    "filename": "charts/redis/values-production.yaml",
    "status": "modified",
    "additions": 3,
    "deletions": 1,
    "changes": 4,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis/values-production.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis/values-production.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/redis/values-production.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -252,7 +252,9 @@ master:\n \n   ## Redis Master additional pod labels and annotations\n   ## ref: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\n-  podLabels: {}\n+  podLabels:\n+    # Add label to advertise this POD as providing palisade-redis services\n+    service: \"palisade-redis\"\n   podAnnotations: {}\n \n   ## Redis Master resource requests and limits"
  },
  {
    "sha": "372c52aa9a5b3dfd6ed528fc47f7b14f3e247dcf",
    "filename": "charts/redis/values.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis/values.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/redis/values.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/redis/values.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -253,7 +253,10 @@ master:\n \n   ## Redis Master additional pod labels and annotations\n   ## ref: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\n-  podLabels: {}\n+  podLabels:\n+    # Add label to advertise this POD as providing palisade-redis services\n+    service: \"palisade-redis\"\n+\n   podAnnotations: {}\n \n   ## Redis Master resource requests and limits"
  },
  {
    "sha": "3371ecbfaeeb90d4c591b8c87e9865acb8b7b8db",
    "filename": "charts/resource-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/resource-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/resource-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/resource-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,11 +28,14 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}user {{ end }}\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}resource {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092\n   application-redis.yaml: |\n     {{- if and ($.Values.global.redis.install) ((index $.Values.global \"redis-cluster\").install) }}"
  },
  {
    "sha": "cbd2178a454f25f416d4a2a508c95425a78022c9",
    "filename": "charts/topic-offset-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/topic-offset-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/topic-offset-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/topic-offset-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,9 +28,12 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}masked-resource {{ end }}\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}masked-resource-offset {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092"
  },
  {
    "sha": "dba3c4ce9a93eca59ebff2935bc00a2d4dfa0312",
    "filename": "charts/user-service/templates/configmap.yaml",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/charts/user-service/templates/configmap.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/charts/user-service/templates/configmap.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/charts/user-service/templates/configmap.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -28,11 +28,14 @@ data:\n       kafka:\n         consumer.topics:\n           input-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}input-topic.name: {{ .Values.global.topicPrefix }}request {{ end }}\n         producer.topics:\n           output-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}output-topic.name: {{ .Values.global.topicPrefix }}user {{ end }}\n           error-topic.partitions: {{ .Values.replicaCount }}\n+          {{ if .Values.global.topicPrefix }}error-topic.name: {{ .Values.global.topicPrefix }}error {{ end }}\n       discovery.config.services.kafka.endpoints:\n-      - host: {{ include \"palisade.kafka.fullname\" . }}-headless\n+      - host: {{ include \"palisade.kafka.fullname\" . }}\n         port: 9092\n   application-redis.yaml: |\n     {{- if and ($.Values.global.redis.install) ((index $.Values.global \"redis-cluster\").install) }}"
  },
  {
    "sha": "4fe2cfb082ccbb045c0b7542fdaf85dfbea7ee4d",
    "filename": "templates/kafka-proxy-svc.yaml",
    "status": "added",
    "additions": 41,
    "deletions": 0,
    "changes": 41,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/templates/kafka-proxy-svc.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/templates/kafka-proxy-svc.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/templates/kafka-proxy-svc.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -0,0 +1,41 @@\n+# Copyright 2018-2021 Crown Copyright\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+# Create a service that will uses a pod selector to determine on which pod(s) is to be used\n+# for the kafka service.\n+#\n+# The palisade application will point to this kafka service which will find a pod that matches the specified service label.\n+#\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: palisade-kafka-proxy\n+  namespace: {{ include \"palisade.namespace\" . }}\n+  annotations:\n+    service.alpha.kubernetes.io/tolerate-unready-endpoints: \"true\"\n+spec:\n+  ports:\n+  - name: palisade-kafka\n+    port: 9092\n+  type: ExternalName\n+  # Specify the FQDN of the service to use. Pod selectors can't select outside of namespace\n+{{- if eq .Values.global.hosting \"aws\" }}\n+  externalName: kafka.palisade-shared.svc.cluster.local\n+  ports:\n+  - port: 9092\n+{{- else }}\n+  externalName: palisade-kafka.{{ include \"palisade.namespace\" . }}.svc.cluster.local\n+  ports:\n+  - port: 9092\n+{{- end }}"
  },
  {
    "sha": "62aecfe7516f74eab4a1a14c31db0ce2421945d8",
    "filename": "templates/redis-cluster-proxy-svc.yaml",
    "status": "added",
    "additions": 41,
    "deletions": 0,
    "changes": 41,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/templates/redis-cluster-proxy-svc.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/templates/redis-cluster-proxy-svc.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/templates/redis-cluster-proxy-svc.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -0,0 +1,41 @@\n+# Copyright 2018-2021 Crown Copyright\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+# Create a service that will uses a pod selector to determine on which pod(s) is to be used\n+# for the redis service.\n+#\n+# The palisade application will point to this service which will find a pod that matches the specified service label.\n+#\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: palisade-redis-proxy-cluster\n+  namespace: {{ include \"palisade.namespace\" . }}\n+  annotations:\n+    service.alpha.kubernetes.io/tolerate-unready-endpoints: \"true\"\n+spec:\n+  ports:\n+  - name: palisade-redis-cluster\n+    port: 16379\n+  type: ExternalName\n+  # Specify the FQDN of the service to use. Pod selectors can't select outside of namespace\n+{{- if eq .Values.global.hosting \"aws\" }}\n+  externalName: redis-cluster.palisade-shared.svc.cluster.local\n+  ports:\n+  - port: 16379\n+{{- else }}\n+  externalName: palisade-redis-cluster.{{ include \"palisade.namespace\" . }}.svc.cluster.local\n+  ports:\n+  - port: 16379\n+{{- end }}"
  },
  {
    "sha": "6aca03c796cfb566a05e79fb77d88d856d87c009",
    "filename": "templates/redis-proxy-svc.yaml",
    "status": "added",
    "additions": 41,
    "deletions": 0,
    "changes": 41,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/templates/redis-proxy-svc.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/templates/redis-proxy-svc.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/templates/redis-proxy-svc.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -0,0 +1,41 @@\n+# Copyright 2018-2021 Crown Copyright\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+# Create a service that will uses a pod selector to determine on which pod(s) is to be used\n+# for the redis service.\n+#\n+# The palisade application will point to this service which will find a pod that matches the specified service label.\n+#\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: palisade-redis-proxy-master\n+  namespace: {{ include \"palisade.namespace\" . }}\n+  annotations:\n+    service.alpha.kubernetes.io/tolerate-unready-endpoints: \"true\"\n+spec:\n+  ports:\n+  - name: palisade-redis\n+    port: 6379\n+  type: ExternalName\n+  # Specify the FQDN of the service to use. Pod selectors can't select outside of namespace\n+{{- if eq .Values.global.hosting \"aws\" }}\n+  externalName: redis-master.palisade-shared.svc.cluster.local\n+  ports:\n+  - port: 6379\n+{{- else }}\n+  externalName: palisade-redis-master.{{ include \"palisade.namespace\" . }}.svc.cluster.local\n+  ports:\n+  - port: 6379\n+{{- end }}"
  },
  {
    "sha": "12a2b4d2af853d9635c5a2ba27237368aec24a2e",
    "filename": "templates/zookeeper-proxy-svc.yaml",
    "status": "added",
    "additions": 41,
    "deletions": 0,
    "changes": 41,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/templates/zookeeper-proxy-svc.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/templates/zookeeper-proxy-svc.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/templates/zookeeper-proxy-svc.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -0,0 +1,41 @@\n+# Copyright 2018-2021 Crown Copyright\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+# Create a service that will uses a pod selector to determine on which pod(s) is to be used\n+# for the zookeeper service.\n+#\n+# The palisade application will point to this kafka service which will find a pod that matches the specified service label.\n+#\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: palisade-zookeeper-proxy\n+  namespace: {{ include \"palisade.namespace\" . }}\n+  annotations:\n+    service.alpha.kubernetes.io/tolerate-unready-endpoints: \"true\"\n+spec:\n+  ports:\n+  - name: palisade-zookeeper\n+    port: 2181\n+  type: ExternalName\n+  # Specify the FQDN of the service to use. Pod selectors can't select outside of namespace\n+{{- if eq .Values.global.hosting \"aws\" }}\n+  externalName: zookeeper.palisade-shared.svc.cluster.local\n+  ports:\n+  - port: 2181\n+{{- else }}\n+  externalName: palisade-zookeeper.{{ include \"palisade.namespace\" . }}.svc.cluster.local\n+  ports:\n+  - port: 2181\n+{{- end }}"
  },
  {
    "sha": "b095b4412a5b0711dd2f7398c21a610f26b85a12",
    "filename": "values.yaml",
    "status": "modified",
    "additions": 5,
    "deletions": 4,
    "changes": 9,
    "blob_url": "https://github.com/gchq/Palisade-services/blob/ad95bfa9efeb86657054707263711b3a8839a082/values.yaml",
    "raw_url": "https://github.com/gchq/Palisade-services/raw/ad95bfa9efeb86657054707263711b3a8839a082/values.yaml",
    "contents_url": "https://api.github.com/repos/gchq/Palisade-services/contents/values.yaml?ref=ad95bfa9efeb86657054707263711b3a8839a082",
    "patch": "@@ -40,18 +40,19 @@ global:\n     install: true\n     # imported from sub-chart, default values here are overridden by sub-chart values\n     exports:\n-      nameOverride: \"kafka\"\n+      nameOverride: \"kafka-proxy\"\n \n   zookeeper:\n     exports: {}\n-    # nameOverride: \"zookeeper\"\n+    nameOverride: \"zookeeper-proxy\"\n \n   redis:\n     # install: install redis persistence and caching data storage platform\n     install: true\n     # imported from sub-chart, default values here are overridden by sub-chart values\n     exports:\n-      nameOverride: \"redis\"\n+      # By default always use the redis-proxy kubernetes service to resolve the redis endpoint\n+      nameOverride: \"redis-proxy\"\n     master:\n       service:\n         port: 6379\n@@ -61,7 +62,7 @@ global:\n     install: false\n     # imported from sub-chart, default values here are overridden by sub-chart values\n     exports:\n-      nameOverride: \"redis\"\n+      nameOverride: \"redis-proxy\"\n       redisPort: 6379\n     cluster:\n       nodes: 6"
  }
]
