[
  {
    "sha": "f7fad7b544ecd4d2379499e327639144837d4bf2",
    "filename": "openmrs-client/src/main/java/org/openmrs/mobile/activities/addeditallergy/AddEditAllergyFragment.java",
    "status": "modified",
    "additions": 62,
    "deletions": 57,
    "changes": 119,
    "blob_url": "https://github.com/openmrs/openmrs-contrib-android-client/blob/988189af2d5d8e0101b45558ad26307e3369fa37/openmrs-client/src/main/java/org/openmrs/mobile/activities/addeditallergy/AddEditAllergyFragment.java",
    "raw_url": "https://github.com/openmrs/openmrs-contrib-android-client/raw/988189af2d5d8e0101b45558ad26307e3369fa37/openmrs-client/src/main/java/org/openmrs/mobile/activities/addeditallergy/AddEditAllergyFragment.java",
    "contents_url": "https://api.github.com/repos/openmrs/openmrs-contrib-android-client/contents/openmrs-client/src/main/java/org/openmrs/mobile/activities/addeditallergy/AddEditAllergyFragment.java?ref=988189af2d5d8e0101b45558ad26307e3369fa37",
    "patch": "@@ -44,7 +44,6 @@\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Objects;\n \n import static org.openmrs.mobile.utilities.ApplicationConstants.AllergyModule.PROPERTY_DRUG;\n import static org.openmrs.mobile.utilities.ApplicationConstants.AllergyModule.PROPERTY_FOOD;\n@@ -58,7 +57,7 @@\n public class AddEditAllergyFragment extends ACBaseFragment<AddEditAllergyContract.Presenter> implements AddEditAllergyContract.View {\n     AllergyCreate allergyCreate = new AllergyCreate();\n     AlertDialog alertDialog;\n-    private FragmentAllergyInfoBinding patientAllergyBinding;\n+    private FragmentAllergyInfoBinding binding;\n     private List<Resource> foodAllergens = new ArrayList<>();\n     private List<Resource> drugAllergens = new ArrayList<>();\n     private List<Resource> environmentAllergens = new ArrayList<>();\n@@ -76,59 +75,59 @@ public static AddEditAllergyFragment newInstance() {\n     @Nullable\n     @Override\n     public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n-        patientAllergyBinding = FragmentAllergyInfoBinding.inflate(inflater, container, false);\n-        View root = patientAllergyBinding.getRoot();\n+        binding = FragmentAllergyInfoBinding.inflate(inflater, container, false);\n+        View root = binding.getRoot();\n         mPresenter.fetchSystemProperties(this);\n         initListeners();\n         return root;\n     }\n \n     private void initListeners() {\n-        patientAllergyBinding.mildSeverity.setOnClickListener(view -> {\n+        binding.mildSeverity.setOnClickListener(view -> {\n             allergyCreate.setSeverity(new AllergyUuid(mildSeverity));\n-            selectSeverity(patientAllergyBinding.mildSeverity);\n-            unSelectSeverity(patientAllergyBinding.moderateSeverity);\n-            unSelectSeverity(patientAllergyBinding.severeSeverity);\n+            selectSeverity(binding.mildSeverity);\n+            unSelectSeverity(binding.moderateSeverity);\n+            unSelectSeverity(binding.severeSeverity);\n         });\n \n-        patientAllergyBinding.moderateSeverity.setOnClickListener(view -> {\n+        binding.moderateSeverity.setOnClickListener(view -> {\n             allergyCreate.setSeverity(new AllergyUuid(moderateSeverity));\n-            unSelectSeverity(patientAllergyBinding.mildSeverity);\n-            selectSeverity(patientAllergyBinding.moderateSeverity);\n-            unSelectSeverity(patientAllergyBinding.severeSeverity);\n+            unSelectSeverity(binding.mildSeverity);\n+            selectSeverity(binding.moderateSeverity);\n+            unSelectSeverity(binding.severeSeverity);\n         });\n \n-        patientAllergyBinding.severeSeverity.setOnClickListener(view -> {\n+        binding.severeSeverity.setOnClickListener(view -> {\n             allergyCreate.setSeverity(new AllergyUuid(severeSeverity));\n-            unSelectSeverity(patientAllergyBinding.mildSeverity);\n-            unSelectSeverity(patientAllergyBinding.moderateSeverity);\n-            selectSeverity(patientAllergyBinding.severeSeverity);\n+            unSelectSeverity(binding.mildSeverity);\n+            unSelectSeverity(binding.moderateSeverity);\n+            selectSeverity(binding.severeSeverity);\n         });\n \n-        patientAllergyBinding.allergenDrug.setOnClickListener(view -> {\n+        binding.allergenDrug.setOnClickListener(view -> {\n             setUpAllergenSpinner(drugAllergens, PROPERTY_DRUG);\n-            selectChip(patientAllergyBinding.allergenDrug);\n-            unSelectChip(patientAllergyBinding.allergenFood);\n-            unSelectChip(patientAllergyBinding.allergenOther);\n+            selectChip(binding.allergenDrug);\n+            unSelectChip(binding.allergenFood);\n+            unSelectChip(binding.allergenOther);\n         });\n \n-        patientAllergyBinding.allergenFood.setOnClickListener(view -> {\n+        binding.allergenFood.setOnClickListener(view -> {\n             setUpAllergenSpinner(foodAllergens, PROPERTY_FOOD);\n-            unSelectChip(patientAllergyBinding.allergenDrug);\n-            selectChip(patientAllergyBinding.allergenFood);\n-            unSelectChip(patientAllergyBinding.allergenOther);\n+            unSelectChip(binding.allergenDrug);\n+            selectChip(binding.allergenFood);\n+            unSelectChip(binding.allergenOther);\n         });\n \n-        patientAllergyBinding.allergenOther.setOnClickListener(view -> {\n+        binding.allergenOther.setOnClickListener(view -> {\n             setUpAllergenSpinner(environmentAllergens, PROPERTY_OTHER);\n-            unSelectChip(patientAllergyBinding.allergenDrug);\n-            unSelectChip(patientAllergyBinding.allergenFood);\n-            selectChip(patientAllergyBinding.allergenOther);\n+            unSelectChip(binding.allergenDrug);\n+            unSelectChip(binding.allergenFood);\n+            selectChip(binding.allergenOther);\n         });\n \n-        patientAllergyBinding.cancelButton.setOnClickListener(view -> requireActivity().finish());\n+        binding.cancelButton.setOnClickListener(view -> requireActivity().finish());\n \n-        patientAllergyBinding.submitButton.setOnClickListener(view -> createAllergy());\n+        binding.submitButton.setOnClickListener(view -> createAllergy());\n     }\n \n     private void setUpAllergenSpinner(List<Resource> allergens, String allergenType) {\n@@ -138,11 +137,11 @@ private void setUpAllergenSpinner(List<Resource> allergens, String allergenType)\n             allergenArray[i + 1] = allergens.get(i).getDisplay();\n         }\n         ArrayAdapter<String> reactionAdapter = new ArrayAdapter<>(getContext(), android.R.layout.simple_list_item_1, allergenArray);\n-        patientAllergyBinding.allergySpinner.setAdapter(reactionAdapter);\n-        patientAllergyBinding.allergySpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\n+        binding.allergySpinner.setAdapter(reactionAdapter);\n+        binding.allergySpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\n             @Override\n             public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {\n-                String selectedAllergen = patientAllergyBinding.allergySpinner.getSelectedItem().toString();\n+                String selectedAllergen = binding.allergySpinner.getSelectedItem().toString();\n                 if (!selectedAllergen.equals(allergenArray[0])) {\n                     String uuid = null;\n                     for (int j = 0; j < allergens.size(); j++) {\n@@ -172,11 +171,11 @@ private void setupReactionSpinner() {\n             reactionArray[i + 1] = reactionList.get(i).getDisplay();\n         }\n         ArrayAdapter<String> reactionAdapter = new ArrayAdapter<>(getContext(), android.R.layout.simple_list_item_1, reactionArray);\n-        patientAllergyBinding.reactionSpinner.setAdapter(reactionAdapter);\n-        patientAllergyBinding.reactionSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\n+        binding.reactionSpinner.setAdapter(reactionAdapter);\n+        binding.reactionSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\n             @Override\n             public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {\n-                String selectedReaction = patientAllergyBinding.reactionSpinner.getSelectedItem().toString();\n+                String selectedReaction = binding.reactionSpinner.getSelectedItem().toString();\n                 if (!selectedReaction.equals(reactionArray[0])) {\n                     if (selectedReactions.contains(selectedReaction)) {\n                         ToastUtil.error(getString(R.string.allergy_already_selected));\n@@ -194,7 +193,7 @@ public void onNothingSelected(AdapterView<?> adapterView) {\n     }\n \n     private void createAllergy() {\n-        allergyCreate.setComment(patientAllergyBinding.commentBox.getText().toString());\n+        allergyCreate.setComment(binding.commentBox.getText().toString());\n         allergyCreate.setReactions(getSelectedReactionFromChips());\n \n         if (null == allergyCreate.getAllergen()) {\n@@ -257,11 +256,11 @@ public void setSeverity(SystemProperty systemProperty) {\n     @Override\n     public void showLoading(boolean loading, boolean exitScreen) {\n         if (loading) {\n-            patientAllergyBinding.transparentScreen.setVisibility(View.VISIBLE);\n-            patientAllergyBinding.progressBar.setVisibility(View.VISIBLE);\n+            binding.transparentScreen.setVisibility(View.VISIBLE);\n+            binding.progressBar.setVisibility(View.VISIBLE);\n         } else {\n-            patientAllergyBinding.transparentScreen.setVisibility(View.GONE);\n-            patientAllergyBinding.progressBar.setVisibility(View.GONE);\n+            binding.transparentScreen.setVisibility(View.GONE);\n+            binding.progressBar.setVisibility(View.GONE);\n             if (exitScreen) {\n                 getActivity().finish();\n             }\n@@ -272,19 +271,19 @@ public void showLoading(boolean loading, boolean exitScreen) {\n     public void fillAllergyToUpdate(Allergy mAllergy) {\n         if (mAllergy != null) {\n             allergyToUpdate = true;\n-            patientAllergyBinding.commentBox.setText(mAllergy.getComment());\n+            binding.commentBox.setText(mAllergy.getComment());\n \n-            unSelectSeverity(patientAllergyBinding.mildSeverity);\n-            unSelectSeverity(patientAllergyBinding.moderateSeverity);\n-            unSelectSeverity(patientAllergyBinding.severeSeverity);\n+            unSelectSeverity(binding.mildSeverity);\n+            unSelectSeverity(binding.moderateSeverity);\n+            unSelectSeverity(binding.severeSeverity);\n             if (mAllergy.getSeverity() != null) {\n                 allergyCreate.setSeverity(new AllergyUuid(mAllergy.getSeverity().getUuid()));\n                 if (mAllergy.getSeverity().getDisplay().contains(PROPERTY_MILD)) {\n-                    selectSeverity(patientAllergyBinding.mildSeverity);\n+                    selectSeverity(binding.mildSeverity);\n                 } else if (mAllergy.getSeverity().getDisplay().contains(PROPERTY_SEVERE)) {\n-                    selectSeverity(patientAllergyBinding.severeSeverity);\n+                    selectSeverity(binding.severeSeverity);\n                 } else {\n-                    selectSeverity(patientAllergyBinding.moderateSeverity);\n+                    selectSeverity(binding.moderateSeverity);\n                 }\n             }\n \n@@ -293,10 +292,10 @@ public void fillAllergyToUpdate(Allergy mAllergy) {\n                 createReactionChip(allergyReaction.getReaction().getDisplay());\n             }\n \n-            patientAllergyBinding.linearLayoutCategory.setVisibility(View.GONE);\n-            patientAllergyBinding.allergySpinner.setVisibility(View.GONE);\n-            patientAllergyBinding.finalAllergen.setVisibility(View.VISIBLE);\n-            patientAllergyBinding.finalAllergen.setText(mAllergy.getAllergen().getCodedAllergen().getDisplay());\n+            binding.linearLayoutCategory.setVisibility(View.GONE);\n+            binding.allergySpinner.setVisibility(View.GONE);\n+            binding.finalAllergen.setVisibility(View.VISIBLE);\n+            binding.finalAllergen.setText(mAllergy.getAllergen().getCodedAllergen().getDisplay());\n             AllergenCreate allergenCreate = new AllergenCreate();\n             allergenCreate.setAllergenType(mAllergy.getAllergen().getAllergenType());\n             allergenCreate.setCodedAllergen(new AllergyUuid(mAllergy.getAllergen().getCodedAllergen().getUuid()));\n@@ -330,18 +329,18 @@ private void createReactionChip(String selectedReaction) {\n         chip.setClickable(false);\n         chip.setClickable(false);\n         chip.setOnCloseIconClickListener(selected_chip -> {\n-            patientAllergyBinding.chipGroup.removeView(selected_chip);\n+            binding.chipGroup.removeView(selected_chip);\n             selectedReactions.remove(chip.getText().toString());\n         });\n-        patientAllergyBinding.chipGroup.addView(chip);\n-        patientAllergyBinding.linearLayoutReaction.setVisibility(View.VISIBLE);\n+        binding.chipGroup.addView(chip);\n+        binding.linearLayoutReaction.setVisibility(View.VISIBLE);\n     }\n \n     private List<AllergyReactionCreate> getSelectedReactionFromChips() {\n         List<AllergyReactionCreate> allergyReactionList = new ArrayList<>();\n \n-        for (int j = 0; j < patientAllergyBinding.chipGroup.getChildCount(); j++) {\n-            Chip chip = (Chip) patientAllergyBinding.chipGroup.getChildAt(j);\n+        for (int j = 0; j < binding.chipGroup.getChildCount(); j++) {\n+            Chip chip = (Chip) binding.chipGroup.getChildAt(j);\n             String uuid = null;\n             for (int i = 0; i < reactionList.size(); i++) {\n                 if (reactionList.get(i).getDisplay().equals(chip.getText().toString())) {\n@@ -355,4 +354,10 @@ private void createReactionChip(String selectedReaction) {\n         }\n         return allergyReactionList;\n     }\n+    \n+    @Override\n+    public void onDestroyView() {\n+        super.onDestroyView();\n+        binding = null;\n+    }\n }"
  }
]
