[
  {
    "sha": "d241d6d0140a713144589573dfbeb965e2d1d35d",
    "filename": "AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java",
    "status": "modified",
    "additions": 24,
    "deletions": 0,
    "changes": 24,
    "blob_url": "https://github.com/ankidroid/Anki-Android/blob/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java",
    "raw_url": "https://github.com/ankidroid/Anki-Android/raw/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java",
    "contents_url": "https://api.github.com/repos/ankidroid/Anki-Android/contents/AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java?ref=56aa0130f4308341f22fe27624668e4c7e398861",
    "patch": "@@ -359,6 +359,30 @@ public static boolean isEnabled() {\n \n     public static class Category {\n         public static final String SYNC = \"Sync\";\n+        public static final String LINK_CLICKED = \"LinkClicked\";\n+\n+        /* These Strings must not be changed as they are used for analytic comparisons between AnkiDroid versions */\n+        public static final String OPENED_HELPDIALOG = \"Opened HelpDialogBox\";\n+        public static final String OPENED_USING_ANKIDROID = \"Opened Using AnkiDroid\";\n+        public static final String OPENED_GET_HELP = \"Opened Get Help\";\n+        public static final String OPENED_SUPPORT_ANKIDROID = \"Opened Support AnkiDroid\";\n+        public static final String OPENED_COMMUNITY = \"Opened Community\";\n+        public static final String OPENED_ANKIDROID_MANUAL = \"Opened AnkiDroid Manual\";\n+        public static final String OPENED_ANKI_MANUAL = \"Opened Anki Manual\";\n+        public static final String OPENED_ANKIDROID_FAQ = \"Opened AnkiDroid FAQ\";\n+        public static final String OPENED_MAILING_LIST = \"Opened Mailing List\";\n+        public static final String OPENED_REPORT_BUG = \"Opened Report a Bug\";\n+        public static final String OPENED_DONATE = \"Opened Donate\";\n+        public static final String OPENED_TRANSLATE = \"Opened Translate\";\n+        public static final String OPENED_DEVELOP = \"Opened Develop\";\n+        public static final String OPENED_RATE = \"Opened Rate\";\n+        public static final String OPENED_OTHER = \"Opened Other\";\n+        public static final String OPENED_SEND_FEEDBACK = \"Opened Send Feedback\";\n+        public static final String OPENED_ANKI_FORUMS = \"Opened Anki Forums\";\n+        public static final String OPENED_REDDIT = \"Opened Reddit\";\n+        public static final String OPENED_DISCORD = \"Opened Discord\";\n+        public static final String OPENED_FACEBOOK = \"Opened Facebook\";\n+        public static final String OPENED_TWITTER = \"Opened Twitter\";\n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.NONE) // TOOD: Make this package-protected"
  },
  {
    "sha": "572dd90c2213941853b8aac7b3b214c95b24a679",
    "filename": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/HelpDialog.java",
    "status": "modified",
    "additions": 54,
    "deletions": 32,
    "changes": 86,
    "blob_url": "https://github.com/ankidroid/Anki-Android/blob/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/HelpDialog.java",
    "raw_url": "https://github.com/ankidroid/Anki-Android/raw/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/HelpDialog.java",
    "contents_url": "https://api.github.com/repos/ankidroid/Anki-Android/contents/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/HelpDialog.java?ref=56aa0130f4308341f22fe27624668e4c7e398861",
    "patch": "@@ -24,6 +24,7 @@\n import com.ichi2.anki.AnkiActivity;\n import com.ichi2.anki.AnkiDroidApp;\n import com.ichi2.anki.R;\n+import com.ichi2.anki.analytics.UsageAnalytics;\n import com.ichi2.anki.dialogs.RecursivePictureMenu.Item;\n import com.ichi2.anki.dialogs.RecursivePictureMenu.ItemHeader;\n import com.ichi2.utils.IntentUtil;\n@@ -48,32 +49,33 @@ private static void openFeedback(AnkiActivity ankiActivity) {\n \n     public static DialogFragment createInstance(Context context) {\n \n-        RateAppItem rateAppItem = new RateAppItem(R.string.help_item_support_rate_ankidroid, R.drawable.ic_star_black_24);\n+        UsageAnalytics.sendAnalyticsEvent(UsageAnalytics.Category.LINK_CLICKED, UsageAnalytics.Category.OPENED_HELPDIALOG);\n+        RateAppItem rateAppItem = new RateAppItem(R.string.help_item_support_rate_ankidroid, R.drawable.ic_star_black_24, UsageAnalytics.Category.OPENED_RATE);\n         Item[] allItems = {\n-                new ItemHeader(R.string.help_title_using_ankidroid, R.drawable.ic_manual_black_24dp,\n-                        new FunctionItem(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, HelpDialog::openManual),\n-                        new LinkItem(R.string.help_item_anki_manual, R.drawable.ic_manual_black_24dp, R.string.link_anki_manual),\n-                        new LinkItem(R.string.help_item_ankidroid_faq, R.drawable.ic_help_black_24dp, R.string.link_ankidroid_faq)\n+                new ItemHeader(R.string.help_title_using_ankidroid, R.drawable.ic_manual_black_24dp, UsageAnalytics.Category.OPENED_USING_ANKIDROID,\n+                        new FunctionItem(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, UsageAnalytics.Category.OPENED_ANKIDROID_MANUAL, HelpDialog::openManual),\n+                        new LinkItem(R.string.help_item_anki_manual, R.drawable.ic_manual_black_24dp, UsageAnalytics.Category.OPENED_ANKI_MANUAL, R.string.link_anki_manual),\n+                        new LinkItem(R.string.help_item_ankidroid_faq, R.drawable.ic_help_black_24dp, UsageAnalytics.Category.OPENED_ANKIDROID_FAQ, R.string.link_ankidroid_faq)\n                 ),\n-                new ItemHeader(R.string.help_title_get_help, R.drawable.ic_help_black_24dp,\n-                        new LinkItem(R.string.help_item_mailing_list, R.drawable.ic_email_black_24dp, R.string.link_forum),\n-                        new FunctionItem(R.string.help_item_report_bug, R.drawable.ic_bug_report_black_24dp, HelpDialog::openFeedback)\n+                new ItemHeader(R.string.help_title_get_help, R.drawable.ic_help_black_24dp, UsageAnalytics.Category.OPENED_GET_HELP,\n+                        new LinkItem(R.string.help_item_mailing_list, R.drawable.ic_email_black_24dp, UsageAnalytics.Category.OPENED_MAILING_LIST, R.string.link_forum),\n+                        new FunctionItem(R.string.help_item_report_bug, R.drawable.ic_bug_report_black_24dp, UsageAnalytics.Category.OPENED_REPORT_BUG, HelpDialog::openFeedback)\n                 ),\n-                new ItemHeader(R.string.help_title_support_ankidroid, R.drawable.ic_heart_black_24dp,\n-                        new LinkItem(R.string.help_item_support_opencollective_donate, R.drawable.ic_donate_black_24dp, R.string.link_opencollective_donate),\n-                        new LinkItem(R.string.multimedia_editor_trans_translate, R.drawable.ic_language_black_24dp, R.string.link_translation),\n-                        new LinkItem(R.string.help_item_support_develop_ankidroid, R.drawable.ic_build_black_24, R.string.link_ankidroid_development_guide),\n+                new ItemHeader(R.string.help_title_support_ankidroid, R.drawable.ic_heart_black_24dp, UsageAnalytics.Category.OPENED_SUPPORT_ANKIDROID,\n+                        new LinkItem(R.string.help_item_support_opencollective_donate, R.drawable.ic_donate_black_24dp, UsageAnalytics.Category.OPENED_DONATE, R.string.link_opencollective_donate),\n+                        new LinkItem(R.string.multimedia_editor_trans_translate, R.drawable.ic_language_black_24dp, UsageAnalytics.Category.OPENED_TRANSLATE, R.string.link_translation),\n+                        new LinkItem(R.string.help_item_support_develop_ankidroid, R.drawable.ic_build_black_24, UsageAnalytics.Category.OPENED_DEVELOP, R.string.link_ankidroid_development_guide),\n                         rateAppItem,\n-                        new LinkItem(R.string.help_item_support_other_ankidroid, R.drawable.ic_help_black_24dp, R.string.link_contribution),\n-                        new FunctionItem(R.string.send_feedback, R.drawable.ic_email_black_24dp, HelpDialog::openFeedback)\n+                        new LinkItem(R.string.help_item_support_other_ankidroid, R.drawable.ic_help_black_24dp, UsageAnalytics.Category.OPENED_OTHER, R.string.link_contribution),\n+                        new FunctionItem(R.string.send_feedback, R.drawable.ic_email_black_24dp, UsageAnalytics.Category.OPENED_SEND_FEEDBACK, HelpDialog::openFeedback)\n                 ),\n-                new ItemHeader(R.string.help_title_community, R.drawable.ic_people_black_24dp,\n-                        new LinkItem(R.string.help_item_anki_forums, R.drawable.ic_forum_black_24dp, R.string.link_anki_forum),\n-                        new LinkItem(R.string.help_item_reddit, R.drawable.ic_mail_outline_black_24dp, R.string.link_reddit),\n-                        new LinkItem(R.string.help_item_mailing_list, R.drawable.ic_email_black_24dp, R.string.link_forum),\n-                        new LinkItem(R.string.help_item_discord, R.drawable.ic_message_black_24dp, R.string.link_discord),\n-                        new LinkItem(R.string.help_item_facebook, R.drawable.ic_link_black_24dp, R.string.link_facebook),\n-                        new LinkItem(R.string.help_item_twitter, R.drawable.ic_link_black_24dp, R.string.link_twitter)\n+                new ItemHeader(R.string.help_title_community, R.drawable.ic_people_black_24dp, UsageAnalytics.Category.OPENED_COMMUNITY,\n+                        new LinkItem(R.string.help_item_anki_forums, R.drawable.ic_forum_black_24dp, UsageAnalytics.Category.OPENED_ANKI_FORUMS, R.string.link_anki_forum),\n+                        new LinkItem(R.string.help_item_reddit, R.drawable.ic_mail_outline_black_24dp, UsageAnalytics.Category.OPENED_REDDIT, R.string.link_reddit),\n+                        new LinkItem(R.string.help_item_mailing_list, R.drawable.ic_email_black_24dp, UsageAnalytics.Category.OPENED_MAILING_LIST, R.string.link_forum),\n+                        new LinkItem(R.string.help_item_discord, R.drawable.ic_message_black_24dp, UsageAnalytics.Category.OPENED_DISCORD, R.string.link_discord),\n+                        new LinkItem(R.string.help_item_facebook, R.drawable.ic_link_black_24dp, UsageAnalytics.Category.OPENED_FACEBOOK, R.string.link_facebook),\n+                        new LinkItem(R.string.help_item_twitter, R.drawable.ic_link_black_24dp, UsageAnalytics.Category.OPENED_TWITTER, R.string.link_twitter)\n                 ),\n         };\n \n@@ -88,22 +90,29 @@ public static DialogFragment createInstance(Context context) {\n \n     public static class RateAppItem extends Item implements Parcelable {\n \n-        public RateAppItem(@StringRes int titleRes, @DrawableRes int iconRes) {\n-            super(titleRes, iconRes);\n+        public RateAppItem(@StringRes int titleRes, @DrawableRes int iconRes, String analyticsRes) {\n+            super(titleRes, iconRes, analyticsRes);\n         }\n \n         @Override\n-        public void execute(AnkiActivity activity) {\n+        protected void onClicked(AnkiActivity activity) {\n             IntentUtil.tryOpenIntent(activity, AnkiDroidApp.getMarketIntent(activity));\n         }\n \n+        /*This method calls onClicked method to handle click event in a suitable manner and\n+        * the analytics of the item clicked are send.\n+        */\n+        @Override\n+        public void execute(AnkiActivity activity) {\n+            sendAnalytics();\n+            onClicked(activity);\n+        }\n \n         @Override\n         public void remove(Item toRemove) {\n             // intentionally blank - no children\n         }\n \n-\n         protected RateAppItem(Parcel in) {\n             super(in);\n         }\n@@ -123,19 +132,26 @@ public RateAppItem createFromParcel(Parcel in) {\n     }\n \n     public static class LinkItem extends Item implements Parcelable {\n-        private final @StringRes int mUrlLocationRes;\n+        @StringRes\n+        private final int mUrlLocationRes;\n \n-        public LinkItem(@StringRes int titleRes, @DrawableRes int iconRes, @StringRes int urlLocation) {\n-            super(titleRes, iconRes);\n+        public LinkItem(@StringRes int titleRes, @DrawableRes int iconRes, String analyticsRes, @StringRes int urlLocation) {\n+            super(titleRes, iconRes, analyticsRes);\n \n             this.mUrlLocationRes = urlLocation;\n         }\n \n         @Override\n-        public void execute(AnkiActivity activity) {\n+        protected void onClicked(AnkiActivity activity) {\n             activity.openUrl(getUrl(activity));\n         }\n \n+        @Override\n+        public void execute(AnkiActivity activity) {\n+            sendAnalytics();\n+            onClicked(activity);\n+        }\n+\n         protected Uri getUrl(Context ctx) {\n             return Uri.parse(ctx.getString(mUrlLocationRes));\n         }\n@@ -173,16 +189,22 @@ public LinkItem createFromParcel(Parcel in) {\n     public static class FunctionItem extends Item implements Parcelable {\n         private final ActivityConsumer mFunc;\n \n-        public FunctionItem(@StringRes int titleRes, @DrawableRes int iconRes, ActivityConsumer func) {\n-            super(titleRes, iconRes);\n+        public FunctionItem(@StringRes int titleRes, @DrawableRes int iconRes, String analyticsRes, ActivityConsumer func) {\n+            super(titleRes, iconRes, analyticsRes);\n             this.mFunc = func;\n         }\n \n         @Override\n-        public void execute(AnkiActivity activity)  {\n+        protected void onClicked(AnkiActivity activity) {\n             mFunc.consume(activity);\n         }\n \n+        @Override\n+        public void execute(AnkiActivity activity) {\n+            sendAnalytics();\n+            onClicked(activity);\n+        }\n+\n         protected FunctionItem(Parcel in) {\n             super(in);\n             mFunc = (ActivityConsumer) in.readSerializable();"
  },
  {
    "sha": "e0cd4657b4db6630222c60e8414b57b273fda73e",
    "filename": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/RecursivePictureMenu.java",
    "status": "modified",
    "additions": 25,
    "deletions": 10,
    "changes": 35,
    "blob_url": "https://github.com/ankidroid/Anki-Android/blob/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/RecursivePictureMenu.java",
    "raw_url": "https://github.com/ankidroid/Anki-Android/raw/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/RecursivePictureMenu.java",
    "contents_url": "https://api.github.com/repos/ankidroid/Anki-Android/contents/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/RecursivePictureMenu.java?ref=56aa0130f4308341f22fe27624668e4c7e398861",
    "patch": "@@ -17,6 +17,7 @@\n package com.ichi2.anki.dialogs;\n \n import android.app.Dialog;\n+import android.content.Context;\n import android.graphics.drawable.Drawable;\n import android.os.Bundle;\n import android.os.Parcel;\n@@ -28,6 +29,7 @@\n import com.afollestad.materialdialogs.MaterialDialog;\n import com.ichi2.anki.AnkiActivity;\n import com.ichi2.anki.R;\n+import com.ichi2.anki.analytics.UsageAnalytics;\n \n import java.util.ArrayList;\n import java.util.Arrays;\n@@ -142,12 +144,16 @@ protected void setMenuBreadcrumbHeader(MaterialDialog dialog) {\n \n     public abstract static class Item implements Parcelable {\n \n-        private final @StringRes int mText;\n-        private final @DrawableRes int mIcon;\n+        @StringRes\n+        private final int mText;\n+        @DrawableRes\n+        private final int mIcon;\n+        private final String analyticsId;\n \n-        public Item(@StringRes int titleString, @DrawableRes int iconDrawable) {\n+        public Item(@StringRes int titleString, @DrawableRes int iconDrawable, String analyticsId) {\n             this.mText = titleString;\n             this.mIcon = iconDrawable;\n+            this.analyticsId = analyticsId;\n         }\n \n         public List<Item> getChildren() {\n@@ -157,6 +163,7 @@ public Item(@StringRes int titleString, @DrawableRes int iconDrawable) {\n         protected Item(Parcel in) {\n             mText = in.readInt();\n             mIcon = in.readInt();\n+            analyticsId = in.readString();\n         }\n \n         @StringRes\n@@ -173,6 +180,13 @@ public int describeContents() {\n         public void writeToParcel(Parcel dest, int flags) {\n             dest.writeInt(mText);\n             dest.writeInt(mIcon);\n+            dest.writeString(analyticsId);\n+        }\n+\n+        protected abstract void onClicked(AnkiActivity activity);\n+\n+        public final void sendAnalytics() {\n+            UsageAnalytics.sendAnalyticsEvent(UsageAnalytics.Category.LINK_CLICKED, analyticsId);\n         }\n \n         public abstract void execute(AnkiActivity activity);\n@@ -184,26 +198,28 @@ public void writeToParcel(Parcel dest, int flags) {\n \n         private final List<Item> mChildren;\n \n-\n-        public ItemHeader(@StringRes int titleString, int i, Item... children) {\n-            super(titleString, i);\n+        public ItemHeader(@StringRes int titleString, int i, String analyticsStringId, Item... children) {\n+            super(titleString, i, analyticsStringId);\n             mChildren = new ArrayList<>(Arrays.asList(children));\n         }\n \n-\n         @Override\n         public List<Item> getChildren() {\n             return new ArrayList<>(mChildren);\n         }\n \n-\n         @Override\n-        public void execute(AnkiActivity activity) {\n+        public void onClicked(AnkiActivity activity) {\n             ArrayList<Item> children = new ArrayList<>(this.getChildren());\n             DialogFragment nextFragment = RecursivePictureMenu.createInstance(children, getTitle());\n             activity.showDialogFragment(nextFragment);\n         }\n \n+        @Override\n+        public void execute(AnkiActivity activity) {\n+            sendAnalytics();\n+            onClicked(activity);\n+        }\n \n         @Override\n         public void remove(Item toRemove) {\n@@ -213,7 +229,6 @@ public void remove(Item toRemove) {\n             }\n         }\n \n-\n         protected ItemHeader(Parcel in) {\n             super(in);\n             if (in.readByte() == 0x01) {"
  },
  {
    "sha": "ae781456012aec961aa7138394324865ad833b06",
    "filename": "AnkiDroid/src/test/java/com/ichi2/anki/dialogs/RecursivePictureMenuTest.java",
    "status": "modified",
    "additions": 3,
    "deletions": 2,
    "changes": 5,
    "blob_url": "https://github.com/ankidroid/Anki-Android/blob/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/RecursivePictureMenuTest.java",
    "raw_url": "https://github.com/ankidroid/Anki-Android/raw/56aa0130f4308341f22fe27624668e4c7e398861/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/RecursivePictureMenuTest.java",
    "contents_url": "https://api.github.com/repos/ankidroid/Anki-Android/contents/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/RecursivePictureMenuTest.java?ref=56aa0130f4308341f22fe27624668e4c7e398861",
    "patch": "@@ -20,6 +20,7 @@\n \n import com.ichi2.anki.R;\n import com.ichi2.anki.RobolectricTest;\n+import com.ichi2.anki.analytics.UsageAnalytics;\n import com.ichi2.anki.dialogs.HelpDialog.LinkItem;\n import com.ichi2.anki.dialogs.RecursivePictureMenu.Item;\n import com.ichi2.anki.dialogs.RecursivePictureMenu.ItemHeader;\n@@ -124,7 +125,7 @@ protected void clickChildAtIndex(RecyclerView v, @SuppressWarnings(\"SameParamete\n     }\n \n     private Item getItemLinkingTo(int linkLocation) {\n-        return new LinkItem(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, linkLocation);\n+        return new LinkItem(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, UsageAnalytics.Category.OPENED_ANKIDROID_MANUAL, linkLocation);\n     }\n \n \n@@ -135,6 +136,6 @@ private ItemHeader getHeaderWithSubItems(int count) {\n             items[i] = getItemLinkingTo(R.string.link_anki);\n         }\n \n-        return new ItemHeader(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, items);\n+        return new ItemHeader(R.string.help_item_ankidroid_manual, R.drawable.ic_manual_black_24dp, UsageAnalytics.Category.OPENED_ANKIDROID_MANUAL, items);\n     }\n }"
  }
]
