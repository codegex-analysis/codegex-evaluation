[
  {
    "sha": "203c9374669438238606ade2a706a715717cb0d9",
    "filename": "native-tests/pom.xml",
    "status": "added",
    "additions": 93,
    "deletions": 0,
    "changes": 93,
    "blob_url": "https://github.com/neo4j/neo4j-java-driver/blob/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/pom.xml",
    "raw_url": "https://github.com/neo4j/neo4j-java-driver/raw/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/pom.xml",
    "contents_url": "https://api.github.com/repos/neo4j/neo4j-java-driver/contents/native-tests/pom.xml?ref=e20a04d50c8e37921d53f0ff5f7f9e12533efd2f",
    "patch": "@@ -0,0 +1,93 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>neo4j-java-driver-parent</artifactId>\n+        <groupId>org.neo4j.driver</groupId>\n+        <version>4.2-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>native-tests</artifactId>\n+\n+    <properties>\n+        <rootDir>${project.basedir}/..</rootDir>\n+        <java.version>11</java.version>\n+        <native-image-maven-plugin.version>20.3.0</native-image-maven-plugin.version>\n+    </properties>\n+\n+    <name>Neo4j Java Driver (Native Tests)</name>\n+    <description>Ensures that the Java Driver can be compiled and used natively.</description>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.neo4j.driver</groupId>\n+            <artifactId>neo4j-java-driver</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+    </dependencies>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.graalvm.nativeimage</groupId>\n+                <artifactId>native-image-maven-plugin</artifactId>\n+                <version>${native-image-maven-plugin.version}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>package</phase>\n+                        <goals>\n+                            <goal>native-image</goal>\n+                        </goals>\n+                        <configuration>\n+                            <mainClass>org.neo4j.driver.Application</mainClass>\n+                            <imageName>application</imageName>\n+                            <buildArgs>--no-fallback -H:+ReportExceptionStackTraces --allow-incomplete-classpath --enable-all-security-services -H:+JNI</buildArgs>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-jar-plugin</artifactId>\n+                <configuration>\n+                    <skipIfEmpty>true</skipIfEmpty>\n+                </configuration>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-install-plugin</artifactId>\n+                <configuration>\n+                    <skip>true</skip>\n+                </configuration>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-deploy-plugin</artifactId>\n+                <configuration>\n+                    <skip>true</skip>\n+                </configuration>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-failsafe-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <goals>\n+                            <goal>integration-test</goal>\n+                            <goal>verify</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+        </plugins>\n+    </build>\n+</project>"
  },
  {
    "sha": "af5f7fb5d9850199ba1a8d030b40a8e94427f641",
    "filename": "native-tests/src/main/java/org/neo4j/driver/Application.java",
    "status": "added",
    "additions": 42,
    "deletions": 0,
    "changes": 42,
    "blob_url": "https://github.com/neo4j/neo4j-java-driver/blob/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/src/main/java/org/neo4j/driver/Application.java",
    "raw_url": "https://github.com/neo4j/neo4j-java-driver/raw/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/src/main/java/org/neo4j/driver/Application.java",
    "contents_url": "https://api.github.com/repos/neo4j/neo4j-java-driver/contents/native-tests/src/main/java/org/neo4j/driver/Application.java?ref=e20a04d50c8e37921d53f0ff5f7f9e12533efd2f",
    "patch": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright (c) \"Neo4j\"\n+ * Neo4j Sweden AB [http://neo4j.com]\n+ *\n+ * This file is part of Neo4j.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.neo4j.driver;\n+\n+public class Application {\n+\n+    public static void main( String[] args )\n+    {\n+        String serverAddress = System.getenv( \"NATIVE_IMAGE_NEO4J_URL\" );\n+        String serverPass = System.getenv( \"NATIVE_IMAGE_NEO4J_PASS\" );\n+        String uri = serverAddress +\":7687\";\n+        AuthToken auth = AuthTokens.basic( \"neo4j\", serverPass );\n+        Config config = Config.builder().build();\n+\n+        try ( Driver driver = GraphDatabase.driver( uri, auth, config ) )\n+        {\n+            try ( Session session = driver.session() )\n+            {\n+                session.run( \"RETURN 1 as i, true as b, \\\"string\\\" as s\" )\n+                       .next()\n+                       .asMap()\n+                       .forEach( (k,v) -> System.out.println( v ) );\n+            }\n+        }\n+    }\n+}"
  },
  {
    "sha": "ad9ca1a92895d9eef60f2fa72ea963e0f54d6aa1",
    "filename": "native-tests/src/test/java/org/neo4j/driver/NativeApplicationIT.java",
    "status": "added",
    "additions": 70,
    "deletions": 0,
    "changes": 70,
    "blob_url": "https://github.com/neo4j/neo4j-java-driver/blob/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/src/test/java/org/neo4j/driver/NativeApplicationIT.java",
    "raw_url": "https://github.com/neo4j/neo4j-java-driver/raw/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/native-tests/src/test/java/org/neo4j/driver/NativeApplicationIT.java",
    "contents_url": "https://api.github.com/repos/neo4j/neo4j-java-driver/contents/native-tests/src/test/java/org/neo4j/driver/NativeApplicationIT.java?ref=e20a04d50c8e37921d53f0ff5f7f9e12533efd2f",
    "patch": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright (c) \"Neo4j\"\n+ * Neo4j Sweden AB [http://neo4j.com]\n+ *\n+ * This file is part of Neo4j.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.neo4j.driver;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+public class NativeApplicationIT\n+{\n+\n+    @Test\n+    public void f() throws IOException\n+    {\n+        List<String> values = new ArrayList<>();\n+        values.add( \"1\" );\n+        values.add( \"true\" );\n+        values.add( \"string\" );\n+\n+        Process p = new ProcessBuilder( Paths.get( \".\", \"target\", \"application\" ).toAbsolutePath().normalize().toString() )\n+                .start();\n+\n+        try ( BufferedReader in = new BufferedReader( new InputStreamReader( p.getInputStream() ) ) )\n+        {\n+            Set<String> generatedValues = in.lines().collect( Collectors.toSet() );\n+\n+            System.out.println( \"Native Program Output:\" );\n+            System.out.println( generatedValues );\n+\n+            Assertions.assertTrue( generatedValues.containsAll( values ) );\n+        } catch ( Throwable t )\n+        {\n+            //dump log output for debugging\n+            try ( BufferedReader in = new BufferedReader( new InputStreamReader( p.getErrorStream() ) ) )\n+            {\n+                Set<String> errorOutput = in.lines().collect( Collectors.toSet() );\n+\n+                System.out.println( \"Native Program Error Output:\" );\n+                errorOutput.forEach( System.out::println );\n+                fail();\n+            }\n+        }\n+    }\n+}"
  },
  {
    "sha": "42bd20ff70ccddf72888e64d4a93dd2c9a8ad2f7",
    "filename": "pom.xml",
    "status": "modified",
    "additions": 8,
    "deletions": 0,
    "changes": 8,
    "blob_url": "https://github.com/neo4j/neo4j-java-driver/blob/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/pom.xml",
    "raw_url": "https://github.com/neo4j/neo4j-java-driver/raw/e20a04d50c8e37921d53f0ff5f7f9e12533efd2f/pom.xml",
    "contents_url": "https://api.github.com/repos/neo4j/neo4j-java-driver/contents/pom.xml?ref=e20a04d50c8e37921d53f0ff5f7f9e12533efd2f",
    "patch": "@@ -203,6 +203,14 @@\n         <parallelizable.it.forkCount>1</parallelizable.it.forkCount>\n       </properties>\n     </profile>\n+\n+    <!-- Only run the native test setup explicitly -->\n+    <profile>\n+      <id>run-native-test</id>\n+      <modules>\n+        <module>native-tests</module>\n+      </modules>\n+    </profile>\n   </profiles>\n \n   <build>"
  }
]
