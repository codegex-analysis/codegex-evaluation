[
  {
    "sha": "688b7f154d06bdd4f72b1f045e4e408ad1a037a3",
    "filename": "Chat.db",
    "status": "added",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/Chat.db",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/Chat.db",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/Chat.db?ref=25330867d166c864c2c71a72263525121247c94f"
  },
  {
    "sha": "14869ce6d31f872d17ba90b3f524566e2f07b273",
    "filename": "client/src/main/java/sample/Controller.java",
    "status": "modified",
    "additions": 6,
    "deletions": 0,
    "changes": 6,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/client/src/main/java/sample/Controller.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/client/src/main/java/sample/Controller.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/client/src/main/java/sample/Controller.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -48,6 +48,7 @@\n     public HBox authPanel;\n     @FXML\n     public ListView<String> clientList;\n+    public MenuItem changeNick;\n \n     private Socket socket;\n     private final int PORT = 9999;\n@@ -100,6 +101,7 @@ private void connect() {\n             new Thread(() -> {\n                 try {\n                     while (true) {\n+\n                         String str = in.readUTF();\n                         if (str.startsWith(\"/\")) {\n                             if (str.equals(Command.END)) {\n@@ -257,4 +259,8 @@ public void registration(String login, String password, String nickName){\n             e.printStackTrace();\n         }\n     }\n+\n+    public void ChangeNick(ActionEvent actionEvent) {\n+        textField1.appendText(Command.CHNG_NICK + \" \" + nickname + \" to: \");\n+    }\n }"
  },
  {
    "sha": "ce36813c8fb4160afa1a561d44d49eaff66015f1",
    "filename": "client/src/main/java/sample/RegController.java",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/client/src/main/java/sample/RegController.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/client/src/main/java/sample/RegController.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/client/src/main/java/sample/RegController.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -33,7 +33,7 @@ public void setResultTryToReg(String comnand) {\n             textArea.appendText(\"Регистрация прошла успешно\\n\");\n         }\n         if (comnand.equals(Command.REG_NO)) {\n-            textArea.appendText(\"Логин или никнейм занят\\n\");\n+            textArea.appendText(\"Логин занят, просьба придумать другой\\n\");\n         }\n     }\n "
  },
  {
    "sha": "2713563dfe8d0c84546afd7f96a2c5fb1abb35f0",
    "filename": "client/src/main/resources/css/style.css",
    "status": "modified",
    "additions": 1,
    "deletions": 10,
    "changes": 11,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/client/src/main/resources/css/style.css",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/client/src/main/resources/css/style.css",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/client/src/main/resources/css/style.css?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -43,7 +43,7 @@\n     -fx-background-color: #5d8831;\n }\n \n-#menuFile, #menuItemExit {\n+#menuFile, #menuItemExit, #changeNick {\n     -fx-background-color: #97be6a;\n     -fx-border-color: black;\n     -fx-border-radius: 5;\n@@ -89,15 +89,6 @@\n     -fx-background-radius: 9;\n }\n \n-\n-\n-\n-\n-\n-\n-\n-\n-\n .list-view .content{\n     -fx-background-color: #d3e5bf;\n     -fx-background-radius: 9;"
  },
  {
    "sha": "6e73cde0bfb2a01af33d73e51d0c13d8cd6fa99b",
    "filename": "client/src/main/resources/sample.fxml",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/client/src/main/resources/sample.fxml",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/client/src/main/resources/sample.fxml",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/client/src/main/resources/sample.fxml?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -18,6 +18,7 @@\n             </cursor>\n             <Menu text=\"File\" fx:id=\"menuFile\">\n                 <MenuItem fx:id=\"menuItemExit\" onAction=\"#CloseWindow\" text=\"Close window\"/>\n+                <MenuItem fx:id=\"changeNick\" onAction=\"#ChangeNick\" text=\"Change nick name\"/>\n             </Menu>\n         </MenuBar>\n     </top>"
  },
  {
    "sha": "87b9df3056466eb6c2dfb282f8abf1623351ee79",
    "filename": "command/src/main/java/commands/Command.java",
    "status": "modified",
    "additions": 1,
    "deletions": 0,
    "changes": 1,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/command/src/main/java/commands/Command.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/command/src/main/java/commands/Command.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/command/src/main/java/commands/Command.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -9,4 +9,5 @@\n     public static final String REG = \"/reg\";\n     public static final String REG_OK = \"/regok\";\n     public static final String REG_NO = \"/regno\";\n+    public static final String CHNG_NICK = \"/changeNick\";\n }"
  },
  {
    "sha": "32e3bdfc1e0fa3cb0a041021ee7e06977d30ea5b",
    "filename": "server/pom.xml",
    "status": "modified",
    "additions": 7,
    "deletions": 0,
    "changes": 7,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/pom.xml",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/pom.xml",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/pom.xml?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -16,4 +16,11 @@\n         <maven.compiler.target>8</maven.compiler.target>\n     </properties>\n \n+    <dependencies>\n+        <dependency>\n+            <groupId>org.xerial</groupId>\n+            <artifactId>sqlite-jdbc</artifactId>\n+            <version>3.34.0</version>\n+        </dependency>\n+    </dependencies>\n </project>\n\\ No newline at end of file"
  },
  {
    "sha": "88c3f980b6015d3bbf8d5afdb4ce3422dcedfaaf",
    "filename": "server/src/main/java/server/AuthService.java",
    "status": "modified",
    "additions": 2,
    "deletions": 0,
    "changes": 2,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/AuthService.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/AuthService.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/AuthService.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -3,4 +3,6 @@\n public interface AuthService {\n     String getNicknameAndPassword(String login, String password);\n     boolean registration(String login, String password, String nickName);\n+    boolean changeNick(String oldNickName, String newNickName);\n+\n }"
  },
  {
    "sha": "799d9911c9626ade3d77cf1278cae6caf96580a0",
    "filename": "server/src/main/java/server/ClientHandler.java",
    "status": "modified",
    "additions": 10,
    "deletions": 0,
    "changes": 10,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/ClientHandler.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/ClientHandler.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/ClientHandler.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -69,12 +69,22 @@ public ClientHandler(Server server, Socket socket) {\n                                 sendMessage(Command.REG_OK);\n                             } else sendMessage(Command.REG_NO);\n                         }\n+\n                     }\n                     //цикл работы\n                     while (true) {\n                         socket.setSoTimeout(0);\n                         String str = in.readUTF();\n                         if (str.startsWith(\"/\")) {\n+                            //смена ника\n+                            if (str.startsWith(Command.CHNG_NICK)){\n+                                String[] token = str.split(\" \", 4);\n+                                Boolean result = server.getAuthService().changeNick(token[1], token[3]);\n+                                sendMessage(\"Никнейм изменен на \" + token[3]);\n+                                this.nickname = token[3];\n+                                server.broadcastClientList();\n+                            }\n+\n                             if (str.equals(Command.END)) {\n                                 System.out.println(\"Клиент отключен \" + socket.getRemoteSocketAddress());\n                                 out.writeUTF(Command.END);"
  },
  {
    "sha": "8453cad8ceed0c5da994e858f209cafc2ee6e874",
    "filename": "server/src/main/java/server/DBAuthService.java",
    "status": "added",
    "additions": 19,
    "deletions": 0,
    "changes": 19,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/DBAuthService.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/DBAuthService.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/DBAuthService.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -0,0 +1,19 @@\n+package server;\n+\n+public class DBAuthService implements AuthService {\n+    @Override\n+    public String getNicknameAndPassword(String login, String password) {\n+\n+        return SQLHandler.getNicknameAndPassword(login, password);\n+    }\n+\n+    @Override\n+    public boolean registration(String login, String password, String nickName) {\n+        return SQLHandler.registration(login, password, nickName);\n+    }\n+\n+    @Override\n+    public boolean changeNick(String oldNickName, String newNickName) {\n+        return SQLHandler.changeNick(oldNickName, newNickName);\n+    }\n+}"
  },
  {
    "sha": "cab9b83cece6295ddc715532ca86ebbd5cce32ef",
    "filename": "server/src/main/java/server/SQLHandler.java",
    "status": "added",
    "additions": 83,
    "deletions": 0,
    "changes": 83,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/SQLHandler.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/SQLHandler.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/SQLHandler.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -0,0 +1,83 @@\n+package server;\n+\n+import java.sql.*;\n+\n+public class SQLHandler {\n+    private static Connection connection;\n+    private static PreparedStatement psChangeNick;\n+    private static PreparedStatement psRegistration;\n+    private static PreparedStatement psGetNickname;\n+\n+    public static boolean connect() {\n+        try {\n+            Class.forName(\"org.sqlite.JDBC\");\n+            connection = DriverManager.getConnection(\"jdbc:sqlite:Chat.db\");\n+            return true;\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            return false;\n+        }\n+    }\n+\n+    public static void disconnect() {\n+        try {\n+            connection.close();\n+        } catch (SQLException throwables) {\n+            throwables.printStackTrace();\n+        }\n+    }\n+\n+    public static String getNicknameAndPassword(String login, String password) {\n+        String nick = null;\n+        try {\n+            psGetNickname = connection.prepareStatement(\"select nickname FROM users WHERE login = ? AND password = ?;\");\n+            psGetNickname.setString(1, login);\n+            psGetNickname.setString(2, password);\n+            ResultSet rs = psGetNickname.executeQuery();\n+            if (rs.next()) {\n+                nick = rs.getString(1);\n+            }\n+            rs.close();\n+        } catch (SQLException throwables) {\n+            throwables.printStackTrace();\n+        }\n+        return nick;\n+    }\n+\n+    public static boolean registration(String login, String password, String nickName) {\n+        try {\n+            psGetNickname = connection.prepareStatement(\"select login FROM users WHERE login = ? AND password = ?;\");\n+            psGetNickname.setString(1, login);\n+            psGetNickname.setString(2, password);\n+            ResultSet rs = psGetNickname.executeQuery();\n+            if (rs.next()) {\n+                rs.close();\n+                return false;\n+            } else {\n+                rs.close();\n+                psRegistration = connection.prepareStatement(\"INSERT INTO users (login, nickname, password) VALUES (?, ?, ?)\");\n+                psRegistration.setString(1, login);\n+                psRegistration.setString(2, nickName);\n+                psRegistration.setString(3, password);\n+                psRegistration.executeUpdate();\n+                return true;\n+            }\n+        } catch (SQLException throwables) {\n+            throwables.printStackTrace();\n+            return false;\n+        }\n+    }\n+\n+    public static boolean changeNick(String oldNickName, String newNickName){\n+        try {\n+            psChangeNick = connection.prepareStatement(\"UPDATE users SET nickname = ? WHERE nickname = ?;\");\n+            psChangeNick.setString(1, newNickName);\n+            psChangeNick.setString(2,oldNickName);\n+            psChangeNick.executeUpdate();\n+            return true;\n+        } catch (SQLException throwables) {\n+            throwables.printStackTrace();\n+            return false;\n+        }\n+    }\n+}"
  },
  {
    "sha": "4bf09bad70bb382ac1014c84aaaccc5eaece42e4",
    "filename": "server/src/main/java/server/Server.java",
    "status": "modified",
    "additions": 6,
    "deletions": 1,
    "changes": 7,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/Server.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/Server.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/Server.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -19,7 +19,11 @@\n \n     public Server() {\n         clientHandlerList = new CopyOnWriteArrayList<>();\n-        authService = new SimpleAuthService();\n+        //authService = new SimpleAuthService();\n+        if (!SQLHandler.connect()){\n+            throw new RuntimeException(\"Не удалось подключиться\");\n+        }\n+        authService = new DBAuthService();\n         try {\n             server = new ServerSocket(PORT);\n             System.out.println(\"Сервер запущен\");\n@@ -34,6 +38,7 @@ public Server() {\n             e.printStackTrace();\n         } finally {\n             try {\n+                SQLHandler.disconnect();\n                 socket.close();\n                 server.close();\n             } catch (IOException e) {"
  },
  {
    "sha": "ea219398d4da78d5288abafecdc1501215205bc7",
    "filename": "server/src/main/java/server/SimpleAuthService.java",
    "status": "modified",
    "additions": 5,
    "deletions": 0,
    "changes": 5,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/SimpleAuthService.java",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/src/main/java/server/SimpleAuthService.java",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/src/main/java/server/SimpleAuthService.java?ref=25330867d166c864c2c71a72263525121247c94f",
    "patch": "@@ -47,4 +47,9 @@ public boolean registration(String login, String password, String nickName) {\n         users.add(new UserData(login, password, nickName));\n         return true;\n     }\n+\n+    @Override\n+    public boolean changeNick(String oldNickName, String newNickName) {\n+        return false;\n+    }\n }"
  },
  {
    "sha": "f39e7c1847bbfad037c3dfca9f425046261ff7d6",
    "filename": "server/target/classes/server/AuthService.class",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/AuthService.class",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/AuthService.class",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/target/classes/server/AuthService.class?ref=25330867d166c864c2c71a72263525121247c94f"
  },
  {
    "sha": "c0e20a343e8290659667bff6b668bc7e529475dc",
    "filename": "server/target/classes/server/DBAuthService.class",
    "status": "added",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/DBAuthService.class",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/DBAuthService.class",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/target/classes/server/DBAuthService.class?ref=25330867d166c864c2c71a72263525121247c94f"
  },
  {
    "sha": "c04547a8991426bdcc2e66fbb4f7de9725101c1c",
    "filename": "server/target/classes/server/SQLHandler.class",
    "status": "added",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/SQLHandler.class",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/SQLHandler.class",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/target/classes/server/SQLHandler.class?ref=25330867d166c864c2c71a72263525121247c94f"
  },
  {
    "sha": "44552a95512e5ffc671f40117777c0efb6615c2a",
    "filename": "server/target/classes/server/Server.class",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/Server.class",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/Server.class",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/target/classes/server/Server.class?ref=25330867d166c864c2c71a72263525121247c94f"
  },
  {
    "sha": "5696c229528af5685e8dd5122c688b8135cb747e",
    "filename": "server/target/classes/server/SimpleAuthService.class",
    "status": "modified",
    "additions": 0,
    "deletions": 0,
    "changes": 0,
    "blob_url": "https://github.com/BichevoyIgor/newJavaChat/blob/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/SimpleAuthService.class",
    "raw_url": "https://github.com/BichevoyIgor/newJavaChat/raw/25330867d166c864c2c71a72263525121247c94f/server/target/classes/server/SimpleAuthService.class",
    "contents_url": "https://api.github.com/repos/BichevoyIgor/newJavaChat/contents/server/target/classes/server/SimpleAuthService.class?ref=25330867d166c864c2c71a72263525121247c94f"
  }
]
